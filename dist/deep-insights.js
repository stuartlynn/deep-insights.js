!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.cartodb=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(b){!function(d){var e="object"==typeof self&&self.self==self&&self||"object"==typeof b&&b.global==b&&b;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(a,b,c){e.Backbone=d(e,c,a,b)});else if("undefined"!=typeof c){var f,g=a("underscore");try{f=a("jquery")}catch(h){}d(e,c,g,f)}else e.Backbone=d(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(function(a,b,c,d){var e=a.Backbone,f=Array.prototype.slice;b.VERSION="1.2.3",b.$=d,b.noConflict=function(){return a.Backbone=e,this},b.emulateHTTP=!1,b.emulateJSON=!1;var g=function(a,b,d){switch(a){case 1:return function(){return c[b](this[d])};case 2:return function(a){return c[b](this[d],a)};case 3:return function(a,e){return c[b](this[d],i(a,this),e)};case 4:return function(a,e,f){return c[b](this[d],i(a,this),e,f)};default:return function(){var a=f.call(arguments);return a.unshift(this[d]),c[b].apply(c,a)}}},h=function(a,b,d){c.each(b,function(b,e){c[e]&&(a.prototype[e]=g(b,e,d))})},i=function(a,b){return c.isFunction(a)?a:c.isObject(a)&&!b._isModel(a)?j(a):c.isString(a)?function(b){return b.get(a)}:a},j=function(a){var b=c.matches(a);return function(a){return b(a.attributes)}},k=b.Events={},l=/\s+/,m=function(a,b,d,e,f){var g,h=0;if(d&&"object"==typeof d){void 0!==e&&"context"in f&&void 0===f.context&&(f.context=e);for(g=c.keys(d);h<g.length;h++)b=m(a,b,g[h],d[g[h]],f)}else if(d&&l.test(d))for(g=d.split(l);h<g.length;h++)b=a(b,g[h],e,f);else b=a(b,d,e,f);return b};k.on=function(a,b,c){return n(this,a,b,c)};var n=function(a,b,c,d,e){if(a._events=m(o,a._events||{},b,c,{context:d,ctx:a,listening:e}),e){var f=a._listeners||(a._listeners={});f[e.id]=e}return a};k.listenTo=function(a,b,d){if(!a)return this;var e=a._listenId||(a._listenId=c.uniqueId("l")),f=this._listeningTo||(this._listeningTo={}),g=f[e];if(!g){var h=this._listenId||(this._listenId=c.uniqueId("l"));g=f[e]={obj:a,objId:e,id:h,listeningTo:f,count:0}}return n(a,b,d,this,g),this};var o=function(a,b,c,d){if(c){var e=a[b]||(a[b]=[]),f=d.context,g=d.ctx,h=d.listening;h&&h.count++,e.push({callback:c,context:f,ctx:f||g,listening:h})}return a};k.off=function(a,b,c){return this._events?(this._events=m(p,this._events,a,b,{context:c,listeners:this._listeners}),this):this},k.stopListening=function(a,b,d){var e=this._listeningTo;if(!e)return this;for(var f=a?[a._listenId]:c.keys(e),g=0;g<f.length;g++){var h=e[f[g]];if(!h)break;h.obj.off(b,d,this)}return c.isEmpty(e)&&(this._listeningTo=void 0),this};var p=function(a,b,d,e){if(a){var f,g=0,h=e.context,i=e.listeners;if(b||d||h){for(var j=b?[b]:c.keys(a);g<j.length;g++){b=j[g];var k=a[b];if(!k)break;for(var l=[],m=0;m<k.length;m++){var n=k[m];d&&d!==n.callback&&d!==n.callback._callback||h&&h!==n.context?l.push(n):(f=n.listening,f&&0===--f.count&&(delete i[f.id],delete f.listeningTo[f.objId]))}l.length?a[b]=l:delete a[b]}return c.size(a)?a:void 0}for(var o=c.keys(i);g<o.length;g++)f=i[o[g]],delete i[f.id],delete f.listeningTo[f.objId]}};k.once=function(a,b,d){var e=m(q,{},a,b,c.bind(this.off,this));return this.on(e,void 0,d)},k.listenToOnce=function(a,b,d){var e=m(q,{},b,d,c.bind(this.stopListening,this,a));return this.listenTo(a,e)};var q=function(a,b,d,e){if(d){var f=a[b]=c.once(function(){e(b,f),d.apply(this,arguments)});f._callback=d}return a};k.trigger=function(a){if(!this._events)return this;for(var b=Math.max(0,arguments.length-1),c=Array(b),d=0;b>d;d++)c[d]=arguments[d+1];return m(r,this._events,a,void 0,c),this};var r=function(a,b,c,d){if(a){var e=a[b],f=a.all;e&&f&&(f=f.slice()),e&&s(e,d),f&&s(f,[b].concat(d))}return a},s=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}};k.bind=k.on,k.unbind=k.off,c.extend(b,k);var t=b.Model=function(a,b){var d=a||{};b||(b={}),this.cid=c.uniqueId(this.cidPrefix),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{}),d=c.defaults({},d,c.result(this,"defaults")),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)};c.extend(t.prototype,k,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(a){return c.clone(this.attributes)},sync:function(){return b.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return c.escape(this.get(a))},has:function(a){return null!=this.get(a)},matches:function(a){return!!c.iteratee(a,this)(this.attributes)},set:function(a,b,d){if(null==a)return this;var e;if("object"==typeof a?(e=a,d=b):(e={})[a]=b,d||(d={}),!this._validate(e,d))return!1;var f=d.unset,g=d.silent,h=[],i=this._changing;this._changing=!0,i||(this._previousAttributes=c.clone(this.attributes),this.changed={});var j=this.attributes,k=this.changed,l=this._previousAttributes;for(var m in e)b=e[m],c.isEqual(j[m],b)||h.push(m),c.isEqual(l[m],b)?delete k[m]:k[m]=b,f?delete j[m]:j[m]=b;if(this.id=this.get(this.idAttribute),!g){h.length&&(this._pending=d);for(var n=0;n<h.length;n++)this.trigger("change:"+h[n],this,j[h[n]],d)}if(i)return this;if(!g)for(;this._pending;)d=this._pending,this._pending=!1,this.trigger("change",this,d);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,c.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var d in this.attributes)b[d]=void 0;return this.set(b,c.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!c.isEmpty(this.changed):c.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?c.clone(this.changed):!1;var b=this._changing?this._previousAttributes:this.attributes,d={};for(var e in a){var f=a[e];c.isEqual(b[e],f)||(d[e]=f)}return c.size(d)?d:!1},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return c.clone(this._previousAttributes)},fetch:function(a){a=c.extend({parse:!0},a);var b=this,d=a.success;return a.success=function(c){var e=a.parse?b.parse(c,a):c;return b.set(e,a)?(d&&d.call(a.context,b,c,a),void b.trigger("sync",b,c,a)):!1},P(this,a),this.sync("read",this,a)},save:function(a,b,d){var e;null==a||"object"==typeof a?(e=a,d=b):(e={})[a]=b,d=c.extend({validate:!0,parse:!0},d);var f=d.wait;if(e&&!f){if(!this.set(e,d))return!1}else if(!this._validate(e,d))return!1;var g=this,h=d.success,i=this.attributes;d.success=function(a){g.attributes=i;var b=d.parse?g.parse(a,d):a;return f&&(b=c.extend({},e,b)),b&&!g.set(b,d)?!1:(h&&h.call(d.context,g,a,d),void g.trigger("sync",g,a,d))},P(this,d),e&&f&&(this.attributes=c.extend({},i,e));var j=this.isNew()?"create":d.patch?"patch":"update";"patch"!==j||d.attrs||(d.attrs=e);var k=this.sync(j,this,d);return this.attributes=i,k},destroy:function(a){a=a?c.clone(a):{};var b=this,d=a.success,e=a.wait,f=function(){b.stopListening(),b.trigger("destroy",b,b.collection,a)};a.success=function(c){e&&f(),d&&d.call(a.context,b,c,a),b.isNew()||b.trigger("sync",b,c,a)};var g=!1;return this.isNew()?c.defer(a.success):(P(this,a),g=this.sync("delete",this,a)),e||f(),g},url:function(){var a=c.result(this,"urlRoot")||c.result(this.collection,"url")||O();if(this.isNew())return a;var b=this.get(this.idAttribute);return a.replace(/[^\/]$/,"$&/")+encodeURIComponent(b)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(a){return this._validate({},c.defaults({validate:!0},a))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=c.extend({},this.attributes,a);var d=this.validationError=this.validate(a,b)||null;return d?(this.trigger("invalid",this,d,c.extend(b,{validationError:d})),!1):!0}});var u={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};h(t,u,"attributes");var v=b.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,c.extend({silent:!0},b))},w={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},y=function(a,b,c){c=Math.min(Math.max(c,0),a.length);for(var d=Array(a.length-c),e=b.length,f=0;f<d.length;f++)d[f]=a[f+c];for(f=0;e>f;f++)a[f+c]=b[f];for(f=0;f<d.length;f++)a[f+e+c]=d[f]};c.extend(v.prototype,k,{model:t,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return b.sync.apply(this,arguments)},add:function(a,b){return this.set(a,c.extend({merge:!1},b,x))},remove:function(a,b){b=c.extend({},b);var d=!c.isArray(a);a=d?[a]:c.clone(a);var e=this._removeModels(a,b);return!b.silent&&e&&this.trigger("update",this,b),d?e[0]:e},set:function(a,b){if(null!=a){b=c.defaults({},b,w),b.parse&&!this._isModel(a)&&(a=this.parse(a,b));var d=!c.isArray(a);a=d?[a]:a.slice();var e=b.at;null!=e&&(e=+e),0>e&&(e+=this.length+1);for(var f,g=[],h=[],i=[],j={},k=b.add,l=b.merge,m=b.remove,n=!1,o=this.comparator&&null==e&&b.sort!==!1,p=c.isString(this.comparator)?this.comparator:null,q=0;q<a.length;q++){f=a[q];var r=this.get(f);if(r){if(l&&f!==r){var s=this._isModel(f)?f.attributes:f;b.parse&&(s=r.parse(s,b)),r.set(s,b),o&&!n&&(n=r.hasChanged(p))}j[r.cid]||(j[r.cid]=!0,g.push(r)),a[q]=r}else k&&(f=a[q]=this._prepareModel(f,b),f&&(h.push(f),this._addReference(f,b),j[f.cid]=!0,g.push(f)))}if(m){for(q=0;q<this.length;q++)f=this.models[q],j[f.cid]||i.push(f);i.length&&this._removeModels(i,b)}var t=!1,u=!o&&k&&m;if(g.length&&u?(t=this.length!=g.length||c.some(this.models,function(a,b){return a!==g[b]}),this.models.length=0,y(this.models,g,0),this.length=this.models.length):h.length&&(o&&(n=!0),y(this.models,h,null==e?this.length:e),this.length=this.models.length),n&&this.sort({silent:!0}),!b.silent){for(q=0;q<h.length;q++)null!=e&&(b.index=e+q),f=h[q],f.trigger("add",f,this,b);(n||t)&&this.trigger("sort",this,b),(h.length||i.length)&&this.trigger("update",this,b)}return d?a[0]:a}},reset:function(a,b){b=b?c.clone(b):{};for(var d=0;d<this.models.length;d++)this._removeReference(this.models[d],b);return b.previousModels=this.models,this._reset(),a=this.add(a,c.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,c.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a)},unshift:function(a,b){return this.add(a,c.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a)},slice:function(){return f.apply(this.models,arguments)},get:function(a){if(null!=a){var b=this.modelId(this._isModel(a)?a.attributes:a);return this._byId[a]||this._byId[b]||this._byId[a.cid]}},at:function(a){return 0>a&&(a+=this.length),this.models[a]},where:function(a,b){return this[b?"find":"filter"](a)},findWhere:function(a){return this.where(a,!0)},sort:function(a){var b=this.comparator;if(!b)throw new Error("Cannot sort a set without a comparator");a||(a={});var d=b.length;return c.isFunction(b)&&(b=c.bind(b,this)),1===d||c.isString(b)?this.models=this.sortBy(b):this.models.sort(b),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return c.invoke(this.models,"get",a)},fetch:function(a){a=c.extend({parse:!0},a);var b=a.success,d=this;return a.success=function(c){var e=a.reset?"reset":"set";d[e](c,a),b&&b.call(a.context,d,c,a),d.trigger("sync",d,c,a)},P(this,a),this.sync("read",this,a)},create:function(a,b){b=b?c.clone(b):{};var d=b.wait;if(a=this._prepareModel(a,b),!a)return!1;d||this.add(a,b);var e=this,f=b.success;return b.success=function(a,b,c){d&&e.add(a,c),f&&f.call(c.context,a,b,c)},a.save(null,b),a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(a){return a[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(this._isModel(a))return a.collection||(a.collection=this),a;b=b?c.clone(b):{},b.collection=this;var d=new this.model(a,b);return d.validationError?(this.trigger("invalid",this,d.validationError,b),!1):d},_removeModels:function(a,b){for(var c=[],d=0;d<a.length;d++){var e=this.get(a[d]);if(e){var f=this.indexOf(e);this.models.splice(f,1),this.length--,b.silent||(b.index=f,e.trigger("remove",e,this,b)),c.push(e),this._removeReference(e,b)}}return c.length?c:!1},_isModel:function(a){return a instanceof t},_addReference:function(a,b){this._byId[a.cid]=a;var c=this.modelId(a.attributes);null!=c&&(this._byId[c]=a),a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){delete this._byId[a.cid];var c=this.modelId(a.attributes);null!=c&&delete this._byId[c],this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if("add"!==a&&"remove"!==a||c===this){if("destroy"===a&&this.remove(b,d),"change"===a){var e=this.modelId(b.previousAttributes()),f=this.modelId(b.attributes);e!==f&&(null!=e&&delete this._byId[e],null!=f&&(this._byId[f]=b))}this.trigger.apply(this,arguments)}}});var z={forEach:3,each:3,map:3,collect:3,reduce:4,foldl:4,inject:4,reduceRight:4,foldr:4,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3};h(v,z,"models");var A=b.View=function(a){this.cid=c.uniqueId("view"),c.extend(this,c.pick(a,C)),this._ensureElement(),this.initialize.apply(this,arguments)},B=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];c.extend(A.prototype,k,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(a){return this.undelegateEvents(),this._setElement(a),this.delegateEvents(),this},_setElement:function(a){this.$el=a instanceof b.$?a:b.$(a),this.el=this.$el[0]},delegateEvents:function(a){if(a||(a=c.result(this,"events")),!a)return this;this.undelegateEvents();for(var b in a){var d=a[b];if(c.isFunction(d)||(d=this[d]),d){var e=b.match(B);this.delegate(e[1],e[2],c.bind(d,this))}}return this},delegate:function(a,b,c){return this.$el.on(a+".delegateEvents"+this.cid,b,c),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(a,b,c){return this.$el.off(a+".delegateEvents"+this.cid,b,c),this},_createElement:function(a){return document.createElement(a)},_ensureElement:function(){if(this.el)this.setElement(c.result(this,"el"));else{var a=c.extend({},c.result(this,"attributes"));this.id&&(a.id=c.result(this,"id")),this.className&&(a["class"]=c.result(this,"className")),this.setElement(this._createElement(c.result(this,"tagName"))),this._setAttributes(a)}},_setAttributes:function(a){this.$el.attr(a)}}),b.sync=function(a,d,e){var f=D[a];c.defaults(e||(e={}),{emulateHTTP:b.emulateHTTP,emulateJSON:b.emulateJSON});var g={type:f,dataType:"json"};if(e.url||(g.url=c.result(d,"url")||O()),null!=e.data||!d||"create"!==a&&"update"!==a&&"patch"!==a||(g.contentType="application/json",g.data=JSON.stringify(e.attrs||d.toJSON(e))),e.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),e.emulateHTTP&&("PUT"===f||"DELETE"===f||"PATCH"===f)){g.type="POST",e.emulateJSON&&(g.data._method=f);var h=e.beforeSend;e.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",f),h?h.apply(this,arguments):void 0}}"GET"===g.type||e.emulateJSON||(g.processData=!1);var i=e.error;e.error=function(a,b,c){e.textStatus=b,e.errorThrown=c,i&&i.call(e.context,a,b,c)};var j=e.xhr=b.ajax(c.extend(g,e));return d.trigger("request",d,j,e),j};var D={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};b.ajax=function(){return b.$.ajax.apply(b.$,arguments)};var E=b.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},F=/\((.*?)\)/g,G=/(\(\?)?:\w+/g,H=/\*\w+/g,I=/[\-{}\[\]+?.,\\\^$|#\s]/g;c.extend(E.prototype,k,{initialize:function(){},route:function(a,d,e){c.isRegExp(a)||(a=this._routeToRegExp(a)),c.isFunction(d)&&(e=d,d=""),e||(e=this[d]);var f=this;return b.history.route(a,function(c){var g=f._extractParameters(a,c);f.execute(e,g,d)!==!1&&(f.trigger.apply(f,["route:"+d].concat(g)),f.trigger("route",d,g),b.history.trigger("route",f,d,g))}),this},execute:function(a,b,c){a&&a.apply(this,b)},navigate:function(a,c){return b.history.navigate(a,c),this},_bindRoutes:function(){if(this.routes){this.routes=c.result(this,"routes");for(var a,b=c.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(I,"\\$&").replace(F,"(?:$1)?").replace(G,function(a,b){return b?a:"([^/?]+)"}).replace(H,"([^?]*?)"),new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,b){var d=a.exec(b).slice(1);return c.map(d,function(a,b){return b===d.length-1?a||null:a?decodeURIComponent(a):null})}});var J=b.History=function(){this.handlers=[],this.checkUrl=c.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},K=/^[#\/]|\s+$/g,L=/^\/+|\/+$/g,M=/#.*$/;J.started=!1,c.extend(J.prototype,k,{interval:50,atRoot:function(){var a=this.location.pathname.replace(/[^\/]$/,"$&/");return a===this.root&&!this.getSearch()},matchRoot:function(){var a=this.decodeFragment(this.location.pathname),b=a.slice(0,this.root.length-1)+"/";return b===this.root},decodeFragment:function(a){return decodeURI(a.replace(/%25/g,"%2525"))},getSearch:function(){var a=this.location.href.replace(/#.*/,"").match(/\?.+/);return a?a[0]:""},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getPath:function(){var a=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===a.charAt(0)?a.slice(1):a},getFragment:function(a){return null==a&&(a=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),a.replace(K,"")},start:function(a){if(J.started)throw new Error("Backbone.history has already been started");if(J.started=!0,this.options=c.extend({root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(L,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var b=this.root.slice(0,-1)||"/";return this.location.replace(b+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var d=document.body,e=d.insertBefore(this.iframe,d.firstChild).contentWindow;e.document.open(),e.document.close(),e.location.hash="#"+this.fragment}var f=window.addEventListener||function(a,b){return attachEvent("on"+a,b)};return this._usePushState?f("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?f("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.options.silent?void 0:this.loadUrl()},stop:function(){var a=window.removeEventListener||function(a,b){return detachEvent("on"+a,b)};this._usePushState?a("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&a("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),J.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();return b===this.fragment&&this.iframe&&(b=this.getHash(this.iframe.contentWindow)),b===this.fragment?!1:(this.iframe&&this.navigate(b),void this.loadUrl())},loadUrl:function(a){return this.matchRoot()?(a=this.fragment=this.getFragment(a),c.some(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})):!1},navigate:function(a,b){if(!J.started)return!1;b&&b!==!0||(b={trigger:!!b}),a=this.getFragment(a||"");var c=this.root;""!==a&&"?"!==a.charAt(0)||(c=c.slice(0,-1)||"/");var d=c+a;if(a=this.decodeFragment(a.replace(M,"")),this.fragment!==a){if(this.fragment=a,this._usePushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,d);else{if(!this._wantsHashChange)return this.location.assign(d);if(this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getHash(this.iframe.contentWindow)){var e=this.iframe.contentWindow;b.replace||(e.document.open(),e.document.close()),this._updateHash(e.location,a,b.replace)}}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),b.history=new J;var N=function(a,b){var d,e=this;d=a&&c.has(a,"constructor")?a.constructor:function(){return e.apply(this,arguments)},c.extend(d,e,b);var f=function(){this.constructor=d};return f.prototype=e.prototype,d.prototype=new f,a&&c.extend(d.prototype,a),d.__super__=e.prototype,d};t.extend=v.extend=E.extend=A.extend=J.extend=N;var O=function(){throw new Error('A "url" property or function must be specified')},P=function(a,b){var c=b.error;b.error=function(d){c&&c.call(b.context,a,d,b),a.trigger("error",a,d,b)}};return b})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{jquery:57,underscore:148}],2:[function(a,b,c){!function(a){function b(b){return a.functions.hsla(b.h,b.s,b.l,b.a)}function c(b){return b instanceof a.Dimension?parseFloat("%"==b.unit?b.value/100:b.value):"number"==typeof b?b:NaN}function d(a){return Math.min(1,Math.max(0,a))}a.functions={rgb:function(a,b,c){return this.rgba(a,b,c,1)},rgba:function(b,d,e,f){var g=[b,d,e].map(function(a){return c(a)});return f=c(f),g.some(isNaN)||isNaN(f)?null:new a.Color(g,f)},stop:function(a){var b,c;return arguments.length>1&&(b=arguments[1]),arguments.length>2&&(c=arguments[2]),{is:"tag",val:a,color:b,mode:c,toString:function(d){return'\n	<stop value="'+a.ev(d)+'"'+(b?' color="'+b.ev(d)+'" ':"")+(c?' mode="'+c.ev(d)+'" ':"")+"/>"}}},hsl:function(a,b,c){return this.hsla(a,b,c,1)},hsla:function(a,b,d,e){function f(a){return a=0>a?a+1:a>1?a-1:a,1>6*a?h+(g-h)*a*6:1>2*a?g:2>3*a?h+(g-h)*(2/3-a)*6:h}if(a=c(a)%360/360,b=c(b),d=c(d),e=c(e),[a,b,d,e].some(isNaN))return null;var g=.5>=d?d*(b+1):d+b-d*b,h=2*d-g;return this.rgba(255*f(a+1/3),255*f(a),255*f(a-1/3),e)},hue:function(b){return"toHSL"in b?new a.Dimension(Math.round(b.toHSL().h)):null},saturation:function(b){return"toHSL"in b?new a.Dimension(Math.round(100*b.toHSL().s),"%"):null},lightness:function(b){return"toHSL"in b?new a.Dimension(Math.round(100*b.toHSL().l),"%"):null},alpha:function(b){return"toHSL"in b?new a.Dimension(b.toHSL().a):null},saturate:function(a,c){if(!("toHSL"in a))return null;var e=a.toHSL();return e.s+=c.value/100,e.s=d(e.s),b(e)},desaturate:function(a,c){if(!("toHSL"in a))return null;var e=a.toHSL();return e.s-=c.value/100,e.s=d(e.s),b(e)},lighten:function(a,c){if(!("toHSL"in a))return null;var e=a.toHSL();return e.l+=c.value/100,e.l=d(e.l),b(e)},darken:function(a,c){if(!("toHSL"in a))return null;var e=a.toHSL();return e.l-=c.value/100,e.l=d(e.l),b(e)},fadein:function(a,c){if(!("toHSL"in a))return null;var e=a.toHSL();return e.a+=c.value/100,e.a=d(e.a),b(e)},fadeout:function(a,c){if(!("toHSL"in a))return null;var e=a.toHSL();return e.a-=c.value/100,e.a=d(e.a),b(e)},spin:function(a,c){if(!("toHSL"in a))return null;var d=a.toHSL(),e=(d.h+c.value)%360;return d.h=0>e?360+e:e,b(d)},replace:function(a,b,c){return"field"===a.is?a.toString+".replace("+b.toString()+", "+c.toString()+")":a.replace(b,c)},mix:function(b,c,d){var e=d.value/100,f=2*e-1,g=b.toHSL().a-c.toHSL().a,h=((f*g==-1?f:(f+g)/(1+f*g))+1)/2,i=1-h,j=[b.rgb[0]*h+c.rgb[0]*i,b.rgb[1]*h+c.rgb[1]*i,b.rgb[2]*h+c.rgb[2]*i],k=b.alpha*e+c.alpha*(1-e);return new a.Color(j,k)},greyscale:function(b){return this.desaturate(b,new a.Dimension(100))},"%":function(b){for(var c=Array.prototype.slice.call(arguments,1),d=b.value,e=0;e<c.length;e++)d=d.replace(/%s/,c[e].value).replace(/%[da]/,c[e].toString());return d=d.replace(/%%/g,"%"),new a.Quoted(d)}};for(var e=["emboss","blur","gray","sobel","edge-detect","x-gradient","y-gradient","sharpen"],f=0;f<e.length;f++){var g=e[f];a.functions[g]=function(b){return function(){return new a.ImageFilter(b)}}(g)}a.functions["agg-stack-blur"]=function(b,c){return new a.ImageFilter("agg-stack-blur",[b,c])},a.functions["scale-hsla"]=function(b,c,d,e,f,g,h,i){return new a.ImageFilter("scale-hsla",[b,c,d,e,f,g,h,i])}}(a("./tree"))},{"./tree":8}],3:[function(a,b,c){(function(b,d){function e(){if(b.browser)return a("../../package.json").version.split(".");if(parseInt(b.version.split(".")[1],10)>4)return a("../../package.json").version.split(".");var c=JSON.parse(h.readFileSync(i.join(d,"../../package.json")));return c.version.split(".")}function f(a,b){var c={bold:[1,22],inverse:[7,27],underline:[4,24],yellow:[33,39],green:[32,39],red:[31,39],grey:[90,39]};return"["+c[b][0]+"m"+a+"["+c[b][1]+"m"}var g=a("util"),h=a("fs"),i=a("path"),j={version:e(),Parser:a("./parser").Parser,Renderer:a("./renderer").Renderer,tree:a("./tree"),RendererJS:a("./renderer_js"),default_reference:a("./torque-reference"),writeError:function(a,b){var c="",d=a.extract,e=[];if(b=b||{},!b.silent){if(b.indent=b.indent||"",!("index"in a&&d))return g.error(b.indent+(a.stack||a.message));"string"==typeof d[0]&&e.push(f(a.line-1+" "+d[0],"grey")),""===d[1]&&"undefined"==typeof d[2]&&(d[1]="¶"),e.push(a.line+" "+d[1].slice(0,a.column)+f(f(d[1][a.column],"bold")+d[1].slice(a.column+1),"yellow")),"string"==typeof d[2]&&e.push(f(a.line+1+" "+d[2],"grey")),e=b.indent+e.join("\n"+b.indent)+"[0m\n",c=b.indent+c+f(a.message,"red"),a.filename&&(c+=f(" in ","red")+a.filename),g.error(c,e),a.callLine&&(g.error(f("from ","red")+(a.filename||"")),g.error(f(a.callLine,"grey")+" "+a.callExtract)),a.stack&&g.error(f(a.stack,"red"))}}};a("./tree/call"),a("./tree/color"),a("./tree/comment"),a("./tree/definition"),a("./tree/dimension"),a("./tree/element"),a("./tree/expression"),a("./tree/filterset"),a("./tree/filter"),a("./tree/field"),a("./tree/keyword"),a("./tree/layer"),a("./tree/literal"),a("./tree/operation"),a("./tree/quoted"),a("./tree/imagefilter"),a("./tree/reference"),a("./tree/rule"),a("./tree/ruleset"),a("./tree/selector"),a("./tree/style"),a("./tree/url"),a("./tree/value"),a("./tree/variable"),a("./tree/zoom"),a("./tree/invalid"),a("./tree/fontset"),a("./tree/frame_offset"),a("./functions");for(var k in j)c[k]=j[k]}).call(this,a("_process"),"/../cartodb.js/node_modules/d3.cartodb/node_modules/carto/lib/carto")},{"../../package.json":39,"./functions":2,"./parser":4,"./renderer":5,"./renderer_js":6,"./torque-reference":7,"./tree":8,"./tree/call":9,"./tree/color":10,"./tree/comment":11,"./tree/definition":12,"./tree/dimension":13,"./tree/element":14,"./tree/expression":15,"./tree/field":16,"./tree/filter":17,"./tree/filterset":18,"./tree/fontset":19,"./tree/frame_offset":20,"./tree/imagefilter":21,"./tree/invalid":22,"./tree/keyword":23,"./tree/layer":24,"./tree/literal":25,"./tree/operation":26,"./tree/quoted":27,"./tree/reference":28,"./tree/rule":29,"./tree/ruleset":30,"./tree/selector":31,"./tree/style":32,"./tree/url":33,"./tree/value":34,"./tree/variable":35,"./tree/zoom":36,_process:327,fs:323,path:326,util:329}],4:[function(a,b,c){(function(b){var d=c,e=a("./tree"),f=b._||a("underscore");d.Parser=function(a){function b(){n=q[m],o=l,r=l}function c(){q[m]=n,l=o,r=l}function d(){l>r&&(q[m]=q[m].slice(l-r),r=l)}function g(a){var b,c,e,f;if(a instanceof Function)return a.call(s.parsers);if("string"==typeof a)b=k.charAt(l)===a?a:null,c=1,d();else{if(d(),b=a.exec(q[m]),!b)return null;c=b[0].length}if(b){var g=l+=c;for(f=l+q[m].length-c;f>l&&(e=k.charCodeAt(l),32===e||10===e||9===e);)l++;return q[m]=q[m].slice(c+(l-g)),r=l,0===q[m].length&&m<q.length-1&&m++,"string"==typeof b?b:1===b.length?b[0]:b}}function h(a){return"string"==typeof a?k.charAt(l)===a:!!a.test(q[m])}function i(a,b){return(a.slice(0,b).match(/\n/g)||"").length+1}function j(b){var c;f(b).defaults({index:p,filename:a.filename,message:"Parse error.",line:0,column:-1}),c=b.filename&&t.env.inputs&&t.env.inputs[b.filename]?t.env.inputs[b.filename]:k,b.line=i(c,b.index);for(var d=b.index;d>=0&&"\n"!==c.charAt(d);d--)b.column++;return new Error(f("<%=filename%>:<%=line%>:<%=column%> <%=message%>").template(b))}var k,l,m,n,o,p,q,r,s,t=this;return this.env=a=a||{},this.env.filename=this.env.filename||null,this.env.inputs=this.env.inputs||{},s={extractErrorLine:i,parse:function(b){var c,d=null;l=m=r=p=0,q=[],k=b.replace(/\r\n/g,"\n"),a.filename&&(t.env.inputs[a.filename]=k);if(q=function(a){for(var b,c,e,f,g=0,h=/(?:@\{[\w-]+\}|[^"'`\{\}\/\(\)\\])+/g,i=/\/\*(?:[^*]|\*+[^\/*])*\*+\/|\/\/.*/g,j=/"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'|`((?:[^`]|\\.)*)`/g,l=0,m=a[0],n=0;n<k.length;)if(h.lastIndex=n,(b=h.exec(k))&&b.index===n&&(n+=b[0].length,m.push(b[0])),e=k.charAt(n),i.lastIndex=j.lastIndex=n,(b=j.exec(k))&&b.index===n)n+=b[0].length,m.push(b[0]);else if(c||"/"!==e||(f=k.charAt(n+1),"/"!==f&&"*"!==f||!(b=i.exec(k))||b.index!==n)){switch(e){case"{":if(!c){l++,m.push(e);break}case"}":if(!c){l--,m.push(e),a[++g]=m=[];break}case"(":if(!c){c=!0,m.push(e);break}case")":if(c){c=!1,m.push(e);break}default:m.push(e)}n++}else n+=b[0].length,m.push(b[0]);return 0!==l&&(d={index:n-1,type:"Parse",message:l>0?"missing closing `}`":"missing opening `{`"}),a.map(function(a){return a.join("")})}([[]]),d)throw j(d);c=new e.Ruleset([],g(this.parsers.primary)),c.root=!0,c.toList=function(){return function(a){a.error=function(b){a.errors||(a.errors=new Error("")),a.errors.message?a.errors.message+="\n"+j(b).message:a.errors.message=j(b).message},a.frames=a.frames||[];var b=this.flatten([],[],a);return b.sort(f),b}}();var f=function(a,b){var c=a.specificity,d=b.specificity;return c[0]!=d[0]?d[0]-c[0]:c[1]!=d[1]?d[1]-c[1]:c[2]!=d[2]?d[2]-c[2]:d[3]-c[3]};return c},parsers:{primary:function(){for(var a,b=[];(a=g(this.rule)||g(this.ruleset)||g(this.comment))||g(/^[\s\n]+/)||(a=g(this.invalid));)a&&b.push(a);return b},invalid:function(){var a=g(/^[^;\n]*[;\n]/);return a?new e.Invalid(a,o):void 0},comment:function(){var a;
if("/"===k.charAt(l))return"/"===k.charAt(l+1)?new e.Comment(g(/^\/\/.*/),!0):(a=g(/^\/\*(?:[^*]|\*+[^\/*])*\*+\/\n?/))?new e.Comment(a):void 0},entities:{quoted:function(){if('"'===k.charAt(l)||"'"===k.charAt(l)){var a=g(/^"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'/);return a?new e.Quoted(a[1]||a[2]):void 0}},field:function(){if(g("[")){var a=g(/(^[^\]]+)/);if(g("]"))return a?new e.Field(a[1]):void 0}},comparison:function(){var a=g(/^=~|=|!=|<=|>=|<|>/);return a?a:void 0},keyword:function(){var a=g(/^[A-Za-z-]+[A-Za-z-0-9_]*/);return a?new e.Keyword(a):void 0},call:function(){var a,b;if(a=/^([\w\-]+|%)\(/.exec(q[m])){if(a=a[1],"url"===a)return null;if(l+=a.length,g("("),b=g(this.entities.arguments),g(")"))return a?new e.Call(a,b,l):void 0}},arguments:function(){for(var a,b=[];(a=g(this.expression))&&(b.push(a),g(",")););return b},literal:function(){return g(this.entities.dimension)||g(this.entities.keywordcolor)||g(this.entities.hexcolor)||g(this.entities.quoted)},url:function(){var a;if("u"===k.charAt(l)&&g(/^url\(/))return a=g(this.entities.quoted)||g(this.entities.variable)||g(/^[\-\w%@$\/.&=:;#+?~]+/)||"",g(")")?new e.URL("undefined"!=typeof a.value||a instanceof e.Variable?a:new e.Quoted(a)):new e.Invalid(a,o,"Missing closing ) in URL.")},variable:function(){var b,c=l;return"@"===k.charAt(l)&&(b=g(/^@[\w-]+/))?new e.Variable(b,c,a.filename):void 0},hexcolor:function(){var a;return"#"===k.charAt(l)&&(a=g(/^#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})/))?new e.Color(a[1]):void 0},keywordcolor:function(){var a=q[m].match(/^[a-z]+/);return a&&a[0]in e.Reference.data.colors?new e.Color(e.Reference.data.colors[g(/^[a-z]+/)]):void 0},dimension:function(){var a=k.charCodeAt(l);if(!(a>57||45>a||47===a)){var b=g(/^(-?\d*\.?\d+(?:[eE][-+]?\d+)?)(\%|\w+)?/);return b?new e.Dimension(b[1],b[2],o):void 0}}},variable:function(){var a;return"@"===k.charAt(l)&&(a=g(/^(@[\w-]+)\s*:/))?a[1]:void 0},entity:function(){return g(this.entities.call)||g(this.entities.literal)||g(this.entities.field)||g(this.entities.variable)||g(this.entities.url)||g(this.entities.keyword)},end:function(){return g(";")||h("}")},element:function(){var a=g(/^(?:[.#][\w\-]+|\*|Map)/);return a?new e.Element(a):void 0},attachment:function(){var a=g(/^::([\w\-]+(?:\/[\w\-]+)*)/);return a?a[1]:void 0},selector:function(){var a,b,c,d,f,h=[],i=new e.Filterset,m=[],n=e.FrameOffset.none;for(segments=0,conditions=0;(c=g(this.element))||(f=g(this.zoom))||(fo=g(this.frame_offset))||(d=g(this.filter))||(a=g(this.attachment));){if(segments++,c)h.push(c);else if(f)m.push(f),conditions++;else if(fo)n=fo,conditions++;else if(d){var p=i.add(d);if(p)throw j({message:p,index:l-1});conditions++}else{if(b)throw j({message:"Encountered second attachment name.",index:l-1});b=a}var q=k.charAt(l);if("{"===q||"}"===q||";"===q||","===q)break}return segments?new e.Selector(i,m,n,h,b,conditions,o):void 0},filter:function(){b();var c,d,f;if(g("[")&&(c=g(/^[a-zA-Z0-9\-_]+/)||g(this.entities.quoted)||g(this.entities.variable)||g(this.entities.keyword)||g(this.entities.field))&&(c instanceof e.Quoted&&(c=new e.Field(c.toString())),(d=g(this.entities.comparison))&&(f=g(this.entities.quoted)||g(this.entities.variable)||g(this.entities.dimension)||g(this.entities.keyword)||g(this.entities.field)))){if(!g("]"))throw j({message:"Missing closing ] of filter.",index:o-1});return c.is||(c=new e.Field(c)),new e.Filter(c,d,f,o,a.filename)}},frame_offset:function(){b();var a,c;return g(/^\[\s*frame-offset/g)&&(a=g(this.entities.comparison))&&(c=g(/^\d+/))&&g("]")?e.FrameOffset(a,c,o):void 0},zoom:function(){b();var a,d;return g(/^\[\s*zoom/g)&&(a=g(this.entities.comparison))&&(d=g(this.entities.variable)||g(this.entities.dimension))&&g("]")?new e.Zoom(a,d,o):void c()},block:function(){var a;return g("{")&&(a=g(this.primary))&&g("}")?a:void 0},ruleset:function(){var a,d,f=[];for(b();a=g(this.selector);){for(f.push(a);g(this.comment););if(!g(","))break;for(;g(this.comment););}if(a)for(;g(this.comment););if(f.length>0&&(d=g(this.block))){if(1===f.length&&f[0].elements.length&&"Map"===f[0].elements[0].value){var h=new e.Ruleset(f,d);return h.isMap=!0,h}return new e.Ruleset(f,d)}c()},rule:function(){var d,f,h=k.charAt(l);if(b(),"."!==h&&"#"!==h&&(d=g(this.variable)||g(this.property))){if(f=g(this.value),f&&g(this.end))return new e.Rule(d,f,o,a.filename);p=l,c()}},font:function(){for(var a,b=[],c=[];a=g(this.entity);)c.push(a);if(b.push(new e.Expression(c)),g(","))for(;(a=g(this.expression))&&(b.push(a),g(",")););return new e.Value(b)},value:function(){for(var a,b=[];(a=g(this.expression))&&(b.push(a),g(",")););return b.length>1?new e.Value(b.map(function(a){return a.value[0]})):1===b.length?new e.Value(b):void 0},sub:function(){var a;return g("(")&&(a=g(this.expression))&&g(")")?a:void 0},multiplication:function(){var a,b,c,d;if(a=g(this.operand)){for(;(c=g("/")||g("*")||g("%"))&&(b=g(this.operand));)d=new e.Operation(c,[d||a,b],o);return d||a}},addition:function(){var a,b,c,d;if(a=g(this.multiplication)){for(;(c=g(/^[-+]\s+/)||" "!=k.charAt(l-1)&&(g("+")||g("-")))&&(b=g(this.multiplication));)d=new e.Operation(c,[d||a,b],o);return d||a}},operand:function(){return g(this.sub)||g(this.entity)},expression:function(){for(var a,b=[];a=g(this.addition)||g(this.entity);)b.push(a);return b.length>0?new e.Expression(b):void 0},property:function(){var a=g(/^(([a-z][-a-z_0-9]*\/)?\*?-?[-a-z_0-9]+)\s*:/);return a?a[1]:void 0}}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./tree":8,underscore:38}],5:[function(a,b,c){(function(c){function d(a,b,c,d){for(var e,f,g,h=b.filters,i=b.rules,j=0;j<a.length;j++)e=a[j].filters.cloneWith(h),e?(g=c[e],g?g.addRules(i):(f=a[j].clone(e),f.addRules(i)&&(c[e]=f,a.splice(j,0,f),j++))):null===e&&(a[j]=a[j].clone(),a[j].addRules(i));return a}function e(a,b){var c,e,f=+new Date,g={},h={},i=[];a.forEach(function(a){a.filters.ev(b)});for(var j=0;j<a.length;j++){e=a[j].attachment,c=[a[j]],g[e]||(g[e]=[],g[e].attachment=e,h[e]={},i.push(g[e]));for(var k=j+1;k<a.length;k++)a[k].attachment===e&&(c=d(c,a[k],h[e],b));for(var l=0;l<c.length;l++)h[e][c[l].filters]=c[l],g[e].push(c[l])}return b.benchmark&&console.warn("Inheritance time: "+(new Date-f)+"ms"),i}function f(a,b){return b.index-a.index}function g(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.index=1/0;for(var e=0;e<d.length;e++)for(var g=d[e].rules,h=0;h<g.length;h++){var i=g[h];i.index<d.index&&(d.index=i.index)}}var j=a.slice();return j.sort(f),j}function h(a,b,c){var d={},e=j.tree.Reference.data.symbolizers.map;return i(a).each(function(a,b){b in e&&(d[b]=b+'="'+a+'"')}),b.filter(function(a){return"Map"===a.elements.join("")}).forEach(function(a){for(var b=0;b<a.rules.length;b++){var f=a.rules[b].name;f in e||c.error({message:"Rule "+f+" not allowed for Map.",index:a.rules[b].index}),d[f]=a.rules[b].ev(c).toXML(c)}}),d}var i=c._||a("underscore"),j=a("./index");j.Renderer=function(a,b){this.env=a||{},this.options=b||{},this.options.mapnik_version=this.options.mapnik_version||"3.0.0"},j.Renderer.prototype.renderMSS=function(a){var b=i(this.env).defaults({benchmark:!1,validation_data:!1,effects:[]});if(!j.tree.Reference.setVersion(this.options.mapnik_version))throw new Error("Could not set mapnik version to "+this.options.mapnik_version);var c=[],d=[];b.benchmark&&console.time("Parsing MSS");var f=j.Parser(b).parse(a);b.benchmark&&console.timeEnd("Parsing MSS"),b.benchmark&&console.time("Rule generation");var h=f.toList(b);b.benchmark&&console.timeEnd("Rule generation"),b.benchmark&&console.time("Rule inheritance");var k=e(h,b);b.benchmark&&console.timeEnd("Rule inheritance"),b.benchmark&&console.time("Style sort");var l=g(k,b);b.benchmark&&console.timeEnd("Style sort"),b.benchmark&&console.time("Total Style generation");for(var m,n,o=0;o<l.length;o++){m=l[o],n="style"+("__default__"!==m.attachment?"-"+m.attachment:""),d.push(n);var p='	Style "'+n+'" (#'+o+") toXML";b.benchmark&&console.time(p),c.push(j.tree.StyleXML(n,m.attachment,m,b)),b.benchmark&&console.timeEnd(p)}if(b.benchmark&&console.timeEnd("Total Style generation"),b.errors)throw b.errors;return c.join("\n")},j.Renderer.prototype.render=function(a){function b(a,b){return function(a){return a.appliesTo(f.name,b)}}var c=i(this.env).defaults({benchmark:!1,validation_data:!1,effects:[],ppi:90.714});if(!j.tree.Reference.setVersion(this.options.mapnik_version))throw new Error("Could not set mapnik version to "+this.options.mapnik_version);for(var d,f,k,l,m,n,o=[],p=i(a.Stylesheet).chain().map(function(a){if("string"==typeof a)throw new Error("Stylesheet object is expected not a string: '"+a+"'");c=i(c).extend({filename:a.id});var b=+new Date,d=j.Parser(c).parse(a.data);return c.benchmark&&console.warn("Parsing time: "+(new Date-b)+"ms"),d.toList(c)}).flatten().value(),q=0;q<a.Layer.length;q++){f=a.Layer[q],d=[],k={},c.benchmark&&console.warn("processing layer: "+f.id);for(var r=(f["class"]||"").split(/\s+/g),s=0;s<r.length;s++)k[r[s]]=!0;n=p.filter(b(f.name,k)),l=e(n,c),m=g(l,c);for(var t,u,v=0;v<m.length;v++){t=m[v],u=f.name+("__default__"!==t.attachment?"-"+t.attachment:"");var w=j.tree.StyleXML(u,t.attachment,t,c);w&&(o.push(w),d.push(u))}o.push(j.tree.LayerXML(f,d))}o.unshift(c.effects.map(function(a){return a.toXML(c)}).join("\n"));var x=h(a,p,c);if(c.errors)throw c.errors;var y=i(a).reduce(function(a,b,c){if(!b&&0!==b)return a;switch(c){case"srs":case"Layer":case"Stylesheet":break;case"bounds":case"center":case"minzoom":case"maxzoom":case"version":a.push('  <Parameter name="'+c+'">'+b+"</Parameter>");break;case"name":case"description":case"legend":case"attribution":case"template":a.push('  <Parameter name="'+c+'"><![CDATA['+b+"]]></Parameter>");break;case"format":a.push('  <Parameter name="'+c+'">'+b+"</Parameter>");break;case"interactivity":a.push('  <Parameter name="interactivity_layer">'+b.layer+"</Parameter>"),a.push('  <Parameter name="interactivity_fields">'+b.fields+"</Parameter>");break;default:"string"==typeof b?a.push('  <Parameter name="'+c+'"><![CDATA['+b+"]]></Parameter>"):"number"==typeof b?a.push('  <Parameter name="'+c+'">'+b+"</Parameter>"):"boolean"==typeof b&&a.push('  <Parameter name="'+c+'">'+b+"</Parameter>")}return a},[]);y.length&&o.unshift("<Parameters>\n"+y.join("\n")+"\n</Parameters>\n");var z=i(x).map(function(a){return" "+a}).join("");return o.unshift('<?xml version="1.0" encoding="utf-8"?>\n<!DOCTYPE Map[]>\n<Map'+z+">\n"),o.push("</Map>"),o.join("\n")},b.exports=j,b.exports.addRules=d,b.exports.inheritDefinitions=e,b.exports.sortStyles=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./index":3,underscore:38}],6:[function(require,module,exports){(function(global){!function(carto){function CartoCSS(a,b){this.options=b||{},this.imageURLs=[],a&&this.setStyle(a)}var tree=require("./tree"),_=global._||require("underscore");CartoCSS.Layer=function(a,b){this.options=b,this.shader=a},CartoCSS.Layer.prototype={fullName:function(){return this.shader.attachment},name:function(){return this.fullName().split("::")[0]},frames:function(){return this.shader.frames},attachment:function(){return this.fullName().split("::")[1]},eval:function(a){var b=this.shader[a];if(b&&b.style)return b.style({},{zoom:0,"frame-offset":0})},getStyle:function(a,b){var c={};for(var d in this.shader)"attachment"!==d&&"zoom"!==d&&"frames"!==d&&"symbolizers"!==d&&(c[d]=this.shader[d].style(a,b));return c},getSymbolizers:function(){return this.shader.symbolizers},isVariable:function(){for(var a in this.shader)if("attachment"!==a&&"zoom"!==a&&"frames"!==a&&"symbolizers"!==a&&!this.shader[a].constant)return!0;return!1},getShader:function(){return this.shader},filter:function(a,b,c){for(var d in this.shader){var e=this.shader[d](b,c);if(e)return!0}return!1},transformGeometry:function(a){return a},transformGeometries:function(a){return a}},CartoCSS.prototype={setStyle:function(a){var b=this.parse(a);if(!b)throw new Error(this.parse_env.errors);this.layers=b.map(function(a){return new CartoCSS.Layer(a)})},getLayers:function(){return this.layers},getDefault:function(){return this.findLayer({attachment:"__default__"})},findLayer:function(a){return _.find(this.layers,function(b){for(var c in a){var d=b[c];if("function"==typeof d&&(d=d.call(b)),a[c]!==d)return!1}return!0})},_createFn:function(a){var b=a.join("\n");return this.options.debug&&console.log(b),Function("data","ctx","var _value = null; "+b+"; return _value; ")},_compile:function(shader){"string"==typeof shader&&(shader=eval("(function() { return "+shader+"; })()")),this.shader_src=shader;for(var attr in shader){var c=mapper[attr];c&&(this.compiled[c]=eval("(function() { return shader[attr]; })();"))}},getImageURLs:function(){return this.imageURLs},parse:function(a){function b(a){return a.elements[0]+"::"+a.attachment}var c={frames:[],errors:[],error:function(a){this.errors.push(a)}};this.parse_env=c;var d=null;try{d=new carto.Parser(c).parse(a)}catch(e){return void c.errors.push(e.message)}if(d){var f=d.toList(c);f.reverse();for(var g={},h=0;h<f.length;++h){for(var i=f[h],j=b(i),k=g[j]=g[j]||{symbolizers:[]},l=0;l<i.rules.length;l++)if("marker-file"===i.rules[l].name||"point-file"===i.rules[l].name){var m=i.rules[l].value.value[0].value[0].value.value;this.imageURLs.push(m)}k.frames=[],k.zoom=tree.Zoom.all;var n=i.toJS(c);this.options.debug&&console.log("props",n);for(var o in n){var p=k[o]=k[o]||{constant:!1,symbolizer:null,js:[],index:0};p.js.push(n[o].map(function(a){return a.js}).join("\n")),p.symbolizer=_.first(n[o].map(function(a){return a.symbolizer})),p.index=_.max(n[o].map(function(a){return a.index}).concat(p.index)),p.constant=!_.any(n[o].map(function(a){return!a.constant}))}}var q=[];this.options.debug&&console.log(g);for(var r={},h=0;h<f.length;++h){var i=f[h],s=b(i),k=g[s];if(!r[s]){this.options.debug&&console.log("**",s);for(var t in k)"zoom"!==t&&"frames"!==t&&"symbolizers"!==t&&(this.options.debug&&console.log("*",t),k[t].style=this._createFn(k[t].js),k.symbolizers.push(k[t].symbolizer),k.symbolizers=_.uniq(k.symbolizers));k.attachment=s,q.push(k),r[s]=!0}k.zoom|=i.zoom,k.frames.push(i.frame_offset)}for(h=0;h<q.length;++h)q[h].frames=_.uniq(q[h].frames);return q}return null}},carto.RendererJS=function(a){this.options=a||{},this.options.mapnik_version=this.options.mapnik_version||"latest"},carto.RendererJS.prototype.render=function(a,b){var c=require("./torque-reference");return tree.Reference.setData(c.version.latest),new CartoCSS(a,this.options)},"undefined"!=typeof module&&(module.exports=carto.RendererJS)}(require("../carto"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../carto":3,"./torque-reference":7,"./tree":8,underscore:38}],7:[function(a,b,c){var d={version:"2.1.1",style:{"filter-mode":{type:["all","first"],doc:"Control the processing behavior of Rule filters within a Style. If 'all' is used then all Rules are processed sequentially independent of whether any previous filters matched. If 'first' is used then it means processing ends after the first match (a positive filter evaluation) and no further Rules in the Style are processed ('first' is usually the default for CSS implementations on top of Mapnik to simplify translation from CSS to Mapnik XML)","default-value":"all","default-meaning":"All Rules in a Style are processed whether they have filters or not and whether or not the filter conditions evaluate to true."},"image-filters":{css:"image-filters","default-value":"none","default-meaning":"no filters",type:"functions",functions:[["agg-stack-blur",2],["emboss",0],["blur",0],["gray",0],["sobel",0],["edge-detect",0],["x-gradient",0],["y-gradient",0],["invert",0],["sharpen",0],["colorize-alpha",-1],["color-to-alpha",1],["scale-hsla",8]],doc:"A list of image filters."},"comp-op":{css:"comp-op","default-value":"src-over","default-meaning":"add the current layer on top of other layers",doc:"Composite operation. This defines how this layer should behave relative to layers atop or below it.",type:["clear","src","dst","src-over","source-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","lighter","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]},opacity:{css:"opacity",type:"float",doc:"An alpha value for the style (which means an alpha applied to all features in separate buffer and then composited back to main buffer)","default-value":1,"default-meaning":"no separate buffer will be used and no alpha will be applied to the style after rendering"}},layer:{name:{"default-value":"",type:"string",required:!0,"default-meaning":"No layer name has been provided",doc:"The name of a layer. Can be anything you wish and is not strictly validated, but ideally unique  in the map"},srs:{"default-value":"",type:"string","default-meaning":"No srs value is provided and the value will be inherited from the Map's srs",doc:"The spatial reference system definition for the layer, aka the projection. Can either be a proj4 literal string like '+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs' or, if the proper proj4 epsg/nad/etc identifier files are installed, a string that uses an id like: '+init=epsg:4326'"},status:{"default-value":!0,type:"boolean","default-meaning":"This layer will be marked as active and available for processing",doc:"A property that can be set to false to disable this layer from being processed"},minzoom:{"default-value":"0",type:"float","default-meaning":"The layer will be visible at the minimum possible scale",doc:"The minimum scale denominator that this layer will be visible at. A layer's visibility is determined by whether its status is true and if the Map scale >= minzoom - 1e-6 and scale < maxzoom + 1e-6"},maxzoom:{"default-value":"1.79769e+308",type:"float","default-meaning":"The layer will be visible at the maximum possible scale",doc:"The maximum scale denominator that this layer will be visible at. The default is the numeric limit of the C++ double type, which may vary slightly by system, but is likely a massive number like 1.79769e+308 and ensures that this layer will always be visible unless the value is reduced. A layer's visibility is determined by whether its status is true and if the Map scale >= minzoom - 1e-6 and scale < maxzoom + 1e-6"},queryable:{"default-value":!1,type:"boolean","default-meaning":"The layer will not be available for the direct querying of data values",doc:"This property was added for GetFeatureInfo/WMS compatibility and is rarely used. It is off by default meaning that in a WMS context the layer will not be able to be queried unless the property is explicitly set to true"},"clear-label-cache":{"default-value":!1,type:"boolean","default-meaning":"The renderer's collision detector cache (used for avoiding duplicate labels and overlapping markers) will not be cleared immediately before processing this layer",doc:"This property, by default off, can be enabled to allow a user to clear the collision detector cache before a given layer is processed. This may be desirable to ensure that a given layers data shows up on the map even if it normally would not because of collisions with previously rendered labels or markers"},"group-by":{"default-value":"",type:"string","default-meaning":"No special layer grouping will be used during rendering",doc:"https://github.com/mapnik/mapnik/wiki/Grouped-rendering"},"buffer-size":{"default-value":"0",type:"float","default-meaning":"No buffer will be used",doc:"Extra tolerance around the Layer extent (in pixels) used to when querying and (potentially) clipping the layer data during rendering"},"maximum-extent":{"default-value":"none",type:"bbox","default-meaning":"No clipping extent will be used",doc:"An extent to be used to limit the bounds used to query this specific layer data during rendering. Should be minx, miny, maxx, maxy in the coordinates of the Layer."}},symbolizers:{"*":{"image-filters":{css:"image-filters","default-value":"none","default-meaning":"no filters",type:"functions",functions:[["agg-stack-blur",2],["emboss",0],["blur",0],["gray",0],["sobel",0],["edge-detect",0],["x-gradient",0],["y-gradient",0],["invert",0],["sharpen",0],["colorize-alpha",-1],["color-to-alpha",1],["scale-hsla",8]],doc:"A list of image filters."},"comp-op":{css:"comp-op","default-value":"src-over","default-meaning":"add the current layer on top of other layers",doc:"Composite operation. This defines how this layer should behave relative to layers atop or below it.",type:["clear","src","dst","src-over","source-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","lighter","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]},opacity:{css:"opacity",type:"float",doc:"An alpha value for the style (which means an alpha applied to all features in separate buffer and then composited back to main buffer)","default-value":1,"default-meaning":"no separate buffer will be used and no alpha will be applied to the style after rendering"}},map:{"background-color":{css:"background-color","default-value":"none","default-meaning":"transparent",type:"color",doc:"Map Background color"},"background-image":{css:"background-image",type:"uri","default-value":"","default-meaning":"transparent",doc:"An image that is repeated below all features on a map as a background.",description:"Map Background image"},srs:{css:"srs",type:"string","default-value":"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs","default-meaning":"The proj4 literal of EPSG:4326 is assumed to be the Map's spatial reference and all data from layers within this map will be plotted using this coordinate system. If any layers do not declare an srs value then they will be assumed to be in the same srs as the Map and not transformations will be needed to plot them in the Map's coordinate space",doc:"Map spatial reference (proj4 string)"},"buffer-size":{css:"buffer-size","default-value":"0",type:"float","default-meaning":"No buffer will be used",doc:'Extra tolerance around the map (in pixels) used to ensure labels crossing tile boundaries are equally rendered in each tile (e.g. cut in each tile). Not intended to be used in combination with "avoid-edges".'},"maximum-extent":{css:"","default-value":"none",type:"bbox","default-meaning":"No clipping extent will be used",doc:"An extent to be used to limit the bounds used to query all layers during rendering. Should be minx, miny, maxx, maxy in the coordinates of the Map."},base:{css:"base","default-value":"","default-meaning":"This base path defaults to an empty string meaning that any relative paths to files referenced in styles or layers will be interpreted relative to the application process.",type:"string",doc:"Any relative paths used to reference files will be understood as relative to this directory path if the map is loaded from an in memory object rather than from the filesystem. If the map is loaded from the filesystem and this option is not provided it will be set to the directory of the stylesheet."},"paths-from-xml":{css:"","default-value":!0,"default-meaning":"Paths read from XML will be interpreted from the location of the XML",type:"boolean",doc:"value to control whether paths in the XML will be interpreted from the location of the XML or from the working directory of the program that calls load_map()"},"minimum-version":{css:"","default-value":"none","default-meaning":"Mapnik version will not be detected and no error will be thrown about compatibility",type:"string",doc:"The minumum Mapnik version (e.g. 0.7.2) needed to use certain functionality in the stylesheet"},"font-directory":{css:"font-directory",type:"uri","default-value":"none","default-meaning":"No map-specific fonts will be registered",doc:"Path to a directory which holds fonts which should be registered when the Map is loaded (in addition to any fonts that may be automatically registered)."}},polygon:{fill:{css:"polygon-fill",type:"color","default-value":"rgba(128,128,128,1)","default-meaning":"gray and fully opaque (alpha = 1), same as rgb(128,128,128)",doc:"Fill color to assign to a polygon"},"fill-opacity":{css:"polygon-opacity",type:"float",doc:"The opacity of the polygon","default-value":1,"default-meaning":"opaque"},gamma:{css:"polygon-gamma",type:"float","default-value":1,"default-meaning":"fully antialiased",range:"0-1",doc:"Level of antialiasing of polygon edges"},"gamma-method":{css:"polygon-gamma-method",type:["power","linear","none","threshold","multiply"],"default-value":"power","default-meaning":"pow(x,gamma) is used to calculate pixel gamma, which produces slightly smoother line and polygon antialiasing than the 'linear' method, while other methods are usually only used to disable AA",doc:"An Antigrain Geometry specific rendering hint to control the quality of antialiasing. Under the hood in Mapnik this method is used in combination with the 'gamma' value (which defaults to 1). The methods are in the AGG source at https://github.com/mapnik/mapnik/blob/master/deps/agg/include/agg_gamma_functions.h"},clip:{css:"polygon-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"polygon-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"polygon-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"polygon-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},line:{stroke:{css:"line-color","default-value":"rgba(0,0,0,1)",type:"color","default-meaning":"black and fully opaque (alpha = 1), same as rgb(0,0,0)",doc:"The color of a drawn line"},"stroke-width":{css:"line-width","default-value":1,type:"float",doc:"The width of a line in pixels"},"stroke-opacity":{css:"line-opacity","default-value":1,type:"float","default-meaning":"opaque",doc:"The opacity of a line"},"stroke-linejoin":{css:"line-join","default-value":"miter",type:["miter","round","bevel"],doc:"The behavior of lines when joining"},"stroke-linecap":{css:"line-cap","default-value":"butt",type:["butt","round","square"],doc:"The display of line endings"},"stroke-gamma":{css:"line-gamma",type:"float","default-value":1,"default-meaning":"fully antialiased",range:"0-1",doc:"Level of antialiasing of stroke line"},"stroke-gamma-method":{css:"line-gamma-method",type:["power","linear","none","threshold","multiply"],"default-value":"power","default-meaning":"pow(x,gamma) is used to calculate pixel gamma, which produces slightly smoother line and polygon antialiasing than the 'linear' method, while other methods are usually only used to disable AA",doc:"An Antigrain Geometry specific rendering hint to control the quality of antialiasing. Under the hood in Mapnik this method is used in combination with the 'gamma' value (which defaults to 1). The methods are in the AGG source at https://github.com/mapnik/mapnik/blob/master/deps/agg/include/agg_gamma_functions.h"},"stroke-dasharray":{css:"line-dasharray",type:"numbers",doc:"A pair of length values [a,b], where (a) is the dash length and (b) is the gap length respectively. More than two values are supported for more complex patterns.","default-value":"none","default-meaning":"solid line"},"stroke-dashoffset":{css:"line-dash-offset",type:"numbers",doc:"valid parameter but not currently used in renderers (only exists for experimental svg support in Mapnik which is not yet enabled)","default-value":"none","default-meaning":"solid line"},"stroke-miterlimit":{css:"line-miterlimit",type:"float",doc:"The limit on the ratio of the miter length to the stroke-width. Used to automatically convert miter joins to bevel joins for sharp angles to avoid the miter extending beyond the thickness of the stroking path. Normally will not need to be set, but a larger value can sometimes help avoid jaggy artifacts.","default-value":4,"default-meaning":"Will auto-convert miters to bevel line joins when theta is less than 29 degrees as per the SVG spec: 'miterLength / stroke-width = 1 / sin ( theta / 2 )'"},clip:{css:"line-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"line-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},offset:{css:"line-offset",type:"float","default-value":0,"default-meaning":"no offset",doc:"Offsets a line a number of pixels parallel to its actual path. Postive values move the line left, negative values move it right (relative to the directionality of the line)."},rasterizer:{css:"line-rasterizer",type:["full","fast"],"default-value":"full",doc:"Exposes an alternate AGG rendering method that sacrifices some accuracy for speed."},"geometry-transform":{css:"line-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"line-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},markers:{file:{css:"marker-file",doc:"An SVG file that this marker shows at each placement. If no file is given, the marker will show an ellipse.","default-value":"","default-meaning":"An ellipse or circle, if width equals height",type:"uri"},opacity:{css:"marker-opacity",doc:"The overall opacity of the marker, if set, overrides both the opacity of both the fill and stroke","default-value":1,"default-meaning":"The stroke-opacity and fill-opacity will be used",type:"float"},"fill-opacity":{css:"marker-fill-opacity",doc:"The fill opacity of the marker","default-value":1,"default-meaning":"opaque",type:"float"},stroke:{css:"marker-line-color",
doc:"The color of the stroke around a marker shape.","default-value":"black",type:"color"},"stroke-width":{css:"marker-line-width",doc:"The width of the stroke around a marker shape, in pixels. This is positioned on the boundary, so high values can cover the area itself.",type:"float"},"stroke-opacity":{css:"marker-line-opacity","default-value":1,"default-meaning":"opaque",doc:"The opacity of a line",type:"float"},placement:{css:"marker-placement",type:["point","line","interior"],"default-value":"point","default-meaning":"Place markers at the center point (centroid) of the geometry",doc:"Attempt to place markers on a point, in the center of a polygon, or if markers-placement:line, then multiple times along a line. 'interior' placement can be used to ensure that points placed on polygons are forced to be inside the polygon interior"},"multi-policy":{css:"marker-multi-policy",type:["each","whole","largest"],"default-value":"each","default-meaning":"If a feature contains multiple geometries and the placement type is either point or interior then a marker will be rendered for each",doc:"A special setting to allow the user to control rendering behavior for 'multi-geometries' (when a feature contains multiple geometries). This setting does not apply to markers placed along lines. The 'each' policy is default and means all geometries will get a marker. The 'whole' policy means that the aggregate centroid between all geometries will be used. The 'largest' policy means that only the largest (by bounding box areas) feature will get a rendered marker (this is how text labeling behaves by default)."},"marker-type":{css:"marker-type",type:["arrow","ellipse","rectangle"],"default-value":"ellipse",doc:"The default marker-type. If a SVG file is not given as the marker-file parameter, the renderer provides either an arrow or an ellipse (a circle if height is equal to width)"},width:{css:"marker-width","default-value":10,doc:"The width of the marker, if using one of the default types.",type:"float",expression:!0},height:{css:"marker-height","default-value":10,doc:"The height of the marker, if using one of the default types.",type:"float",expression:!0},fill:{css:"marker-fill","default-value":"blue",doc:"The color of the area of the marker.",type:"color"},"allow-overlap":{css:"marker-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping markers are shown or hidden.","default-meaning":"Do not allow makers to overlap with each other - overlapping markers will not be shown."},"ignore-placement":{css:"marker-ignore-placement",type:"boolean","default-value":!1,"default-meaning":"do not store the bbox of this geometry in the collision detector cache",doc:"value to control whether the placement of the feature will prevent the placement of other features"},spacing:{css:"marker-spacing",doc:"Space between repeated labels","default-value":100,type:"float"},"max-error":{css:"marker-max-error",type:"float","default-value":.2,doc:"The maximum difference between actual marker placement and the marker-spacing parameter. Setting a high value can allow the renderer to try to resolve placement conflicts with other symbolizers."},transform:{css:"marker-transform",type:"functions",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]],"default-value":"","default-meaning":"No transformation",doc:"SVG transformation definition"},clip:{css:"marker-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"marker-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"marker-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"marker-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},shield:{name:{css:"shield-name",type:"string",expression:!0,serialization:"content",doc:'Value to use for a shield"s text label. Data columns are specified using brackets like [column_name]'},file:{css:"shield-file",required:!0,type:"uri","default-value":"none",doc:"Image file to render behind the shield text"},"face-name":{css:"shield-face-name",type:"string",validate:"font",doc:"Font name and style to use for the shield text","default-value":"",required:!0},"unlock-image":{css:"shield-unlock-image",type:"boolean",doc:"This parameter should be set to true if you are trying to position text beside rather than on top of the shield image","default-value":!1,"default-meaning":"text alignment relative to the shield image uses the center of the image as the anchor for text positioning."},size:{css:"shield-size",type:"float",doc:"The size of the shield text in pixels"},fill:{css:"shield-fill",type:"color",doc:"The color of the shield text"},placement:{css:"shield-placement",type:["point","line","vertex","interior"],"default-value":"point",doc:"How this shield should be placed. Point placement attempts to place it on top of points, line places along lines multiple times per feature, vertex places on the vertexes of polygons, and interior attempts to place inside of polygons."},"avoid-edges":{css:"shield-avoid-edges",doc:"Tell positioning algorithm to avoid labeling near intersection edges.",type:"boolean","default-value":!1},"allow-overlap":{css:"shield-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping shields are shown or hidden.","default-meaning":"Do not allow shields to overlap with other map elements already placed."},"minimum-distance":{css:"shield-min-distance",type:"float","default-value":0,doc:"Minimum distance to the next shield symbol, not necessarily the same shield."},spacing:{css:"shield-spacing",type:"float","default-value":0,doc:"The spacing between repeated occurrences of the same shield on a line"},"minimum-padding":{css:"shield-min-padding","default-value":0,doc:"Determines the minimum amount of padding that a shield gets relative to other shields",type:"float"},"wrap-width":{css:"shield-wrap-width",type:"unsigned","default-value":0,doc:"Length of a chunk of text in characters before wrapping text"},"wrap-before":{css:"shield-wrap-before",type:"boolean","default-value":!1,doc:"Wrap text before wrap-width is reached. If false, wrapped lines will be a bit longer than wrap-width."},"wrap-character":{css:"shield-wrap-character",type:"string","default-value":" ",doc:"Use this character instead of a space to wrap long names."},"halo-fill":{css:"shield-halo-fill",type:"color","default-value":"#FFFFFF","default-meaning":"white",doc:"Specifies the color of the halo around the text."},"halo-radius":{css:"shield-halo-radius",doc:"Specify the radius of the halo in pixels","default-value":0,"default-meaning":"no halo",type:"float"},"character-spacing":{css:"shield-character-spacing",type:"unsigned","default-value":0,doc:"Horizontal spacing between characters (in pixels). Currently works for point placement only, not line placement."},"line-spacing":{css:"shield-line-spacing",doc:"Vertical spacing between lines of multiline labels (in pixels)",type:"unsigned"},dx:{css:"shield-text-dx",type:"float",doc:"Displace text within shield by fixed amount, in pixels, +/- along the X axis.  A positive value will shift the text right","default-value":0},dy:{css:"shield-text-dy",type:"float",doc:"Displace text within shield by fixed amount, in pixels, +/- along the Y axis.  A positive value will shift the text down","default-value":0},"shield-dx":{css:"shield-dx",type:"float",doc:"Displace shield by fixed amount, in pixels, +/- along the X axis.  A positive value will shift the text right","default-value":0},"shield-dy":{css:"shield-dy",type:"float",doc:"Displace shield by fixed amount, in pixels, +/- along the Y axis.  A positive value will shift the text down","default-value":0},opacity:{css:"shield-opacity",type:"float",doc:"(Default 1.0) - opacity of the image used for the shield","default-value":1},"text-opacity":{css:"shield-text-opacity",type:"float",doc:"(Default 1.0) - opacity of the text placed on top of the shield","default-value":1},"horizontal-alignment":{css:"shield-horizontal-alignment",type:["left","middle","right","auto"],doc:"The shield's horizontal alignment from its centerpoint","default-value":"auto"},"vertical-alignment":{css:"shield-vertical-alignment",type:["top","middle","bottom","auto"],doc:"The shield's vertical alignment from its centerpoint","default-value":"middle"},"text-transform":{css:"shield-text-transform",type:["none","uppercase","lowercase","capitalize"],doc:"Transform the case of the characters","default-value":"none"},"justify-alignment":{css:"shield-justify-alignment",type:["left","center","right","auto"],doc:"Define how text in a shield's label is justified","default-value":"auto"},clip:{css:"shield-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},"comp-op":{css:"shield-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},"line-pattern":{file:{css:"line-pattern-file",type:"uri","default-value":"none",required:!0,doc:"An image file to be repeated and warped along a line"},clip:{css:"line-pattern-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"line-pattern-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"line-pattern-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"line-pattern-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},"polygon-pattern":{file:{css:"polygon-pattern-file",type:"uri","default-value":"none",required:!0,doc:"Image to use as a repeated pattern fill within a polygon"},alignment:{css:"polygon-pattern-alignment",type:["local","global"],"default-value":"local",doc:"Specify whether to align pattern fills to the layer or to the map."},gamma:{css:"polygon-pattern-gamma",type:"float","default-value":1,"default-meaning":"fully antialiased",range:"0-1",doc:"Level of antialiasing of polygon pattern edges"},opacity:{css:"polygon-pattern-opacity",type:"float",doc:"(Default 1.0) - Apply an opacity level to the image used for the pattern","default-value":1,"default-meaning":"The image is rendered without modifications"},clip:{css:"polygon-pattern-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},smooth:{css:"polygon-pattern-smooth",type:"float","default-value":0,"default-meaning":"no smoothing",range:"0-1",doc:"Smooths out geometry angles. 0 is no smoothing, 1 is fully smoothed. Values greater than 1 will produce wild, looping geometries."},"geometry-transform":{css:"polygon-pattern-geometry-transform",type:"functions","default-value":"none","default-meaning":"geometry will not be transformed",doc:"Allows transformation functions to be applied to the geometry.",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]]},"comp-op":{css:"polygon-pattern-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},raster:{opacity:{css:"raster-opacity","default-value":1,"default-meaning":"opaque",type:"float",doc:"The opacity of the raster symbolizer on top of other symbolizers."},"filter-factor":{css:"raster-filter-factor","default-value":-1,"default-meaning":"Allow the datasource to choose appropriate downscaling.",type:"float",doc:"This is used by the Raster or Gdal datasources to pre-downscale images using overviews. Higher numbers can sometimes cause much better scaled image output, at the cost of speed."},scaling:{css:"raster-scaling",type:["near","fast","bilinear","bilinear8","bicubic","spline16","spline36","hanning","hamming","hermite","kaiser","quadric","catrom","gaussian","bessel","mitchell","sinc","lanczos","blackman"],"default-value":"near",doc:"The scaling algorithm used to making different resolution versions of this raster layer. Bilinear is a good compromise between speed and accuracy, while lanczos gives the highest quality."},"mesh-size":{css:"raster-mesh-size","default-value":16,"default-meaning":"Reprojection mesh will be 1/16 of the resolution of the source image",type:"unsigned",doc:"A reduced resolution mesh is used for raster reprojection, and the total image size is divided by the mesh-size to determine the quality of that mesh. Values for mesh-size larger than the default will result in faster reprojection but might lead to distortion."},"comp-op":{css:"raster-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},point:{file:{css:"point-file",type:"uri",required:!1,"default-value":"none",doc:"Image file to represent a point"},"allow-overlap":{css:"point-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping points are shown or hidden.","default-meaning":"Do not allow points to overlap with each other - overlapping markers will not be shown."},"ignore-placement":{css:"point-ignore-placement",type:"boolean","default-value":!1,"default-meaning":"do not store the bbox of this geometry in the collision detector cache",doc:"value to control whether the placement of the feature will prevent the placement of other features"},opacity:{css:"point-opacity",type:"float","default-value":1,"default-meaning":"Fully opaque",doc:"A value from 0 to 1 to control the opacity of the point"},placement:{css:"point-placement",type:["centroid","interior"],doc:"How this point should be placed. Centroid calculates the geometric center of a polygon, which can be outside of it, while interior always places inside of a polygon.","default-value":"centroid"},transform:{css:"point-transform",type:"functions",functions:[["matrix",6],["translate",2],["scale",2],["rotate",3],["skewX",1],["skewY",1]],"default-value":"","default-meaning":"No transformation",doc:"SVG transformation definition"},"comp-op":{css:"point-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},text:{name:{css:"text-name",type:"string",expression:!0,required:!0,"default-value":"",serialization:"content",doc:"Value to use for a text label. Data columns are specified using brackets like [column_name]"},"face-name":{css:"text-face-name",type:"string",validate:"font",doc:"Font name and style to render a label in",required:!0},size:{css:"text-size",type:"float","default-value":10,doc:"Text size in pixels"},"text-ratio":{css:"text-ratio",doc:"Define the amount of text (of the total) present on successive lines when wrapping occurs","default-value":0,type:"unsigned"},"wrap-width":{css:"text-wrap-width",doc:"Length of a chunk of text in characters before wrapping text","default-value":0,type:"unsigned"},"wrap-before":{css:"text-wrap-before",type:"boolean","default-value":!1,doc:"Wrap text before wrap-width is reached. If false, wrapped lines will be a bit longer than wrap-width."},"wrap-character":{css:"text-wrap-character",type:"string","default-value":" ",doc:"Use this character instead of a space to wrap long text."},spacing:{css:"text-spacing",type:"unsigned",doc:"Distance between repeated text labels on a line (aka. label-spacing)"},"character-spacing":{css:"text-character-spacing",type:"float","default-value":0,doc:"Horizontal spacing adjustment between characters in pixels"},"line-spacing":{css:"text-line-spacing","default-value":0,type:"unsigned",doc:"Vertical spacing adjustment between lines in pixels"},"label-position-tolerance":{css:"text-label-position-tolerance","default-value":0,type:"unsigned",doc:"Allows the label to be displaced from its ideal position by a number of pixels (only works with placement:line)"},"max-char-angle-delta":{css:"text-max-char-angle-delta",type:"float","default-value":"22.5",doc:"The maximum angle change, in degrees, allowed between adjacent characters in a label. This value internally is converted to radians to the default is 22.5*math.pi/180.0. The higher the value the fewer labels will be placed around around sharp corners."},fill:{css:"text-fill",doc:"Specifies the color for the text","default-value":"#000000",type:"color"},opacity:{css:"text-opacity",doc:"A number from 0 to 1 specifying the opacity for the text","default-value":1,"default-meaning":"Fully opaque",type:"float"},"halo-fill":{css:"text-halo-fill",type:"color","default-value":"#FFFFFF","default-meaning":"white",doc:"Specifies the color of the halo around the text."},"halo-radius":{css:"text-halo-radius",doc:"Specify the radius of the halo in pixels","default-value":0,"default-meaning":"no halo",type:"float"},dx:{css:"text-dx",type:"float",doc:"Displace text by fixed amount, in pixels, +/- along the X axis.  A positive value will shift the text right","default-value":0},dy:{css:"text-dy",type:"float",doc:"Displace text by fixed amount, in pixels, +/- along the Y axis.  A positive value will shift the text down","default-value":0},"vertical-alignment":{css:"text-vertical-alignment",type:["top","middle","bottom","auto"],doc:"Position of label relative to point position.","default-value":"auto","default-meaning":'Default affected by value of dy; "bottom" for dy>0, "top" for dy<0.'},"avoid-edges":{css:"text-avoid-edges",doc:"Tell positioning algorithm to avoid labeling near intersection edges.","default-value":!1,type:"boolean"},"minimum-distance":{css:"text-min-distance",doc:"Minimum permitted distance to the next text symbolizer.",type:"float"},"minimum-padding":{css:"text-min-padding",doc:"Determines the minimum amount of padding that a text symbolizer gets relative to other text",type:"float"},"minimum-path-length":{css:"text-min-path-length",type:"float","default-value":0,"default-meaning":"place labels on all paths",doc:"Place labels only on paths longer than this value."},"allow-overlap":{css:"text-allow-overlap",type:"boolean","default-value":!1,doc:"Control whether overlapping text is shown or hidden.","default-meaning":"Do not allow text to overlap with other text - overlapping markers will not be shown."},orientation:{css:"text-orientation",type:"float",expression:!0,doc:"Rotate the text."},placement:{css:"text-placement",type:["point","line","vertex","interior"],"default-value":"point",doc:"Control the style of placement of a point versus the geometry it is attached to."},"placement-type":{css:"text-placement-type",doc:'Re-position and/or re-size text to avoid overlaps. "simple" for basic algorithm (using text-placements string,) "dummy" to turn this feature off.',type:["dummy","simple"],"default-value":"dummy"},placements:{css:"text-placements",type:"string","default-value":"",doc:'If "placement-type" is set to "simple", use this "POSITIONS,[SIZES]" string. An example is `text-placements: "E,NE,SE,W,NW,SW";` '},"text-transform":{css:"text-transform",type:["none","uppercase","lowercase","capitalize"],doc:"Transform the case of the characters","default-value":"none"},"horizontal-alignment":{css:"text-horizontal-alignment",type:["left","middle","right","auto"],doc:"The text's horizontal alignment from its centerpoint","default-value":"auto"},"justify-alignment":{css:"text-align",type:["left","right","center","auto"],doc:"Define how text is justified","default-value":"auto","default-meaning":"Auto alignment means that text will be centered by default except when using the `placement-type` parameter - in that case either right or left justification will be used automatically depending on where the text could be fit given the `text-placements` directives"},clip:{css:"text-clip",type:"boolean","default-value":!0,"default-meaning":"geometry will be clipped to map bounds before rendering",doc:"geometries are clipped to map bounds by default for best rendering performance. In some cases users may wish to disable this to avoid rendering artifacts."},"comp-op":{css:"text-comp-op","default-value":"src-over","default-meaning":"add the current symbolizer on top of other symbolizer",doc:"Composite operation. This defines how this symbolizer should behave relative to symbolizers atop or below it.",type:["clear","src","dst","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","plus","minus","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","contrast","invert","invert-rgb","grain-merge","grain-extract","hue","saturation","color","value"]}},building:{fill:{css:"building-fill","default-value":"#FFFFFF",doc:"The color of the buildings walls.",type:"color"},"fill-opacity":{css:"building-fill-opacity",type:"float",doc:"The opacity of the building as a whole, including all walls.","default-value":1},height:{css:"building-height",doc:"The height of the building in pixels.",type:"float",expression:!0,"default-value":"0"}},torque:{"-torque-clear-color":{css:"-torque-clear-color",type:"color","default-value":"rgba(255, 255, 255, 0)","default-meaning":"full clear",doc:"color used to clear canvas on each frame"},"-torque-frame-count":{css:"-torque-frame-count","default-value":"128",type:"float","default-meaning":"the data is broken into 128 time frames",doc:"Number of animation steps/frames used in the animation. If the data contains a fewere number of total frames, the lesser value will be used."},"-torque-resolution":{css:"-torque-resolution","default-value":"2",type:"float","default-meaning":"",doc:"Spatial resolution in pixels. A resolution of 1 means no spatial aggregation of the data. Any other resolution of N results in spatial aggregation into cells of NxN pixels. The value N must be power of 2"},"-torque-animation-duration":{css:"-torque-animation-duration","default-value":"30",type:"float","default-meaning":"the animation lasts 30 seconds",doc:"Animation duration in seconds"},"-torque-aggregation-function":{css:"-torque-aggregation-function","default-value":"count(cartodb_id)",type:"string","default-meaning":"the value for each cell is the count of points in that cell",doc:"A function used to calculate a value from the aggregate data for each cell. See -torque-resolution"},"-torque-time-attribute":{css:"-torque-time-attribute","default-value":"time",type:"string","default-meaning":"the data column in your table that is of a time based type",doc:"The table column that contains the time information used create the animation"},"-torque-data-aggregation":{css:"-torque-data-aggregation","default-value":"linear",type:["linear","cumulative"],"default-meaning":"previous values are discarded",doc:"A linear animation will discard previous values while a cumulative animation will accumulate them until it restarts"}}},colors:{aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50],transparent:[0,0,0,0]},filter:{value:["true","false","null","point","linestring","polygon","collection"]}};b.exports={version:{latest:d,"2.1.1":d}}},{}],8:[function(a,b,c){"undefined"!=typeof b&&(b.exports.find=function(a,b){for(var c,d=0;d<a.length;d++)if(c=b.call(a,a[d]))return c;return null})},{}],9:[function(a,b,c){(function(b){!function(c){var d=b._||a("underscore");c.Call=function(a,b,c){this.name=a,this.args=b,this.index=c},c.Call.prototype={is:"call",ev:function(a){for(var b=this.args.map(function(b){return b.ev(a)}),e=0;e<b.length;e++)if("undefined"===b[e].is)return{is:"undefined",value:"undefined"};if(this.name in c.functions){if(c.functions[this.name].length<=b.length){var f=c.functions[this.name].apply(c.functions,b);return null===f?(a.error({message:"incorrect arguments given to "+this.name+"()",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):f}return a.error({message:"incorrect number of arguments for "+this.name+"(). "+c.functions[this.name].length+" expected.",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}}var g=c.Reference.mapnikFunctions[this.name];if(void 0===g){var h=d.pairs(c.Reference.mapnikFunctions),i=this.name,j=h.map(function(a){return[a[0],c.Reference.editDistance(i,a[0]),a[1]]}).sort(function(a,b){return a[1]-b[1]});return a.error({message:"unknown function "+this.name+"(), did you mean "+j[0][0]+"("+j[0][2]+")",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}}return g===b.length||Array.isArray(g)&&d.include(g,b.length)||-1===g?(this.args=b,this):(a.error({message:"function "+this.name+"() takes "+g+" arguments and was given "+b.length,
index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"})},toString:function(a,b){return this.args.length?this.name+"("+this.args.join(",")+")":this.name}}}(a("../tree"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":8,underscore:38}],10:[function(a,b,c){!function(a){a.Color=function(a,b){Array.isArray(a)?this.rgb=a.slice(0,3):6==a.length?this.rgb=a.match(/.{2}/g).map(function(a){return parseInt(a,16)}):this.rgb=a.split("").map(function(a){return parseInt(a+a,16)}),"number"==typeof b?this.alpha=b:4===a.length?this.alpha=a[3]:this.alpha=1},a.Color.prototype={is:"color",ev:function(){return this},toString:function(){return this.alpha<1?"rgba("+this.rgb.map(function(a){return Math.round(a)}).concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(a){return a=Math.round(a),a=(a>255?255:0>a?0:a).toString(16),1===a.length?"0"+a:a}).join("")},operate:function(b,c,d){var e=[];d instanceof a.Color||(d=d.toColor());for(var f=0;3>f;f++)e[f]=a.operate(c,this.rgb[f],d.rgb[f]);return new a.Color(e)},toHSL:function(){var a,b,c=this.rgb[0]/255,d=this.rgb[1]/255,e=this.rgb[2]/255,f=this.alpha,g=Math.max(c,d,e),h=Math.min(c,d,e),i=(g+h)/2,j=g-h;if(g===h)a=b=0;else{switch(b=i>.5?j/(2-g-h):j/(g+h),g){case c:a=(d-e)/j+(e>d?6:0);break;case d:a=(e-c)/j+2;break;case e:a=(c-d)/j+4}a/=6}return{h:360*a,s:b,l:i,a:f}}}}(a("../tree"))},{"../tree":8}],11:[function(a,b,c){!function(a){a.Comment=function(a,b){this.value=a,this.silent=!!b},a.Comment.prototype={toString:function(a){return"<!--"+this.value+"-->"},ev:function(){return this}}}(a("../tree"))},{"../tree":8}],12:[function(a,b,c){(function(b){!function(c){function d(a){function b(a){return a[1].toUpperCase()}return a.charAt(0).toUpperCase()+a.slice(1).replace(/\-./,b)+"Symbolizer"}function e(a){return a.sort(function(a,b){return a[1]-b[1]}).map(function(a){return a[0]})}var f=a("assert"),g=b._||a("underscore");c.Definition=function(a,b){this.elements=a.elements,f.ok(a.filters instanceof c.Filterset),this.rules=b,this.ruleIndex={};for(var d=0;d<this.rules.length;d++)"zoom"in this.rules[d]&&(this.rules[d]=this.rules[d].clone()),this.rules[d].zoom=a.zoom,this.ruleIndex[this.rules[d].updateID()]=!0;this.filters=a.filters,this.zoom=a.zoom,this.frame_offset=a.frame_offset,this.attachment=a.attachment||"__default__",this.specificity=a.specificity()},c.Definition.prototype.toString=function(){for(var a=this.filters.toString(),b=0;b<this.rules.length;b++)a+="\n    "+this.rules[b];return a},c.Definition.prototype.clone=function(a){a&&f.ok(a instanceof c.Filterset);var b=Object.create(c.Definition.prototype);return b.rules=this.rules.slice(),b.ruleIndex=g.clone(this.ruleIndex),b.filters=a?a:this.filters.clone(),b.attachment=this.attachment,b},c.Definition.prototype.addRules=function(a){for(var b=0,c=0;c<a.length;c++)this.ruleIndex[a[c].id]||(this.rules.push(a[c]),this.ruleIndex[a[c].id]=!0,b++);return b},c.Definition.prototype.appliesTo=function(a,b){for(var c=0,d=this.elements.length;d>c;c++){var e=this.elements[c];if(!(e.wildcard||"class"===e.type&&b[e.clean]||"id"===e.type&&a===e.clean))return!1}return!0},c.Definition.prototype.symbolizersToXML=function(a,b,f){var g=f.toXML(a).join("")+this.filters.toXML(a),h=[],i=[];for(var j in b){i=[];for(var k in b[j])i.push(b[j][k].index);var l=Math.min.apply(Math,i);h.push([j,l])}h=e(h);for(var m=0,n=0;n<h.length;n++){var o=b[h[n]],p=h[n].split("/").pop();if("*"!==p){m++;var q=c.Reference.requiredProperties(p,o);if(q){var r=o[Object.keys(o).shift()];a.error({message:q,index:r.index,filename:r.filename})}var s,t=d(p),u=!0;g+="    <"+t+" ";for(var v in o){"map"===p&&a.error({message:"Map properties are not permitted in other rules",index:o[v].index,filename:o[v].filename});var w=c.Reference.selector(o[v].name);w&&w.serialization&&"content"===w.serialization?(u=!1,s=o[v].ev(a).toXML(a,!0)):w&&w.serialization&&"tag"===w.serialization?(u=!1,s=o[v].ev(a).toXML(a,!0)):g+=o[v].ev(a).toXML(a)+" "}u?g+="/>\n":"undefined"!=typeof s&&(g+=-1!=s.indexOf("<")?">"+s+"</"+t+">\n":"><![CDATA["+s+"]]></"+t+">\n")}}return m&&g?"  <Rule>\n"+g+"  </Rule>\n":""},c.Definition.prototype.collectSymbolizers=function(a,b){for(var c,d={},e=b;e<this.rules.length;e++){c=this.rules[e];var f=c.instance+"/"+c.symbolizer;!(a.current&c.zoom)||f in d&&c.name in d[f]||(a.current&=c.zoom,f in d||(d[f]={}),d[f][c.name]=c)}return Object.keys(d).length?(a.rule&=a.available&=~a.current,d):void 0},c.Definition.prototype.toXML=function(a,b){var d=this.filters.toString();d in b||(b[d]=c.Zoom.all);for(var e,f=c.Zoom.all,g="",h={available:c.Zoom.all},i=0;i<this.rules.length&&f;i++)if(h.rule=this.rules[i].zoom,b[d]&h.rule)for(;h.current=h.rule&f;)if(e=this.collectSymbolizers(h,i)){if(!(b[d]&h.current))continue;g+=this.symbolizersToXML(a,e,(new c.Zoom).setZoom(b[d]&h.current)),b[d]&=~h.current}return g},c.Definition.prototype.toJS=function(a){var b={},d="("+this.zoom+" & (1 << ctx.zoom))",e=this.frame_offset,f=this.filters.toJS(a),h=[d];return f&&h.push(f),e&&h.push('ctx["frame-offset"] === '+e),f=h.join(" && "),g.each(this.rules,function(d){if(!(d instanceof c.Rule))throw new Error("Ruleset not supported");b[d.name]=b[d.name]||[];var e={index:d.index,symbolizer:d.symbolizer};f?e.js="if("+f+"){"+d.value.toJS(a)+"}":e.js=d.value.toJS(a),e.constant="field"!==d.value.ev(a).is,e.filtered=!!f,b[d.name].push(e)}),b}}(a("../tree"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":8,assert:324,underscore:38}],13:[function(a,b,c){(function(b){!function(c){var d=b._||a("underscore");c.Dimension=function(a,b,c){this.value=parseFloat(a),this.unit=b||null,this.index=c},c.Dimension.prototype={is:"float",physical_units:["m","cm","in","mm","pt","pc"],screen_units:["px","%"],all_units:["m","cm","in","mm","pt","pc","px","%"],densities:{m:.0254,mm:25.4,cm:2.54,pt:72,pc:6},ev:function(a){if(this.unit&&!d.contains(this.all_units,this.unit))return a.error({message:"Invalid unit: '"+this.unit+"'",index:this.index}),{is:"undefined",value:"undefined"};if(this.unit&&d.contains(this.physical_units,this.unit)){if(!a.ppi)return a.error({message:"ppi is not set, so metric units can't be used",index:this.index}),{is:"undefined",value:"undefined"};this.value=this.value/this.densities[this.unit]*a.ppi,this.unit="px"}return this},round:function(){return this.value=Math.round(this.value),this},toColor:function(){return new c.Color([this.value,this.value,this.value])},round:function(){return this.value=Math.round(this.value),this},toString:function(){return this.value.toString()},operate:function(a,b,d){return"%"===this.unit&&"%"!==d.unit?(a.error({message:"If two operands differ, the first must not be %",index:this.index}),{is:"undefined",value:"undefined"}):"%"!==this.unit&&"%"===d.unit?"*"===b||"/"===b||"%"===b?(a.error({message:"Percent values can only be added or subtracted from other values",index:this.index}),{is:"undefined",value:"undefined"}):new c.Dimension(c.operate(b,this.value,this.value*d.value*.01),this.unit):new c.Dimension(c.operate(b,this.value,d.value),this.unit||d.unit)}}}(a("../tree"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":8,underscore:38}],14:[function(a,b,c){!function(a){a.Element=function(a){this.value=a.trim(),"#"===this.value[0]&&(this.type="id",this.clean=this.value.replace(/^#/,"")),"."===this.value[0]&&(this.type="class",this.clean=this.value.replace(/^\./,"")),-1!==this.value.indexOf("*")&&(this.type="wildcard")},a.Element.prototype.specificity=function(){return["id"===this.type?1:0,"class"===this.type?1:0]},a.Element.prototype.toString=function(){return this.value}}(a("../tree"))},{"../tree":8}],15:[function(a,b,c){!function(a){a.Expression=function(a){this.value=a},a.Expression.prototype={is:"expression",ev:function(b){return this.value.length>1?new a.Expression(this.value.map(function(a){return a.ev(b)})):this.value[0].ev(b)},toString:function(a){return this.value.map(function(b){return b.toString(a)}).join(" ")}}}(a("../tree"))},{"../tree":8}],16:[function(a,b,c){!function(a){a.Field=function(a){this.value=a||""},a.Field.prototype={is:"field",toString:function(){return"["+this.value+"]"},ev:function(){return this}}}(a("../tree"))},{"../tree":8}],17:[function(a,b,c){!function(a){a.Filter=function(a,b,c,d,e){this.key=a,this.op=b,this.val=c,this.index=d,this.filename=e,this.id=this.key+this.op+this.val};var b={"<":[" &lt; ","numeric"],">":[" &gt; ","numeric"],"=":[" = ","both"],"!=":[" != ","both"],"<=":[" &lt;= ","numeric"],">=":[" &gt;= ","numeric"],"=~":[".match(","string",")"]};a.Filter.prototype.ev=function(a){return this.key=this.key.ev(a),this.val=this.val.ev(a),this},a.Filter.prototype.toXML=function(c){a.Reference.data.filter&&("keyword"===this.key.is&&-1===a.Reference.data.filter.value.indexOf(this.key.toString())&&c.error({message:this.key.toString()+" is not a valid keyword in a filter expression",index:this.index,filename:this.filename}),"keyword"===this.val.is&&-1===a.Reference.data.filter.value.indexOf(this.val.toString())&&c.error({message:this.val.toString()+" is not a valid keyword in a filter expression",index:this.index,filename:this.filename}));var d=this.key.toString(!1),e=this.val.toString("string"==this.val.is);return("numeric"==b[this.op][1]&&isNaN(e)&&"field"!==this.val.is||"string"==b[this.op][1]&&"'"!=e[0])&&c.error({message:'Cannot use operator "'+this.op+'" with value '+this.val,index:this.index,filename:this.filename}),d+b[this.op][0]+e+(b[this.op][2]||"")},a.Filter.prototype.toString=function(){return"["+this.id+"]"}}(a("../tree"))},{"../tree":8}],18:[function(a,b,c){(function(b){var c=a("../tree"),d=b._||a("underscore");c.Filterset=function(){this.filters={}},c.Filterset.prototype.toXML=function(a){var b=[];for(var c in this.filters)b.push("("+this.filters[c].toXML(a).trim()+")");return b.length?"    <Filter>"+b.join(" and ")+"</Filter>\n":""},c.Filterset.prototype.toString=function(){var a=[];for(var b in this.filters)a.push(this.filters[b].id);return a.sort().join("	")},c.Filterset.prototype.ev=function(a){for(var b in this.filters)this.filters[b].ev(a);return this},c.Filterset.prototype.clone=function(){var a=new c.Filterset;for(var b in this.filters)a.filters[b]=this.filters[b];return a},c.Filterset.prototype.cloneWith=function(a){var b=[];for(var d in a.filters){var e=this.addable(a.filters[d]);if(e===!1)return!1;e===!0&&b.push(a.filters[d])}if(!b.length)return null;var f=new c.Filterset;for(d in this.filters)f.filters[d]=this.filters[d];for(;d=b.shift();)f.add(d);return f},c.Filterset.prototype.toJS=function(a){var b={"=":"==="};return d.map(this.filters,function(a){var c=a.op;c in b&&(c=b[c]);var d=a.val;void 0!==a._val&&(d=a._val.toString(!0));var e="data";return e+"."+a.key.value+" "+c+" "+("string"===d.is?"'"+d.toString().replace(/'/g,"\\'")+"'":d)}).join(" && ")},c.Filterset.prototype.addable=function(a){var b=a.key.toString(),c=a.val.toString();switch(c.match(/^[0-9]+(\.[0-9]*)?$/)&&(c=parseFloat(c)),a.op){case"=":return void 0!==this.filters[b+"="]?this.filters[b+"="].val.toString()!=c?!1:null:void 0!==this.filters[b+"!="+c]?!1:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?!1:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?!1:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>c?!1:!(void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<c);case"=~":return!0;case"!=":return void 0!==this.filters[b+"="]?this.filters[b+"="].val==c?!1:null:void 0!==this.filters[b+"!="+c]?null:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?null:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?null:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>c?null:void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<c?null:!0;case">":return b+"="in this.filters?this.filters[b+"="].val<=c?!1:null:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?!1:void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<=c?!1:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?null:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>c?null:!0;case">=":return void 0!==this.filters[b+"="]?this.filters[b+"="].val<c?!1:null:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?!1:void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<c?!1:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?null:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>=c?null:!0;case"<":return void 0!==this.filters[b+"="]?this.filters[b+"="].val>=c?!1:null:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?!1:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>=c?!1:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?null:void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<c?null:!0;case"<=":return void 0!==this.filters[b+"="]?this.filters[b+"="].val>c?!1:null:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?!1:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>c?!1:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?null:void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<=c?null:!0}},c.Filterset.prototype.conflict=function(a){var b=a.key.toString(),c=a.val.toString();return isNaN(parseFloat(c))||(c=parseFloat(c)),"="===a.op&&void 0!==this.filters[b+"="]&&c!=this.filters[b+"="].val.toString()||"!="===a.op&&void 0!==this.filters[b+"="]&&c==this.filters[b+"="].val.toString()||"="===a.op&&void 0!==this.filters[b+"!="]&&c==this.filters[b+"!="].val.toString()?a.toString()+" added to "+this.toString()+" produces an invalid filter":!1},c.Filterset.prototype.add=function(a,b){var c,d=a.key.toString(),e=a.op,f=this.conflict(a);if(f)return f;if("="===e){for(var g in this.filters)this.filters[g].key==d&&delete this.filters[g];this.filters[d+"="]=a}else if("!="===e)this.filters[d+"!="+a.val]=a;else if("=~"===e)this.filters[d+"=~"+a.val]=a;else if(">"===e){for(var h in this.filters)this.filters[h].key==d&&this.filters[h].val<=a.val&&delete this.filters[h];this.filters[d+">"]=a}else if(">="===e){for(var i in this.filters)c=+this.filters[i].val.toString(),this.filters[i].key==d&&c<a.val&&delete this.filters[i];void 0!==this.filters[d+"!="+a.val]?(delete this.filters[d+"!="+a.val],a.op=">",this.filters[d+">"]=a):this.filters[d+">="]=a}else if("<"===e){for(var j in this.filters)c=+this.filters[j].val.toString(),this.filters[j].key==d&&c>=a.val&&delete this.filters[j];this.filters[d+"<"]=a}else if("<="===e){for(var k in this.filters)c=+this.filters[k].val.toString(),this.filters[k].key==d&&c>a.val&&delete this.filters[k];void 0!==this.filters[d+"!="+a.val]?(delete this.filters[d+"!="+a.val],a.op="<",this.filters[d+"<"]=a):this.filters[d+"<="]=a}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":8,underscore:38}],19:[function(a,b,c){!function(a){a._getFontSet=function(b,c){var d=c.join("");if(b._fontMap&&b._fontMap[d])return b._fontMap[d];var e=new a.FontSet(b,c);return b.effects.push(e),b._fontMap||(b._fontMap={}),b._fontMap[d]=e,e},a.FontSet=function(a,b){this.fonts=b,this.name="fontset-"+a.effects.length},a.FontSet.prototype.toXML=function(a){return'<FontSet name="'+this.name+'">\n'+this.fonts.map(function(a){return'  <Font face-name="'+a+'"/>'}).join("\n")+"\n</FontSet>"}}(a("../tree"))},{"../tree":8}],20:[function(a,b,c){var d=a("../tree");d.FrameOffset=function(a,b,c){if(b=parseInt(b,10),b>d.FrameOffset.max||0>=b)throw{message:"Only frame-offset levels between 1 and "+d.FrameOffset.max+" supported.",index:c};if("="!==a)throw{message:"only = operator is supported for frame-offset",index:c};return b},d.FrameOffset.max=32,d.FrameOffset.none=0},{"../tree":8}],21:[function(a,b,c){!function(a){a.ImageFilter=function(a,b){this.filter=a,this.args=b||null},a.ImageFilter.prototype={is:"imagefilter",ev:function(){return this},toString:function(){return this.args?this.filter+"("+this.args.join(",")+")":this.filter}}}(a("../tree"))},{"../tree":8}],22:[function(a,b,c){!function(a){a.Invalid=function(a,b,c){this.chunk=a,this.index=b,this.type="syntax",this.message=c||"Invalid code: "+this.chunk},a.Invalid.prototype.is="invalid",a.Invalid.prototype.ev=function(a){return a.error({chunk:this.chunk,index:this.index,type:"syntax",message:this.message||"Invalid code: "+this.chunk}),{is:"undefined"}}}(a("../tree"))},{"../tree":8}],23:[function(a,b,c){!function(a){a.Keyword=function(a){this.value=a;var b={transparent:"color","true":"boolean","false":"boolean"};this.is=b[a]?b[a]:"keyword"},a.Keyword.prototype={ev:function(){return this},toString:function(){return this.value}}}(a("../tree"))},{"../tree":8}],24:[function(a,b,c){!function(a){a.LayerXML=function(b,c){var d=[];for(var e in b.Datasource)d.push('<Parameter name="'+e+'"><![CDATA['+b.Datasource[e]+"]]></Parameter>");var f="";for(var g in b.properties)f+="minzoom"===g?'  maxzoom="'+a.Zoom.ranges[b.properties[g]]+'"\n':"maxzoom"===g?'  minzoom="'+a.Zoom.ranges[b.properties[g]+1]+'"\n':"  "+g+'="'+b.properties[g]+'"\n';return'<Layer name="'+b.name+'"\n'+f+("undefined"==typeof b.status?"":'  status="'+b.status+'"\n')+("undefined"==typeof b.srs?"":'  srs="'+b.srs+'"')+">\n    "+c.reverse().map(function(a){return"<StyleName>"+a+"</StyleName>"}).join("\n    ")+(d.length?"\n    <Datasource>\n       "+d.join("\n       ")+"\n    </Datasource>\n":"")+"  </Layer>\n"}}(a("../tree"))},{"../tree":8}],25:[function(a,b,c){!function(a){a.Literal=function(a){this.value=a||"",this.is="field"},a.Literal.prototype={toString:function(){return this.value},ev:function(){return this}}}(a("../tree"))},{"../tree":8}],26:[function(a,b,c){!function(a){a.Operation=function(a,b,c){this.op=a.trim(),this.operands=b,this.index=c},a.Operation.prototype.is="operation",a.Operation.prototype.ev=function(b){var c,d=this.operands[0].ev(b),e=this.operands[1].ev(b);return"undefined"===d.is||"undefined"===e.is?{is:"undefined",value:"undefined"}:(d instanceof a.Dimension&&e instanceof a.Color&&("*"===this.op||"+"===this.op?(c=e,e=d,d=c):b.error({name:"OperationError",message:"Can't substract or divide a color from a number",index:this.index})),d instanceof a.Quoted&&e instanceof a.Quoted&&"+"!==this.op?(b.error({message:"Can't subtract, divide, or multiply strings.",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):d instanceof a.Field||e instanceof a.Field||d instanceof a.Literal||e instanceof a.Literal?"color"===d.is||"color"===e.is?(b.error({message:"Can't subtract, divide, or multiply colors in expressions.",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):new a.Literal(d.ev(b).toString(!0)+this.op+e.ev(b).toString(!0)):void 0===d.operate?(b.error({message:"Cannot do math with type "+d.is+".",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):d.operate(b,this.op,e))},a.operate=function(a,b,c){switch(a){case"+":return b+c;case"-":return b-c;case"*":return b*c;case"%":return b%c;case"/":return b/c}}}(a("../tree"))},{"../tree":8}],27:[function(a,b,c){!function(a){a.Quoted=function(a){this.value=a||""},a.Quoted.prototype={is:"string",toString:function(a){var b=this.value.replace(/&/g,"&amp;"),c=b.replace(/\'/g,"\\'").replace(/\"/g,"&quot;").replace(/</g,"&lt;").replace(/\>/g,"&gt;");return a===!0?"'"+c+"'":b},ev:function(){return this},operate:function(b,c,d){return new a.Quoted(a.operate(c,this.toString(),d.toString(this.contains_field)))}}}(a("../tree"))},{"../tree":8}],28:[function(a,b,c){(function(b){!function(c){function d(a){var b={};for(var c in a.symbolizers)for(var d in a.symbolizers[c])a.symbolizers[c][d].hasOwnProperty("css")&&(b[a.symbolizers[c][d].css]=[a.symbolizers[c][d],c,d]);return b}function e(a){var b={};for(var c in a.symbolizers)for(var d in a.symbolizers[c])if("functions"===a.symbolizers[c][d].type)for(var e=0;e<a.symbolizers[c][d].functions.length;e++){var f=a.symbolizers[c][d].functions[e];b[f[0]]=f[1]}return b}function f(a){var b={};for(var c in a.symbolizers){b[c]=[];for(var d in a.symbolizers[c])a.symbolizers[c][d].required&&b[c].push(a.symbolizers[c][d].css)}return b}function g(a,b){if("string"===a.value[0].is)return!0;for(var c in a.value)for(var d in a.value[c].value){if("call"!==a.value[c].value[d].is)return!1;var e=i.find(j.selector(b).functions,function(b){return b[0]==a.value[c].value[d].name});if(!(e&&-1==e[1]||e&&e[1]===a.value[c].value[d].args.length))return!1}return!0}function h(a,b){return"object"==typeof j.selector(b).type?-1!==j.selector(b).type.indexOf(a.value[0].value):"string"===j.selector(b).type}var i=b._||a("underscore"),j={};j.setData=function(a){j.data=a,j.selector_cache=d(a),j.mapnikFunctions=e(a),j.mapnikFunctions.matrix=[6],j.mapnikFunctions.translate=[1,2],j.mapnikFunctions.scale=[1,2],j.mapnikFunctions.rotate=[1,3],j.mapnikFunctions.skewX=[1],j.mapnikFunctions.skewY=[1],j.required_cache=f(a)},j.setVersion=function(b){var c=a("mapnik-reference");return c.version.hasOwnProperty(b)?(j.setData(c.version[b]),!0):!1},j.selectorData=function(a,b){return j.selector_cache[a]?j.selector_cache[a][b]:void 0},j.validSelector=function(a){return!!j.selector_cache[a]},j.selectorName=function(a){return j.selectorData(a,2)},j.selector=function(a){return j.selectorData(a,0)},j.symbolizer=function(a){return j.selectorData(a,1)},j.requiredProperties=function(a,b){var c=j.required_cache[a];for(var d in c)if(!(c[d]in b))return"Property "+c[d]+" required for defining "+a+" styles."},j._validateValue={font:function(a,b){return a.validation_data&&a.validation_data.fonts?-1!=a.validation_data.fonts.indexOf(b):!0}},j.isFont=function(a){return"font"==j.selector(a).validate},j.editDistance=function(a,b){if(0===a.length)return b.length;if(0===b.length)return a.length;for(var c=[],d=0;d<=b.length;d++)c[d]=[d];for(var e=0;e<=a.length;e++)c[0][e]=e;for(d=1;d<=b.length;d++)for(e=1;e<=a.length;e++)b.charAt(d-1)==a.charAt(e-1)?c[d][e]=c[d-1][e-1]:c[d][e]=Math.min(c[d-1][e-1]+1,Math.min(c[d][e-1]+1,c[d-1][e]+1));return c[b.length][a.length]},j.validValue=function(a,b,c){var d;if(j.selector(b)){if("keyword"==c.value[0].is)return h(c,b);if("undefined"==c.value[0].is)return!0;if("numbers"==j.selector(b).type){for(d in c.value)if("float"!==c.value[d].is)return!1;return!0}if("tags"==j.selector(b).type){if(!c.value)return!1;if(!c.value[0].value)return"tag"===c.value[0].is;for(d=0;d<c.value[0].value.length;d++)if("tag"!==c.value[0].value[d].is)return!1;return!0}if("functions"==j.selector(b).type)return g(c,b);if("unsigned"===j.selector(b).type)return"float"===c.value[0].is?(c.value[0].round(),!0):!1;if(j.selector(b).expression)return!0;if(j.selector(b).validate){var e=!1;for(d=0;d<c.value.length;d++)if(j.selector(b).type==c.value[d].is&&j._validateValue[j.selector(b).validate](a,c.value[d].value))return!0;return e}return j.selector(b).type==c.value[0].is}return!1},c.Reference=j}(a("../tree"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":8,"mapnik-reference":37,underscore:38}],29:[function(a,b,c){!function(a){function b(b){return Object.keys(a.Reference.selector_cache).map(function(c){return[c,a.Reference.editDistance(b,c)]}).sort(function(a,b){return a[1]-b[1]})}a.Rule=function(b,c,d,e){var f=b.split("/");this.name=f.pop(),this.instance=f.length?f[0]:"__default__",this.value=c instanceof a.Value?c:new a.Value([c]),this.index=d,this.symbolizer=a.Reference.symbolizer(this.name),this.filename=e,this.variable="@"===b.charAt(0)},a.Rule.prototype.is="rule",a.Rule.prototype.clone=function(){var b=Object.create(a.Rule.prototype);return b.name=this.name,b.value=this.value,b.index=this.index,b.instance=this.instance,b.symbolizer=this.symbolizer,b.filename=this.filename,b.variable=this.variable,b},a.Rule.prototype.updateID=function(){return this.id=this.zoom+"#"+this.instance+"#"+this.name},a.Rule.prototype.toString=function(){return"["+a.Zoom.toString(this.zoom)+"] "+this.name+": "+this.value},a.Rule.prototype.toXML=function(c,d,e,f){if(!a.Reference.validSelector(this.name)){var g=b(this.name),h="";return g[0][1]<3&&(h=". Did you mean "+g[0][0]+"?"),c.error({message:"Unrecognized rule: "+this.name+h,index:this.index,type:"syntax",filename:this.filename})}if(this.value instanceof a.Value&&!a.Reference.validValue(c,this.name,this.value)){if(a.Reference.selector(this.name)){var i;return i=a.Reference.selector(this.name).validate?a.Reference.selector(this.name).validate:"object"==typeof a.Reference.selector(this.name).type?"keyword (options: "+a.Reference.selector(this.name).type.join(", ")+")":a.Reference.selector(this.name).type,c.error({message:"Invalid value for "+this.name+", the type "+i+" is expected. "+this.value+" (of type "+this.value.value[0].is+")  was given.",index:this.index,type:"syntax",filename:this.filename})}return c.error({message:"Unrecognized property: "+this.name,index:this.index,type:"syntax",filename:this.filename})}if(this.variable)return"";if(a.Reference.isFont(this.name)&&this.value.value.length>1){var j=a._getFontSet(c,this.value.value);return'fontset-name="'+j.name+'"'}return d?this.value.toString(c,this.name,e):a.Reference.selectorName(this.name)+'="'+this.value.toString(c,this.name)+'"'},a.Rule.prototype.ev=function(b){return new a.Rule(this.name,this.value.ev(b),this.index,this.filename)}}(a("../tree"))},{"../tree":8}],30:[function(a,b,c){!function(a){a.Ruleset=function(a,b){this.selectors=a,this.rules=b,this._lookups={}},a.Ruleset.prototype={is:"ruleset",ev:function(b){var c,d=new a.Ruleset(this.selectors,this.rules.slice(0));for(d.root=this.root,b.frames.unshift(d),c=0,rule;c<d.rules.length;c++)rule=d.rules[c],d.rules[c]=rule.ev?rule.ev(b):rule;return b.frames.shift(),d},match:function(a){return!a||0===a.length},variables:function(){return this._variables?this._variables:this._variables=this.rules.reduce(function(b,c){return c instanceof a.Rule&&c.variable===!0&&(b[c.name]=c),b},{})},variable:function(a){return this.variables()[a]},rulesets:function(){return this._rulesets?this._rulesets:this._rulesets=this.rules.filter(function(b){return b instanceof a.Ruleset})},find:function(b,c){c=c||this;var d,e=[],f=b.toString();return f in this._lookups?this._lookups[f]:(this.rulesets().forEach(function(f){if(f!==c)for(var g=0;g<f.selectors.length;g++)if(d=b.match(f.selectors[g])){b.elements.length>1?Array.prototype.push.apply(e,f.find(new a.Selector(null,null,null,b.elements.slice(1)),c)):e.push(f);break}}),this._lookups[f]=e)},evZooms:function(b){for(var c=0;c<this.selectors.length;c++){for(var d=a.Zoom.all,e=0;e<this.selectors[c].zoom.length;e++)d&=this.selectors[c].zoom[e].ev(b).zoom;this.selectors[c].zoom=d}},flatten:function(b,c,d){var e,f,g=[];for(0===this.selectors.length&&(d.frames=d.frames.concat(this.rules)),this.evZooms(d),e=0;e<this.selectors.length;e++){var h=this.selectors[e];if(h.filters)if(c.length)for(f=0;f<c.length;f++){var i=c[f],j=i.filters.cloneWith(h.filters);if(null===j){if(i.zoom===(i.zoom&h.zoom)&&i.frame_offset===h.frame_offset&&i.attachment===h.attachment&&i.elements.join()===h.elements.join()){g.push(i);continue}j=i.filters}else if(!j)continue;var k=Object.create(a.Selector.prototype);k.filters=j,k.zoom=i.zoom&h.zoom,k.frame_offset=h.frame_offset,k.elements=i.elements.concat(h.elements),i.attachment&&h.attachment?k.attachment=i.attachment+"/"+h.attachment:k.attachment=h.attachment||i.attachment,k.conditions=i.conditions+h.conditions,k.index=h.index,g.push(k)}else g.push(h)}var l=[];for(e=0;e<this.rules.length;e++){var m=this.rules[e];m instanceof a.Ruleset?m.flatten(b,g,d):m instanceof a.Rule?l.push(m):m instanceof a.Invalid&&d.error(m)}var n=l.length?l[0].index:!1;for(e=0;e<g.length;e++)n!==!1&&(g[e].index=n),b.push(new a.Definition(g[e],l.slice()));return b}}}(a("../tree"))},{"../tree":8}],31:[function(a,b,c){!function(a){a.Selector=function(b,c,d,e,f,g,h){this.elements=e||[],this.attachment=f,this.filters=b||{},this.frame_offset=d,this.zoom="undefined"!=typeof c?c:a.Zoom.all,this.conditions=g,this.index=h},a.Selector.prototype.specificity=function(){return this.elements.reduce(function(a,b){var c=b.specificity();return a[0]+=c[0],a[1]+=c[1],a},[0,0,this.conditions,this.index])}}(a("../tree"))},{"../tree":8}],32:[function(a,b,c){(function(b){!function(c){var d=b._||a("underscore");c.StyleXML=function(a,b,c,e){for(var f={},g=[],h=[],i=[],j=[],k=[],l=0;l<c.length;l++)for(var m=0;m<c[l].rules.length;m++)"image-filters"===c[l].rules[m].name&&g.push(c[l].rules[m]),"image-filters-inflate"===c[l].rules[m].name&&h.push(c[l].rules[m]),"direct-image-filters"===c[l].rules[m].name&&i.push(c[l].rules[m]),"comp-op"===c[l].rules[m].name&&j.push(c[l].rules[m]),"opacity"===c[l].rules[m].name&&k.push(c[l].rules[m]);var n=c.map(function(a){return a.toXML(e,f)}),o="";g.length&&(o+=' image-filters="'+d.chain(g).uniq(function(a){return a.id}).map(function(a){return a.ev(e).toXML(e,!0,",","image-filter")}).value().join(",")+'"'),h.length&&(o+=' image-filters-inflate="'+h[0].value.ev(e).toString()+'"'),i.length&&(o+=' direct-image-filters="'+d.chain(i).uniq(function(a){return a.id}).map(function(a){return a.ev(e).toXML(e,!0,",","direct-image-filter")}).value().join(",")+'"'),j.length&&"src-over"!=j[0].value.ev(e).value&&(o+=' comp-op="'+j[0].value.ev(e).toString()+'"'),k.length&&1!=k[0].value.ev(e).value&&(o+=' opacity="'+k[0].value.ev(e).toString()+'"');var p=n.join("");return o||p?'<Style name="'+a+'" filter-mode="first"'+o+">\n"+p+"</Style>":""}}(a("../tree"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":8,underscore:38}],33:[function(a,b,c){!function(a){a.URL=function(a,b){this.value=a,this.paths=b},a.URL.prototype={is:"uri",toString:function(){return this.value.toString()},ev:function(b){return new a.URL(this.value.ev(b),this.paths)}}}(a("../tree"))},{"../tree":8}],34:[function(a,b,c){!function(a){a.Value=function(a){this.value=a},a.Value.prototype={is:"value",ev:function(b){return 1===this.value.length?this.value[0].ev(b):new a.Value(this.value.map(function(a){return a.ev(b)}))},toString:function(a,b,c,d){return this.value.map(function(b){return b.toString(a,d)}).join(c||", ")},clone:function(){var b=Object.create(a.Value.prototype);return Array.isArray(b)?b.value=this.value.slice():b.value=this.value,b.is=this.is,b},toJS:function(a){var b=this.ev(a),c=b.toString();return"color"===b.is||"uri"===b.is||"string"===b.is||"keyword"===b.is?c="'"+c+"'":"field"===b.is?c=c.replace(/\[(.*)\]/g,"data['$1']"):"call"===b.is&&(c=JSON.stringify({name:b.name,args:b.args})),"_value = "+c+";"}}}(a("../tree"))},{"../tree":8}],35:[function(a,b,c){!function(a){a.Variable=function(a,b,c){this.name=a,this.index=b,this.filename=c},a.Variable.prototype={is:"variable",toString:function(){return this.name},ev:function(a){this.name;if(this._css)return this._css;var b=a.frames.filter(function(a){return a.name==this.name}.bind(this));return b.length?b[0].value.ev(a):(a.error({message:"variable "+this.name+" is undefined",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"})}}}(a("../tree"))},{"../tree":8}],36:[function(a,b,c){var d=a("../tree");d.Zoom=function(a,b,c){this.op=a,this.value=b,this.index=c},d.Zoom.prototype.setZoom=function(a){return this.zoom=a,this},d.Zoom.prototype.ev=function(a){var b=0,c=1/0,e=parseInt(this.value.ev(a).toString(),10),f=0;switch((e>d.Zoom.maxZoom||0>e)&&a.error({message:"Only zoom levels between 0 and "+d.Zoom.maxZoom+" supported.",index:this.index}),this.op){case"=":return this.zoom=1<<e,this;case">":b=e+1;break;case">=":b=e;break;case"<":c=e-1;break;case"<=":c=e}for(var g=0;g<=d.Zoom.maxZoom;g++)g>=b&&c>=g&&(f|=1<<g);return this.zoom=f,this},d.Zoom.prototype.toString=function(){return this.zoom},d.Zoom.all=8388607,d.Zoom.maxZoom=22,d.Zoom.ranges={0:1e9,1:5e8,2:2e8,3:1e8,4:5e7,5:25e6,6:125e5,7:65e5,
8:3e6,9:15e5,10:75e4,11:4e5,12:2e5,13:1e5,14:5e4,15:25e3,16:12500,17:5e3,18:2500,19:1500,20:750,21:500,22:250,23:100},d.Zoom.prototype.toXML=function(){var a=[];if(this.zoom!=d.Zoom.all){for(var b=null,c=null,e=0;e<=d.Zoom.maxZoom;e++)this.zoom&1<<e&&(null===b&&(b=e),c=e);b>0&&a.push("    <MaxScaleDenominator>"+d.Zoom.ranges[b]+"</MaxScaleDenominator>\n"),22>c&&a.push("    <MinScaleDenominator>"+d.Zoom.ranges[c+1]+"</MinScaleDenominator>\n")}return a},d.Zoom.prototype.toString=function(){for(var a="",b=0;b<=d.Zoom.maxZoom;b++)a+=this.zoom&1<<b?"X":".";return a}},{"../tree":8}],37:[function(a,b,c){(function(c){var d=(a("fs"),a("path")),e=a("fs").existsSync||a("path").existsSync;b.exports.version={};var f=["2.0.0","2.0.1","2.0.2","2.1.0","2.1.1","2.2.0","2.3.0","3.0.0"];f.map(function(f){b.exports.version[f]=a(d.join(c,f,"reference.json"));var g=d.join(c,f,"datasources.json");e(g)&&(b.exports.version[f].datasources=a(g).datasources)})}).call(this,"/../cartodb.js/node_modules/d3.cartodb/node_modules/carto/node_modules/mapnik-reference")},{fs:323,path:326}],38:[function(a,b,c){b.exports=a(148)},{dup:148}],39:[function(a,b,c){b.exports={name:"carto",version:"0.15.1-cdb1",description:"CartoCSS Stylesheet Compiler",url:"https://github.com/cartodb/carto",repository:{type:"git",url:"git+ssh://git@github.com/cartodb/carto.git"},author:{name:"CartoDB",url:"http://cartodb.com/"},keywords:["maps","css","stylesheets"],contributors:[{name:"Tom MacWright",email:"macwright@gmail.com"},{name:"Konstantin Käfer"},{name:"Alexis Sellier",email:"self@cloudhead.net"},{name:"Raul Ochoa",email:"rochoa@cartodb.com"},{name:"Javi Santana",email:"jsantana@cartodb.com"}],licenses:[{type:"Apache"}],bin:{carto:"./bin/carto"},man:["./man/carto.1"],main:"./lib/carto/index",engines:{node:">=0.4.x"},dependencies:{underscore:"~1.6.0","mapnik-reference":"~6.0.2",optimist:"~0.6.0"},devDependencies:{mocha:"1.12.x",jshint:"0.2.x",sax:"0.1.x",istanbul:"~0.2.14",coveralls:"~2.10.1",browserify:"~7.0.0","uglify-js":"1.3.3"},scripts:{pretest:"npm install",test:"mocha -R spec",coverage:"istanbul cover ./node_modules/.bin/_mocha && coveralls < ./coverage/lcov.info"},gitHead:"27850ed122a6f5dbfc5efa4938d8385bbcbc87c5",readme:"# CartoCSS\n\n[![Build Status](https://secure.travis-ci.org/mapbox/carto.png)](http://travis-ci.org/mapbox/carto)\n\nIs as stylesheet renderer for javascript, It's an evolution of the Mapnik renderer from Mapbox.\nPlease, see original [Mapbox repo](http://github.com/mapbox/carto) for more information and credits\n\n## Quick Start\n\n```javascript\n// shader is a CartoCSS object\n\nvar cartocss = [\n    '#layer {',\n    ' marker-width: [property]',\n    ' marker-fill: red',\n    '}'\n].join('')\nvar shader = new carto.RendererJS().render(cartocss);\nvar layers = shader.getLayers()\nfor (var i = 0; i < layers.length; ++i) {\n    var layer = layers[i];\n    console.log(\"layer name: \", layer.fullName())\n    console.log(\"- frames: \", layer.frames())\n    console.log(\"- attachment: \", layer.attachment())\n\n    var layerShader = layer.getStyle({ property: 1 }, { zoom: 10 })\n    console.log(layerShader['marker-width']) // 1\n    console.log(layerShader['marker-fill']) // #FF0000\n}\n\n```\n\n# API\n\n## RendererJS\n\n### render(cartocss)\n\n## CartoCSS\n\ncompiled cartocss object\n\n### getLayers\n\nreturn the layers, an array of ``CartoCSS.Layer`` object\n\n### getDefault\n\nreturn the default layer (``CartoCSS.Layer``), usually the Map layer\n\n\n### findLayer(where)\n\nfind a layer using where object.\n\n```\nshader.findLayer({ name: 'test' })\n```\n\n## CartoCSS.Layer\n\n### getStyle(props, context)\n\nreturn the evaluated style:\n    - props: object containing properties needed to render the style. If the cartocss style uses\n      some variables they should be passed in this object\n    - context: rendering context variables like ``zoom`` or animation ``frame``\n\n\n\n\n\n\n\n\n\n\n## Reference Documentation\n\n* [mapbox.com/carto](http://mapbox.com/carto/)\n\n\n",readmeFilename:"README.md",bugs:{url:"https://github.com/cartodb/carto/issues"},homepage:"https://github.com/cartodb/carto#readme",_id:"carto@0.15.1-cdb1",_shasum:"e9fc37db0867d45b3776cf08bf4342958038a438",_from:"git://github.com/CartoDB/carto.git#27850ed",_resolved:"git://github.com/CartoDB/carto.git#27850ed122a6f5dbfc5efa4938d8385bbcbc87c5"}},{}],40:[function(a,b,c){!function(a){function b(a){return a}function c(a,b){for(var c=0,d=b.length,e=new Array(d);d>c;++c)e[c]=a[b[c]];return e}function d(a){function b(b,c,d,e){for(;e>d;){var f=d+e>>>1;a(b[f])<c?d=f+1:e=f}return d}function c(b,c,d,e){for(;e>d;){var f=d+e>>>1;c<a(b[f])?e=f:d=f+1}return d}return c.right=c,c.left=b,c}function e(a){function b(a,b,c){for(var e=c-b,f=(e>>>1)+1;--f>0;)d(a,f,e,b);return a}function c(a,b,c){for(var e,f=c-b;--f>0;)e=a[b],a[b]=a[b+f],a[b+f]=e,d(a,1,f,b);return a}function d(b,c,d,e){for(var f,g=b[--e+c],h=a(g);(f=c<<1)<=d&&(d>f&&a(b[e+f])>a(b[e+f+1])&&f++,!(h<=a(b[e+f])));)b[e+c]=b[e+f],c=f;b[e+c]=g}return b.sort=c,b}function f(a){function b(b,d,e,f){var g,h,i,j,k=new Array(f=Math.min(e-d,f));for(h=0;f>h;++h)k[h]=b[d++];if(c(k,0,f),e>d){g=a(k[0]);do(i=a(j=b[d])>g)&&(k[0]=j,g=a(c(k,0,f)[0]));while(++d<e)}return k}var c=e(a);return b}function g(a){function b(b,c,d){for(var e=c+1;d>e;++e){for(var f=e,g=b[e],h=a(g);f>c&&a(b[f-1])>h;--f)b[f]=b[f-1];b[f]=g}return b}return b}function h(a){function b(a,b,e){return(D>e-b?d:c)(a,b,e)}function c(c,d,e){var f,g=(e-d)/6|0,h=d+g,i=e-1-g,j=d+e-1>>1,k=j-g,l=j+g,m=c[h],n=a(m),o=c[k],p=a(o),q=c[j],r=a(q),s=c[l],t=a(s),u=c[i],v=a(u);n>p&&(f=m,m=o,o=f,f=n,n=p,p=f),t>v&&(f=s,s=u,u=f,f=t,t=v,v=f),n>r&&(f=m,m=q,q=f,f=n,n=r,r=f),p>r&&(f=o,o=q,q=f,f=p,p=r,r=f),n>t&&(f=m,m=s,s=f,f=n,n=t,t=f),r>t&&(f=q,q=s,s=f,f=r,r=t,t=f),p>v&&(f=o,o=u,u=f,f=p,p=v,v=f),p>r&&(f=o,o=q,q=f,f=p,p=r,r=f),t>v&&(f=s,s=u,u=f,f=t,t=v,v=f);var w=o,x=p,y=s,z=t;c[h]=m,c[k]=c[d],c[j]=q,c[l]=c[e-1],c[i]=u;var A=d+1,B=e-2,C=z>=x&&x>=z;if(C)for(var D=A;B>=D;++D){var E=c[D],F=a(E);if(x>F)D!==A&&(c[D]=c[A],c[A]=E),++A;else if(F>x)for(;;){var G=a(c[B]);{if(!(G>x)){if(x>G){c[D]=c[A],c[A++]=c[B],c[B--]=E;break}c[D]=c[B],c[B--]=E;break}B--}}}else for(var D=A;B>=D;D++){var E=c[D],F=a(E);if(x>F)D!==A&&(c[D]=c[A],c[A]=E),++A;else if(F>z)for(;;){var G=a(c[B]);{if(!(G>z)){x>G?(c[D]=c[A],c[A++]=c[B],c[B--]=E):(c[D]=c[B],c[B--]=E);break}if(B--,D>B)break}}}if(c[d]=c[A-1],c[A-1]=w,c[e-1]=c[B+1],c[B+1]=y,b(c,d,A-1),b(c,B+2,e),C)return c;if(h>A&&B>i){for(var H,G;(H=a(c[A]))<=x&&H>=x;)++A;for(;(G=a(c[B]))<=z&&G>=z;)--B;for(var D=A;B>=D;D++){var E=c[D],F=a(E);if(x>=F&&F>=x)D!==A&&(c[D]=c[A],c[A]=E),A++;else if(z>=F&&F>=z)for(;;){var G=a(c[B]);{if(!(z>=G&&G>=z)){x>G?(c[D]=c[A],c[A++]=c[B],c[B--]=E):(c[D]=c[B],c[B--]=E);break}if(B--,D>B)break}}}}return b(c,A,B+1)}var d=g(a);return b}function i(a){for(var b=new Array(a),c=-1;++c<a;)b[c]=0;return b}function j(a,b){for(var c=a.length;b>c;)a[c++]=0;return a}function k(a,b){if(b>32)throw new Error("invalid array width!");return a}function l(a,b){return function(c){var d=c.length;return[a.left(c,b,0,d),a.right(c,b,0,d)]}}function m(a,b){var c=b[0],d=b[1];return function(b){var e=b.length;return[a.left(b,c,0,e),a.left(b,d,0,e)]}}function n(a){return[0,a.length]}function o(){return null}function p(){return 0}function q(a){return a+1}function r(a){return a-1}function s(a){return function(b,c){return b+ +a(c)}}function t(a){return function(b,c){return b-a(c)}}function u(){function a(a){var b=z,c=a.length;return c&&(u=u.concat(a),C=H(C,z+=c),F.forEach(function(d){d(a,b,c)})),k}function d(){for(var a=v(z,z),b=[],c=0,d=0;z>c;++c)C[c]?a[c]=d++:b.push(c);D.forEach(function(a){a(0,[],b)}),G.forEach(function(b){b(a)});for(var e,c=0,d=0;z>c;++c)(e=C[c])&&(c!==d&&(C[d]=e,u[d]=u[c]),++d);for(u.length=d;z>d;)C[--z]=0}function g(a){function d(b,d,e){U=b.map(a),V=$(w(e),0,e),U=c(U,V);var f,g=_(U),h=g[0],i=g[1];if(W)for(f=0;e>f;++f)W(U[f],f)||(C[V[f]+d]|=Y);else{for(f=0;h>f;++f)C[V[f]+d]|=Y;for(f=i;e>f;++f)C[V[f]+d]|=Y}if(!d)return S=U,T=V,ca=h,void(da=i);var j=S,k=T,l=0,m=0;for(S=new Array(z),T=v(z,z),f=0;d>l&&e>m;++f)j[l]<U[m]?(S[f]=j[l],T[f]=k[l++]):(S[f]=U[m],T[f]=V[m++]+d);for(;d>l;++l,++f)S[f]=j[l],T[f]=k[l];for(;e>m;++m,++f)S[f]=U[m],T[f]=V[m]+d;g=_(S),ca=g[0],da=g[1]}function g(a,b,c){aa.forEach(function(a){a(U,V,b,c)}),U=V=null}function i(a){for(var b,c=0,d=0;z>c;++c)C[b=T[c]]&&(c!==d&&(S[d]=S[c]),T[d]=a[b],++d);for(S.length=d;z>d;)T[d++]=0;var e=_(S);ca=e[0],da=e[1]}function j(a){var b=a[0],c=a[1];if(W)return W=null,M(function(a,d){return d>=b&&c>d}),ca=b,da=c,X;var d,e,f,g=[],h=[];if(ca>b)for(d=b,e=Math.min(ca,c);e>d;++d)C[f=T[d]]^=Y,g.push(f);else if(b>ca)for(d=ca,e=Math.min(b,da);e>d;++d)C[f=T[d]]^=Y,h.push(f);if(c>da)for(d=Math.max(b,da),e=c;e>d;++d)C[f=T[d]]^=Y,g.push(f);else if(da>c)for(d=Math.max(ca,c),e=da;e>d;++d)C[f=T[d]]^=Y,h.push(f);return ca=b,da=c,D.forEach(function(a){a(Y,g,h)}),X}function k(a){return null==a?K():Array.isArray(a)?J(a):"function"==typeof a?L(a):E(a)}function E(a){return j((_=l(y,a))(S))}function J(a){return j((_=m(y,a))(S))}function K(){return j((_=n)(S))}function L(a){return _=n,M(W=a),ca=0,da=z,X}function M(a){var b,c,d,e=[],f=[];for(b=0;z>b;++b)!(C[c=T[b]]&Y)^!!(d=a(S[b],b))&&(d?(C[c]&=Z,e.push(c)):(C[c]|=Y,f.push(c)));D.forEach(function(a){a(Y,e,f)})}function N(a){for(var b,c=[],d=da;--d>=ca&&a>0;)C[b=T[d]]||(c.push(u[b]),--a);return c}function O(a){for(var b,c=[],d=ca;da>d&&a>0;)C[b=T[d]]||(c.push(u[b]),--a),d++;return c}function P(a){function c(b,c,d,e){function f(){++U===R&&(s=I(s,Q<<=1),K=I(K,Q),R=x(Q))}var k,l,m,n,p,q,r=J,s=v(U,R),t=N,w=P,y=U,A=0,B=0;for(X&&(t=w=o),J=new Array(U),U=0,K=y>1?H(K,z):v(z,R),y&&(m=(l=r[0]).key);e>B&&!((n=a(b[B]))>=n);)++B;for(;e>B;){for(l&&n>=m?(p=l,q=m,s[A]=U,(l=r[++A])&&(m=l.key)):(p={key:n,value:w()},q=n),J[U]=p;!(n>q||(K[k=c[B]+d]=U,C[k]&Z||(p.value=t(p.value,u[k])),++B>=e));)n=a(b[B]);f()}for(;y>A;)J[s[A]=U]=r[A++],f();if(U>A)for(A=0;d>A;++A)K[A]=s[K[A]];k=D.indexOf(V),U>1?(V=g,W=i):(!U&&$&&(U=1,J=[{key:null,value:w()}]),1===U?(V=h,W=j):(V=o,W=o),K=null),D[k]=V}function d(){if(U>1){for(var a=U,b=J,c=v(a,a),d=0,e=0;z>d;++d)C[d]&&(c[K[e]=K[d]]=1,++e);for(J=[],U=0,d=0;a>d;++d)c[d]&&(c[d]=U++,J.push(b[d]));if(U>1)for(var d=0;e>d;++d)K[d]=c[K[d]];else K=null;D[D.indexOf(V)]=U>1?(W=i,V=g):1===U?(W=j,V=h):W=V=o}else if(1===U){if($)return;for(var d=0;z>d;++d)if(C[d])return;J=[],U=0,D[D.indexOf(V)]=V=W=o}}function g(a,b,c){if(a!==Y&&!X){var d,e,f,g;for(d=0,f=b.length;f>d;++d)C[e=b[d]]&Z||(g=J[K[e]],g.value=N(g.value,u[e]));for(d=0,f=c.length;f>d;++d)(C[e=c[d]]&Z)===a&&(g=J[K[e]],g.value=O(g.value,u[e]))}}function h(a,b,c){if(a!==Y&&!X){var d,e,f,g=J[0];for(d=0,f=b.length;f>d;++d)C[e=b[d]]&Z||(g.value=N(g.value,u[e]));for(d=0,f=c.length;f>d;++d)(C[e=c[d]]&Z)===a&&(g.value=O(g.value,u[e]))}}function i(){var a,b;for(a=0;U>a;++a)J[a].value=P();for(a=0;z>a;++a)C[a]&Z||(b=J[K[a]],b.value=N(b.value,u[a]))}function j(){var a,b=J[0];for(b.value=P(),a=0;z>a;++a)C[a]&Z||(b.value=N(b.value,u[a]))}function k(){return X&&(W(),X=!1),J}function l(a){var b=L(k(),0,J.length,a);return M.sort(b,0,b.length)}function m(a,b,c){return N=a,O=b,P=c,X=!0,F}function n(){return m(q,r,p)}function w(a){return m(s(a),t(a),p)}function y(a){function b(b){return a(b.value)}return L=f(b),M=e(b),F}function A(){return y(b)}function B(){return U}function E(){var a=D.indexOf(V);return a>=0&&D.splice(a,1),a=aa.indexOf(c),a>=0&&aa.splice(a,1),a=G.indexOf(d),a>=0&&G.splice(a,1),F}var F={top:l,all:k,reduce:m,reduceCount:n,reduceSum:w,order:y,orderNatural:A,size:B,dispose:E,remove:E};ba.push(F);var J,K,L,M,N,O,P,Q=8,R=x(Q),U=0,V=o,W=o,X=!0,$=a===o;return arguments.length<1&&(a=b),D.push(V),aa.push(c),G.push(d),c(S,T,0,z),n().orderNatural()}function Q(){var a=P(o),b=a.all;return delete a.all,delete a.top,delete a.order,delete a.orderNatural,delete a.size,a.value=function(){return b()[0].value},a}function R(){ba.forEach(function(a){a.dispose()});var a=F.indexOf(d);return a>=0&&F.splice(a,1),a=F.indexOf(g),a>=0&&F.splice(a,1),a=G.indexOf(i),a>=0&&G.splice(a,1),A&=Z,K()}var S,T,U,V,W,X={filter:k,filterExact:E,filterRange:J,filterFunction:L,filterAll:K,top:N,bottom:O,group:P,groupAll:Q,dispose:R,remove:R},Y=~A&-~A,Z=~Y,$=h(function(a){return U[a]}),_=n,aa=[],ba=[],ca=0,da=0;return F.unshift(d),F.push(g),G.push(i),A|=Y,(B>=32?!Y:A&-(1<<B))&&(C=I(C,B<<=1)),d(u,0,z),g(u,0,z),X}function i(){function a(a,b){var c;if(!n)for(c=b;z>c;++c)C[c]||(i=j(i,u[c]))}function b(a,b,c){var d,e,f;if(!n){for(d=0,f=b.length;f>d;++d)C[e=b[d]]||(i=j(i,u[e]));for(d=0,f=c.length;f>d;++d)C[e=c[d]]===a&&(i=k(i,u[e]))}}function c(){var a;for(i=l(),a=0;z>a;++a)C[a]||(i=j(i,u[a]))}function d(a,b,c){return j=a,k=b,l=c,n=!0,m}function e(){return d(q,r,p)}function f(a){return d(s(a),t(a),p)}function g(){return n&&(c(),n=!1),i}function h(){var c=D.indexOf(b);return c>=0&&D.splice(c),c=F.indexOf(a),c>=0&&F.splice(c),m}var i,j,k,l,m={reduce:d,reduceCount:e,reduceSum:f,value:g,dispose:h,remove:h},n=!0;return D.push(b),F.push(a),a(u,0,z),e()}function j(){return z}var k={add:a,remove:d,dimension:g,groupAll:i,size:j},u=[],z=0,A=0,B=8,C=E(0),D=[],F=[],G=[];return arguments.length?a(arguments[0]):k}function v(a,b){return(257>b?E:65537>b?F:G)(a)}function w(a){for(var b=v(a,a),c=-1;++c<a;)b[c]=c;return b}function x(a){return 8===a?256:16===a?65536:4294967296}u.version="1.3.12",u.permute=c;var y=u.bisect=d(b);y.by=d;var z=u.heap=e(b);z.by=e;var A=u.heapselect=f(b);A.by=f;var B=u.insertionsort=g(b);B.by=g;var C=u.quicksort=h(b);C.by=h;var D=32,E=i,F=i,G=i,H=j,I=k;"undefined"!=typeof Uint8Array&&(E=function(a){return new Uint8Array(a)},F=function(a){return new Uint16Array(a)},G=function(a){return new Uint32Array(a)},H=function(a,b){if(a.length>=b)return a;var c=new a.constructor(b);return c.set(a),c},I=function(a,b){var c;switch(b){case 16:c=F(a.length);break;case 32:c=G(a.length);break;default:throw new Error("invalid array width!")}return c.set(a),c}),a.crossfilter=u}("undefined"!=typeof c&&c||this)},{}],41:[function(a,b,c){b.exports=a("./crossfilter").crossfilter},{"./crossfilter":40}],42:[function(a,b,c){!function(a,d){"object"==typeof c&&"undefined"!=typeof b?d(c):"function"==typeof define&&define.amd?define(["exports"],d):d(a.topojson={})}(this,function(a){"use strict";function b(){}function c(a){if(!a)return b;var c,d,e=a.scale[0],f=a.scale[1],g=a.translate[0],h=a.translate[1];return function(a,b){b||(c=d=0),a[0]=(c+=a[0])*e+g,a[1]=(d+=a[1])*f+h}}function d(a){if(!a)return b;var c,d,e=a.scale[0],f=a.scale[1],g=a.translate[0],h=a.translate[1];return function(a,b){b||(c=d=0);var i=(a[0]-g)/e|0,j=(a[1]-h)/f|0;a[0]=i-c,a[1]=j-d,c=i,d=j}}function e(a,b){for(var c,d=a.length,e=d-b;e<--d;)c=a[e],a[e++]=a[d],a[d]=c}function f(a,b){for(var c=0,d=a.length;d>c;){var e=c+d>>>1;a[e]<b?c=e+1:d=e}return c}function g(a,b){return"GeometryCollection"===b.type?{type:"FeatureCollection",features:b.geometries.map(function(b){return h(a,b)})}:h(a,b)}function h(a,b){var c={type:"Feature",id:b.id,properties:b.properties||{},geometry:i(a,b)};return null==b.id&&delete c.id,c}function i(a,b){function d(a,b){b.length&&b.pop();for(var c,d=l[0>a?~a:a],f=0,g=d.length;g>f;++f)b.push(c=d[f].slice()),k(c,f);0>a&&e(b,g)}function f(a){return a=a.slice(),k(a,0),a}function g(a){for(var b=[],c=0,e=a.length;e>c;++c)d(a[c],b);return b.length<2&&b.push(b[0].slice()),b}function h(a){for(var b=g(a);b.length<4;)b.push(b[0].slice());return b}function i(a){return a.map(h)}function j(a){var b=a.type;return"GeometryCollection"===b?{type:b,geometries:a.geometries.map(j)}:b in m?{type:b,coordinates:m[b](a)}:null}var k=c(a.transform),l=a.arcs,m={Point:function(a){return f(a.coordinates)},MultiPoint:function(a){return a.coordinates.map(f)},LineString:function(a){return g(a.arcs)},MultiLineString:function(a){return a.arcs.map(g)},Polygon:function(a){return i(a.arcs)},MultiPolygon:function(a){return a.arcs.map(i)}};return j(b)}function j(a,b){function c(b){var c,d=a.arcs[0>b?~b:b],e=d[0];return a.transform?(c=[0,0],d.forEach(function(a){c[0]+=a[0],c[1]+=a[1]})):c=d[d.length-1],0>b?[c,e]:[e,c]}function d(a,b){for(var c in a){var d=a[c];delete b[d.start],delete d.start,delete d.end,d.forEach(function(a){e[0>a?~a:a]=1}),h.push(d)}}var e={},f={},g={},h=[],i=-1;return b.forEach(function(c,d){var e,f=a.arcs[0>c?~c:c];f.length<3&&!f[1][0]&&!f[1][1]&&(e=b[++i],b[i]=c,b[d]=e)}),b.forEach(function(a){var b,d,e=c(a),h=e[0],i=e[1];if(b=g[h])if(delete g[b.end],b.push(a),b.end=i,d=f[i]){delete f[d.start];var j=d===b?b:b.concat(d);f[j.start=b.start]=g[j.end=d.end]=j}else f[b.start]=g[b.end]=b;else if(b=f[i])if(delete f[b.start],b.unshift(a),b.start=h,d=g[h]){delete g[d.end];var k=d===b?b:d.concat(b);f[k.start=d.start]=g[k.end=b.end]=k}else f[b.start]=g[b.end]=b;else b=[a],f[b.start=h]=g[b.end=i]=b}),d(g,f),d(f,g),b.forEach(function(a){e[0>a?~a:a]||h.push([a])}),h}function k(a){return i(a,l.apply(this,arguments))}function l(a,b,c){function d(a){var b=0>a?~a:a;(k[b]||(k[b]=[])).push({i:a,g:i})}function e(a){a.forEach(d)}function f(a){a.forEach(e)}function g(a){"GeometryCollection"===a.type?a.geometries.forEach(g):a.type in l&&(i=a,l[a.type](a.arcs))}var h=[];if(arguments.length>1){var i,k=[],l={LineString:e,MultiLineString:f,Polygon:f,MultiPolygon:function(a){a.forEach(f)}};g(b),k.forEach(arguments.length<3?function(a){h.push(a[0].i)}:function(a){c(a[0].g,a[a.length-1].g)&&h.push(a[0].i)})}else for(var m=0,n=a.arcs.length;n>m;++m)h.push(m);return{type:"MultiLineString",arcs:j(a,h)}}function m(a){var b=a[0],c=a[1],d=a[2];return Math.abs((b[0]-d[0])*(c[1]-b[1])-(b[0]-c[0])*(d[1]-b[1]))}function n(a){for(var b,c=-1,d=a.length,e=a[d-1],f=0;++c<d;)b=e,e=a[c],f+=b[0]*e[1]-b[1]*e[0];return f/2}function o(a){return i(a,p.apply(this,arguments))}function p(a,b){function c(a){a.forEach(function(b){b.forEach(function(b){(e[b=0>b?~b:b]||(e[b]=[])).push(a)})}),f.push(a)}function d(b){return n(i(a,{type:"Polygon",arcs:[b]}).coordinates[0])>0}var e={},f=[],g=[];return b.forEach(function(a){"Polygon"===a.type?c(a.arcs):"MultiPolygon"===a.type&&a.arcs.forEach(c)}),f.forEach(function(a){if(!a._){var b=[],c=[a];for(a._=1,g.push(b);a=c.pop();)b.push(a),a.forEach(function(a){a.forEach(function(a){e[0>a?~a:a].forEach(function(a){a._||(a._=1,c.push(a))})})})}}),f.forEach(function(a){delete a._}),{type:"MultiPolygon",arcs:g.map(function(b){var c,f=[];if(b.forEach(function(a){a.forEach(function(a){a.forEach(function(a){e[0>a?~a:a].length<2&&f.push(a)})})}),f=j(a,f),(c=f.length)>1)for(var g,h=d(b[0][0]),i=0;c>i;++i)if(h===d(f[i])){g=f[0],f[0]=f[i],f[i]=g;break}return f})}}function q(a){function b(a,b){a.forEach(function(a){0>a&&(a=~a);var c=e[a];c?c.push(b):e[a]=[b]})}function c(a,c){a.forEach(function(a){b(a,c)})}function d(a,b){"GeometryCollection"===a.type?a.geometries.forEach(function(a){d(a,b)}):a.type in h&&h[a.type](a.arcs,b)}var e={},g=a.map(function(){return[]}),h={LineString:b,MultiLineString:c,Polygon:c,MultiPolygon:function(a,b){a.forEach(function(a){c(a,b)})}};a.forEach(d);for(var i in e)for(var j=e[i],k=j.length,l=0;k>l;++l)for(var m=l+1;k>m;++m){var n,o=j[l],p=j[m];(n=g[o])[i=f(n,p)]!==p&&n.splice(i,0,p),(n=g[p])[i=f(n,o)]!==o&&n.splice(i,0,o)}return g}function r(a,b){return a[1][2]-b[1][2]}function s(){function a(a,b){for(;b>0;){var c=(b+1>>1)-1,e=d[c];if(r(a,e)>=0)break;d[e._=b]=e,d[a._=b=c]=a}}function b(a,b){for(;;){var c=b+1<<1,f=c-1,g=b,h=d[g];if(e>f&&r(d[f],h)<0&&(h=d[g=f]),e>c&&r(d[c],h)<0&&(h=d[g=c]),g===b)break;d[h._=b]=h,d[a._=b=g]=a}}var c={},d=[],e=0;return c.push=function(b){return a(d[b._=e]=b,e++),e},c.pop=function(){if(!(0>=e)){var a,c=d[0];return--e>0&&(a=d[e],b(d[a._=0]=a,0)),c}},c.remove=function(c){var f,g=c._;if(d[g]===c)return g!==--e&&(f=d[e],(r(f,c)<0?a:b)(d[f._=g]=f,g)),g},c}function t(a,b){function e(a){h.remove(a),a[1][2]=b(a),h.push(a)}var f=c(a.transform),g=d(a.transform),h=s();return b||(b=m),a.arcs.forEach(function(a){var c,d,i,j,k=[],l=0;for(d=0,i=a.length;i>d;++d)j=a[d],f(a[d]=[j[0],j[1],1/0],d);for(d=1,i=a.length-1;i>d;++d)c=a.slice(d-1,d+2),c[1][2]=b(c),k.push(c),h.push(c);for(d=0,i=k.length;i>d;++d)c=k[d],c.previous=k[d-1],c.next=k[d+1];for(;c=h.pop();){var m=c.previous,n=c.next;c[1][2]<l?c[1][2]=l:l=c[1][2],m&&(m.next=n,m[2]=c[2],e(m)),n&&(n.previous=m,n[0]=c[0],e(n))}a.forEach(g)}),a}var u="1.6.24";a.version=u,a.mesh=k,a.meshArcs=l,a.merge=o,a.mergeArcs=p,a.feature=g,a.neighbors=q,a.presimplify=t})},{}],43:[function(a,b,c){(function(a){function c(){for(var a=arguments,b=a[0],c=1;c<a.length;++c){var d=a[c];for(var e in d)b[e]=d[e]}return b}function d(a){return c({},a)}function e(a){return"function"==typeof a||!1}function f(a){return a&&"object"==typeof a&&"[object Array]"===Object.prototype.toString.call(a)}function g(){return!!document.createElement("canvas")}function h(){return"undefined"!=typeof navigator?navigator.userAgent:""}var i={};i.on=function(a,b){var c=this._evt_callbacks=this._evt_callbacks||{},d=c[a]||(c[a]=[]);return d.push(b),this},i.trigger=function(a){for(var b=this._evt_callbacks&&this._evt_callbacks[a],c=0;b&&c<b.length;++c)b[c].apply(this,Array.prototype.slice.call(arguments,1));return this},i.fire=i.trigger,i.off=function(a,b){var c=this._evt_callbacks&&this._evt_callbacks[a];if(c&&!b)return delete this._evt_callbacks[a],this;for(var d=[],e=0;c&&e<c.length;++e)c[e]===b&&d.push(e);for(;void 0!==(e=d.pop());)c.splice(e,1);return this},i.callbacks=function(a){return this._evt_callbacks&&this._evt_callbacks[a]||[]};var j={Uint8Array:"undefined"!=typeof a.Uint8Array?a.Uint8Array:Array,Uint8ClampedArray:"undefined"!=typeof a.Uint8ClampedArray?a.Uint8ClampedArray:Array,Uint32Array:"undefined"!=typeof a.Uint32Array?a.Uint32Array:Array,Int16Array:"undefined"!=typeof a.Int16Array?a.Int16Array:Array,Int32Array:"undefined"!=typeof a.Int32Array?a.Int32Array:Array},k={sprites_to_images:-1===h().indexOf("Safari")&&-1===h().indexOf("Firefox")};b.exports={Event:i,extend:c,clone:d,isFunction:e,isArray:f,types:j,isBrowserSupported:g,flags:k}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(a,b,c){function d(){this.crossfilter=new e,this.dimensions={},this.tiles={},this.visibleTiles=[],this.filters={}}var e=a("crossfilter"),f=a("./");f.d3.extend(d.prototype,f.d3.Event,{addTile:function(a,b){var c=a.x+":"+a.y+":"+a.zoom;return"undefined"!=typeof this.tiles[c]?this.getTile(a):(this.crossfilter.add(b.features.map(function(b){return b.properties.tilePoint=a.x+":"+a.y+":"+a.zoom,b})),this.tiles[c]=!0,this.getTile(a))},removeTile:function(a){var b=a.x+":"+a.y+":"+a.zoom;this.dimensions.tiles&&(this.dimensions.tiles.filter(b),this.crossfilter.remove(),this.dimensions.tiles.filterAll(),delete this.tiles[b])},getTile:function(a){var b=a.x+":"+a.y+":"+a.zoom;this.dimensions.tiles||(this.dimensions.tiles=this.crossfilter.dimension(function(a){return a.properties.tilePoint}));var c={type:"FeatureCollection",features:null};return this.dimensions.tiles.filter(b),c.features=this.dimensions.tiles.top(1/0),this.dimensions.tiles.filterAll(),c},filterRange:function(a,b){this.filter(a,b)},filter:function(a,b){this._createDimension(a),this.dimensions[a].filter(b),this.filters[a]=b,this.fire("filterApplied")},filterAccept:function(a,b){this.filter(a,d.accept(b))},filterReject:function(a,b){this.filter(a,d.reject(b))},clearFilters:function(){for(var a in this.dimensions)this.dimensions[a].filterAll(),delete this.filters[a];this.fire("filterApplied")},clearFilter:function(a){this.dimensions[a].filterAll(),delete this.filters[a],this.fire("filterApplied")},getValues:function(a,b){if(!this.dimensions.tiles)return[];var c=[];if("undefined"==typeof a||a)c=this.dimensions.tiles.top(1/0);else{this._createDimension(b),this.dimensions[b].filterAll();var c=this.dimensions[b].top(1/0);this.dimensions[b].filter(this.filters[b])}for(var d=[],e={},f=0;f<c.length;f++)c[f].properties.cartodb_id in e||(d.push(c[f]),e[c[f].properties.cartodb_id]=!0);var g=this.visibleTiles.tiles;this.visibleTiles.ring;return g&&(d=d.filter(function(a){return this.visibleTiles.se.x>=a.geometry.coordinates[0]&&a.geometry.coordinates[0]>=this.visibleTiles.nw.x&&this.visibleTiles.se.y<=a.geometry.coordinates[1]&&a.geometry.coordinates[1]<=this.visibleTiles.nw.y}.bind(this))),d},getColumnValues:function(a,b){return this._createDimension(a),this.dimensions[a].group().top(b?b:1/0)},setBoundingBox:function(a){this.visibleTiles=a},getMax:function(a){this._createDimension(a);try{return this.dimensions[a].top(1)[0].properties[a]}catch(b){return null}},getMin:function(a){this._createDimension(a);try{return this.dimensions[a].bottom(1)[0].properties[a]}catch(b){return null}},getCount:function(a){return this._createDimension(a),this.dimensions[a].groupAll().value()},_createDimension:function(a){this.dimensions[a]||(this.dimensions[a]=this.crossfilter.dimension(function(b){return b.properties[a]}))}}),d.accept=function(a){if("all"===a)return function(){return!0};if("none"===a)return function(){return!1};var b={};return a.forEach(function(a){b[a]=!0}),function(a){return!!b[a]}},d.reject=function(a){if("all"===a)return function(){return!1};if("none"===a)return function(){return!0};var b={};return a.forEach(function(a){b[a]=!0}),function(a){return!b[a]}},b.exports=d},{"./":46,crossfilter:41}],45:[function(a,b,c){b.exports={tile2lon:function(a,b){return a/Math.pow(2,b)*360-180},tile2lat:function(a,b){var c=Math.PI-2*Math.PI*a/Math.pow(2,b);return 180/Math.PI*Math.atan(.5*(Math.exp(c)-Math.exp(-c)))},geo2Webmercator:function(a,b){a%=180;var c=.017453292519943295*a,d=6378137*c,e=.017453292519943295*b,f=d,g=3189068.5*Math.log((1+Math.sin(e))/(1-Math.sin(e)));return{x:f,y:g}},webmercator2Geo:function(a,b){},wrapX:function(a,b){var c=Math.pow(2,b),d=(a%c+c)%c;return d},hashFeature:function(a,b){var c=b.x,d=b.zoom;"string"==typeof b&&(b=b.split(":"),c=b[0],d=b[2]);var e=Math.floor(c/Math.pow(2,d));return[a,e].join(":")},lng2tile:function(a,b){return Math.floor((a+180)/360*Math.pow(2,b))},lat2tile:function(a,b){return Math.floor((1-Math.log(Math.tan(a*Math.PI/180)+1/Math.cos(a*Math.PI/180))/Math.PI)/2*Math.pow(2,b))},latLng2Tile:function(a,b,c){return{x:this.lng2tile(b,c),y:this.lat2tile(a,c),zoom:c}}}},{}],46:[function(a,b,c){b.exports.d3=a("./core"),a("./leaflet_d3.js");var d={Util:a("./util.js"),geo:a("./geo.js"),Renderer:a("./renderer.js"),net:a("./net.js"),Filter:a("./filter.js"),provider:a("./providers")};for(var e in d)b.exports.d3[e]=d[e]},{"./core":43,"./filter.js":44,"./geo.js":45,"./leaflet_d3.js":47,"./net.js":48,"./providers":49,"./renderer.js":53,"./util.js":55}],47:[function(a,b,c){var d=a("./renderer"),e=a("./providers"),f=a("./tileloader"),g=a("./geo"),h=window.L;h.CartoDBd3Layer=h.TileLayer.extend({options:{minZoom:0,maxZoom:28,tileSize:256,zoomOffset:0,tileBuffer:50},events:{featureOver:null,featureOut:null,featureClick:null},initialize:function(a){a=a||{},this.renderers=[],this.svgTiles={},this.eventCallbacks={},this._animated=!0,h.Util.setOptions(this,a);var b=this.options.styles;b||(b=[this.options.cartocss],this.options.styles=b),this.options.layers&&this.options.user?this.provider=new e.WindshaftProvider(this.options):this.provider=new e.XYZProvider(this.options),this.provider.on("ready",this._resetRenderers.bind(this))},on:function(a,b){a in this.events?this.renderers.length>0?this.renderers.forEach(function(c){c.on(a,b)}):this.eventCallbacks[a]=b:h.TileLayer.prototype.on.call(this,arguments[0],arguments[1])},_getVisibleTiles:function(){for(var a=this._map.getBounds(),b=this._map.getZoom(),c=a.getNorthWest(),d=a.getSouthEast(),e=g.latLng2Tile(c.lat,c.lng,b),f=g.latLng2Tile(d.lat,d.lng,b),h=[],i=[],j=e.y;j<=f.y;j++)for(var k=e.x;k<=f.x;k++)j===e.y||j===f.y||k===e.x||k===f.x?i.push([k,j,b].join(":")):h.push([k,j,b].join(":"));var l=g.geo2Webmercator(d.lng,d.lat),m=g.geo2Webmercator(c.lng,c.lat);return{tiles:h,ring:i,se:l,nw:m}},applyFilter:function(a,b,c){var d=this.renderers[a];switch(b){case"accept":d.filter.filterAccept(c.column,c.values);break;case"reject":d.filter.filterReject(c.column,c.values);break;case"range":d.filter.filterRange(c.column,[c.min,c.max])}d.redraw()},setProvider:function(a){this.styles=a.styles,this.provider.setURL(a.urlTemplate)},setUrl:function(a){this.setProvider({styles:this.options.styles,urlTemplate:a})},featuresLoaded:function(){return this.provider?this.provider.allTilesLoaded():!1},getFilter:function(a){return this.renderers[a].filter},getFeatures:function(){var a=[];return this.renderers.length>0&&this.renderers.forEach(function(b){a.push(b.filter.getValues())}),a},onAdd:function(a){this._map=a,this.options.map=a,this.options.layer=this,this._initContainer(),this.tileLoader=new f({tileSize:this.options.tileSize,maxZoom:this.options.maxZoom,minZoom:this.options.minZoom,provider:this.provider,map:a}),this.tileLoader.loadTiles(),this._tileContainer.setAttribute("class","leaflet-zoom-animated leaflet-tile-container"),this._bgBuffer.setAttribute("class","leaflet-zoom-animated leaflet-tile-container"),this.tileLoader.on("tileAdded",this._renderTile,this),this.tileLoader.on("tileRemoved",this._clearTile,this),this.tileLoader.on("tilesLoaded",function(){this._setBoundingBox(),this.fire("featuresChanged",this.getFeatures())},this),this._map.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim,moveend:this._setBoundingBox},this)},onRemove:function(a){this.tileLoader.unbindAndClearTiles()},addTo:function(a){return a.addLayer(this),this},_setBoundingBox:function(){var a=this._getVisibleTiles();this.renderers.forEach(function(b){b.filter.setBoundingBox(a)})},_resetRenderers:function(){var a=this;this.renderers.length>0&&(this.renderers=[]);var b=this.options.styles;if(b.length>0)for(var c=0;c<b.length;c++)this.renderers.push(new d({cartocss:b[c],index:c,layer:this}));else this.renderers.push(new d({cartocss:"",index:0,layer:this}));for(var e in this.svgTiles){var f=e.split(":"),g={x:parseInt(f[0],10),y:parseInt(f[1],10),zoom:parseInt(f[2],10)};this.tileLoader._loadTile(g)}this.renderers.forEach(function(b){b.filter.on("filterApplied",function(){a.fire("featuresChanged",a.getFeatures())});for(var c in a.eventCallbacks)b.on(c,a.eventCallbacks[c])})},_renderTile:function(a){var b=a.tilePoint,c=a.geometry,d=this,e=b.x+":"+b.y+":"+b.zoom,f=this.svgTiles[e];f||(f=document.createElementNS("http://www.w3.org/2000/svg","svg"),f.setAttribute("class","leaflet-tile"),this.svgTiles[e]=f,this._tileContainer.appendChild(f));for(var g=0;g<d.renderers.length;g++){if(c.features.length>1&&"FeatureCollection"===c.features[0].type){if(c.features.length!==this.renderers.length)return}else if(this.renderers.length>1)return;var i=d.renderers.length>1?c.features[g]:c;d.renderers[g].render(f,i,b)}var j=this._getTilePos(b);f.style.width=f.style.height=this._getTileSize()+"px",h.DomUtil.setPosition(f,j,h.Browser.chrome)},_clearTile:function(a){var b=a.tileKey.split(":"),c={x:b[0],y:b[1],zoom:b[2]};this.renderers.forEach(function(a){a.filter.removeTile(c)}),this._tileContainer.hasChildNodes(this.svgTiles[a.tileKey])&&this._tileContainer.removeChild(this.svgTiles[a.tileKey]),delete this.svgTiles[a.tileKey]},_getTilePos:function(a){a=new h.Point(a.x,a.y);var b=this._map.getPixelOrigin(),c=this._getTileSize();return a.multiplyBy(c).subtract(b)},latLngToLayerPoint:function(a,b){return this._map.latLngToLayerPoint(new h.LatLng(a,b))},_getTileSize:function(){var a=this._map,b=a.getZoom()+this.options.zoomOffset,c=this.options.maxNativeZoom,d=this.options.tileSize;return c&&b>c&&(d=Math.round(a.getZoomScale(b)/a.getZoomScale(c)*d)),d},setCartoCSS:function(a,b){this.options.styles[a]=b,this.renderers[a].setCartoCSS(b)},_getLoadedTilesPercentage:function(a){var b,c,d=a.getElementsByTagName("svg"),e=0;for(b=0,c=d.length;c>b;b++)d[b].complete&&e++;return e/c},_endZoomAnim:function(){var a=this._tileContainer,b=this._bgBuffer;a.style.visibility="",a.parentNode.appendChild(a),b.style.transform="",b.innerHTML="",h.Util.falseFn(b.offsetWidth),this._animating=!1},_stopLoadingImages:function(a){var b,c,d,e=Array.prototype.slice.call(a.getElementsByTagName("svg"));
for(this.tileLoader._tilesLoading={},b=0,c=e.length;c>b;b++)d=e[b],d.parentNode.removeChild(d);this.provider.abortPending()}})},{"./geo":45,"./providers":49,"./renderer":53,"./tileloader":54}],48:[function(a,b,c){(function(c){var d=a("d3");b.exports.jsonp=function(a,b){function c(){for(var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",b="",c=-1;++c<15;)b+=a.charAt(Math.floor(52*Math.random()));return b}function e(a){var d=a.match(/callback=(\w+)/),e=d?d[1]:c();return window[e]=function(a){b(a),delete window[e],g.remove()},e}var f=e(a),g=d.select("head").append("script").attr("type","text/javascript").attr("src",a.replace(/(\{|%7B)callback(\{|%7D)/,f))},b.exports.get=function(a,b,d){function e(){var a=g.status,c="arraybuffer"===d.responseType?g.response:g.responseText;b(!a&&c||a>=200&&300>a||304===a?g:null)}d=d||{method:"GET",data:null,responseType:"text"};var f=window.XMLHttpRequest;!c.XDomainRequest||"withCredentials"in f||!/^(http(s)?:)?\/\//.test(a)||(f=c.XDomainRequest);var g=new f;return g.open(d.method,a,!0),"onload"in g?g.onload=g.onerror=e:g.onreadystatechange=function(){g.readyState>3&&e()},g.onprogress=function(){},g.responseType=d.responseType,d.data&&(g.setRequestHeader("Content-type","application/json"),g.setRequestHeader("Accept","*")),g.send(d.data),g}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{d3:56}],49:[function(a,b,c){b.exports={SQLProvider:a("./sql.js"),XYZProvider:a("./xyz.js"),WindshaftProvider:a("./windshaft.js")}},{"./sql.js":50,"./windshaft.js":51,"./xyz.js":52}],50:[function(a,b,c){function d(a){this.sql_api_template=a.sql_api_template||"http://{user}.cartodb.com",this.user=a.user,this.table=a.table,this.format=a.format,this.tileCache={}}var e=a("d3"),f=a("../geo");d.prototype={getTile:function(a,b){var c=this.tileCache[a.zoom+":"+a.x+":"+a.y];if(c)b(a,c);else{var d={n:f.tile2lat(a.y,a.zoom),s:f.tile2lat(a.y+1,a.zoom),e:f.tile2lon(a.x,a.zoom),w:f.tile2lon(a.x+1,a.zoom)},e="SELECT * FROM "+this.table;e+=" WHERE the_geom && ST_MakeEnvelope({w},{s},{e},{n}, 4326)",e=e.replace("{w}",d.w).replace("{s}",d.s).replace("{e}",d.e).replace("{n}",d.n),this.getGeometry(e,a.zoom,function(c){this.tileCache[a.zoom+":"+a.x+":"+a.y]=c,b(a,c)}.bind(this))}},_query:function(a,b,c){var d=this.sql_api_template.replace("{user}",this.user);d+="/api/v2/sql?q="+encodeURIComponent(a),c&&(d+="&format="+c),e.json(d,b)},getGeometry:function(a,b,c){var d="select * from ("+a+") __cdb limit 0";this._query(d,function(d){var e=Object.keys(d.fields).filter(function(a){return"the_geom"!==a&&"the_geom_webmercator"!==a}),f=this.pixelSizeForZoom(b),g="st_transform(st_simplify(st_snaptogrid(the_geom_webmercator, {px}, {px}), {px}/2), 3857) as the_geom".replace(/{px}/g,f),h="select "+e.join(",")+","+g+" FROM ("+a+") __cdb";this._query(h,function(a){a.features=a.features.filter(function(a){return a.geometry&&a.geometry.coordinates.length>0}),c(a)},"geojson")}.bind(this))},pixelSizeForZoom:function(a){var b=40075017,c=256,d=b/c;return d/Math.pow(2,a)},invalidateCache:function(){this.tileCache={}}},b.exports=d},{"../geo":45,d3:56}],51:[function(a,b,c){function d(a){this.tiler_template=a.tiler_template||"http://{user}.cartodb.com",this.user=a.user,this.layers=a.layers,this.format=a.format,this.options=a,this._tileQueue=[],this.initialize(),this._ready=!1,this.requests={}}var e=a("../"),f=a("./xyz.js");e.d3.extend(d.prototype,e.d3.Event,{initialize:function(){this.tiler_template=this.tiler_template.replace("{user}",this.user);var a=this._generateMapconfig(this.table),b=this.tiler_template+"/api/v1/map?config="+encodeURIComponent(JSON.stringify(a));e.d3.net.jsonp(b+"&callback=mapconfig",function(a){this.layergroup=a,this._ready=!0,this.urlTemplate=this.tiler_template+"/api/v1/map/"+this.layergroup.layergroupid+"/mapnik/{z}/{x}/{y}.geojson",f.prototype._processQueue.apply(this),this.fire("ready")}.bind(this))},getTile:f.prototype.getTile,getGeometry:f.prototype.getGeometry,abortPending:f.prototype.abortPending,allTilesLoaded:f.prototype.allTilesLoaded,_generateMapconfig:function(a){var b={version:"1.0.1",layers:this.layers.map(function(a){return{type:"cartodb",options:{sql:a.sql,cartocss:a.cartocss,cartocss_version:"2.1.1"}}})};return b}}),b.exports=d},{"../":46,"./xyz.js":52}],52:[function(a,b,c){function d(a){this.format=a.format,this.urlTemplate=a.urlTemplate,this.tilejson=a.tilejson,this._tileQueue=[],this._ready=!1,this.requests={},this.urlTemplate?this._setReady():this.tilejson&&(this.urlTemplate=this.tilejson.tiles[0],this._setReady())}var e=a("d3"),f=a("topojson"),g=a("../");g.d3.extend(d.prototype,g.d3.Event,{getTile:function(a,b){if(this._ready){var c=this;this.getGeometry(a,function(d,e){d||("Topology"===e.type&&(c.format="topojson",e=f.feature(e,e.objects.vectile)),c.requests[[a.x,a.y,a.zoom].join(":")].complete=!0,b(a,e))})}else this._tileQueue.push([a,b])},getGeometry:function(a,b){var c=this.urlTemplate.replace("{x}",a.x).replace("{y}",a.y).replace("{z}",a.zoom).replace("{s}","abcd"[a.x*a.y%4]).replace(".png",".geojson"),d=[a.x,a.y,a.zoom].join(":"),f=e.json(c,b);this.requests[d]=f},_setReady:function(){this._ready=!0,window.setTimeout(function(){this.fire("ready"),this._processQueue()}.bind(this),0)},setURL:function(a){this.urlTemplate=a,this._setReady()},abortPending:function(){for(var a in this.requests)this.requests[a].abort();this.requests={}},allTilesLoaded:function(){for(var a in this.requests)if(!this.requests[a].complete)return!1;return!0},_processQueue:function(){var a=this;this._tileQueue.forEach(function(b){a.getTile.apply(a,b)})}}),b.exports=d},{"../":46,d3:56,topojson:42}],53:[function(a,b,c){(function(c){function d(a){if("markers"===a||"labels"===a){var b=e.geo.path().projection(function(a){return a});return function(a){return a._centroid||(a._centroid={type:"Point",properties:a.properties,coordinates:b.centroid(a)})}}return null}var e=c.d3||a("d3"),f=c.cartodb||{},g=c.carto||a("carto"),h=c._||a("underscore"),i=a("./geo"),j=a("./filter");f.d3=e||{},e.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};var k=function(a){this.options=a,this.index=a.index,a.cartocss&&this.setCartoCSS(a.cartocss),this.globalVariables={},this.layer=a.layer,this.filter=new j,this.geometries={}};k.prototype={events:{featureOver:null,featureOut:null,featureClick:null},setGlobal:function(){var a=Array.prototype.slice.call(arguments);2===a.length?this.globalVariables[a[0]]=a[1]:this.globalVariables=a[0]},setCartoCSS:function(a){if(this.renderer=new g.RendererJS,this.shader=this.renderer.render(a),this.layer)for(var b in this.layer.svgTiles){var c=b.split(":");c={x:c[0],y:c[1],zoom:c[2]},this.render(this.layer.svgTiles[b],null,c,!0)}},on:function(a,b){var c=this;"featureOver"===a?this.events.featureOver=function(a){this.style.cursor="pointer";var b=e.select(this),d=b.data()[0].properties,f=k.getIndexFromFeature(this),g=c._getLayerPointFromEvent(c.layer._map,a),h=c.layer._map.layerPointToLatLng(g),i=c.layer._map.layerPointToContainerPoint(g);c.layer.eventCallbacks.featureOver(a,[h.lat,h.lng],i,d,f)}:"featureOut"===a?this.events.featureOut=function(a){var b=e.select(this),d=b.data()[0].properties,f=this.attributes["class"].value;b.reset=function(){b.style(c.styleForSymbolizer(f,"shader"))};var g=k.getIndexFromFeature(this),h=c._getLayerPointFromEvent(c.layer._map,a),i=c.layer._map.layerPointToLatLng(h),j=c.layer._map.layerPointToContainerPoint(h);c.layer.eventCallbacks.featureOut(a,[i.lat,i.lng],j,d,g)}:"featureClick"===a?this.events.featureClick=function(a){var b=e.select(this),d=b.data()[0].properties,f=k.getIndexFromFeature(this),g=c._getLayerPointFromEvent(c.layer._map,a),h=c.layer._map.layerPointToLatLng(g),i=c.layer._map.layerPointToContainerPoint(g);c.layer.eventCallbacks.featureClick(a,[h.lat,h.lng],i,d,f)}:"featuresChanged"===a&&this.filter.on("featuresChanged",b)},_getLayerPointFromEvent:function(a,b){var c,d,e=0,f=0,g=a.getContainer();b.changedTouches&&b.changedTouches.length>0?(c=b.changedTouches[0].clientX+window.scrollX,d=b.changedTouches[0].clientY+window.scrollY):(c=b.clientX,d=b.clientY);var h,i;if(g.offsetParent&&g.offsetTop>0){do e+=g.offsetLeft,f+=g.offsetTop;while(g=g.offsetParent);h=c-e,i=d-f}else{var j=g.getBoundingClientRect(),k=window.scrollX||window.pageXOffset,l=window.scrollY||window.pageYOffset;h=(b.clientX?b.clientX:c)-j.left-g.clientLeft-k,i=(b.clientY?b.clientY:d)-j.top-g.clientTop-l}var m=new L.Point(h,i);return a.containerPointToLayerPoint(m)},redraw:function(a){if(this.layer)for(var b in this.layer.svgTiles){var c=b.split(":");this.layer.svgTiles[b].children[this.index].innerHTML="",c={x:c[0],y:c[1],zoom:c[2]},this.render(this.layer.svgTiles[b],null,c,!1)}},processLayersRules:function(a){var b=["hover"],c=[],d=[],e={};return a.forEach(function(a){-1!==b.indexOf(a.attachment())?d.push(a):(e[a.name()]=a,c.push(a))}),d.forEach(function(a){var b=e[a.name()];b?b[a.attachment()]=a:console.log("attachment without layer")}),c},styleForSymbolizer:function(a,b){return"polygon"===a||"line"===a?{fill:function(a){return a[b]["polygon-fill"]||"none"},"fill-opacity":function(a){return a[b]["polygon-opacity"]},stroke:function(a){return a[b]["line-color"]},"stroke-width":function(a){return a[b]["line-width"]},"stroke-opacity":function(a){return a[b]["line-opacity"]},"mix-blend-mode":function(a){return a[b]["comp-op"]},"stroke-dasharray":function(a){return a[b]["line-dasharray"]}}:"markers"===a?{fill:function(a){return a[b]["marker-fill"]||"none"},"fill-opacity":function(a){return a[b]["marker-fill-opacity"]},stroke:function(a){return a[b]["marker-line-color"]},"stroke-opacity":function(a){return a[b]["marker-line-opacity"]},"stroke-width":function(a){return a[b]["marker-line-width"]},radius:function(a){return a[b]["marker-width"]/2},"mix-blend-mode":function(a){return a[b]["comp-op"]},"stroke-dasharray":function(a){return a[b]["line-dasharray"]}}:"text"===a?{fill:function(a){return a[b]["text-fill"]||"none"},"mix-blend-mode":function(a){return a[b]["comp-op"]}}:void 0},generateProjection:function(a){var b=i.wrapX(a.x,a.zoom);return function(c,d){var e=12756274*Math.PI,f=e/2,g=1/e,h=256*(1<<a.zoom);return c=h*(c+f)*g,d=h*(-d+f)*g,this.stream?void this.stream.point(c-256*b,d-256*a.y):{x:c-256*b,y:d-256*a.y}}},render:function(a,b,c,d){var f=this;b=this.filter.addTile(c,b);var g,h,i=e.select(a);if(a.children[this.index]?(g=e.select(a.children[this.index]),h=g.data()):g=i.append("g"),this.projection=this.generateProjection(c),this.path=e.geo.path().projection(e.geo.transform({point:this.projection})),this.shader&&b&&0!==b.features.length){var j=this.shader.getLayers();j=this.processLayersRules(j),j.forEach(function(a,h){var i,j=g[0][0].children;i=j[h]?e.select(j[h]):g.append("g");var k,l=f._getSymbolizer(a);k=d?i.selectAll("."+l):f._createFeatures(a,b,i[0][0]),this.tilePoint=c,f._styleFeatures(a,k,this)}),i.attr("class",i.attr("class")+" leaflet-tile-loaded")}},_styleFeatures:function(a,b,c){var d=this._getSymbolizer(a),f=this;b.each(function(b){b.properties||(b.properties={});var g=i.hashFeature(b.properties.cartodb_id,c.tilePoint);f.geometries[g]||(f.geometries[g]=[]),f.geometries[g].push(this),b.properties.global=f.globalVariables,b.shader=a.getStyle(b.properties,{zoom:c.tilePoint.zoom,time:f.time}),this.onmousemove=f.events.featureOver,this.onmouseleave=f.events.featureOut,this.onclick=f.events.featureClick,a.hover&&(b.shader_hover=a.hover.getStyle(b.properties,{zoom:c.tilePoint.zoom,time:f.time}),h.defaults(b.shader_hover,b.shader),f.events.featureOver=function(a){this.style.cursor="default";var b=e.select(this).data()[0],c=i.hashFeature(b.properties.cartodb_id,b.properties.tilePoint);f.geometries[c].forEach(function(a){e.select(a).style(f.styleForSymbolizer(d,"shader_hover"))})},f.events.featureOut=function(){var a=e.select(this).data()[0],b=i.hashFeature(a.properties.cartodb_id,a.properties.tilePoint);f.geometries[b].forEach(function(a){e.select(a).style(f.styleForSymbolizer(d,"shader"))})})}),"text"===d&&(b=this._transformText(b));var g=f.styleForSymbolizer(this._getSymbolizer(a),"shader");b.attr("r",g.radius),b.attr("mix-blend-mode",g["mix-blend-mode"]),b.style(g)},_createFeatures:function(a,b,c){var f=this,g=this._getSymbolizer(a),h=b.features,i=d(g);i&&(h=h.map(i));var j=e.select(c).selectAll("."+g).data(h);return"text"===g?j.enter().append("svg:text").attr("class",g):"markers"===g?(j.enter().append("circle").attr("class",g),j.each(function(a){if(a.coordinates[0]){var b=f.projection.apply(this,a.coordinates);this.setAttribute("cx",b.x),this.setAttribute("cy",b.y)}else this.parentElement.removeChild(this)})):(j.enter().append("path").attr("class",g),j.attr("d",this.path)),j.exit().remove(),j},_getSymbolizer:function(a){var b=a.getSymbolizers();return b=h.filter(b,function(a){return"*"!==a}),b=h.uniq(b.map(function(a){return"line"===a?"polygon":a})),b[0]},_transformText:function(a){var b=this;return a.text(function(a){return a.shader["text-name"]}),a.attr("dy",function(a){return a.shader["text-dy"]}),a.attr("text-anchor","middle"),a.attr("x",function(a){if(a.geometry.coordinates[0]){var c=b.projection(a.geometry.coordinates[0],a.geometry.coordinates[1]);return c.x}this.remove()}),a.attr("y",function(a){if(a.geometry.coordinates[0]){var c=b.projection(a.geometry.coordinates[0],a.geometry.coordinates[1]);return c.y}this.remove()}),a}},k.getIndexFromFeature=function(a){for(var b=0,c=a.parentElement.parentElement;c=c.previousSibling;)b++;return b},b.exports=k}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./filter":44,"./geo":45,carto:3,d3:56,underscore:148}],54:[function(a,b,c){var d=window.L;b.exports=d.Class.extend({includes:d.Mixin.Events,initialize:function(a){this.options=a,this.provider=a.provider,this._map=a.map,this._tiles={},this._tilesLoading={},this._tilesToLoad=0,this.lastDrag=0,this._map.on("moveend",this._reloadTiles,this)},loadTiles:function(){this._reloadTiles()},_reloadTiles:function(){if(this._map){var a=this._map.getPixelBounds(),b=this._map.getZoom(),c=this.options.tileSize;if(!(b>this.options.maxZoom||b<this.options.minZoom)){var e=new d.Point(Math.floor(a.min.x/c),Math.floor(a.min.y/c)),f=new d.Point(Math.floor(a.max.x/c),Math.floor(a.max.y/c)),g=new d.Bounds(e,f);this._addTilesFromCenterOut(g),this._removeOtherTiles(g)}}},_addTilesFromCenterOut:function(a){var b,c,e,f=[],g=a.getCenter(),h=this._map.getZoom();for(b=a.min.y;b<=a.max.y;b++)for(c=a.min.x;c<=a.max.x;c++)e=new d.Point(c,b),e.zoom=h,this._tileShouldBeLoaded(e)&&f.push(e);var i=f.length;if(0!==i){for(f.sort(function(a,b){return a.distanceTo(g)-b.distanceTo(g)}),this._tilesToLoad+=i,c=0;i>c;c++)this._loadTile(f[c]);this.fire("tilesLoading")}},_loadTile:function(a){var b=this._tileKey(a);this._tilesLoading[b]=a,this.provider.getTile(a,function(a,c){a.zoom===this._map.getZoom()&&(this._tiles[b]=!0,delete this._tilesLoading[b],this._tilesToLoad--,this.fire("tileAdded",{tilePoint:a,geometry:c}),this.provider.allTilesLoaded()&&this.fire("tilesLoaded"))}.bind(this))},_removeOtherTiles:function(a){var b,c,d,e,f,g=this._map.getZoom();for(f in this._tiles)this._tiles.hasOwnProperty(f)&&(b=f.split(":"),c=parseInt(b[0],10),d=parseInt(b[1],10),e=parseInt(b[2],10),(g!==e||c<a.min.x||c>a.max.x||d<a.min.y||d>a.max.y)&&this._removeTile(f))},unbindAndClearTiles:function(){this._map.off("moveend",this._reloadTiles,this),this._map.off("zoomstart",this._invalidateProviderCache,this),this._removeTiles()},_removeTiles:function(a){for(var b in this._tiles)this._removeTile(b)},_removeTile:function(a){this.fire("tileRemoved",{tileKey:a}),delete this._tiles[a],delete this._tilesLoading[a]},_tileShouldBeLoaded:function(a){var b=this._tileKey(a);return!(b in this._tiles||b in this._tilesLoading)},_tileKey:function(a){return a.x+":"+a.y+":"+a.zoom}})},{}],55:[function(a,b,c){var d=window.L,e=a("../");b.exports={viz:function(a,b,c){e.d3.net.jsonp(a+"?callback=vizjson",function(a){b.setView(JSON.parse(a.center),a.zoom);var e=a.layers[0];e.options.urlTemplate?b.addLayer(new d.TileLayer(e.options.urlTemplate,{subdomains:e.options.subdomains||"abcd"})):e.options.color&&(document.getElementById("map").style["background-color"]=e.options.color);var f=a.layers[1];if("layergroup"===f.type){var g=f.options.layer_definition.layers.map(function(a){return{sql:a.options.sql.replace(/\n/g," "),cartocss:a.options.cartocss}}),h=new d.CartoDBd3Layer({user:f.options.user_name,layers:g,styles:g.map(function(a){return a.cartocss})}).addTo(b);c(null,h,g)}else c(new Error("named maps not supported"))})}}},{"../":46}],56:[function(a,b,c){!function(){function a(a){return a&&(a.ownerDocument||a.document||a).documentElement}function c(a){return a&&(a.ownerDocument&&a.ownerDocument.defaultView||a.document&&a||a.defaultView)}function d(a,b){return b>a?-1:a>b?1:a>=b?0:NaN}function e(a){return null===a?NaN:+a}function f(a){return!isNaN(a)}function g(a){return{left:function(b,c,d,e){for(arguments.length<3&&(d=0),arguments.length<4&&(e=b.length);e>d;){var f=d+e>>>1;a(b[f],c)<0?d=f+1:e=f}return d},right:function(b,c,d,e){for(arguments.length<3&&(d=0),arguments.length<4&&(e=b.length);e>d;){var f=d+e>>>1;a(b[f],c)>0?e=f:d=f+1}return d}}}function h(a){return a.length}function i(a){for(var b=1;a*b%1;)b*=10;return b}function j(a,b){for(var c in b)Object.defineProperty(a.prototype,c,{value:b[c],enumerable:!1})}function k(){this._=Object.create(null)}function l(a){return(a+="")===vg||a[0]===wg?wg+a:a}function m(a){return(a+="")[0]===wg?a.slice(1):a}function n(a){return l(a)in this._}function o(a){return(a=l(a))in this._&&delete this._[a]}function p(){var a=[];for(var b in this._)a.push(m(b));return a}function q(){var a=0;for(var b in this._)++a;return a}function r(){for(var a in this._)return!1;return!0}function s(){this._=Object.create(null)}function t(a){return a}function u(a,b,c){return function(){var d=c.apply(b,arguments);return d===b?a:d}}function v(a,b){if(b in a)return b;b=b.charAt(0).toUpperCase()+b.slice(1);for(var c=0,d=xg.length;d>c;++c){var e=xg[c]+b;if(e in a)return e}}function w(){}function x(){}function y(a){function b(){for(var b,d=c,e=-1,f=d.length;++e<f;)(b=d[e].on)&&b.apply(this,arguments);return a}var c=[],d=new k;return b.on=function(b,e){var f,g=d.get(b);return arguments.length<2?g&&g.on:(g&&(g.on=null,c=c.slice(0,f=c.indexOf(g)).concat(c.slice(f+1)),d.remove(b)),e&&c.push(d.set(b,{on:e})),a)},b}function z(){ig.event.preventDefault()}function A(){for(var a,b=ig.event;a=b.sourceEvent;)b=a;return b}function B(a){for(var b=new x,c=0,d=arguments.length;++c<d;)b[arguments[c]]=y(b);return b.of=function(c,d){return function(e){try{var f=e.sourceEvent=ig.event;e.target=a,ig.event=e,b[e.type].apply(c,d)}finally{ig.event=f}}},b}function C(a){return zg(a,Dg),a}function D(a){return"function"==typeof a?a:function(){return Ag(a,this)}}function E(a){return"function"==typeof a?a:function(){return Bg(a,this)}}function F(a,b){function c(){this.removeAttribute(a)}function d(){this.removeAttributeNS(a.space,a.local)}function e(){this.setAttribute(a,b)}function f(){this.setAttributeNS(a.space,a.local,b)}function g(){var c=b.apply(this,arguments);null==c?this.removeAttribute(a):this.setAttribute(a,c)}function h(){var c=b.apply(this,arguments);null==c?this.removeAttributeNS(a.space,a.local):this.setAttributeNS(a.space,a.local,c)}return a=ig.ns.qualify(a),null==b?a.local?d:c:"function"==typeof b?a.local?h:g:a.local?f:e}function G(a){return a.trim().replace(/\s+/g," ")}function H(a){return new RegExp("(?:^|\\s+)"+ig.requote(a)+"(?:\\s+|$)","g")}function I(a){return(a+"").trim().split(/^|\s+/)}function J(a,b){function c(){for(var c=-1;++c<e;)a[c](this,b)}function d(){for(var c=-1,d=b.apply(this,arguments);++c<e;)a[c](this,d)}a=I(a).map(K);var e=a.length;return"function"==typeof b?d:c}function K(a){var b=H(a);return function(c,d){if(e=c.classList)return d?e.add(a):e.remove(a);var e=c.getAttribute("class")||"";d?(b.lastIndex=0,b.test(e)||c.setAttribute("class",G(e+" "+a))):c.setAttribute("class",G(e.replace(b," ")))}}function L(a,b,c){function d(){this.style.removeProperty(a)}function e(){this.style.setProperty(a,b,c)}function f(){var d=b.apply(this,arguments);null==d?this.style.removeProperty(a):this.style.setProperty(a,d,c)}return null==b?d:"function"==typeof b?f:e}function M(a,b){function c(){delete this[a]}function d(){this[a]=b}function e(){var c=b.apply(this,arguments);null==c?delete this[a]:this[a]=c}return null==b?c:"function"==typeof b?e:d}function N(a){function b(){var b=this.ownerDocument,c=this.namespaceURI;return c?b.createElementNS(c,a):b.createElement(a)}function c(){return this.ownerDocument.createElementNS(a.space,a.local)}return"function"==typeof a?a:(a=ig.ns.qualify(a)).local?c:b}function O(){var a=this.parentNode;a&&a.removeChild(this)}function P(a){return{__data__:a}}function Q(a){return function(){return Cg(this,a)}}function R(a){return arguments.length||(a=d),function(b,c){return b&&c?a(b.__data__,c.__data__):!b-!c}}function S(a,b){for(var c=0,d=a.length;d>c;c++)for(var e,f=a[c],g=0,h=f.length;h>g;g++)(e=f[g])&&b(e,g,c);return a}function T(a){return zg(a,Fg),a}function U(a){var b,c;return function(d,e,f){var g,h=a[f].update,i=h.length;for(f!=c&&(c=f,b=0),e>=b&&(b=e+1);!(g=h[b])&&++b<i;);return g}}function V(a,b,c){function d(){var b=this[g];b&&(this.removeEventListener(a,b,b.$),delete this[g])}function e(){var e=i(b,kg(arguments));d.call(this),this.addEventListener(a,this[g]=e,e.$=c),e._=b}function f(){var b,c=new RegExp("^__on([^.]+)"+ig.requote(a)+"$");for(var d in this)if(b=d.match(c)){var e=this[d];this.removeEventListener(b[1],e,e.$),delete this[d]}}var g="__on"+a,h=a.indexOf("."),i=W;h>0&&(a=a.slice(0,h));var j=Gg.get(a);return j&&(a=j,i=X),h?b?e:d:b?w:f}function W(a,b){return function(c){var d=ig.event;ig.event=c,b[0]=this.__data__;try{a.apply(this,b)}finally{ig.event=d}}}function X(a,b){var c=W(a,b);return function(a){var b=this,d=a.relatedTarget;d&&(d===b||8&d.compareDocumentPosition(b))||c.call(b,a)}}function Y(b){var d=".dragsuppress-"+ ++Ig,e="click"+d,f=ig.select(c(b)).on("touchmove"+d,z).on("dragstart"+d,z).on("selectstart"+d,z);if(null==Hg&&(Hg="onselectstart"in b?!1:v(b.style,"userSelect")),Hg){var g=a(b).style,h=g[Hg];g[Hg]="none"}return function(a){if(f.on(d,null),Hg&&(g[Hg]=h),a){var b=function(){f.on(e,null)};f.on(e,function(){z(),b()},!0),setTimeout(b,0)}}}function Z(a,b){b.changedTouches&&(b=b.changedTouches[0]);var d=a.ownerSVGElement||a;if(d.createSVGPoint){var e=d.createSVGPoint();if(0>Jg){var f=c(a);if(f.scrollX||f.scrollY){d=ig.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var g=d[0][0].getScreenCTM();Jg=!(g.f||g.e),d.remove()}}return Jg?(e.x=b.pageX,e.y=b.pageY):(e.x=b.clientX,e.y=b.clientY),e=e.matrixTransform(a.getScreenCTM().inverse()),[e.x,e.y]}var h=a.getBoundingClientRect();return[b.clientX-h.left-a.clientLeft,b.clientY-h.top-a.clientTop]}function $(){return ig.event.changedTouches[0].identifier}function _(a){return a>0?1:0>a?-1:0}function aa(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(b[1]-a[1])*(c[0]-a[0])}function ba(a){return a>1?0:-1>a?Mg:Math.acos(a)}function ca(a){return a>1?Pg:-1>a?-Pg:Math.asin(a)}function da(a){return((a=Math.exp(a))-1/a)/2}function ea(a){return((a=Math.exp(a))+1/a)/2}function fa(a){return((a=Math.exp(2*a))-1)/(a+1)}function ga(a){return(a=Math.sin(a/2))*a}function ha(){}function ia(a,b,c){return this instanceof ia?(this.h=+a,this.s=+b,void(this.l=+c)):arguments.length<2?a instanceof ia?new ia(a.h,a.s,a.l):wa(""+a,xa,ia):new ia(a,b,c)}function ja(a,b,c){function d(a){return a>360?a-=360:0>a&&(a+=360),60>a?f+(g-f)*a/60:180>a?g:240>a?f+(g-f)*(240-a)/60:f}function e(a){return Math.round(255*d(a))}var f,g;return a=isNaN(a)?0:(a%=360)<0?a+360:a,b=isNaN(b)?0:0>b?0:b>1?1:b,c=0>c?0:c>1?1:c,g=.5>=c?c*(1+b):c+b-c*b,f=2*c-g,new sa(e(a+120),e(a),e(a-120))}function ka(a,b,c){return this instanceof ka?(this.h=+a,this.c=+b,void(this.l=+c)):arguments.length<2?a instanceof ka?new ka(a.h,a.c,a.l):a instanceof ma?oa(a.l,a.a,a.b):oa((a=ya((a=ig.rgb(a)).r,a.g,a.b)).l,a.a,a.b):new ka(a,b,c)}function la(a,b,c){return isNaN(a)&&(a=0),isNaN(b)&&(b=0),new ma(c,Math.cos(a*=Qg)*b,Math.sin(a)*b)}function ma(a,b,c){return this instanceof ma?(this.l=+a,this.a=+b,void(this.b=+c)):arguments.length<2?a instanceof ma?new ma(a.l,a.a,a.b):a instanceof ka?la(a.h,a.c,a.l):ya((a=sa(a)).r,a.g,a.b):new ma(a,b,c)}function na(a,b,c){var d=(a+16)/116,e=d+b/500,f=d-c/200;return e=pa(e)*_g,d=pa(d)*ah,f=pa(f)*bh,new sa(ra(3.2404542*e-1.5371385*d-.4985314*f),ra(-.969266*e+1.8760108*d+.041556*f),ra(.0556434*e-.2040259*d+1.0572252*f))}function oa(a,b,c){return a>0?new ka(Math.atan2(c,b)*Rg,Math.sqrt(b*b+c*c),a):new ka(NaN,NaN,a)}function pa(a){return a>.206893034?a*a*a:(a-4/29)/7.787037}function qa(a){return a>.008856?Math.pow(a,1/3):7.787037*a+4/29}function ra(a){return Math.round(255*(.00304>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055))}function sa(a,b,c){return this instanceof sa?(this.r=~~a,this.g=~~b,void(this.b=~~c)):arguments.length<2?a instanceof sa?new sa(a.r,a.g,a.b):wa(""+a,sa,ja):new sa(a,b,c)}function ta(a){return new sa(a>>16,a>>8&255,255&a)}function ua(a){return ta(a)+""}function va(a){return 16>a?"0"+Math.max(0,a).toString(16):Math.min(255,a).toString(16)}function wa(a,b,c){var d,e,f,g=0,h=0,i=0;if(d=/([a-z]+)\((.*)\)/.exec(a=a.toLowerCase()))switch(e=d[2].split(","),d[1]){case"hsl":return c(parseFloat(e[0]),parseFloat(e[1])/100,parseFloat(e[2])/100);case"rgb":return b(Aa(e[0]),Aa(e[1]),Aa(e[2]))}return(f=eh.get(a))?b(f.r,f.g,f.b):(null==a||"#"!==a.charAt(0)||isNaN(f=parseInt(a.slice(1),16))||(4===a.length?(g=(3840&f)>>4,g=g>>4|g,h=240&f,h=h>>4|h,i=15&f,i=i<<4|i):7===a.length&&(g=(16711680&f)>>16,h=(65280&f)>>8,i=255&f)),b(g,h,i))}function xa(a,b,c){var d,e,f=Math.min(a/=255,b/=255,c/=255),g=Math.max(a,b,c),h=g-f,i=(g+f)/2;return h?(e=.5>i?h/(g+f):h/(2-g-f),d=a==g?(b-c)/h+(c>b?6:0):b==g?(c-a)/h+2:(a-b)/h+4,d*=60):(d=NaN,e=i>0&&1>i?0:d),new ia(d,e,i)}function ya(a,b,c){a=za(a),b=za(b),c=za(c);var d=qa((.4124564*a+.3575761*b+.1804375*c)/_g),e=qa((.2126729*a+.7151522*b+.072175*c)/ah),f=qa((.0193339*a+.119192*b+.9503041*c)/bh);return ma(116*e-16,500*(d-e),200*(e-f))}function za(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Aa(a){var b=parseFloat(a);return"%"===a.charAt(a.length-1)?Math.round(2.55*b):b}function Ba(a){return"function"==typeof a?a:function(){return a}}function Ca(a){return function(b,c,d){return 2===arguments.length&&"function"==typeof c&&(d=c,c=null),Da(b,c,a,d)}}function Da(a,b,c,d){function e(){var a,b=i.status;if(!b&&Fa(i)||b>=200&&300>b||304===b){try{a=c.call(f,i)}catch(d){return void g.error.call(f,d)}g.load.call(f,a)}else g.error.call(f,i)}var f={},g=ig.dispatch("beforesend","progress","load","error"),h={},i=new XMLHttpRequest,j=null;return!this.XDomainRequest||"withCredentials"in i||!/^(http(s)?:)?\/\//.test(a)||(i=new XDomainRequest),"onload"in i?i.onload=i.onerror=e:i.onreadystatechange=function(){i.readyState>3&&e()},i.onprogress=function(a){var b=ig.event;ig.event=a;try{g.progress.call(f,i)}finally{ig.event=b}},f.header=function(a,b){return a=(a+"").toLowerCase(),arguments.length<2?h[a]:(null==b?delete h[a]:h[a]=b+"",f)},f.mimeType=function(a){return arguments.length?(b=null==a?null:a+"",f):b},f.responseType=function(a){return arguments.length?(j=a,f):j},f.response=function(a){return c=a,f},["get","post"].forEach(function(a){f[a]=function(){return f.send.apply(f,[a].concat(kg(arguments)))}}),f.send=function(c,d,e){if(2===arguments.length&&"function"==typeof d&&(e=d,d=null),i.open(c,a,!0),null==b||"accept"in h||(h.accept=b+",*/*"),i.setRequestHeader)for(var k in h)i.setRequestHeader(k,h[k]);return null!=b&&i.overrideMimeType&&i.overrideMimeType(b),null!=j&&(i.responseType=j),null!=e&&f.on("error",e).on("load",function(a){e(null,a)}),g.beforesend.call(f,i),i.send(null==d?null:d),f},f.abort=function(){return i.abort(),f},ig.rebind(f,g,"on"),null==d?f:f.get(Ea(d))}function Ea(a){return 1===a.length?function(b,c){a(null==b?c:null)}:a}function Fa(a){var b=a.responseType;return b&&"text"!==b?a.response:a.responseText}function Ga(a,b,c){var d=arguments.length;2>d&&(b=0),3>d&&(c=Date.now());var e=c+b,f={c:a,t:e,n:null};return gh?gh.n=f:fh=f,gh=f,hh||(ih=clearTimeout(ih),hh=1,jh(Ha)),f}function Ha(){var a=Ia(),b=Ja()-a;b>24?(isFinite(b)&&(clearTimeout(ih),ih=setTimeout(Ha,b)),hh=0):(hh=1,jh(Ha))}function Ia(){for(var a=Date.now(),b=fh;b;)a>=b.t&&b.c(a-b.t)&&(b.c=null),b=b.n;return a}function Ja(){for(var a,b=fh,c=1/0;b;)b.c?(b.t<c&&(c=b.t),b=(a=b).n):b=a?a.n=b.n:fh=b.n;return gh=a,c}function Ka(a,b){return b-(a?Math.ceil(Math.log(a)/Math.LN10):1)}function La(a,b){var c=Math.pow(10,3*ug(8-b));return{scale:b>8?function(a){return a/c}:function(a){return a*c},symbol:a}}function Ma(a){var b=a.decimal,c=a.thousands,d=a.grouping,e=a.currency,f=d&&c?function(a,b){for(var e=a.length,f=[],g=0,h=d[0],i=0;e>0&&h>0&&(i+h+1>b&&(h=Math.max(1,b-i)),f.push(a.substring(e-=h,e+h)),!((i+=h+1)>b));)h=d[g=(g+1)%d.length];return f.reverse().join(c)}:t;return function(a){var c=lh.exec(a),d=c[1]||" ",g=c[2]||">",h=c[3]||"-",i=c[4]||"",j=c[5],k=+c[6],l=c[7],m=c[8],n=c[9],o=1,p="",q="",r=!1,s=!0;switch(m&&(m=+m.substring(1)),(j||"0"===d&&"="===g)&&(j=d="0",g="="),n){case"n":l=!0,n="g";break;case"%":o=100,q="%",n="f";break;case"p":o=100,q="%",n="r";break;case"b":case"o":case"x":case"X":"#"===i&&(p="0"+n.toLowerCase());case"c":s=!1;case"d":r=!0,m=0;break;case"s":o=-1,n="r"}"$"===i&&(p=e[0],q=e[1]),"r"!=n||m||(n="g"),null!=m&&("g"==n?m=Math.max(1,Math.min(21,m)):"e"!=n&&"f"!=n||(m=Math.max(0,Math.min(20,m)))),n=mh.get(n)||Na;var t=j&&l;return function(a){var c=q;if(r&&a%1)return"";var e=0>a||0===a&&0>1/a?(a=-a,"-"):"-"===h?"":h;if(0>o){var i=ig.formatPrefix(a,m);a=i.scale(a),c=i.symbol+q}else a*=o;a=n(a,m);var u,v,w=a.lastIndexOf(".");if(0>w){var x=s?a.lastIndexOf("e"):-1;0>x?(u=a,v=""):(u=a.substring(0,x),v=a.substring(x))}else u=a.substring(0,w),v=b+a.substring(w+1);!j&&l&&(u=f(u,1/0));var y=p.length+u.length+v.length+(t?0:e.length),z=k>y?new Array(y=k-y+1).join(d):"";return t&&(u=f(z+u,z.length?k-v.length:1/0)),e+=p,a=u+v,("<"===g?e+a+z:">"===g?z+e+a:"^"===g?z.substring(0,y>>=1)+e+a+z.substring(y):e+(t?a:z+a))+c}}}function Na(a){return a+""}function Oa(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Pa(a,b,c){function d(b){var c=a(b),d=f(c,1);return d-b>b-c?c:d}function e(c){return b(c=a(new oh(c-1)),1),c}function f(a,c){return b(a=new oh(+a),c),a}function g(a,d,f){var g=e(a),h=[];if(f>1)for(;d>g;)c(g)%f||h.push(new Date(+g)),b(g,1);else for(;d>g;)h.push(new Date(+g)),b(g,1);return h}function h(a,b,c){try{oh=Oa;var d=new Oa;return d._=a,g(d,b,c)}finally{oh=Date}}a.floor=a,a.round=d,a.ceil=e,a.offset=f,a.range=g;var i=a.utc=Qa(a);return i.floor=i,i.round=Qa(d),i.ceil=Qa(e),i.offset=Qa(f),i.range=h,a}function Qa(a){return function(b,c){try{oh=Oa;var d=new Oa;return d._=b,a(d,c)._}finally{oh=Date}}}function Ra(a){function b(a){function b(b){for(var c,e,f,g=[],h=-1,i=0;++h<d;)37===a.charCodeAt(h)&&(g.push(a.slice(i,h)),null!=(e=qh[c=a.charAt(++h)])&&(c=a.charAt(++h)),(f=C[c])&&(c=f(b,null==e?"e"===c?" ":"0":e)),g.push(c),i=h+1);return g.push(a.slice(i,h)),g.join("")}var d=a.length;return b.parse=function(b){var d={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},e=c(d,a,b,0);if(e!=b.length)return null;"p"in d&&(d.H=d.H%12+12*d.p);var f=null!=d.Z&&oh!==Oa,g=new(f?Oa:oh);return"j"in d?g.setFullYear(d.y,0,d.j):"W"in d||"U"in d?("w"in d||(d.w="W"in d?1:0),g.setFullYear(d.y,0,1),g.setFullYear(d.y,0,"W"in d?(d.w+6)%7+7*d.W-(g.getDay()+5)%7:d.w+7*d.U-(g.getDay()+6)%7)):g.setFullYear(d.y,d.m,d.d),g.setHours(d.H+(d.Z/100|0),d.M+d.Z%100,d.S,d.L),f?g._:g},b.toString=function(){return a},b}function c(a,b,c,d){for(var e,f,g,h=0,i=b.length,j=c.length;i>h;){if(d>=j)return-1;if(e=b.charCodeAt(h++),37===e){if(g=b.charAt(h++),f=D[g in qh?b.charAt(h++):g],
!f||(d=f(a,c,d))<0)return-1}else if(e!=c.charCodeAt(d++))return-1}return d}function d(a,b,c){w.lastIndex=0;var d=w.exec(b.slice(c));return d?(a.w=x.get(d[0].toLowerCase()),c+d[0].length):-1}function e(a,b,c){u.lastIndex=0;var d=u.exec(b.slice(c));return d?(a.w=v.get(d[0].toLowerCase()),c+d[0].length):-1}function f(a,b,c){A.lastIndex=0;var d=A.exec(b.slice(c));return d?(a.m=B.get(d[0].toLowerCase()),c+d[0].length):-1}function g(a,b,c){y.lastIndex=0;var d=y.exec(b.slice(c));return d?(a.m=z.get(d[0].toLowerCase()),c+d[0].length):-1}function h(a,b,d){return c(a,C.c.toString(),b,d)}function i(a,b,d){return c(a,C.x.toString(),b,d)}function j(a,b,d){return c(a,C.X.toString(),b,d)}function k(a,b,c){var d=t.get(b.slice(c,c+=2).toLowerCase());return null==d?-1:(a.p=d,c)}var l=a.dateTime,m=a.date,n=a.time,o=a.periods,p=a.days,q=a.shortDays,r=a.months,s=a.shortMonths;b.utc=function(a){function c(a){try{oh=Oa;var b=new oh;return b._=a,d(b)}finally{oh=Date}}var d=b(a);return c.parse=function(a){try{oh=Oa;var b=d.parse(a);return b&&b._}finally{oh=Date}},c.toString=d.toString,c},b.multi=b.utc.multi=jb;var t=ig.map(),u=Ta(p),v=Ua(p),w=Ta(q),x=Ua(q),y=Ta(r),z=Ua(r),A=Ta(s),B=Ua(s);o.forEach(function(a,b){t.set(a.toLowerCase(),b)});var C={a:function(a){return q[a.getDay()]},A:function(a){return p[a.getDay()]},b:function(a){return s[a.getMonth()]},B:function(a){return r[a.getMonth()]},c:b(l),d:function(a,b){return Sa(a.getDate(),b,2)},e:function(a,b){return Sa(a.getDate(),b,2)},H:function(a,b){return Sa(a.getHours(),b,2)},I:function(a,b){return Sa(a.getHours()%12||12,b,2)},j:function(a,b){return Sa(1+nh.dayOfYear(a),b,3)},L:function(a,b){return Sa(a.getMilliseconds(),b,3)},m:function(a,b){return Sa(a.getMonth()+1,b,2)},M:function(a,b){return Sa(a.getMinutes(),b,2)},p:function(a){return o[+(a.getHours()>=12)]},S:function(a,b){return Sa(a.getSeconds(),b,2)},U:function(a,b){return Sa(nh.sundayOfYear(a),b,2)},w:function(a){return a.getDay()},W:function(a,b){return Sa(nh.mondayOfYear(a),b,2)},x:b(m),X:b(n),y:function(a,b){return Sa(a.getFullYear()%100,b,2)},Y:function(a,b){return Sa(a.getFullYear()%1e4,b,4)},Z:hb,"%":function(){return"%"}},D={a:d,A:e,b:f,B:g,c:h,d:bb,e:bb,H:db,I:db,j:cb,L:gb,m:ab,M:eb,p:k,S:fb,U:Wa,w:Va,W:Xa,x:i,X:j,y:Za,Y:Ya,Z:$a,"%":ib};return b}function Sa(a,b,c){var d=0>a?"-":"",e=(d?-a:a)+"",f=e.length;return d+(c>f?new Array(c-f+1).join(b)+e:e)}function Ta(a){return new RegExp("^(?:"+a.map(ig.requote).join("|")+")","i")}function Ua(a){for(var b=new k,c=-1,d=a.length;++c<d;)b.set(a[c].toLowerCase(),c);return b}function Va(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c,c+1));return d?(a.w=+d[0],c+d[0].length):-1}function Wa(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c));return d?(a.U=+d[0],c+d[0].length):-1}function Xa(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c));return d?(a.W=+d[0],c+d[0].length):-1}function Ya(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c,c+4));return d?(a.y=+d[0],c+d[0].length):-1}function Za(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c,c+2));return d?(a.y=_a(+d[0]),c+d[0].length):-1}function $a(a,b,c){return/^[+-]\d{4}$/.test(b=b.slice(c,c+5))?(a.Z=-b,c+5):-1}function _a(a){return a+(a>68?1900:2e3)}function ab(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c,c+2));return d?(a.m=d[0]-1,c+d[0].length):-1}function bb(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c,c+2));return d?(a.d=+d[0],c+d[0].length):-1}function cb(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c,c+3));return d?(a.j=+d[0],c+d[0].length):-1}function db(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c,c+2));return d?(a.H=+d[0],c+d[0].length):-1}function eb(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c,c+2));return d?(a.M=+d[0],c+d[0].length):-1}function fb(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c,c+2));return d?(a.S=+d[0],c+d[0].length):-1}function gb(a,b,c){rh.lastIndex=0;var d=rh.exec(b.slice(c,c+3));return d?(a.L=+d[0],c+d[0].length):-1}function hb(a){var b=a.getTimezoneOffset(),c=b>0?"-":"+",d=ug(b)/60|0,e=ug(b)%60;return c+Sa(d,"0",2)+Sa(e,"0",2)}function ib(a,b,c){sh.lastIndex=0;var d=sh.exec(b.slice(c,c+1));return d?c+d[0].length:-1}function jb(a){for(var b=a.length,c=-1;++c<b;)a[c][0]=this(a[c][0]);return function(b){for(var c=0,d=a[c];!d[1](b);)d=a[++c];return d[0](b)}}function kb(){}function lb(a,b,c){var d=c.s=a+b,e=d-a,f=d-e;c.t=a-f+(b-e)}function mb(a,b){a&&wh.hasOwnProperty(a.type)&&wh[a.type](a,b)}function nb(a,b,c){var d,e=-1,f=a.length-c;for(b.lineStart();++e<f;)d=a[e],b.point(d[0],d[1],d[2]);b.lineEnd()}function ob(a,b){var c=-1,d=a.length;for(b.polygonStart();++c<d;)nb(a[c],b,1);b.polygonEnd()}function pb(){function a(a,b){a*=Qg,b=b*Qg/2+Mg/4;var c=a-d,g=c>=0?1:-1,h=g*c,i=Math.cos(b),j=Math.sin(b),k=f*j,l=e*i+k*Math.cos(h),m=k*g*Math.sin(h);yh.add(Math.atan2(m,l)),d=a,e=i,f=j}var b,c,d,e,f;zh.point=function(g,h){zh.point=a,d=(b=g)*Qg,e=Math.cos(h=(c=h)*Qg/2+Mg/4),f=Math.sin(h)},zh.lineEnd=function(){a(b,c)}}function qb(a){var b=a[0],c=a[1],d=Math.cos(c);return[d*Math.cos(b),d*Math.sin(b),Math.sin(c)]}function rb(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function sb(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]}function tb(a,b){a[0]+=b[0],a[1]+=b[1],a[2]+=b[2]}function ub(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function vb(a){var b=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]/=b,a[1]/=b,a[2]/=b}function wb(a){return[Math.atan2(a[1],a[0]),ca(a[2])]}function xb(a,b){return ug(a[0]-b[0])<Kg&&ug(a[1]-b[1])<Kg}function yb(a,b){a*=Qg;var c=Math.cos(b*=Qg);zb(c*Math.cos(a),c*Math.sin(a),Math.sin(b))}function zb(a,b,c){++Ah,Ch+=(a-Ch)/Ah,Dh+=(b-Dh)/Ah,Eh+=(c-Eh)/Ah}function Ab(){function a(a,e){a*=Qg;var f=Math.cos(e*=Qg),g=f*Math.cos(a),h=f*Math.sin(a),i=Math.sin(e),j=Math.atan2(Math.sqrt((j=c*i-d*h)*j+(j=d*g-b*i)*j+(j=b*h-c*g)*j),b*g+c*h+d*i);Bh+=j,Fh+=j*(b+(b=g)),Gh+=j*(c+(c=h)),Hh+=j*(d+(d=i)),zb(b,c,d)}var b,c,d;Lh.point=function(e,f){e*=Qg;var g=Math.cos(f*=Qg);b=g*Math.cos(e),c=g*Math.sin(e),d=Math.sin(f),Lh.point=a,zb(b,c,d)}}function Bb(){Lh.point=yb}function Cb(){function a(a,b){a*=Qg;var c=Math.cos(b*=Qg),g=c*Math.cos(a),h=c*Math.sin(a),i=Math.sin(b),j=e*i-f*h,k=f*g-d*i,l=d*h-e*g,m=Math.sqrt(j*j+k*k+l*l),n=d*g+e*h+f*i,o=m&&-ba(n)/m,p=Math.atan2(m,n);Ih+=o*j,Jh+=o*k,Kh+=o*l,Bh+=p,Fh+=p*(d+(d=g)),Gh+=p*(e+(e=h)),Hh+=p*(f+(f=i)),zb(d,e,f)}var b,c,d,e,f;Lh.point=function(g,h){b=g,c=h,Lh.point=a,g*=Qg;var i=Math.cos(h*=Qg);d=i*Math.cos(g),e=i*Math.sin(g),f=Math.sin(h),zb(d,e,f)},Lh.lineEnd=function(){a(b,c),Lh.lineEnd=Bb,Lh.point=yb}}function Db(a,b){function c(c,d){return c=a(c,d),b(c[0],c[1])}return a.invert&&b.invert&&(c.invert=function(c,d){return c=b.invert(c,d),c&&a.invert(c[0],c[1])}),c}function Eb(){return!0}function Fb(a,b,c,d,e){var f=[],g=[];if(a.forEach(function(a){if(!((b=a.length-1)<=0)){var b,c=a[0],d=a[b];if(xb(c,d)){e.lineStart();for(var h=0;b>h;++h)e.point((c=a[h])[0],c[1]);return void e.lineEnd()}var i=new Hb(c,a,null,!0),j=new Hb(c,null,i,!1);i.o=j,f.push(i),g.push(j),i=new Hb(d,a,null,!1),j=new Hb(d,null,i,!0),i.o=j,f.push(i),g.push(j)}}),g.sort(b),Gb(f),Gb(g),f.length){for(var h=0,i=c,j=g.length;j>h;++h)g[h].e=i=!i;for(var k,l,m=f[0];;){for(var n=m,o=!0;n.v;)if((n=n.n)===m)return;k=n.z,e.lineStart();do{if(n.v=n.o.v=!0,n.e){if(o)for(var h=0,j=k.length;j>h;++h)e.point((l=k[h])[0],l[1]);else d(n.x,n.n.x,1,e);n=n.n}else{if(o){k=n.p.z;for(var h=k.length-1;h>=0;--h)e.point((l=k[h])[0],l[1])}else d(n.x,n.p.x,-1,e);n=n.p}n=n.o,k=n.z,o=!o}while(!n.v);e.lineEnd()}}}function Gb(a){if(b=a.length){for(var b,c,d=0,e=a[0];++d<b;)e.n=c=a[d],c.p=e,e=c;e.n=c=a[0],c.p=e}}function Hb(a,b,c,d){this.x=a,this.z=b,this.o=c,this.e=d,this.v=!1,this.n=this.p=null}function Ib(a,b,c,d){return function(e,f){function g(b,c){var d=e(b,c);a(b=d[0],c=d[1])&&f.point(b,c)}function h(a,b){var c=e(a,b);q.point(c[0],c[1])}function i(){s.point=h,q.lineStart()}function j(){s.point=g,q.lineEnd()}function k(a,b){p.push([a,b]);var c=e(a,b);u.point(c[0],c[1])}function l(){u.lineStart(),p=[]}function m(){k(p[0][0],p[0][1]),u.lineEnd();var a,b=u.clean(),c=t.buffer(),d=c.length;if(p.pop(),o.push(p),p=null,d)if(1&b){a=c[0];var e,d=a.length-1,g=-1;if(d>0){for(v||(f.polygonStart(),v=!0),f.lineStart();++g<d;)f.point((e=a[g])[0],e[1]);f.lineEnd()}}else d>1&&2&b&&c.push(c.pop().concat(c.shift())),n.push(c.filter(Jb))}var n,o,p,q=b(f),r=e.invert(d[0],d[1]),s={point:g,lineStart:i,lineEnd:j,polygonStart:function(){s.point=k,s.lineStart=l,s.lineEnd=m,n=[],o=[]},polygonEnd:function(){s.point=g,s.lineStart=i,s.lineEnd=j,n=ig.merge(n);var a=Pb(r,o);n.length?(v||(f.polygonStart(),v=!0),Fb(n,Lb,a,c,f)):a&&(v||(f.polygonStart(),v=!0),f.lineStart(),c(null,null,1,f),f.lineEnd()),v&&(f.polygonEnd(),v=!1),n=o=null},sphere:function(){f.polygonStart(),f.lineStart(),c(null,null,1,f),f.lineEnd(),f.polygonEnd()}},t=Kb(),u=b(t),v=!1;return s}}function Jb(a){return a.length>1}function Kb(){var a,b=[];return{lineStart:function(){b.push(a=[])},point:function(b,c){a.push([b,c])},lineEnd:w,buffer:function(){var c=b;return b=[],a=null,c},rejoin:function(){b.length>1&&b.push(b.pop().concat(b.shift()))}}}function Lb(a,b){return((a=a.x)[0]<0?a[1]-Pg-Kg:Pg-a[1])-((b=b.x)[0]<0?b[1]-Pg-Kg:Pg-b[1])}function Mb(a){var b,c=NaN,d=NaN,e=NaN;return{lineStart:function(){a.lineStart(),b=1},point:function(f,g){var h=f>0?Mg:-Mg,i=ug(f-c);ug(i-Mg)<Kg?(a.point(c,d=(d+g)/2>0?Pg:-Pg),a.point(e,d),a.lineEnd(),a.lineStart(),a.point(h,d),a.point(f,d),b=0):e!==h&&i>=Mg&&(ug(c-e)<Kg&&(c-=e*Kg),ug(f-h)<Kg&&(f-=h*Kg),d=Nb(c,d,f,g),a.point(e,d),a.lineEnd(),a.lineStart(),a.point(h,d),b=0),a.point(c=f,d=g),e=h},lineEnd:function(){a.lineEnd(),c=d=NaN},clean:function(){return 2-b}}}function Nb(a,b,c,d){var e,f,g=Math.sin(a-c);return ug(g)>Kg?Math.atan((Math.sin(b)*(f=Math.cos(d))*Math.sin(c)-Math.sin(d)*(e=Math.cos(b))*Math.sin(a))/(e*f*g)):(b+d)/2}function Ob(a,b,c,d){var e;if(null==a)e=c*Pg,d.point(-Mg,e),d.point(0,e),d.point(Mg,e),d.point(Mg,0),d.point(Mg,-e),d.point(0,-e),d.point(-Mg,-e),d.point(-Mg,0),d.point(-Mg,e);else if(ug(a[0]-b[0])>Kg){var f=a[0]<b[0]?Mg:-Mg;e=c*f/2,d.point(-f,e),d.point(0,e),d.point(f,e)}else d.point(b[0],b[1])}function Pb(a,b){var c=a[0],d=a[1],e=[Math.sin(c),-Math.cos(c),0],f=0,g=0;yh.reset();for(var h=0,i=b.length;i>h;++h){var j=b[h],k=j.length;if(k)for(var l=j[0],m=l[0],n=l[1]/2+Mg/4,o=Math.sin(n),p=Math.cos(n),q=1;;){q===k&&(q=0),a=j[q];var r=a[0],s=a[1]/2+Mg/4,t=Math.sin(s),u=Math.cos(s),v=r-m,w=v>=0?1:-1,x=w*v,y=x>Mg,z=o*t;if(yh.add(Math.atan2(z*w*Math.sin(x),p*u+z*Math.cos(x))),f+=y?v+w*Ng:v,y^m>=c^r>=c){var A=sb(qb(l),qb(a));vb(A);var B=sb(e,A);vb(B);var C=(y^v>=0?-1:1)*ca(B[2]);(d>C||d===C&&(A[0]||A[1]))&&(g+=y^v>=0?1:-1)}if(!q++)break;m=r,o=t,p=u,l=a}}return(-Kg>f||Kg>f&&0>yh)^1&g}function Qb(a){function b(a,b){return Math.cos(a)*Math.cos(b)>f}function c(a){var c,f,i,j,k;return{lineStart:function(){j=i=!1,k=1},point:function(l,m){var n,o=[l,m],p=b(l,m),q=g?p?0:e(l,m):p?e(l+(0>l?Mg:-Mg),m):0;if(!c&&(j=i=p)&&a.lineStart(),p!==i&&(n=d(c,o),(xb(c,n)||xb(o,n))&&(o[0]+=Kg,o[1]+=Kg,p=b(o[0],o[1]))),p!==i)k=0,p?(a.lineStart(),n=d(o,c),a.point(n[0],n[1])):(n=d(c,o),a.point(n[0],n[1]),a.lineEnd()),c=n;else if(h&&c&&g^p){var r;q&f||!(r=d(o,c,!0))||(k=0,g?(a.lineStart(),a.point(r[0][0],r[0][1]),a.point(r[1][0],r[1][1]),a.lineEnd()):(a.point(r[1][0],r[1][1]),a.lineEnd(),a.lineStart(),a.point(r[0][0],r[0][1])))}!p||c&&xb(c,o)||a.point(o[0],o[1]),c=o,i=p,f=q},lineEnd:function(){i&&a.lineEnd(),c=null},clean:function(){return k|(j&&i)<<1}}}function d(a,b,c){var d=qb(a),e=qb(b),g=[1,0,0],h=sb(d,e),i=rb(h,h),j=h[0],k=i-j*j;if(!k)return!c&&a;var l=f*i/k,m=-f*j/k,n=sb(g,h),o=ub(g,l),p=ub(h,m);tb(o,p);var q=n,r=rb(o,q),s=rb(q,q),t=r*r-s*(rb(o,o)-1);if(!(0>t)){var u=Math.sqrt(t),v=ub(q,(-r-u)/s);if(tb(v,o),v=wb(v),!c)return v;var w,x=a[0],y=b[0],z=a[1],A=b[1];x>y&&(w=x,x=y,y=w);var B=y-x,C=ug(B-Mg)<Kg,D=C||Kg>B;if(!C&&z>A&&(w=z,z=A,A=w),D?C?z+A>0^v[1]<(ug(v[0]-x)<Kg?z:A):z<=v[1]&&v[1]<=A:B>Mg^(x<=v[0]&&v[0]<=y)){var E=ub(q,(-r+u)/s);return tb(E,o),[v,wb(E)]}}}function e(b,c){var d=g?a:Mg-a,e=0;return-d>b?e|=1:b>d&&(e|=2),-d>c?e|=4:c>d&&(e|=8),e}var f=Math.cos(a),g=f>0,h=ug(f)>Kg,i=pc(a,6*Qg);return Ib(b,c,i,g?[0,-a]:[-Mg,a-Mg])}function Rb(a,b,c,d){return function(e){var f,g=e.a,h=e.b,i=g.x,j=g.y,k=h.x,l=h.y,m=0,n=1,o=k-i,p=l-j;if(f=a-i,o||!(f>0)){if(f/=o,0>o){if(m>f)return;n>f&&(n=f)}else if(o>0){if(f>n)return;f>m&&(m=f)}if(f=c-i,o||!(0>f)){if(f/=o,0>o){if(f>n)return;f>m&&(m=f)}else if(o>0){if(m>f)return;n>f&&(n=f)}if(f=b-j,p||!(f>0)){if(f/=p,0>p){if(m>f)return;n>f&&(n=f)}else if(p>0){if(f>n)return;f>m&&(m=f)}if(f=d-j,p||!(0>f)){if(f/=p,0>p){if(f>n)return;f>m&&(m=f)}else if(p>0){if(m>f)return;n>f&&(n=f)}return m>0&&(e.a={x:i+m*o,y:j+m*p}),1>n&&(e.b={x:i+n*o,y:j+n*p}),e}}}}}}function Sb(a,b,c,d){function e(d,e){return ug(d[0]-a)<Kg?e>0?0:3:ug(d[0]-c)<Kg?e>0?2:1:ug(d[1]-b)<Kg?e>0?1:0:e>0?3:2}function f(a,b){return g(a.x,b.x)}function g(a,b){var c=e(a,1),d=e(b,1);return c!==d?c-d:0===c?b[1]-a[1]:1===c?a[0]-b[0]:2===c?a[1]-b[1]:b[0]-a[0]}return function(h){function i(a){for(var b=0,c=q.length,d=a[1],e=0;c>e;++e)for(var f,g=1,h=q[e],i=h.length,j=h[0];i>g;++g)f=h[g],j[1]<=d?f[1]>d&&aa(j,f,a)>0&&++b:f[1]<=d&&aa(j,f,a)<0&&--b,j=f;return 0!==b}function j(f,h,i,j){var k=0,l=0;if(null==f||(k=e(f,i))!==(l=e(h,i))||g(f,h)<0^i>0){do j.point(0===k||3===k?a:c,k>1?d:b);while((k=(k+i+4)%4)!==l)}else j.point(h[0],h[1])}function k(e,f){return e>=a&&c>=e&&f>=b&&d>=f}function l(a,b){k(a,b)&&h.point(a,b)}function m(){D.point=o,q&&q.push(r=[]),y=!0,x=!1,v=w=NaN}function n(){p&&(o(s,t),u&&x&&B.rejoin(),p.push(B.buffer())),D.point=l,x&&h.lineEnd()}function o(a,b){a=Math.max(-Nh,Math.min(Nh,a)),b=Math.max(-Nh,Math.min(Nh,b));var c=k(a,b);if(q&&r.push([a,b]),y)s=a,t=b,u=c,y=!1,c&&(h.lineStart(),h.point(a,b));else if(c&&x)h.point(a,b);else{var d={a:{x:v,y:w},b:{x:a,y:b}};C(d)?(x||(h.lineStart(),h.point(d.a.x,d.a.y)),h.point(d.b.x,d.b.y),c||h.lineEnd(),z=!1):c&&(h.lineStart(),h.point(a,b),z=!1)}v=a,w=b,x=c}var p,q,r,s,t,u,v,w,x,y,z,A=h,B=Kb(),C=Rb(a,b,c,d),D={point:l,lineStart:m,lineEnd:n,polygonStart:function(){h=B,p=[],q=[],z=!0},polygonEnd:function(){h=A,p=ig.merge(p);var b=i([a,d]),c=z&&b,e=p.length;(c||e)&&(h.polygonStart(),c&&(h.lineStart(),j(null,null,1,h),h.lineEnd()),e&&Fb(p,f,b,j,h),h.polygonEnd()),p=q=r=null}};return D}}function Tb(a){var b=0,c=Mg/3,d=hc(a),e=d(b,c);return e.parallels=function(a){return arguments.length?d(b=a[0]*Mg/180,c=a[1]*Mg/180):[b/Mg*180,c/Mg*180]},e}function Ub(a,b){function c(a,b){var c=Math.sqrt(f-2*e*Math.sin(b))/e;return[c*Math.sin(a*=e),g-c*Math.cos(a)]}var d=Math.sin(a),e=(d+Math.sin(b))/2,f=1+d*(2*e-d),g=Math.sqrt(f)/e;return c.invert=function(a,b){var c=g-b;return[Math.atan2(a,c)/e,ca((f-(a*a+c*c)*e*e)/(2*e))]},c}function Vb(){function a(a,b){Ph+=e*a-d*b,d=a,e=b}var b,c,d,e;Uh.point=function(f,g){Uh.point=a,b=d=f,c=e=g},Uh.lineEnd=function(){a(b,c)}}function Wb(a,b){Qh>a&&(Qh=a),a>Sh&&(Sh=a),Rh>b&&(Rh=b),b>Th&&(Th=b)}function Xb(){function a(a,b){g.push("M",a,",",b,f)}function b(a,b){g.push("M",a,",",b),h.point=c}function c(a,b){g.push("L",a,",",b)}function d(){h.point=a}function e(){g.push("Z")}var f=Yb(4.5),g=[],h={point:a,lineStart:function(){h.point=b},lineEnd:d,polygonStart:function(){h.lineEnd=e},polygonEnd:function(){h.lineEnd=d,h.point=a},pointRadius:function(a){return f=Yb(a),h},result:function(){if(g.length){var a=g.join("");return g=[],a}}};return h}function Yb(a){return"m0,"+a+"a"+a+","+a+" 0 1,1 0,"+-2*a+"a"+a+","+a+" 0 1,1 0,"+2*a+"z"}function Zb(a,b){Ch+=a,Dh+=b,++Eh}function $b(){function a(a,d){var e=a-b,f=d-c,g=Math.sqrt(e*e+f*f);Fh+=g*(b+a)/2,Gh+=g*(c+d)/2,Hh+=g,Zb(b=a,c=d)}var b,c;Wh.point=function(d,e){Wh.point=a,Zb(b=d,c=e)}}function _b(){Wh.point=Zb}function ac(){function a(a,b){var c=a-d,f=b-e,g=Math.sqrt(c*c+f*f);Fh+=g*(d+a)/2,Gh+=g*(e+b)/2,Hh+=g,g=e*a-d*b,Ih+=g*(d+a),Jh+=g*(e+b),Kh+=3*g,Zb(d=a,e=b)}var b,c,d,e;Wh.point=function(f,g){Wh.point=a,Zb(b=d=f,c=e=g)},Wh.lineEnd=function(){a(b,c)}}function bc(a){function b(b,c){a.moveTo(b+g,c),a.arc(b,c,g,0,Ng)}function c(b,c){a.moveTo(b,c),h.point=d}function d(b,c){a.lineTo(b,c)}function e(){h.point=b}function f(){a.closePath()}var g=4.5,h={point:b,lineStart:function(){h.point=c},lineEnd:e,polygonStart:function(){h.lineEnd=f},polygonEnd:function(){h.lineEnd=e,h.point=b},pointRadius:function(a){return g=a,h},result:w};return h}function cc(a){function b(a){return(h?d:c)(a)}function c(b){return fc(b,function(c,d){c=a(c,d),b.point(c[0],c[1])})}function d(b){function c(c,d){c=a(c,d),b.point(c[0],c[1])}function d(){t=NaN,y.point=f,b.lineStart()}function f(c,d){var f=qb([c,d]),g=a(c,d);e(t,u,s,v,w,x,t=g[0],u=g[1],s=c,v=f[0],w=f[1],x=f[2],h,b),b.point(t,u)}function g(){y.point=c,b.lineEnd()}function i(){d(),y.point=j,y.lineEnd=k}function j(a,b){f(l=a,m=b),n=t,o=u,p=v,q=w,r=x,y.point=f}function k(){e(t,u,s,v,w,x,n,o,l,p,q,r,h,b),y.lineEnd=g,g()}var l,m,n,o,p,q,r,s,t,u,v,w,x,y={point:c,lineStart:d,lineEnd:g,polygonStart:function(){b.polygonStart(),y.lineStart=i},polygonEnd:function(){b.polygonEnd(),y.lineStart=d}};return y}function e(b,c,d,h,i,j,k,l,m,n,o,p,q,r){var s=k-b,t=l-c,u=s*s+t*t;if(u>4*f&&q--){var v=h+n,w=i+o,x=j+p,y=Math.sqrt(v*v+w*w+x*x),z=Math.asin(x/=y),A=ug(ug(x)-1)<Kg||ug(d-m)<Kg?(d+m)/2:Math.atan2(w,v),B=a(A,z),C=B[0],D=B[1],E=C-b,F=D-c,G=t*E-s*F;(G*G/u>f||ug((s*E+t*F)/u-.5)>.3||g>h*n+i*o+j*p)&&(e(b,c,d,h,i,j,C,D,A,v/=y,w/=y,x,q,r),r.point(C,D),e(C,D,A,v,w,x,k,l,m,n,o,p,q,r))}}var f=.5,g=Math.cos(30*Qg),h=16;return b.precision=function(a){return arguments.length?(h=(f=a*a)>0&&16,b):Math.sqrt(f)},b}function dc(a){var b=cc(function(b,c){return a([b*Rg,c*Rg])});return function(a){return ic(b(a))}}function ec(a){this.stream=a}function fc(a,b){return{point:b,sphere:function(){a.sphere()},lineStart:function(){a.lineStart()},lineEnd:function(){a.lineEnd()},polygonStart:function(){a.polygonStart()},polygonEnd:function(){a.polygonEnd()}}}function gc(a){return hc(function(){return a})()}function hc(a){function b(a){return a=h(a[0]*Qg,a[1]*Qg),[a[0]*m+i,j-a[1]*m]}function c(a){return a=h.invert((a[0]-i)/m,(j-a[1])/m),a&&[a[0]*Rg,a[1]*Rg]}function d(){h=Db(g=lc(r,s,u),f);var a=f(p,q);return i=n-a[0]*m,j=o+a[1]*m,e()}function e(){return k&&(k.valid=!1,k=null),b}var f,g,h,i,j,k,l=cc(function(a,b){return a=f(a,b),[a[0]*m+i,j-a[1]*m]}),m=150,n=480,o=250,p=0,q=0,r=0,s=0,u=0,v=Mh,w=t,x=null,y=null;return b.stream=function(a){return k&&(k.valid=!1),k=ic(v(g,l(w(a)))),k.valid=!0,k},b.clipAngle=function(a){return arguments.length?(v=null==a?(x=a,Mh):Qb((x=+a)*Qg),e()):x},b.clipExtent=function(a){return arguments.length?(y=a,w=a?Sb(a[0][0],a[0][1],a[1][0],a[1][1]):t,e()):y},b.scale=function(a){return arguments.length?(m=+a,d()):m},b.translate=function(a){return arguments.length?(n=+a[0],o=+a[1],d()):[n,o]},b.center=function(a){return arguments.length?(p=a[0]%360*Qg,q=a[1]%360*Qg,d()):[p*Rg,q*Rg]},b.rotate=function(a){return arguments.length?(r=a[0]%360*Qg,s=a[1]%360*Qg,u=a.length>2?a[2]%360*Qg:0,d()):[r*Rg,s*Rg,u*Rg]},ig.rebind(b,l,"precision"),function(){return f=a.apply(this,arguments),b.invert=f.invert&&c,d()}}function ic(a){return fc(a,function(b,c){a.point(b*Qg,c*Qg)})}function jc(a,b){return[a,b]}function kc(a,b){return[a>Mg?a-Ng:-Mg>a?a+Ng:a,b]}function lc(a,b,c){return a?b||c?Db(nc(a),oc(b,c)):nc(a):b||c?oc(b,c):kc}function mc(a){return function(b,c){return b+=a,[b>Mg?b-Ng:-Mg>b?b+Ng:b,c]}}function nc(a){var b=mc(a);return b.invert=mc(-a),b}function oc(a,b){function c(a,b){var c=Math.cos(b),h=Math.cos(a)*c,i=Math.sin(a)*c,j=Math.sin(b),k=j*d+h*e;return[Math.atan2(i*f-k*g,h*d-j*e),ca(k*f+i*g)]}var d=Math.cos(a),e=Math.sin(a),f=Math.cos(b),g=Math.sin(b);return c.invert=function(a,b){var c=Math.cos(b),h=Math.cos(a)*c,i=Math.sin(a)*c,j=Math.sin(b),k=j*f-i*g;return[Math.atan2(i*f+j*g,h*d+k*e),ca(k*d-h*e)]},c}function pc(a,b){var c=Math.cos(a),d=Math.sin(a);return function(e,f,g,h){var i=g*b;null!=e?(e=qc(c,e),f=qc(c,f),(g>0?f>e:e>f)&&(e+=g*Ng)):(e=a+g*Ng,f=a-.5*i);for(var j,k=e;g>0?k>f:f>k;k-=i)h.point((j=wb([c,-d*Math.cos(k),-d*Math.sin(k)]))[0],j[1])}}function qc(a,b){var c=qb(b);c[0]-=a,vb(c);var d=ba(-c[1]);return((-c[2]<0?-d:d)+2*Math.PI-Kg)%(2*Math.PI)}function rc(a,b,c){var d=ig.range(a,b-Kg,c).concat(b);return function(a){return d.map(function(b){return[a,b]})}}function sc(a,b,c){var d=ig.range(a,b-Kg,c).concat(b);return function(a){return d.map(function(b){return[b,a]})}}function tc(a){return a.source}function uc(a){return a.target}function vc(a,b,c,d){var e=Math.cos(b),f=Math.sin(b),g=Math.cos(d),h=Math.sin(d),i=e*Math.cos(a),j=e*Math.sin(a),k=g*Math.cos(c),l=g*Math.sin(c),m=2*Math.asin(Math.sqrt(ga(d-b)+e*g*ga(c-a))),n=1/Math.sin(m),o=m?function(a){var b=Math.sin(a*=m)*n,c=Math.sin(m-a)*n,d=c*i+b*k,e=c*j+b*l,g=c*f+b*h;return[Math.atan2(e,d)*Rg,Math.atan2(g,Math.sqrt(d*d+e*e))*Rg]}:function(){return[a*Rg,b*Rg]};return o.distance=m,o}function wc(){function a(a,e){var f=Math.sin(e*=Qg),g=Math.cos(e),h=ug((a*=Qg)-b),i=Math.cos(h);Xh+=Math.atan2(Math.sqrt((h=g*Math.sin(h))*h+(h=d*f-c*g*i)*h),c*f+d*g*i),b=a,c=f,d=g}var b,c,d;Yh.point=function(e,f){b=e*Qg,c=Math.sin(f*=Qg),d=Math.cos(f),Yh.point=a},Yh.lineEnd=function(){Yh.point=Yh.lineEnd=w}}function xc(a,b){function c(b,c){var d=Math.cos(b),e=Math.cos(c),f=a(d*e);return[f*e*Math.sin(b),f*Math.sin(c)]}return c.invert=function(a,c){var d=Math.sqrt(a*a+c*c),e=b(d),f=Math.sin(e),g=Math.cos(e);return[Math.atan2(a*f,d*g),Math.asin(d&&c*f/d)]},c}function yc(a,b){function c(a,b){g>0?-Pg+Kg>b&&(b=-Pg+Kg):b>Pg-Kg&&(b=Pg-Kg);var c=g/Math.pow(e(b),f);return[c*Math.sin(f*a),g-c*Math.cos(f*a)]}var d=Math.cos(a),e=function(a){return Math.tan(Mg/4+a/2)},f=a===b?Math.sin(a):Math.log(d/Math.cos(b))/Math.log(e(b)/e(a)),g=d*Math.pow(e(a),f)/f;return f?(c.invert=function(a,b){var c=g-b,d=_(f)*Math.sqrt(a*a+c*c);return[Math.atan2(a,c)/f,2*Math.atan(Math.pow(g/d,1/f))-Pg]},c):Ac}function zc(a,b){function c(a,b){var c=f-b;return[c*Math.sin(e*a),f-c*Math.cos(e*a)]}var d=Math.cos(a),e=a===b?Math.sin(a):(d-Math.cos(b))/(b-a),f=d/e+a;return ug(e)<Kg?jc:(c.invert=function(a,b){var c=f-b;return[Math.atan2(a,c)/e,f-_(e)*Math.sqrt(a*a+c*c)]},c)}function Ac(a,b){return[a,Math.log(Math.tan(Mg/4+b/2))]}function Bc(a){var b,c=gc(a),d=c.scale,e=c.translate,f=c.clipExtent;return c.scale=function(){var a=d.apply(c,arguments);return a===c?b?c.clipExtent(null):c:a},c.translate=function(){var a=e.apply(c,arguments);return a===c?b?c.clipExtent(null):c:a},c.clipExtent=function(a){var g=f.apply(c,arguments);if(g===c){if(b=null==a){var h=Mg*d(),i=e();f([[i[0]-h,i[1]-h],[i[0]+h,i[1]+h]])}}else b&&(g=null);return g},c.clipExtent(null)}function Cc(a,b){return[Math.log(Math.tan(Mg/4+b/2)),-a]}function Dc(a){return a[0]}function Ec(a){return a[1]}function Fc(a){for(var b=a.length,c=[0,1],d=2,e=2;b>e;e++){for(;d>1&&aa(a[c[d-2]],a[c[d-1]],a[e])<=0;)--d;c[d++]=e}return c.slice(0,d)}function Gc(a,b){return a[0]-b[0]||a[1]-b[1]}function Hc(a,b,c){return(c[0]-b[0])*(a[1]-b[1])<(c[1]-b[1])*(a[0]-b[0])}function Ic(a,b,c,d){var e=a[0],f=c[0],g=b[0]-e,h=d[0]-f,i=a[1],j=c[1],k=b[1]-i,l=d[1]-j,m=(h*(i-j)-l*(e-f))/(l*g-h*k);return[e+m*g,i+m*k]}function Jc(a){var b=a[0],c=a[a.length-1];return!(b[0]-c[0]||b[1]-c[1])}function Kc(){dd(this),this.edge=this.site=this.circle=null}function Lc(a){var b=ii.pop()||new Kc;return b.site=a,b}function Mc(a){Wc(a),fi.remove(a),ii.push(a),dd(a)}function Nc(a){var b=a.circle,c=b.x,d=b.cy,e={x:c,y:d},f=a.P,g=a.N,h=[a];Mc(a);for(var i=f;i.circle&&ug(c-i.circle.x)<Kg&&ug(d-i.circle.cy)<Kg;)f=i.P,h.unshift(i),Mc(i),i=f;h.unshift(i),Wc(i);for(var j=g;j.circle&&ug(c-j.circle.x)<Kg&&ug(d-j.circle.cy)<Kg;)g=j.N,h.push(j),Mc(j),j=g;h.push(j),Wc(j);var k,l=h.length;for(k=1;l>k;++k)j=h[k],i=h[k-1],ad(j.edge,i.site,j.site,e);i=h[0],j=h[l-1],j.edge=$c(i.site,j.site,null,e),Vc(i),Vc(j)}function Oc(a){for(var b,c,d,e,f=a.x,g=a.y,h=fi._;h;)if(d=Pc(h,g)-f,d>Kg)h=h.L;else{if(e=f-Qc(h,g),!(e>Kg)){d>-Kg?(b=h.P,c=h):e>-Kg?(b=h,c=h.N):b=c=h;break}if(!h.R){b=h;break}h=h.R}var i=Lc(a);if(fi.insert(b,i),b||c){if(b===c)return Wc(b),c=Lc(b.site),fi.insert(i,c),i.edge=c.edge=$c(b.site,i.site),Vc(b),void Vc(c);if(!c)return void(i.edge=$c(b.site,i.site));Wc(b),Wc(c);var j=b.site,k=j.x,l=j.y,m=a.x-k,n=a.y-l,o=c.site,p=o.x-k,q=o.y-l,r=2*(m*q-n*p),s=m*m+n*n,t=p*p+q*q,u={x:(q*s-n*t)/r+k,y:(m*t-p*s)/r+l};ad(c.edge,j,o,u),i.edge=$c(j,a,null,u),c.edge=$c(a,o,null,u),Vc(b),Vc(c)}}function Pc(a,b){var c=a.site,d=c.x,e=c.y,f=e-b;if(!f)return d;var g=a.P;if(!g)return-(1/0);c=g.site;var h=c.x,i=c.y,j=i-b;if(!j)return h;var k=h-d,l=1/f-1/j,m=k/j;return l?(-m+Math.sqrt(m*m-2*l*(k*k/(-2*j)-i+j/2+e-f/2)))/l+d:(d+h)/2}function Qc(a,b){var c=a.N;if(c)return Pc(c,b);var d=a.site;return d.y===b?d.x:1/0}function Rc(a){this.site=a,this.edges=[]}function Sc(a){for(var b,c,d,e,f,g,h,i,j,k,l=a[0][0],m=a[1][0],n=a[0][1],o=a[1][1],p=ei,q=p.length;q--;)if(f=p[q],f&&f.prepare())for(h=f.edges,i=h.length,g=0;i>g;)k=h[g].end(),d=k.x,e=k.y,j=h[++g%i].start(),b=j.x,c=j.y,(ug(d-b)>Kg||ug(e-c)>Kg)&&(h.splice(g,0,new bd(_c(f.site,k,ug(d-l)<Kg&&o-e>Kg?{x:l,y:ug(b-l)<Kg?c:o}:ug(e-o)<Kg&&m-d>Kg?{x:ug(c-o)<Kg?b:m,y:o}:ug(d-m)<Kg&&e-n>Kg?{x:m,y:ug(b-m)<Kg?c:n}:ug(e-n)<Kg&&d-l>Kg?{x:ug(c-n)<Kg?b:l,y:n}:null),f.site,null)),++i)}function Tc(a,b){return b.angle-a.angle}function Uc(){dd(this),this.x=this.y=this.arc=this.site=this.cy=null}function Vc(a){var b=a.P,c=a.N;if(b&&c){var d=b.site,e=a.site,f=c.site;if(d!==f){var g=e.x,h=e.y,i=d.x-g,j=d.y-h,k=f.x-g,l=f.y-h,m=2*(i*l-j*k);if(!(m>=-Lg)){var n=i*i+j*j,o=k*k+l*l,p=(l*n-j*o)/m,q=(i*o-k*n)/m,l=q+h,r=ji.pop()||new Uc;r.arc=a,r.site=e,r.x=p+g,r.y=l+Math.sqrt(p*p+q*q),r.cy=l,a.circle=r;for(var s=null,t=hi._;t;)if(r.y<t.y||r.y===t.y&&r.x<=t.x){if(!t.L){s=t.P;break}t=t.L}else{if(!t.R){s=t;break}t=t.R}hi.insert(s,r),s||(gi=r)}}}}function Wc(a){var b=a.circle;b&&(b.P||(gi=b.N),hi.remove(b),ji.push(b),dd(b),a.circle=null)}function Xc(a){for(var b,c=di,d=Rb(a[0][0],a[0][1],a[1][0],a[1][1]),e=c.length;e--;)b=c[e],(!Yc(b,a)||!d(b)||ug(b.a.x-b.b.x)<Kg&&ug(b.a.y-b.b.y)<Kg)&&(b.a=b.b=null,c.splice(e,1))}function Yc(a,b){var c=a.b;if(c)return!0;var d,e,f=a.a,g=b[0][0],h=b[1][0],i=b[0][1],j=b[1][1],k=a.l,l=a.r,m=k.x,n=k.y,o=l.x,p=l.y,q=(m+o)/2,r=(n+p)/2;if(p===n){if(g>q||q>=h)return;if(m>o){if(f){if(f.y>=j)return}else f={x:q,y:i};c={x:q,y:j}}else{if(f){if(f.y<i)return}else f={x:q,y:j};c={x:q,y:i}}}else if(d=(m-o)/(p-n),e=r-d*q,-1>d||d>1)if(m>o){if(f){if(f.y>=j)return}else f={x:(i-e)/d,y:i};c={x:(j-e)/d,y:j}}else{if(f){if(f.y<i)return}else f={x:(j-e)/d,y:j};c={x:(i-e)/d,y:i}}else if(p>n){if(f){if(f.x>=h)return}else f={x:g,y:d*g+e};c={x:h,y:d*h+e}}else{if(f){if(f.x<g)return}else f={x:h,y:d*h+e};c={x:g,y:d*g+e}}return a.a=f,a.b=c,!0}function Zc(a,b){this.l=a,this.r=b,this.a=this.b=null}function $c(a,b,c,d){var e=new Zc(a,b);return di.push(e),c&&ad(e,a,b,c),d&&ad(e,b,a,d),ei[a.i].edges.push(new bd(e,a,b)),ei[b.i].edges.push(new bd(e,b,a)),e}function _c(a,b,c){var d=new Zc(a,null);return d.a=b,d.b=c,di.push(d),d}function ad(a,b,c,d){a.a||a.b?a.l===c?a.b=d:a.a=d:(a.a=d,a.l=b,a.r=c)}function bd(a,b,c){var d=a.a,e=a.b;this.edge=a,this.site=b,this.angle=c?Math.atan2(c.y-b.y,c.x-b.x):a.l===b?Math.atan2(e.x-d.x,d.y-e.y):Math.atan2(d.x-e.x,e.y-d.y)}function cd(){this._=null}function dd(a){a.U=a.C=a.L=a.R=a.P=a.N=null}function ed(a,b){var c=b,d=b.R,e=c.U;e?e.L===c?e.L=d:e.R=d:a._=d,d.U=e,c.U=d,c.R=d.L,c.R&&(c.R.U=c),d.L=c}function fd(a,b){var c=b,d=b.L,e=c.U;e?e.L===c?e.L=d:e.R=d:a._=d,d.U=e,c.U=d,c.L=d.R,c.L&&(c.L.U=c),d.R=c}function gd(a){for(;a.L;)a=a.L;return a}function hd(a,b){var c,d,e,f=a.sort(id).pop();for(di=[],ei=new Array(a.length),fi=new cd,hi=new cd;;)if(e=gi,f&&(!e||f.y<e.y||f.y===e.y&&f.x<e.x))f.x===c&&f.y===d||(ei[f.i]=new Rc(f),Oc(f),c=f.x,d=f.y),f=a.pop();else{if(!e)break;Nc(e.arc)}b&&(Xc(b),Sc(b));var g={cells:ei,edges:di};return fi=hi=di=ei=null,g}function id(a,b){return b.y-a.y||b.x-a.x}function jd(a,b,c){return(a.x-c.x)*(b.y-a.y)-(a.x-b.x)*(c.y-a.y)}function kd(a){return a.x}function ld(a){return a.y}function md(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function nd(a,b,c,d,e,f){if(!a(b,c,d,e,f)){var g=.5*(c+e),h=.5*(d+f),i=b.nodes;i[0]&&nd(a,i[0],c,d,g,h),i[1]&&nd(a,i[1],g,d,e,h),i[2]&&nd(a,i[2],c,h,g,f),i[3]&&nd(a,i[3],g,h,e,f)}}function od(a,b,c,d,e,f,g){var h,i=1/0;return function j(a,k,l,m,n){if(!(k>f||l>g||d>m||e>n)){if(o=a.point){var o,p=b-a.x,q=c-a.y,r=p*p+q*q;if(i>r){var s=Math.sqrt(i=r);d=b-s,e=c-s,f=b+s,g=c+s,h=o}}for(var t=a.nodes,u=.5*(k+m),v=.5*(l+n),w=b>=u,x=c>=v,y=x<<1|w,z=y+4;z>y;++y)if(a=t[3&y])switch(3&y){case 0:j(a,k,l,u,v);break;case 1:j(a,u,l,m,v);break;case 2:j(a,k,v,u,n);break;case 3:j(a,u,v,m,n)}}}(a,d,e,f,g),h}function pd(a,b){a=ig.rgb(a),b=ig.rgb(b);var c=a.r,d=a.g,e=a.b,f=b.r-c,g=b.g-d,h=b.b-e;return function(a){return"#"+va(Math.round(c+f*a))+va(Math.round(d+g*a))+va(Math.round(e+h*a))}}function qd(a,b){var c,d={},e={};for(c in a)c in b?d[c]=td(a[c],b[c]):e[c]=a[c];for(c in b)c in a||(e[c]=b[c]);return function(a){for(c in d)e[c]=d[c](a);return e}}function rd(a,b){return a=+a,b=+b,function(c){return a*(1-c)+b*c}}function sd(a,b){var c,d,e,f=li.lastIndex=mi.lastIndex=0,g=-1,h=[],i=[];for(a+="",b+="";(c=li.exec(a))&&(d=mi.exec(b));)(e=d.index)>f&&(e=b.slice(f,e),h[g]?h[g]+=e:h[++g]=e),(c=c[0])===(d=d[0])?h[g]?h[g]+=d:h[++g]=d:(h[++g]=null,i.push({i:g,x:rd(c,d)})),f=mi.lastIndex;return f<b.length&&(e=b.slice(f),h[g]?h[g]+=e:h[++g]=e),h.length<2?i[0]?(b=i[0].x,function(a){return b(a)+""}):function(){return b}:(b=i.length,function(a){for(var c,d=0;b>d;++d)h[(c=i[d]).i]=c.x(a);return h.join("")})}function td(a,b){for(var c,d=ig.interpolators.length;--d>=0&&!(c=ig.interpolators[d](a,b)););return c}function ud(a,b){var c,d=[],e=[],f=a.length,g=b.length,h=Math.min(a.length,b.length);for(c=0;h>c;++c)d.push(td(a[c],b[c]));for(;f>c;++c)e[c]=a[c];for(;g>c;++c)e[c]=b[c];return function(a){for(c=0;h>c;++c)e[c]=d[c](a);return e}}function vd(a){return function(b){return 0>=b?0:b>=1?1:a(b)}}function wd(a){return function(b){return 1-a(1-b)}}function xd(a){return function(b){return.5*(.5>b?a(2*b):2-a(2-2*b))}}function yd(a){return a*a}function zd(a){return a*a*a}function Ad(a){if(0>=a)return 0;if(a>=1)return 1;var b=a*a,c=b*a;return 4*(.5>a?c:3*(a-b)+c-.75)}function Bd(a){return function(b){return Math.pow(b,a)}}function Cd(a){return 1-Math.cos(a*Pg)}function Dd(a){return Math.pow(2,10*(a-1))}function Ed(a){return 1-Math.sqrt(1-a*a)}function Fd(a,b){var c;return arguments.length<2&&(b=.45),arguments.length?c=b/Ng*Math.asin(1/a):(a=1,c=b/4),function(d){return 1+a*Math.pow(2,-10*d)*Math.sin((d-c)*Ng/b)}}function Gd(a){return a||(a=1.70158),function(b){return b*b*((a+1)*b-a)}}function Hd(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}function Id(a,b){a=ig.hcl(a),b=ig.hcl(b);var c=a.h,d=a.c,e=a.l,f=b.h-c,g=b.c-d,h=b.l-e;return isNaN(g)&&(g=0,d=isNaN(d)?b.c:d),isNaN(f)?(f=0,c=isNaN(c)?b.h:c):f>180?f-=360:-180>f&&(f+=360),function(a){return la(c+f*a,d+g*a,e+h*a)+""}}function Jd(a,b){a=ig.hsl(a),b=ig.hsl(b);var c=a.h,d=a.s,e=a.l,f=b.h-c,g=b.s-d,h=b.l-e;return isNaN(g)&&(g=0,d=isNaN(d)?b.s:d),isNaN(f)?(f=0,c=isNaN(c)?b.h:c):f>180?f-=360:-180>f&&(f+=360),function(a){return ja(c+f*a,d+g*a,e+h*a)+""}}function Kd(a,b){a=ig.lab(a),b=ig.lab(b);var c=a.l,d=a.a,e=a.b,f=b.l-c,g=b.a-d,h=b.b-e;return function(a){return na(c+f*a,d+g*a,e+h*a)+""}}function Ld(a,b){return b-=a,function(c){return Math.round(a+b*c)}}function Md(a){var b=[a.a,a.b],c=[a.c,a.d],d=Od(b),e=Nd(b,c),f=Od(Pd(c,b,-e))||0;b[0]*c[1]<c[0]*b[1]&&(b[0]*=-1,b[1]*=-1,d*=-1,e*=-1),this.rotate=(d?Math.atan2(b[1],b[0]):Math.atan2(-c[0],c[1]))*Rg,this.translate=[a.e,a.f],this.scale=[d,f],this.skew=f?Math.atan2(e,f)*Rg:0}function Nd(a,b){return a[0]*b[0]+a[1]*b[1]}function Od(a){var b=Math.sqrt(Nd(a,a));return b&&(a[0]/=b,a[1]/=b),b}function Pd(a,b,c){return a[0]+=c*b[0],a[1]+=c*b[1],a}function Qd(a){return a.length?a.pop()+",":""}function Rd(a,b,c,d){if(a[0]!==b[0]||a[1]!==b[1]){var e=c.push("translate(",null,",",null,")");d.push({i:e-4,x:rd(a[0],b[0])},{i:e-2,x:rd(a[1],b[1])})}else(b[0]||b[1])&&c.push("translate("+b+")");
}function Sd(a,b,c,d){a!==b?(a-b>180?b+=360:b-a>180&&(a+=360),d.push({i:c.push(Qd(c)+"rotate(",null,")")-2,x:rd(a,b)})):b&&c.push(Qd(c)+"rotate("+b+")")}function Td(a,b,c,d){a!==b?d.push({i:c.push(Qd(c)+"skewX(",null,")")-2,x:rd(a,b)}):b&&c.push(Qd(c)+"skewX("+b+")")}function Ud(a,b,c,d){if(a[0]!==b[0]||a[1]!==b[1]){var e=c.push(Qd(c)+"scale(",null,",",null,")");d.push({i:e-4,x:rd(a[0],b[0])},{i:e-2,x:rd(a[1],b[1])})}else 1===b[0]&&1===b[1]||c.push(Qd(c)+"scale("+b+")")}function Vd(a,b){var c=[],d=[];return a=ig.transform(a),b=ig.transform(b),Rd(a.translate,b.translate,c,d),Sd(a.rotate,b.rotate,c,d),Td(a.skew,b.skew,c,d),Ud(a.scale,b.scale,c,d),a=b=null,function(a){for(var b,e=-1,f=d.length;++e<f;)c[(b=d[e]).i]=b.x(a);return c.join("")}}function Wd(a,b){return b=(b-=a=+a)||1/b,function(c){return(c-a)/b}}function Xd(a,b){return b=(b-=a=+a)||1/b,function(c){return Math.max(0,Math.min(1,(c-a)/b))}}function Yd(a){for(var b=a.source,c=a.target,d=$d(b,c),e=[b];b!==d;)b=b.parent,e.push(b);for(var f=e.length;c!==d;)e.splice(f,0,c),c=c.parent;return e}function Zd(a){for(var b=[],c=a.parent;null!=c;)b.push(a),a=c,c=c.parent;return b.push(a),b}function $d(a,b){if(a===b)return a;for(var c=Zd(a),d=Zd(b),e=c.pop(),f=d.pop(),g=null;e===f;)g=e,e=c.pop(),f=d.pop();return g}function _d(a){a.fixed|=2}function ae(a){a.fixed&=-7}function be(a){a.fixed|=4,a.px=a.x,a.py=a.y}function ce(a){a.fixed&=-5}function de(a,b,c){var d=0,e=0;if(a.charge=0,!a.leaf)for(var f,g=a.nodes,h=g.length,i=-1;++i<h;)f=g[i],null!=f&&(de(f,b,c),a.charge+=f.charge,d+=f.charge*f.cx,e+=f.charge*f.cy);if(a.point){a.leaf||(a.point.x+=Math.random()-.5,a.point.y+=Math.random()-.5);var j=b*c[a.point.index];a.charge+=a.pointCharge=j,d+=j*a.point.x,e+=j*a.point.y}a.cx=d/a.charge,a.cy=e/a.charge}function ee(a,b){return ig.rebind(a,b,"sort","children","value"),a.nodes=a,a.links=ke,a}function fe(a,b){for(var c=[a];null!=(a=c.pop());)if(b(a),(e=a.children)&&(d=e.length))for(var d,e;--d>=0;)c.push(e[d])}function ge(a,b){for(var c=[a],d=[];null!=(a=c.pop());)if(d.push(a),(f=a.children)&&(e=f.length))for(var e,f,g=-1;++g<e;)c.push(f[g]);for(;null!=(a=d.pop());)b(a)}function he(a){return a.children}function ie(a){return a.value}function je(a,b){return b.value-a.value}function ke(a){return ig.merge(a.map(function(a){return(a.children||[]).map(function(b){return{source:a,target:b}})}))}function le(a){return a.x}function me(a){return a.y}function ne(a,b,c){a.y0=b,a.y=c}function oe(a){return ig.range(a.length)}function pe(a){for(var b=-1,c=a[0].length,d=[];++b<c;)d[b]=0;return d}function qe(a){for(var b,c=1,d=0,e=a[0][1],f=a.length;f>c;++c)(b=a[c][1])>e&&(d=c,e=b);return d}function re(a){return a.reduce(se,0)}function se(a,b){return a+b[1]}function te(a,b){return ue(a,Math.ceil(Math.log(b.length)/Math.LN2+1))}function ue(a,b){for(var c=-1,d=+a[0],e=(a[1]-d)/b,f=[];++c<=b;)f[c]=e*c+d;return f}function ve(a){return[ig.min(a),ig.max(a)]}function we(a,b){return a.value-b.value}function xe(a,b){var c=a._pack_next;a._pack_next=b,b._pack_prev=a,b._pack_next=c,c._pack_prev=b}function ye(a,b){a._pack_next=b,b._pack_prev=a}function ze(a,b){var c=b.x-a.x,d=b.y-a.y,e=a.r+b.r;return.999*e*e>c*c+d*d}function Ae(a){function b(a){k=Math.min(a.x-a.r,k),l=Math.max(a.x+a.r,l),m=Math.min(a.y-a.r,m),n=Math.max(a.y+a.r,n)}if((c=a.children)&&(j=c.length)){var c,d,e,f,g,h,i,j,k=1/0,l=-(1/0),m=1/0,n=-(1/0);if(c.forEach(Be),d=c[0],d.x=-d.r,d.y=0,b(d),j>1&&(e=c[1],e.x=e.r,e.y=0,b(e),j>2))for(f=c[2],Ee(d,e,f),b(f),xe(d,f),d._pack_prev=f,xe(f,e),e=d._pack_next,g=3;j>g;g++){Ee(d,e,f=c[g]);var o=0,p=1,q=1;for(h=e._pack_next;h!==e;h=h._pack_next,p++)if(ze(h,f)){o=1;break}if(1==o)for(i=d._pack_prev;i!==h._pack_prev&&!ze(i,f);i=i._pack_prev,q++);o?(q>p||p==q&&e.r<d.r?ye(d,e=h):ye(d=i,e),g--):(xe(d,f),e=f,b(f))}var r=(k+l)/2,s=(m+n)/2,t=0;for(g=0;j>g;g++)f=c[g],f.x-=r,f.y-=s,t=Math.max(t,f.r+Math.sqrt(f.x*f.x+f.y*f.y));a.r=t,c.forEach(Ce)}}function Be(a){a._pack_next=a._pack_prev=a}function Ce(a){delete a._pack_next,delete a._pack_prev}function De(a,b,c,d){var e=a.children;if(a.x=b+=d*a.x,a.y=c+=d*a.y,a.r*=d,e)for(var f=-1,g=e.length;++f<g;)De(e[f],b,c,d)}function Ee(a,b,c){var d=a.r+c.r,e=b.x-a.x,f=b.y-a.y;if(d&&(e||f)){var g=b.r+c.r,h=e*e+f*f;g*=g,d*=d;var i=.5+(d-g)/(2*h),j=Math.sqrt(Math.max(0,2*g*(d+h)-(d-=h)*d-g*g))/(2*h);c.x=a.x+i*e+j*f,c.y=a.y+i*f-j*e}else c.x=a.x+d,c.y=a.y}function Fe(a,b){return a.parent==b.parent?1:2}function Ge(a){var b=a.children;return b.length?b[0]:a.t}function He(a){var b,c=a.children;return(b=c.length)?c[b-1]:a.t}function Ie(a,b,c){var d=c/(b.i-a.i);b.c-=d,b.s+=c,a.c+=d,b.z+=c,b.m+=c}function Je(a){for(var b,c=0,d=0,e=a.children,f=e.length;--f>=0;)b=e[f],b.z+=c,b.m+=c,c+=b.s+(d+=b.c)}function Ke(a,b,c){return a.a.parent===b.parent?a.a:c}function Le(a){return 1+ig.max(a,function(a){return a.y})}function Me(a){return a.reduce(function(a,b){return a+b.x},0)/a.length}function Ne(a){var b=a.children;return b&&b.length?Ne(b[0]):a}function Oe(a){var b,c=a.children;return c&&(b=c.length)?Oe(c[b-1]):a}function Pe(a){return{x:a.x,y:a.y,dx:a.dx,dy:a.dy}}function Qe(a,b){var c=a.x+b[3],d=a.y+b[0],e=a.dx-b[1]-b[3],f=a.dy-b[0]-b[2];return 0>e&&(c+=e/2,e=0),0>f&&(d+=f/2,f=0),{x:c,y:d,dx:e,dy:f}}function Re(a){var b=a[0],c=a[a.length-1];return c>b?[b,c]:[c,b]}function Se(a){return a.rangeExtent?a.rangeExtent():Re(a.range())}function Te(a,b,c,d){var e=c(a[0],a[1]),f=d(b[0],b[1]);return function(a){return f(e(a))}}function Ue(a,b){var c,d=0,e=a.length-1,f=a[d],g=a[e];return f>g&&(c=d,d=e,e=c,c=f,f=g,g=c),a[d]=b.floor(f),a[e]=b.ceil(g),a}function Ve(a){return a?{floor:function(b){return Math.floor(b/a)*a},ceil:function(b){return Math.ceil(b/a)*a}}:xi}function We(a,b,c,d){var e=[],f=[],g=0,h=Math.min(a.length,b.length)-1;for(a[h]<a[0]&&(a=a.slice().reverse(),b=b.slice().reverse());++g<=h;)e.push(c(a[g-1],a[g])),f.push(d(b[g-1],b[g]));return function(b){var c=ig.bisect(a,b,1,h)-1;return f[c](e[c](b))}}function Xe(a,b,c,d){function e(){var e=Math.min(a.length,b.length)>2?We:Te,i=d?Xd:Wd;return g=e(a,b,i,c),h=e(b,a,i,td),f}function f(a){return g(a)}var g,h;return f.invert=function(a){return h(a)},f.domain=function(b){return arguments.length?(a=b.map(Number),e()):a},f.range=function(a){return arguments.length?(b=a,e()):b},f.rangeRound=function(a){return f.range(a).interpolate(Ld)},f.clamp=function(a){return arguments.length?(d=a,e()):d},f.interpolate=function(a){return arguments.length?(c=a,e()):c},f.ticks=function(b){return _e(a,b)},f.tickFormat=function(b,c){return af(a,b,c)},f.nice=function(b){return Ze(a,b),e()},f.copy=function(){return Xe(a,b,c,d)},e()}function Ye(a,b){return ig.rebind(a,b,"range","rangeRound","interpolate","clamp")}function Ze(a,b){return Ue(a,Ve($e(a,b)[2]))}function $e(a,b){null==b&&(b=10);var c=Re(a),d=c[1]-c[0],e=Math.pow(10,Math.floor(Math.log(d/b)/Math.LN10)),f=b/d*e;return.15>=f?e*=10:.35>=f?e*=5:.75>=f&&(e*=2),c[0]=Math.ceil(c[0]/e)*e,c[1]=Math.floor(c[1]/e)*e+.5*e,c[2]=e,c}function _e(a,b){return ig.range.apply(ig,$e(a,b))}function af(a,b,c){var d=$e(a,b);if(c){var e=lh.exec(c);if(e.shift(),"s"===e[8]){var f=ig.formatPrefix(Math.max(ug(d[0]),ug(d[1])));return e[7]||(e[7]="."+bf(f.scale(d[2]))),e[8]="f",c=ig.format(e.join("")),function(a){return c(f.scale(a))+f.symbol}}e[7]||(e[7]="."+cf(e[8],d)),c=e.join("")}else c=",."+bf(d[2])+"f";return ig.format(c)}function bf(a){return-Math.floor(Math.log(a)/Math.LN10+.01)}function cf(a,b){var c=bf(b[2]);return a in yi?Math.abs(c-bf(Math.max(ug(b[0]),ug(b[1]))))+ +("e"!==a):c-2*("%"===a)}function df(a,b,c,d){function e(a){return(c?Math.log(0>a?0:a):-Math.log(a>0?0:-a))/Math.log(b)}function f(a){return c?Math.pow(b,a):-Math.pow(b,-a)}function g(b){return a(e(b))}return g.invert=function(b){return f(a.invert(b))},g.domain=function(b){return arguments.length?(c=b[0]>=0,a.domain((d=b.map(Number)).map(e)),g):d},g.base=function(c){return arguments.length?(b=+c,a.domain(d.map(e)),g):b},g.nice=function(){var b=Ue(d.map(e),c?Math:Ai);return a.domain(b),d=b.map(f),g},g.ticks=function(){var a=Re(d),g=[],h=a[0],i=a[1],j=Math.floor(e(h)),k=Math.ceil(e(i)),l=b%1?2:b;if(isFinite(k-j)){if(c){for(;k>j;j++)for(var m=1;l>m;m++)g.push(f(j)*m);g.push(f(j))}else for(g.push(f(j));j++<k;)for(var m=l-1;m>0;m--)g.push(f(j)*m);for(j=0;g[j]<h;j++);for(k=g.length;g[k-1]>i;k--);g=g.slice(j,k)}return g},g.tickFormat=function(a,b){if(!arguments.length)return zi;arguments.length<2?b=zi:"function"!=typeof b&&(b=ig.format(b));var d,h=Math.max(.1,a/g.ticks().length),i=c?(d=1e-12,Math.ceil):(d=-1e-12,Math.floor);return function(a){return a/f(i(e(a)+d))<=h?b(a):""}},g.copy=function(){return df(a.copy(),b,c,d)},Ye(g,a)}function ef(a,b,c){function d(b){return a(e(b))}var e=ff(b),f=ff(1/b);return d.invert=function(b){return f(a.invert(b))},d.domain=function(b){return arguments.length?(a.domain((c=b.map(Number)).map(e)),d):c},d.ticks=function(a){return _e(c,a)},d.tickFormat=function(a,b){return af(c,a,b)},d.nice=function(a){return d.domain(Ze(c,a))},d.exponent=function(g){return arguments.length?(e=ff(b=g),f=ff(1/b),a.domain(c.map(e)),d):b},d.copy=function(){return ef(a.copy(),b,c)},Ye(d,a)}function ff(a){return function(b){return 0>b?-Math.pow(-b,a):Math.pow(b,a)}}function gf(a,b){function c(c){return f[((e.get(c)||("range"===b.t?e.set(c,a.push(c)):NaN))-1)%f.length]}function d(b,c){return ig.range(a.length).map(function(a){return b+c*a})}var e,f,g;return c.domain=function(d){if(!arguments.length)return a;a=[],e=new k;for(var f,g=-1,h=d.length;++g<h;)e.has(f=d[g])||e.set(f,a.push(f));return c[b.t].apply(c,b.a)},c.range=function(a){return arguments.length?(f=a,g=0,b={t:"range",a:arguments},c):f},c.rangePoints=function(e,h){arguments.length<2&&(h=0);var i=e[0],j=e[1],k=a.length<2?(i=(i+j)/2,0):(j-i)/(a.length-1+h);return f=d(i+k*h/2,k),g=0,b={t:"rangePoints",a:arguments},c},c.rangeRoundPoints=function(e,h){arguments.length<2&&(h=0);var i=e[0],j=e[1],k=a.length<2?(i=j=Math.round((i+j)/2),0):(j-i)/(a.length-1+h)|0;return f=d(i+Math.round(k*h/2+(j-i-(a.length-1+h)*k)/2),k),g=0,b={t:"rangeRoundPoints",a:arguments},c},c.rangeBands=function(e,h,i){arguments.length<2&&(h=0),arguments.length<3&&(i=h);var j=e[1]<e[0],k=e[j-0],l=e[1-j],m=(l-k)/(a.length-h+2*i);return f=d(k+m*i,m),j&&f.reverse(),g=m*(1-h),b={t:"rangeBands",a:arguments},c},c.rangeRoundBands=function(e,h,i){arguments.length<2&&(h=0),arguments.length<3&&(i=h);var j=e[1]<e[0],k=e[j-0],l=e[1-j],m=Math.floor((l-k)/(a.length-h+2*i));return f=d(k+Math.round((l-k-(a.length-h)*m)/2),m),j&&f.reverse(),g=Math.round(m*(1-h)),b={t:"rangeRoundBands",a:arguments},c},c.rangeBand=function(){return g},c.rangeExtent=function(){return Re(b.a[0])},c.copy=function(){return gf(a,b)},c.domain(a)}function hf(a,b){function c(){var c=0,d=b.length;for(h=[];++c<d;)h[c-1]=ig.quantile(a,c/d);return g}function g(a){return isNaN(a=+a)?void 0:b[ig.bisect(h,a)]}var h;return g.domain=function(b){return arguments.length?(a=b.map(e).filter(f).sort(d),c()):a},g.range=function(a){return arguments.length?(b=a,c()):b},g.quantiles=function(){return h},g.invertExtent=function(c){return c=b.indexOf(c),0>c?[NaN,NaN]:[c>0?h[c-1]:a[0],c<h.length?h[c]:a[a.length-1]]},g.copy=function(){return hf(a,b)},c()}function jf(a,b,c){function d(b){return c[Math.max(0,Math.min(g,Math.floor(f*(b-a))))]}function e(){return f=c.length/(b-a),g=c.length-1,d}var f,g;return d.domain=function(c){return arguments.length?(a=+c[0],b=+c[c.length-1],e()):[a,b]},d.range=function(a){return arguments.length?(c=a,e()):c},d.invertExtent=function(b){return b=c.indexOf(b),b=0>b?NaN:b/f+a,[b,b+1/f]},d.copy=function(){return jf(a,b,c)},e()}function kf(a,b){function c(c){return c>=c?b[ig.bisect(a,c)]:void 0}return c.domain=function(b){return arguments.length?(a=b,c):a},c.range=function(a){return arguments.length?(b=a,c):b},c.invertExtent=function(c){return c=b.indexOf(c),[a[c-1],a[c]]},c.copy=function(){return kf(a,b)},c}function lf(a){function b(a){return+a}return b.invert=b,b.domain=b.range=function(c){return arguments.length?(a=c.map(b),b):a},b.ticks=function(b){return _e(a,b)},b.tickFormat=function(b,c){return af(a,b,c)},b.copy=function(){return lf(a)},b}function mf(){return 0}function nf(a){return a.innerRadius}function of(a){return a.outerRadius}function pf(a){return a.startAngle}function qf(a){return a.endAngle}function rf(a){return a&&a.padAngle}function sf(a,b,c,d){return(a-c)*b-(b-d)*a>0?0:1}function tf(a,b,c,d,e){var f=a[0]-b[0],g=a[1]-b[1],h=(e?d:-d)/Math.sqrt(f*f+g*g),i=h*g,j=-h*f,k=a[0]+i,l=a[1]+j,m=b[0]+i,n=b[1]+j,o=(k+m)/2,p=(l+n)/2,q=m-k,r=n-l,s=q*q+r*r,t=c-d,u=k*n-m*l,v=(0>r?-1:1)*Math.sqrt(Math.max(0,t*t*s-u*u)),w=(u*r-q*v)/s,x=(-u*q-r*v)/s,y=(u*r+q*v)/s,z=(-u*q+r*v)/s,A=w-o,B=x-p,C=y-o,D=z-p;return A*A+B*B>C*C+D*D&&(w=y,x=z),[[w-i,x-j],[w*c/t,x*c/t]]}function uf(a){function b(b){function g(){j.push("M",f(a(k),h))}for(var i,j=[],k=[],l=-1,m=b.length,n=Ba(c),o=Ba(d);++l<m;)e.call(this,i=b[l],l)?k.push([+n.call(this,i,l),+o.call(this,i,l)]):k.length&&(g(),k=[]);return k.length&&g(),j.length?j.join(""):null}var c=Dc,d=Ec,e=Eb,f=vf,g=f.key,h=.7;return b.x=function(a){return arguments.length?(c=a,b):c},b.y=function(a){return arguments.length?(d=a,b):d},b.defined=function(a){return arguments.length?(e=a,b):e},b.interpolate=function(a){return arguments.length?(g="function"==typeof a?f=a:(f=Gi.get(a)||vf).key,b):g},b.tension=function(a){return arguments.length?(h=a,b):h},b}function vf(a){return a.length>1?a.join("L"):a+"Z"}function wf(a){return a.join("L")+"Z"}function xf(a){for(var b=0,c=a.length,d=a[0],e=[d[0],",",d[1]];++b<c;)e.push("H",(d[0]+(d=a[b])[0])/2,"V",d[1]);return c>1&&e.push("H",d[0]),e.join("")}function yf(a){for(var b=0,c=a.length,d=a[0],e=[d[0],",",d[1]];++b<c;)e.push("V",(d=a[b])[1],"H",d[0]);return e.join("")}function zf(a){for(var b=0,c=a.length,d=a[0],e=[d[0],",",d[1]];++b<c;)e.push("H",(d=a[b])[0],"V",d[1]);return e.join("")}function Af(a,b){return a.length<4?vf(a):a[1]+Df(a.slice(1,-1),Ef(a,b))}function Bf(a,b){return a.length<3?wf(a):a[0]+Df((a.push(a[0]),a),Ef([a[a.length-2]].concat(a,[a[1]]),b))}function Cf(a,b){return a.length<3?vf(a):a[0]+Df(a,Ef(a,b))}function Df(a,b){if(b.length<1||a.length!=b.length&&a.length!=b.length+2)return vf(a);var c=a.length!=b.length,d="",e=a[0],f=a[1],g=b[0],h=g,i=1;if(c&&(d+="Q"+(f[0]-2*g[0]/3)+","+(f[1]-2*g[1]/3)+","+f[0]+","+f[1],e=a[1],i=2),b.length>1){h=b[1],f=a[i],i++,d+="C"+(e[0]+g[0])+","+(e[1]+g[1])+","+(f[0]-h[0])+","+(f[1]-h[1])+","+f[0]+","+f[1];for(var j=2;j<b.length;j++,i++)f=a[i],h=b[j],d+="S"+(f[0]-h[0])+","+(f[1]-h[1])+","+f[0]+","+f[1]}if(c){var k=a[i];d+="Q"+(f[0]+2*h[0]/3)+","+(f[1]+2*h[1]/3)+","+k[0]+","+k[1]}return d}function Ef(a,b){for(var c,d=[],e=(1-b)/2,f=a[0],g=a[1],h=1,i=a.length;++h<i;)c=f,f=g,g=a[h],d.push([e*(g[0]-c[0]),e*(g[1]-c[1])]);return d}function Ff(a){if(a.length<3)return vf(a);var b=1,c=a.length,d=a[0],e=d[0],f=d[1],g=[e,e,e,(d=a[1])[0]],h=[f,f,f,d[1]],i=[e,",",f,"L",Jf(Ji,g),",",Jf(Ji,h)];for(a.push(a[c-1]);++b<=c;)d=a[b],g.shift(),g.push(d[0]),h.shift(),h.push(d[1]),Kf(i,g,h);return a.pop(),i.push("L",d),i.join("")}function Gf(a){if(a.length<4)return vf(a);for(var b,c=[],d=-1,e=a.length,f=[0],g=[0];++d<3;)b=a[d],f.push(b[0]),g.push(b[1]);for(c.push(Jf(Ji,f)+","+Jf(Ji,g)),--d;++d<e;)b=a[d],f.shift(),f.push(b[0]),g.shift(),g.push(b[1]),Kf(c,f,g);return c.join("")}function Hf(a){for(var b,c,d=-1,e=a.length,f=e+4,g=[],h=[];++d<4;)c=a[d%e],g.push(c[0]),h.push(c[1]);for(b=[Jf(Ji,g),",",Jf(Ji,h)],--d;++d<f;)c=a[d%e],g.shift(),g.push(c[0]),h.shift(),h.push(c[1]),Kf(b,g,h);return b.join("")}function If(a,b){var c=a.length-1;if(c)for(var d,e,f=a[0][0],g=a[0][1],h=a[c][0]-f,i=a[c][1]-g,j=-1;++j<=c;)d=a[j],e=j/c,d[0]=b*d[0]+(1-b)*(f+e*h),d[1]=b*d[1]+(1-b)*(g+e*i);return Ff(a)}function Jf(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function Kf(a,b,c){a.push("C",Jf(Hi,b),",",Jf(Hi,c),",",Jf(Ii,b),",",Jf(Ii,c),",",Jf(Ji,b),",",Jf(Ji,c))}function Lf(a,b){return(b[1]-a[1])/(b[0]-a[0])}function Mf(a){for(var b=0,c=a.length-1,d=[],e=a[0],f=a[1],g=d[0]=Lf(e,f);++b<c;)d[b]=(g+(g=Lf(e=f,f=a[b+1])))/2;return d[b]=g,d}function Nf(a){for(var b,c,d,e,f=[],g=Mf(a),h=-1,i=a.length-1;++h<i;)b=Lf(a[h],a[h+1]),ug(b)<Kg?g[h]=g[h+1]=0:(c=g[h]/b,d=g[h+1]/b,e=c*c+d*d,e>9&&(e=3*b/Math.sqrt(e),g[h]=e*c,g[h+1]=e*d));for(h=-1;++h<=i;)e=(a[Math.min(i,h+1)][0]-a[Math.max(0,h-1)][0])/(6*(1+g[h]*g[h])),f.push([e||0,g[h]*e||0]);return f}function Of(a){return a.length<3?vf(a):a[0]+Df(a,Nf(a))}function Pf(a){for(var b,c,d,e=-1,f=a.length;++e<f;)b=a[e],c=b[0],d=b[1]-Pg,b[0]=c*Math.cos(d),b[1]=c*Math.sin(d);return a}function Qf(a){function b(b){function i(){p.push("M",h(a(r),l),k,j(a(q.reverse()),l),"Z")}for(var m,n,o,p=[],q=[],r=[],s=-1,t=b.length,u=Ba(c),v=Ba(e),w=c===d?function(){return n}:Ba(d),x=e===f?function(){return o}:Ba(f);++s<t;)g.call(this,m=b[s],s)?(q.push([n=+u.call(this,m,s),o=+v.call(this,m,s)]),r.push([+w.call(this,m,s),+x.call(this,m,s)])):q.length&&(i(),q=[],r=[]);return q.length&&i(),p.length?p.join(""):null}var c=Dc,d=Dc,e=0,f=Ec,g=Eb,h=vf,i=h.key,j=h,k="L",l=.7;return b.x=function(a){return arguments.length?(c=d=a,b):d},b.x0=function(a){return arguments.length?(c=a,b):c},b.x1=function(a){return arguments.length?(d=a,b):d},b.y=function(a){return arguments.length?(e=f=a,b):f},b.y0=function(a){return arguments.length?(e=a,b):e},b.y1=function(a){return arguments.length?(f=a,b):f},b.defined=function(a){return arguments.length?(g=a,b):g},b.interpolate=function(a){return arguments.length?(i="function"==typeof a?h=a:(h=Gi.get(a)||vf).key,j=h.reverse||h,k=h.closed?"M":"L",b):i},b.tension=function(a){return arguments.length?(l=a,b):l},b}function Rf(a){return a.radius}function Sf(a){return[a.x,a.y]}function Tf(a){return function(){var b=a.apply(this,arguments),c=b[0],d=b[1]-Pg;return[c*Math.cos(d),c*Math.sin(d)]}}function Uf(){return 64}function Vf(){return"circle"}function Wf(a){var b=Math.sqrt(a/Mg);return"M0,"+b+"A"+b+","+b+" 0 1,1 0,"+-b+"A"+b+","+b+" 0 1,1 0,"+b+"Z"}function Xf(a){return function(){var b,c,d;(b=this[a])&&(d=b[c=b.active])&&(d.timer.c=null,d.timer.t=NaN,--b.count?delete b[c]:delete this[a],b.active+=.5,d.event&&d.event.interrupt.call(this,this.__data__,d.index))}}function Yf(a,b,c){return zg(a,Qi),a.namespace=b,a.id=c,a}function Zf(a,b,c,d){var e=a.id,f=a.namespace;return S(a,"function"==typeof c?function(a,g,h){a[f][e].tween.set(b,d(c.call(a,a.__data__,g,h)))}:(c=d(c),function(a){a[f][e].tween.set(b,c)}))}function $f(a){return null==a&&(a=""),function(){this.textContent=a}}function _f(a){return null==a?"__transition__":"__transition_"+a+"__"}function ag(a,b,c,d,e){function f(a){var b=p.delay;return j.t=b+i,a>=b?g(a-b):void(j.c=g)}function g(c){var e=o.active,f=o[e];f&&(f.timer.c=null,f.timer.t=NaN,--o.count,delete o[e],f.event&&f.event.interrupt.call(a,a.__data__,f.index));for(var g in o)if(d>+g){var k=o[g];k.timer.c=null,k.timer.t=NaN,--o.count,delete o[g]}o.active=d,p.event&&p.event.start.call(a,a.__data__,b),n=[],p.tween.forEach(function(c,d){(d=d.call(a,a.__data__,b))&&n.push(d)}),m=p.ease,l=p.duration,j.c=h,Ga(function(){return j.c&&h(c||1)&&(j.c=null,j.t=NaN),1},0,i)}function h(e){for(var f=e/l,g=m(f),h=n.length;h>0;)n[--h].call(a,g);return f>=1?(p.event&&p.event.end.call(a,a.__data__,b),--o.count?delete o[d]:delete a[c],1):void 0}var i,j,l,m,n,o=a[c]||(a[c]={active:0,count:0}),p=o[d];p||(i=e.time,j=Ga(f,0,i),p=o[d]={tween:new k,time:i,timer:j,delay:e.delay,duration:e.duration,ease:e.ease,index:b},e=null,++o.count)}function bg(a,b,c){a.attr("transform",function(a){var d=b(a);return"translate("+(isFinite(d)?d:c(a))+",0)"})}function cg(a,b,c){a.attr("transform",function(a){var d=b(a);return"translate(0,"+(isFinite(d)?d:c(a))+")"})}function dg(a){return a.toISOString()}function eg(a,b,c){function d(b){return a(b)}function e(a,c){var d=a[1]-a[0],e=d/c,f=ig.bisect(Zi,e);return f==Zi.length?[b.year,$e(a.map(function(a){return a/31536e6}),c)[2]]:f?b[e/Zi[f-1]<Zi[f]/e?f-1:f]:[aj,$e(a,c)[2]]}return d.invert=function(b){return fg(a.invert(b))},d.domain=function(b){return arguments.length?(a.domain(b),d):a.domain().map(fg)},d.nice=function(a,b){function c(c){return!isNaN(c)&&!a.range(c,fg(+c+1),b).length}var f=d.domain(),g=Re(f),h=null==a?e(g,10):"number"==typeof a&&e(g,a);return h&&(a=h[0],b=h[1]),d.domain(Ue(f,b>1?{floor:function(b){for(;c(b=a.floor(b));)b=fg(b-1);return b},ceil:function(b){for(;c(b=a.ceil(b));)b=fg(+b+1);return b}}:a))},d.ticks=function(a,b){var c=Re(d.domain()),f=null==a?e(c,10):"number"==typeof a?e(c,a):!a.range&&[{range:a},b];return f&&(a=f[0],b=f[1]),a.range(c[0],fg(+c[1]+1),1>b?1:b)},d.tickFormat=function(){return c},d.copy=function(){return eg(a.copy(),b,c)},Ye(d,a)}function fg(a){return new Date(a)}function gg(a){return JSON.parse(a.responseText)}function hg(a){var b=lg.createRange();return b.selectNode(lg.body),b.createContextualFragment(a.responseText)}var ig={version:"3.5.8"},jg=[].slice,kg=function(a){return jg.call(a)},lg=this.document;if(lg)try{kg(lg.documentElement.childNodes)[0].nodeType}catch(mg){kg=function(a){for(var b=a.length,c=new Array(b);b--;)c[b]=a[b];return c}}if(Date.now||(Date.now=function(){return+new Date}),lg)try{lg.createElement("DIV").style.setProperty("opacity",0,"")}catch(ng){var og=this.Element.prototype,pg=og.setAttribute,qg=og.setAttributeNS,rg=this.CSSStyleDeclaration.prototype,sg=rg.setProperty;og.setAttribute=function(a,b){pg.call(this,a,b+"")},og.setAttributeNS=function(a,b,c){qg.call(this,a,b,c+"")},rg.setProperty=function(a,b,c){sg.call(this,a,b+"",c)}}ig.ascending=d,ig.descending=function(a,b){return a>b?-1:b>a?1:b>=a?0:NaN},ig.min=function(a,b){var c,d,e=-1,f=a.length;if(1===arguments.length){for(;++e<f;)if(null!=(d=a[e])&&d>=d){c=d;break}for(;++e<f;)null!=(d=a[e])&&c>d&&(c=d)}else{for(;++e<f;)if(null!=(d=b.call(a,a[e],e))&&d>=d){c=d;break}for(;++e<f;)null!=(d=b.call(a,a[e],e))&&c>d&&(c=d)}return c},ig.max=function(a,b){var c,d,e=-1,f=a.length;if(1===arguments.length){for(;++e<f;)if(null!=(d=a[e])&&d>=d){c=d;break}for(;++e<f;)null!=(d=a[e])&&d>c&&(c=d)}else{for(;++e<f;)if(null!=(d=b.call(a,a[e],e))&&d>=d){c=d;break}for(;++e<f;)null!=(d=b.call(a,a[e],e))&&d>c&&(c=d)}return c},ig.extent=function(a,b){var c,d,e,f=-1,g=a.length;if(1===arguments.length){for(;++f<g;)if(null!=(d=a[f])&&d>=d){c=e=d;break}for(;++f<g;)null!=(d=a[f])&&(c>d&&(c=d),d>e&&(e=d))}else{for(;++f<g;)if(null!=(d=b.call(a,a[f],f))&&d>=d){c=e=d;break}for(;++f<g;)null!=(d=b.call(a,a[f],f))&&(c>d&&(c=d),d>e&&(e=d))}return[c,e]},ig.sum=function(a,b){var c,d=0,e=a.length,g=-1;if(1===arguments.length)for(;++g<e;)f(c=+a[g])&&(d+=c);else for(;++g<e;)f(c=+b.call(a,a[g],g))&&(d+=c);return d},ig.mean=function(a,b){var c,d=0,g=a.length,h=-1,i=g;if(1===arguments.length)for(;++h<g;)f(c=e(a[h]))?d+=c:--i;else for(;++h<g;)f(c=e(b.call(a,a[h],h)))?d+=c:--i;return i?d/i:void 0},ig.quantile=function(a,b){var c=(a.length-1)*b+1,d=Math.floor(c),e=+a[d-1],f=c-d;return f?e+f*(a[d]-e):e},ig.median=function(a,b){var c,g=[],h=a.length,i=-1;if(1===arguments.length)for(;++i<h;)f(c=e(a[i]))&&g.push(c);else for(;++i<h;)f(c=e(b.call(a,a[i],i)))&&g.push(c);return g.length?ig.quantile(g.sort(d),.5):void 0},ig.variance=function(a,b){var c,d,g=a.length,h=0,i=0,j=-1,k=0;if(1===arguments.length)for(;++j<g;)f(c=e(a[j]))&&(d=c-h,h+=d/++k,i+=d*(c-h));else for(;++j<g;)f(c=e(b.call(a,a[j],j)))&&(d=c-h,h+=d/++k,i+=d*(c-h));return k>1?i/(k-1):void 0},ig.deviation=function(){var a=ig.variance.apply(this,arguments);return a?Math.sqrt(a):a};var tg=g(d);ig.bisectLeft=tg.left,ig.bisect=ig.bisectRight=tg.right,ig.bisector=function(a){return g(1===a.length?function(b,c){return d(a(b),c)}:a)},ig.shuffle=function(a,b,c){(f=arguments.length)<3&&(c=a.length,2>f&&(b=0));for(var d,e,f=c-b;f;)e=Math.random()*f--|0,d=a[f+b],a[f+b]=a[e+b],a[e+b]=d;return a},ig.permute=function(a,b){for(var c=b.length,d=new Array(c);c--;)d[c]=a[b[c]];return d},ig.pairs=function(a){for(var b,c=0,d=a.length-1,e=a[0],f=new Array(0>d?0:d);d>c;)f[c]=[b=e,e=a[++c]];return f},ig.zip=function(){if(!(d=arguments.length))return[];for(var a=-1,b=ig.min(arguments,h),c=new Array(b);++a<b;)for(var d,e=-1,f=c[a]=new Array(d);++e<d;)f[e]=arguments[e][a];return c},ig.transpose=function(a){return ig.zip.apply(ig,a)},ig.keys=function(a){var b=[];for(var c in a)b.push(c);return b},ig.values=function(a){var b=[];for(var c in a)b.push(a[c]);return b},ig.entries=function(a){var b=[];for(var c in a)b.push({key:c,value:a[c]});return b},ig.merge=function(a){for(var b,c,d,e=a.length,f=-1,g=0;++f<e;)g+=a[f].length;for(c=new Array(g);--e>=0;)for(d=a[e],b=d.length;--b>=0;)c[--g]=d[b];return c};var ug=Math.abs;ig.range=function(a,b,c){if(arguments.length<3&&(c=1,arguments.length<2&&(b=a,a=0)),(b-a)/c===1/0)throw new Error("infinite range");var d,e=[],f=i(ug(c)),g=-1;if(a*=f,b*=f,c*=f,0>c)for(;(d=a+c*++g)>b;)e.push(d/f);else for(;(d=a+c*++g)<b;)e.push(d/f);return e},ig.map=function(a,b){var c=new k;if(a instanceof k)a.forEach(function(a,b){c.set(a,b)});else if(Array.isArray(a)){var d,e=-1,f=a.length;if(1===arguments.length)for(;++e<f;)c.set(e,a[e]);else for(;++e<f;)c.set(b.call(a,d=a[e],e),d)}else for(var g in a)c.set(g,a[g]);return c};var vg="__proto__",wg="\x00";j(k,{has:n,get:function(a){return this._[l(a)]},set:function(a,b){return this._[l(a)]=b},remove:o,keys:p,values:function(){var a=[];for(var b in this._)a.push(this._[b]);return a},entries:function(){var a=[];for(var b in this._)a.push({key:m(b),value:this._[b]});return a},size:q,empty:r,forEach:function(a){for(var b in this._)a.call(this,m(b),this._[b])}}),ig.nest=function(){function a(b,g,h){if(h>=f.length)return d?d.call(e,g):c?g.sort(c):g;for(var i,j,l,m,n=-1,o=g.length,p=f[h++],q=new k;++n<o;)(m=q.get(i=p(j=g[n])))?m.push(j):q.set(i,[j]);return b?(j=b(),l=function(c,d){j.set(c,a(b,d,h))}):(j={},l=function(c,d){j[c]=a(b,d,h)}),q.forEach(l),j}function b(a,c){if(c>=f.length)return a;var d=[],e=g[c++];return a.forEach(function(a,e){d.push({key:a,values:b(e,c)})}),e?d.sort(function(a,b){return e(a.key,b.key)}):d}var c,d,e={},f=[],g=[];return e.map=function(b,c){return a(c,b,0)},e.entries=function(c){return b(a(ig.map,c,0),0)},e.key=function(a){return f.push(a),e},e.sortKeys=function(a){return g[f.length-1]=a,e},e.sortValues=function(a){return c=a,e},e.rollup=function(a){return d=a,e},e},ig.set=function(a){var b=new s;if(a)for(var c=0,d=a.length;d>c;++c)b.add(a[c]);return b},j(s,{has:n,add:function(a){return this._[l(a+="")]=!0,a},remove:o,values:p,size:q,empty:r,forEach:function(a){for(var b in this._)a.call(this,m(b))}}),ig.behavior={},ig.rebind=function(a,b){for(var c,d=1,e=arguments.length;++d<e;)a[c=arguments[d]]=u(a,b,b[c]);return a};var xg=["webkit","ms","moz","Moz","o","O"];ig.dispatch=function(){for(var a=new x,b=-1,c=arguments.length;++b<c;)a[arguments[b]]=y(a);return a},x.prototype.on=function(a,b){var c=a.indexOf("."),d="";if(c>=0&&(d=a.slice(c+1),a=a.slice(0,c)),a)return arguments.length<2?this[a].on(d):this[a].on(d,b);if(2===arguments.length){if(null==b)for(a in this)this.hasOwnProperty(a)&&this[a].on(d,null);return this}},ig.event=null,ig.requote=function(a){return a.replace(yg,"\\$&")};var yg=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,zg={}.__proto__?function(a,b){a.__proto__=b}:function(a,b){for(var c in b)a[c]=b[c]},Ag=function(a,b){return b.querySelector(a)},Bg=function(a,b){return b.querySelectorAll(a)},Cg=function(a,b){var c=a.matches||a[v(a,"matchesSelector")];return(Cg=function(a,b){return c.call(a,b)})(a,b)};"function"==typeof Sizzle&&(Ag=function(a,b){return Sizzle(a,b)[0]||null},Bg=Sizzle,Cg=Sizzle.matchesSelector),ig.selection=function(){return ig.select(lg.documentElement)};var Dg=ig.selection.prototype=[];Dg.select=function(a){var b,c,d,e,f=[];a=D(a);for(var g=-1,h=this.length;++g<h;){f.push(b=[]),b.parentNode=(d=this[g]).parentNode;for(var i=-1,j=d.length;++i<j;)(e=d[i])?(b.push(c=a.call(e,e.__data__,i,g)),c&&"__data__"in e&&(c.__data__=e.__data__)):b.push(null)}return C(f)},Dg.selectAll=function(a){var b,c,d=[];a=E(a);for(var e=-1,f=this.length;++e<f;)for(var g=this[e],h=-1,i=g.length;++h<i;)(c=g[h])&&(d.push(b=kg(a.call(c,c.__data__,h,e))),b.parentNode=c);return C(d)};var Eg={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};ig.ns={prefix:Eg,qualify:function(a){var b=a.indexOf(":"),c=a;return b>=0&&"xmlns"!==(c=a.slice(0,b))&&(a=a.slice(b+1)),Eg.hasOwnProperty(c)?{space:Eg[c],local:a}:a}},Dg.attr=function(a,b){if(arguments.length<2){if("string"==typeof a){var c=this.node();return a=ig.ns.qualify(a),a.local?c.getAttributeNS(a.space,a.local):c.getAttribute(a)}for(b in a)this.each(F(b,a[b]));return this}return this.each(F(a,b))},Dg.classed=function(a,b){if(arguments.length<2){if("string"==typeof a){var c=this.node(),d=(a=I(a)).length,e=-1;if(b=c.classList){for(;++e<d;)if(!b.contains(a[e]))return!1}else for(b=c.getAttribute("class");++e<d;)if(!H(a[e]).test(b))return!1;return!0}for(b in a)this.each(J(b,a[b]));return this}return this.each(J(a,b))},Dg.style=function(a,b,d){var e=arguments.length;if(3>e){if("string"!=typeof a){2>e&&(b="");for(d in a)this.each(L(d,a[d],b));return this}if(2>e){var f=this.node();return c(f).getComputedStyle(f,null).getPropertyValue(a)}d=""}return this.each(L(a,b,d))},Dg.property=function(a,b){if(arguments.length<2){if("string"==typeof a)return this.node()[a];for(b in a)this.each(M(b,a[b]));return this}return this.each(M(a,b))},Dg.text=function(a){return arguments.length?this.each("function"==typeof a?function(){var b=a.apply(this,arguments);this.textContent=null==b?"":b}:null==a?function(){this.textContent=""}:function(){this.textContent=a}):this.node().textContent},Dg.html=function(a){return arguments.length?this.each("function"==typeof a?function(){var b=a.apply(this,arguments);this.innerHTML=null==b?"":b}:null==a?function(){this.innerHTML=""}:function(){this.innerHTML=a}):this.node().innerHTML},Dg.append=function(a){return a=N(a),this.select(function(){return this.appendChild(a.apply(this,arguments))})},Dg.insert=function(a,b){return a=N(a),b=D(b),this.select(function(){return this.insertBefore(a.apply(this,arguments),b.apply(this,arguments)||null)})},Dg.remove=function(){return this.each(O)},Dg.data=function(a,b){function c(a,c){var d,e,f,g=a.length,l=c.length,m=Math.min(g,l),n=new Array(l),o=new Array(l),p=new Array(g);if(b){var q,r=new k,s=new Array(g);for(d=-1;++d<g;)(e=a[d])&&(r.has(q=b.call(e,e.__data__,d))?p[d]=e:r.set(q,e),s[d]=q);for(d=-1;++d<l;)(e=r.get(q=b.call(c,f=c[d],d)))?e!==!0&&(n[d]=e,e.__data__=f):o[d]=P(f),r.set(q,!0);for(d=-1;++d<g;)d in s&&r.get(s[d])!==!0&&(p[d]=a[d])}else{for(d=-1;++d<m;)e=a[d],f=c[d],e?(e.__data__=f,n[d]=e):o[d]=P(f);for(;l>d;++d)o[d]=P(c[d]);for(;g>d;++d)p[d]=a[d]}o.update=n,o.parentNode=n.parentNode=p.parentNode=a.parentNode,h.push(o),i.push(n),j.push(p)}var d,e,f=-1,g=this.length;if(!arguments.length){for(a=new Array(g=(d=this[0]).length);++f<g;)(e=d[f])&&(a[f]=e.__data__);return a}var h=T([]),i=C([]),j=C([]);if("function"==typeof a)for(;++f<g;)c(d=this[f],a.call(d,d.parentNode.__data__,f));else for(;++f<g;)c(d=this[f],a);return i.enter=function(){return h},i.exit=function(){return j},i},Dg.datum=function(a){return arguments.length?this.property("__data__",a):this.property("__data__")},Dg.filter=function(a){var b,c,d,e=[];"function"!=typeof a&&(a=Q(a));for(var f=0,g=this.length;g>f;f++){e.push(b=[]),b.parentNode=(c=this[f]).parentNode;for(var h=0,i=c.length;i>h;h++)(d=c[h])&&a.call(d,d.__data__,h,f)&&b.push(d)}return C(e)},Dg.order=function(){for(var a=-1,b=this.length;++a<b;)for(var c,d=this[a],e=d.length-1,f=d[e];--e>=0;)(c=d[e])&&(f&&f!==c.nextSibling&&f.parentNode.insertBefore(c,f),f=c);return this},Dg.sort=function(a){a=R.apply(this,arguments);for(var b=-1,c=this.length;++b<c;)this[b].sort(a);return this.order()},Dg.each=function(a){return S(this,function(b,c,d){a.call(b,b.__data__,c,d)})},Dg.call=function(a){var b=kg(arguments);return a.apply(b[0]=this,b),this},Dg.empty=function(){return!this.node()},Dg.node=function(){for(var a=0,b=this.length;b>a;a++)for(var c=this[a],d=0,e=c.length;e>d;d++){
var f=c[d];if(f)return f}return null},Dg.size=function(){var a=0;return S(this,function(){++a}),a};var Fg=[];ig.selection.enter=T,ig.selection.enter.prototype=Fg,Fg.append=Dg.append,Fg.empty=Dg.empty,Fg.node=Dg.node,Fg.call=Dg.call,Fg.size=Dg.size,Fg.select=function(a){for(var b,c,d,e,f,g=[],h=-1,i=this.length;++h<i;){d=(e=this[h]).update,g.push(b=[]),b.parentNode=e.parentNode;for(var j=-1,k=e.length;++j<k;)(f=e[j])?(b.push(d[j]=c=a.call(e.parentNode,f.__data__,j,h)),c.__data__=f.__data__):b.push(null)}return C(g)},Fg.insert=function(a,b){return arguments.length<2&&(b=U(this)),Dg.insert.call(this,a,b)},ig.select=function(b){var c;return"string"==typeof b?(c=[Ag(b,lg)],c.parentNode=lg.documentElement):(c=[b],c.parentNode=a(b)),C([c])},ig.selectAll=function(a){var b;return"string"==typeof a?(b=kg(Bg(a,lg)),b.parentNode=lg.documentElement):(b=kg(a),b.parentNode=null),C([b])},Dg.on=function(a,b,c){var d=arguments.length;if(3>d){if("string"!=typeof a){2>d&&(b=!1);for(c in a)this.each(V(c,a[c],b));return this}if(2>d)return(d=this.node()["__on"+a])&&d._;c=!1}return this.each(V(a,b,c))};var Gg=ig.map({mouseenter:"mouseover",mouseleave:"mouseout"});lg&&Gg.forEach(function(a){"on"+a in lg&&Gg.remove(a)});var Hg,Ig=0;ig.mouse=function(a){return Z(a,A())};var Jg=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;ig.touch=function(a,b,c){if(arguments.length<3&&(c=b,b=A().changedTouches),b)for(var d,e=0,f=b.length;f>e;++e)if((d=b[e]).identifier===c)return Z(a,d)},ig.behavior.drag=function(){function a(){this.on("mousedown.drag",f).on("touchstart.drag",g)}function b(a,b,c,f,g){return function(){function h(){var a,c,d=b(m,p);d&&(a=d[0]-t[0],c=d[1]-t[1],o|=a|c,t=d,n({type:"drag",x:d[0]+j[0],y:d[1]+j[1],dx:a,dy:c}))}function i(){b(m,p)&&(r.on(f+q,null).on(g+q,null),s(o&&ig.event.target===l),n({type:"dragend"}))}var j,k=this,l=ig.event.target,m=k.parentNode,n=d.of(k,arguments),o=0,p=a(),q=".drag"+(null==p?"":"-"+p),r=ig.select(c(l)).on(f+q,h).on(g+q,i),s=Y(l),t=b(m,p);e?(j=e.apply(k,arguments),j=[j.x-t[0],j.y-t[1]]):j=[0,0],n({type:"dragstart"})}}var d=B(a,"drag","dragstart","dragend"),e=null,f=b(w,ig.mouse,c,"mousemove","mouseup"),g=b($,ig.touch,t,"touchmove","touchend");return a.origin=function(b){return arguments.length?(e=b,a):e},ig.rebind(a,d,"on")},ig.touches=function(a,b){return arguments.length<2&&(b=A().touches),b?kg(b).map(function(b){var c=Z(a,b);return c.identifier=b.identifier,c}):[]};var Kg=1e-6,Lg=Kg*Kg,Mg=Math.PI,Ng=2*Mg,Og=Ng-Kg,Pg=Mg/2,Qg=Mg/180,Rg=180/Mg,Sg=Math.SQRT2,Tg=2,Ug=4;ig.interpolateZoom=function(a,b){var c,d,e=a[0],f=a[1],g=a[2],h=b[0],i=b[1],j=b[2],k=h-e,l=i-f,m=k*k+l*l;if(Lg>m)d=Math.log(j/g)/Sg,c=function(a){return[e+a*k,f+a*l,g*Math.exp(Sg*a*d)]};else{var n=Math.sqrt(m),o=(j*j-g*g+Ug*m)/(2*g*Tg*n),p=(j*j-g*g-Ug*m)/(2*j*Tg*n),q=Math.log(Math.sqrt(o*o+1)-o),r=Math.log(Math.sqrt(p*p+1)-p);d=(r-q)/Sg,c=function(a){var b=a*d,c=ea(q),h=g/(Tg*n)*(c*fa(Sg*b+q)-da(q));return[e+h*k,f+h*l,g*c/ea(Sg*b+q)]}}return c.duration=1e3*d,c},ig.behavior.zoom=function(){function a(a){a.on(F,l).on(Wg+".zoom",n).on("dblclick.zoom",o).on(I,m)}function b(a){return[(a[0]-y.x)/y.k,(a[1]-y.y)/y.k]}function d(a){return[a[0]*y.k+y.x,a[1]*y.k+y.y]}function e(a){y.k=Math.max(C[0],Math.min(C[1],a))}function f(a,b){b=d(b),y.x+=a[0]-b[0],y.y+=a[1]-b[1]}function g(b,c,d,g){b.__chart__={x:y.x,y:y.y,k:y.k},e(Math.pow(2,g)),f(q=c,d),b=ig.select(b),D>0&&(b=b.transition().duration(D)),b.call(a.event)}function h(){v&&v.domain(u.range().map(function(a){return(a-y.x)/y.k}).map(u.invert)),x&&x.domain(w.range().map(function(a){return(a-y.y)/y.k}).map(w.invert))}function i(a){E++||a({type:"zoomstart"})}function j(a){h(),a({type:"zoom",scale:y.k,translate:[y.x,y.y]})}function k(a){--E||(a({type:"zoomend"}),q=null)}function l(){function a(){l=1,f(ig.mouse(e),n),j(h)}function d(){m.on(G,null).on(H,null),o(l&&ig.event.target===g),k(h)}var e=this,g=ig.event.target,h=J.of(e,arguments),l=0,m=ig.select(c(e)).on(G,a).on(H,d),n=b(ig.mouse(e)),o=Y(e);Pi.call(e),i(h)}function m(){function a(){var a=ig.touches(o);return n=y.k,a.forEach(function(a){a.identifier in q&&(q[a.identifier]=b(a))}),a}function c(){var b=ig.event.target;ig.select(b).on(u,d).on(v,h),w.push(b);for(var c=ig.event.changedTouches,e=0,f=c.length;f>e;++e)q[c[e].identifier]=null;var i=a(),j=Date.now();if(1===i.length){if(500>j-t){var k=i[0];g(o,k,q[k.identifier],Math.floor(Math.log(y.k)/Math.LN2)+1),z()}t=j}else if(i.length>1){var k=i[0],l=i[1],m=k[0]-l[0],n=k[1]-l[1];r=m*m+n*n}}function d(){var a,b,c,d,g=ig.touches(o);Pi.call(o);for(var h=0,i=g.length;i>h;++h,d=null)if(c=g[h],d=q[c.identifier]){if(b)break;a=c,b=d}if(d){var k=(k=c[0]-a[0])*k+(k=c[1]-a[1])*k,l=r&&Math.sqrt(k/r);a=[(a[0]+c[0])/2,(a[1]+c[1])/2],b=[(b[0]+d[0])/2,(b[1]+d[1])/2],e(l*n)}t=null,f(a,b),j(p)}function h(){if(ig.event.touches.length){for(var b=ig.event.changedTouches,c=0,d=b.length;d>c;++c)delete q[b[c].identifier];for(var e in q)return void a()}ig.selectAll(w).on(s,null),x.on(F,l).on(I,m),A(),k(p)}var n,o=this,p=J.of(o,arguments),q={},r=0,s=".zoom-"+ig.event.changedTouches[0].identifier,u="touchmove"+s,v="touchend"+s,w=[],x=ig.select(o),A=Y(o);c(),i(p),x.on(F,null).on(I,c)}function n(){var a=J.of(this,arguments);s?clearTimeout(s):(Pi.call(this),p=b(q=r||ig.mouse(this)),i(a)),s=setTimeout(function(){s=null,k(a)},50),z(),e(Math.pow(2,.002*Vg())*y.k),f(q,p),j(a)}function o(){var a=ig.mouse(this),c=Math.log(y.k)/Math.LN2;g(this,a,b(a),ig.event.shiftKey?Math.ceil(c)-1:Math.floor(c)+1)}var p,q,r,s,t,u,v,w,x,y={x:0,y:0,k:1},A=[960,500],C=Xg,D=250,E=0,F="mousedown.zoom",G="mousemove.zoom",H="mouseup.zoom",I="touchstart.zoom",J=B(a,"zoomstart","zoom","zoomend");return Wg||(Wg="onwheel"in lg?(Vg=function(){return-ig.event.deltaY*(ig.event.deltaMode?120:1)},"wheel"):"onmousewheel"in lg?(Vg=function(){return ig.event.wheelDelta},"mousewheel"):(Vg=function(){return-ig.event.detail},"MozMousePixelScroll")),a.event=function(a){a.each(function(){var a=J.of(this,arguments),b=y;Ni?ig.select(this).transition().each("start.zoom",function(){y=this.__chart__||{x:0,y:0,k:1},i(a)}).tween("zoom:zoom",function(){var c=A[0],d=A[1],e=q?q[0]:c/2,f=q?q[1]:d/2,g=ig.interpolateZoom([(e-y.x)/y.k,(f-y.y)/y.k,c/y.k],[(e-b.x)/b.k,(f-b.y)/b.k,c/b.k]);return function(b){var d=g(b),h=c/d[2];this.__chart__=y={x:e-d[0]*h,y:f-d[1]*h,k:h},j(a)}}).each("interrupt.zoom",function(){k(a)}).each("end.zoom",function(){k(a)}):(this.__chart__=y,i(a),j(a),k(a))})},a.translate=function(b){return arguments.length?(y={x:+b[0],y:+b[1],k:y.k},h(),a):[y.x,y.y]},a.scale=function(b){return arguments.length?(y={x:y.x,y:y.y,k:null},e(+b),h(),a):y.k},a.scaleExtent=function(b){return arguments.length?(C=null==b?Xg:[+b[0],+b[1]],a):C},a.center=function(b){return arguments.length?(r=b&&[+b[0],+b[1]],a):r},a.size=function(b){return arguments.length?(A=b&&[+b[0],+b[1]],a):A},a.duration=function(b){return arguments.length?(D=+b,a):D},a.x=function(b){return arguments.length?(v=b,u=b.copy(),y={x:0,y:0,k:1},a):v},a.y=function(b){return arguments.length?(x=b,w=b.copy(),y={x:0,y:0,k:1},a):x},ig.rebind(a,J,"on")};var Vg,Wg,Xg=[0,1/0];ig.color=ha,ha.prototype.toString=function(){return this.rgb()+""},ig.hsl=ia;var Yg=ia.prototype=new ha;Yg.brighter=function(a){return a=Math.pow(.7,arguments.length?a:1),new ia(this.h,this.s,this.l/a)},Yg.darker=function(a){return a=Math.pow(.7,arguments.length?a:1),new ia(this.h,this.s,a*this.l)},Yg.rgb=function(){return ja(this.h,this.s,this.l)},ig.hcl=ka;var Zg=ka.prototype=new ha;Zg.brighter=function(a){return new ka(this.h,this.c,Math.min(100,this.l+$g*(arguments.length?a:1)))},Zg.darker=function(a){return new ka(this.h,this.c,Math.max(0,this.l-$g*(arguments.length?a:1)))},Zg.rgb=function(){return la(this.h,this.c,this.l).rgb()},ig.lab=ma;var $g=18,_g=.95047,ah=1,bh=1.08883,ch=ma.prototype=new ha;ch.brighter=function(a){return new ma(Math.min(100,this.l+$g*(arguments.length?a:1)),this.a,this.b)},ch.darker=function(a){return new ma(Math.max(0,this.l-$g*(arguments.length?a:1)),this.a,this.b)},ch.rgb=function(){return na(this.l,this.a,this.b)},ig.rgb=sa;var dh=sa.prototype=new ha;dh.brighter=function(a){a=Math.pow(.7,arguments.length?a:1);var b=this.r,c=this.g,d=this.b,e=30;return b||c||d?(b&&e>b&&(b=e),c&&e>c&&(c=e),d&&e>d&&(d=e),new sa(Math.min(255,b/a),Math.min(255,c/a),Math.min(255,d/a))):new sa(e,e,e)},dh.darker=function(a){return a=Math.pow(.7,arguments.length?a:1),new sa(a*this.r,a*this.g,a*this.b)},dh.hsl=function(){return xa(this.r,this.g,this.b)},dh.toString=function(){return"#"+va(this.r)+va(this.g)+va(this.b)};var eh=ig.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});eh.forEach(function(a,b){eh.set(a,ta(b))}),ig.functor=Ba,ig.xhr=Ca(t),ig.dsv=function(a,b){function c(a,c,f){arguments.length<3&&(f=c,c=null);var g=Da(a,b,null==c?d:e(c),f);return g.row=function(a){return arguments.length?g.response(null==(c=a)?d:e(a)):c},g}function d(a){return c.parse(a.responseText)}function e(a){return function(b){return c.parse(b.responseText,a)}}function f(b){return b.map(g).join(a)}function g(a){return h.test(a)?'"'+a.replace(/\"/g,'""')+'"':a}var h=new RegExp('["'+a+"\n]"),i=a.charCodeAt(0);return c.parse=function(a,b){var d;return c.parseRows(a,function(a,c){if(d)return d(a,c-1);var e=new Function("d","return {"+a.map(function(a,b){return JSON.stringify(a)+": d["+b+"]"}).join(",")+"}");d=b?function(a,c){return b(e(a),c)}:e})},c.parseRows=function(a,b){function c(){if(k>=j)return g;if(e)return e=!1,f;var b=k;if(34===a.charCodeAt(b)){for(var c=b;c++<j;)if(34===a.charCodeAt(c)){if(34!==a.charCodeAt(c+1))break;++c}k=c+2;var d=a.charCodeAt(c+1);return 13===d?(e=!0,10===a.charCodeAt(c+2)&&++k):10===d&&(e=!0),a.slice(b+1,c).replace(/""/g,'"')}for(;j>k;){var d=a.charCodeAt(k++),h=1;if(10===d)e=!0;else if(13===d)e=!0,10===a.charCodeAt(k)&&(++k,++h);else if(d!==i)continue;return a.slice(b,k-h)}return a.slice(b)}for(var d,e,f={},g={},h=[],j=a.length,k=0,l=0;(d=c())!==g;){for(var m=[];d!==f&&d!==g;)m.push(d),d=c();b&&null==(m=b(m,l++))||h.push(m)}return h},c.format=function(b){if(Array.isArray(b[0]))return c.formatRows(b);var d=new s,e=[];return b.forEach(function(a){for(var b in a)d.has(b)||e.push(d.add(b))}),[e.map(g).join(a)].concat(b.map(function(b){return e.map(function(a){return g(b[a])}).join(a)})).join("\n")},c.formatRows=function(a){return a.map(f).join("\n")},c},ig.csv=ig.dsv(",","text/csv"),ig.tsv=ig.dsv("	","text/tab-separated-values");var fh,gh,hh,ih,jh=this[v(this,"requestAnimationFrame")]||function(a){setTimeout(a,17)};ig.timer=function(){Ga.apply(this,arguments)},ig.timer.flush=function(){Ia(),Ja()},ig.round=function(a,b){return b?Math.round(a*(b=Math.pow(10,b)))/b:Math.round(a)};var kh=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(La);ig.formatPrefix=function(a,b){var c=0;return(a=+a)&&(0>a&&(a*=-1),b&&(a=ig.round(a,Ka(a,b))),c=1+Math.floor(1e-12+Math.log(a)/Math.LN10),c=Math.max(-24,Math.min(24,3*Math.floor((c-1)/3)))),kh[8+c/3]};var lh=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,mh=ig.map({b:function(a){return a.toString(2)},c:function(a){return String.fromCharCode(a)},o:function(a){return a.toString(8)},x:function(a){return a.toString(16)},X:function(a){return a.toString(16).toUpperCase()},g:function(a,b){return a.toPrecision(b)},e:function(a,b){return a.toExponential(b)},f:function(a,b){return a.toFixed(b)},r:function(a,b){return(a=ig.round(a,Ka(a,b))).toFixed(Math.max(0,Math.min(20,Ka(a*(1+1e-15),b))))}}),nh=ig.time={},oh=Date;Oa.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){ph.setUTCDate.apply(this._,arguments)},setDay:function(){ph.setUTCDay.apply(this._,arguments)},setFullYear:function(){ph.setUTCFullYear.apply(this._,arguments)},setHours:function(){ph.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){ph.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){ph.setUTCMinutes.apply(this._,arguments)},setMonth:function(){ph.setUTCMonth.apply(this._,arguments)},setSeconds:function(){ph.setUTCSeconds.apply(this._,arguments)},setTime:function(){ph.setTime.apply(this._,arguments)}};var ph=Date.prototype;nh.year=Pa(function(a){return a=nh.day(a),a.setMonth(0,1),a},function(a,b){a.setFullYear(a.getFullYear()+b)},function(a){return a.getFullYear()}),nh.years=nh.year.range,nh.years.utc=nh.year.utc.range,nh.day=Pa(function(a){var b=new oh(2e3,0);return b.setFullYear(a.getFullYear(),a.getMonth(),a.getDate()),b},function(a,b){a.setDate(a.getDate()+b)},function(a){return a.getDate()-1}),nh.days=nh.day.range,nh.days.utc=nh.day.utc.range,nh.dayOfYear=function(a){var b=nh.year(a);return Math.floor((a-b-6e4*(a.getTimezoneOffset()-b.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(a,b){b=7-b;var c=nh[a]=Pa(function(a){return(a=nh.day(a)).setDate(a.getDate()-(a.getDay()+b)%7),a},function(a,b){a.setDate(a.getDate()+7*Math.floor(b))},function(a){var c=nh.year(a).getDay();return Math.floor((nh.dayOfYear(a)+(c+b)%7)/7)-(c!==b)});nh[a+"s"]=c.range,nh[a+"s"].utc=c.utc.range,nh[a+"OfYear"]=function(a){var c=nh.year(a).getDay();return Math.floor((nh.dayOfYear(a)+(c+b)%7)/7)}}),nh.week=nh.sunday,nh.weeks=nh.sunday.range,nh.weeks.utc=nh.sunday.utc.range,nh.weekOfYear=nh.sundayOfYear;var qh={"-":"",_:" ",0:"0"},rh=/^\s*\d+/,sh=/^%/;ig.locale=function(a){return{numberFormat:Ma(a),timeFormat:Ra(a)}};var th=ig.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});ig.format=th.numberFormat,ig.geo={},kb.prototype={s:0,t:0,add:function(a){lb(a,this.t,uh),lb(uh.s,this.s,this),this.s?this.t+=uh.t:this.s=uh.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var uh=new kb;ig.geo.stream=function(a,b){a&&vh.hasOwnProperty(a.type)?vh[a.type](a,b):mb(a,b)};var vh={Feature:function(a,b){mb(a.geometry,b)},FeatureCollection:function(a,b){for(var c=a.features,d=-1,e=c.length;++d<e;)mb(c[d].geometry,b)}},wh={Sphere:function(a,b){b.sphere()},Point:function(a,b){a=a.coordinates,b.point(a[0],a[1],a[2])},MultiPoint:function(a,b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)a=c[d],b.point(a[0],a[1],a[2])},LineString:function(a,b){nb(a.coordinates,b,0)},MultiLineString:function(a,b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)nb(c[d],b,0)},Polygon:function(a,b){ob(a.coordinates,b)},MultiPolygon:function(a,b){for(var c=a.coordinates,d=-1,e=c.length;++d<e;)ob(c[d],b)},GeometryCollection:function(a,b){for(var c=a.geometries,d=-1,e=c.length;++d<e;)mb(c[d],b)}};ig.geo.area=function(a){return xh=0,ig.geo.stream(a,zh),xh};var xh,yh=new kb,zh={sphere:function(){xh+=4*Mg},point:w,lineStart:w,lineEnd:w,polygonStart:function(){yh.reset(),zh.lineStart=pb},polygonEnd:function(){var a=2*yh;xh+=0>a?4*Mg+a:a,zh.lineStart=zh.lineEnd=zh.point=w}};ig.geo.bounds=function(){function a(a,b){t.push(u=[k=a,m=a]),l>b&&(l=b),b>n&&(n=b)}function b(b,c){var d=qb([b*Qg,c*Qg]);if(r){var e=sb(r,d),f=[e[1],-e[0],0],g=sb(f,e);vb(g),g=wb(g);var i=b-o,j=i>0?1:-1,p=g[0]*Rg*j,q=ug(i)>180;if(q^(p>j*o&&j*b>p)){var s=g[1]*Rg;s>n&&(n=s)}else if(p=(p+360)%360-180,q^(p>j*o&&j*b>p)){var s=-g[1]*Rg;l>s&&(l=s)}else l>c&&(l=c),c>n&&(n=c);q?o>b?h(k,b)>h(k,m)&&(m=b):h(b,m)>h(k,m)&&(k=b):m>=k?(k>b&&(k=b),b>m&&(m=b)):b>o?h(k,b)>h(k,m)&&(m=b):h(b,m)>h(k,m)&&(k=b)}else a(b,c);r=d,o=b}function c(){v.point=b}function d(){u[0]=k,u[1]=m,v.point=a,r=null}function e(a,c){if(r){var d=a-o;s+=ug(d)>180?d+(d>0?360:-360):d}else p=a,q=c;zh.point(a,c),b(a,c)}function f(){zh.lineStart()}function g(){e(p,q),zh.lineEnd(),ug(s)>Kg&&(k=-(m=180)),u[0]=k,u[1]=m,r=null}function h(a,b){return(b-=a)<0?b+360:b}function i(a,b){return a[0]-b[0]}function j(a,b){return b[0]<=b[1]?b[0]<=a&&a<=b[1]:a<b[0]||b[1]<a}var k,l,m,n,o,p,q,r,s,t,u,v={point:a,lineStart:c,lineEnd:d,polygonStart:function(){v.point=e,v.lineStart=f,v.lineEnd=g,s=0,zh.polygonStart()},polygonEnd:function(){zh.polygonEnd(),v.point=a,v.lineStart=c,v.lineEnd=d,0>yh?(k=-(m=180),l=-(n=90)):s>Kg?n=90:-Kg>s&&(l=-90),u[0]=k,u[1]=m}};return function(a){n=m=-(k=l=1/0),t=[],ig.geo.stream(a,v);var b=t.length;if(b){t.sort(i);for(var c,d=1,e=t[0],f=[e];b>d;++d)c=t[d],j(c[0],e)||j(c[1],e)?(h(e[0],c[1])>h(e[0],e[1])&&(e[1]=c[1]),h(c[0],e[1])>h(e[0],e[1])&&(e[0]=c[0])):f.push(e=c);for(var g,c,o=-(1/0),b=f.length-1,d=0,e=f[b];b>=d;e=c,++d)c=f[d],(g=h(e[1],c[0]))>o&&(o=g,k=c[0],m=e[1])}return t=u=null,k===1/0||l===1/0?[[NaN,NaN],[NaN,NaN]]:[[k,l],[m,n]]}}(),ig.geo.centroid=function(a){Ah=Bh=Ch=Dh=Eh=Fh=Gh=Hh=Ih=Jh=Kh=0,ig.geo.stream(a,Lh);var b=Ih,c=Jh,d=Kh,e=b*b+c*c+d*d;return Lg>e&&(b=Fh,c=Gh,d=Hh,Kg>Bh&&(b=Ch,c=Dh,d=Eh),e=b*b+c*c+d*d,Lg>e)?[NaN,NaN]:[Math.atan2(c,b)*Rg,ca(d/Math.sqrt(e))*Rg]};var Ah,Bh,Ch,Dh,Eh,Fh,Gh,Hh,Ih,Jh,Kh,Lh={sphere:w,point:yb,lineStart:Ab,lineEnd:Bb,polygonStart:function(){Lh.lineStart=Cb},polygonEnd:function(){Lh.lineStart=Ab}},Mh=Ib(Eb,Mb,Ob,[-Mg,-Mg/2]),Nh=1e9;ig.geo.clipExtent=function(){var a,b,c,d,e,f,g={stream:function(a){return e&&(e.valid=!1),e=f(a),e.valid=!0,e},extent:function(h){return arguments.length?(f=Sb(a=+h[0][0],b=+h[0][1],c=+h[1][0],d=+h[1][1]),e&&(e.valid=!1,e=null),g):[[a,b],[c,d]]}};return g.extent([[0,0],[960,500]])},(ig.geo.conicEqualArea=function(){return Tb(Ub)}).raw=Ub,ig.geo.albers=function(){return ig.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},ig.geo.albersUsa=function(){function a(a){var f=a[0],g=a[1];return b=null,c(f,g),b||(d(f,g),b)||e(f,g),b}var b,c,d,e,f=ig.geo.albers(),g=ig.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),h=ig.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),i={point:function(a,c){b=[a,c]}};return a.invert=function(a){var b=f.scale(),c=f.translate(),d=(a[0]-c[0])/b,e=(a[1]-c[1])/b;return(e>=.12&&.234>e&&d>=-.425&&-.214>d?g:e>=.166&&.234>e&&d>=-.214&&-.115>d?h:f).invert(a)},a.stream=function(a){var b=f.stream(a),c=g.stream(a),d=h.stream(a);return{point:function(a,e){b.point(a,e),c.point(a,e),d.point(a,e)},sphere:function(){b.sphere(),c.sphere(),d.sphere()},lineStart:function(){b.lineStart(),c.lineStart(),d.lineStart()},lineEnd:function(){b.lineEnd(),c.lineEnd(),d.lineEnd()},polygonStart:function(){b.polygonStart(),c.polygonStart(),d.polygonStart()},polygonEnd:function(){b.polygonEnd(),c.polygonEnd(),d.polygonEnd()}}},a.precision=function(b){return arguments.length?(f.precision(b),g.precision(b),h.precision(b),a):f.precision()},a.scale=function(b){return arguments.length?(f.scale(b),g.scale(.35*b),h.scale(b),a.translate(f.translate())):f.scale()},a.translate=function(b){if(!arguments.length)return f.translate();var j=f.scale(),k=+b[0],l=+b[1];return c=f.translate(b).clipExtent([[k-.455*j,l-.238*j],[k+.455*j,l+.238*j]]).stream(i).point,d=g.translate([k-.307*j,l+.201*j]).clipExtent([[k-.425*j+Kg,l+.12*j+Kg],[k-.214*j-Kg,l+.234*j-Kg]]).stream(i).point,e=h.translate([k-.205*j,l+.212*j]).clipExtent([[k-.214*j+Kg,l+.166*j+Kg],[k-.115*j-Kg,l+.234*j-Kg]]).stream(i).point,a},a.scale(1070)};var Oh,Ph,Qh,Rh,Sh,Th,Uh={point:w,lineStart:w,lineEnd:w,polygonStart:function(){Ph=0,Uh.lineStart=Vb},polygonEnd:function(){Uh.lineStart=Uh.lineEnd=Uh.point=w,Oh+=ug(Ph/2)}},Vh={point:Wb,lineStart:w,lineEnd:w,polygonStart:w,polygonEnd:w},Wh={point:Zb,lineStart:$b,lineEnd:_b,polygonStart:function(){Wh.lineStart=ac},polygonEnd:function(){Wh.point=Zb,Wh.lineStart=$b,Wh.lineEnd=_b}};ig.geo.path=function(){function a(a){return a&&("function"==typeof h&&f.pointRadius(+h.apply(this,arguments)),g&&g.valid||(g=e(f)),ig.geo.stream(a,g)),f.result()}function b(){return g=null,a}var c,d,e,f,g,h=4.5;return a.area=function(a){return Oh=0,ig.geo.stream(a,e(Uh)),Oh},a.centroid=function(a){return Ch=Dh=Eh=Fh=Gh=Hh=Ih=Jh=Kh=0,ig.geo.stream(a,e(Wh)),Kh?[Ih/Kh,Jh/Kh]:Hh?[Fh/Hh,Gh/Hh]:Eh?[Ch/Eh,Dh/Eh]:[NaN,NaN]},a.bounds=function(a){return Sh=Th=-(Qh=Rh=1/0),ig.geo.stream(a,e(Vh)),[[Qh,Rh],[Sh,Th]]},a.projection=function(a){return arguments.length?(e=(c=a)?a.stream||dc(a):t,b()):c},a.context=function(a){return arguments.length?(f=null==(d=a)?new Xb:new bc(a),"function"!=typeof h&&f.pointRadius(h),b()):d},a.pointRadius=function(b){return arguments.length?(h="function"==typeof b?b:(f.pointRadius(+b),+b),a):h},a.projection(ig.geo.albersUsa()).context(null)},ig.geo.transform=function(a){return{stream:function(b){var c=new ec(b);for(var d in a)c[d]=a[d];return c}}},ec.prototype={point:function(a,b){this.stream.point(a,b)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},ig.geo.projection=gc,ig.geo.projectionMutator=hc,(ig.geo.equirectangular=function(){return gc(jc)}).raw=jc.invert=jc,ig.geo.rotation=function(a){function b(b){return b=a(b[0]*Qg,b[1]*Qg),b[0]*=Rg,b[1]*=Rg,b}return a=lc(a[0]%360*Qg,a[1]*Qg,a.length>2?a[2]*Qg:0),b.invert=function(b){return b=a.invert(b[0]*Qg,b[1]*Qg),b[0]*=Rg,b[1]*=Rg,b},b},kc.invert=jc,ig.geo.circle=function(){function a(){var a="function"==typeof d?d.apply(this,arguments):d,b=lc(-a[0]*Qg,-a[1]*Qg,0).invert,e=[];return c(null,null,1,{point:function(a,c){e.push(a=b(a,c)),a[0]*=Rg,a[1]*=Rg}}),{type:"Polygon",coordinates:[e]}}var b,c,d=[0,0],e=6;return a.origin=function(b){return arguments.length?(d=b,a):d},a.angle=function(d){return arguments.length?(c=pc((b=+d)*Qg,e*Qg),a):b},a.precision=function(d){return arguments.length?(c=pc(b*Qg,(e=+d)*Qg),a):e},a.angle(90)},ig.geo.distance=function(a,b){var c,d=(b[0]-a[0])*Qg,e=a[1]*Qg,f=b[1]*Qg,g=Math.sin(d),h=Math.cos(d),i=Math.sin(e),j=Math.cos(e),k=Math.sin(f),l=Math.cos(f);return Math.atan2(Math.sqrt((c=l*g)*c+(c=j*k-i*l*h)*c),i*k+j*l*h)},ig.geo.graticule=function(){function a(){return{type:"MultiLineString",coordinates:b()}}function b(){return ig.range(Math.ceil(f/q)*q,e,q).map(m).concat(ig.range(Math.ceil(j/r)*r,i,r).map(n)).concat(ig.range(Math.ceil(d/o)*o,c,o).filter(function(a){return ug(a%q)>Kg}).map(k)).concat(ig.range(Math.ceil(h/p)*p,g,p).filter(function(a){return ug(a%r)>Kg}).map(l))}var c,d,e,f,g,h,i,j,k,l,m,n,o=10,p=o,q=90,r=360,s=2.5;return a.lines=function(){return b().map(function(a){return{type:"LineString",coordinates:a}})},a.outline=function(){return{type:"Polygon",coordinates:[m(f).concat(n(i).slice(1),m(e).reverse().slice(1),n(j).reverse().slice(1))]}},a.extent=function(b){return arguments.length?a.majorExtent(b).minorExtent(b):a.minorExtent()},a.majorExtent=function(b){return arguments.length?(f=+b[0][0],e=+b[1][0],j=+b[0][1],i=+b[1][1],f>e&&(b=f,f=e,e=b),j>i&&(b=j,j=i,i=b),a.precision(s)):[[f,j],[e,i]]},a.minorExtent=function(b){return arguments.length?(d=+b[0][0],c=+b[1][0],h=+b[0][1],g=+b[1][1],d>c&&(b=d,d=c,c=b),h>g&&(b=h,h=g,g=b),a.precision(s)):[[d,h],[c,g]]},a.step=function(b){return arguments.length?a.majorStep(b).minorStep(b):a.minorStep()},a.majorStep=function(b){return arguments.length?(q=+b[0],r=+b[1],a):[q,r]},a.minorStep=function(b){return arguments.length?(o=+b[0],p=+b[1],a):[o,p]},a.precision=function(b){return arguments.length?(s=+b,k=rc(h,g,90),l=sc(d,c,s),m=rc(j,i,90),n=sc(f,e,s),a):s},a.majorExtent([[-180,-90+Kg],[180,90-Kg]]).minorExtent([[-180,-80-Kg],[180,80+Kg]])},ig.geo.greatArc=function(){function a(){return{type:"LineString",coordinates:[b||d.apply(this,arguments),c||e.apply(this,arguments)]}}var b,c,d=tc,e=uc;return a.distance=function(){return ig.geo.distance(b||d.apply(this,arguments),c||e.apply(this,arguments))},a.source=function(c){return arguments.length?(d=c,b="function"==typeof c?null:c,a):d},a.target=function(b){return arguments.length?(e=b,c="function"==typeof b?null:b,a):e},a.precision=function(){return arguments.length?a:0},a},ig.geo.interpolate=function(a,b){return vc(a[0]*Qg,a[1]*Qg,b[0]*Qg,b[1]*Qg)},ig.geo.length=function(a){return Xh=0,ig.geo.stream(a,Yh),Xh};var Xh,Yh={sphere:w,point:w,lineStart:wc,lineEnd:w,polygonStart:w,polygonEnd:w},Zh=xc(function(a){return Math.sqrt(2/(1+a))},function(a){return 2*Math.asin(a/2)});(ig.geo.azimuthalEqualArea=function(){return gc(Zh)}).raw=Zh;var $h=xc(function(a){var b=Math.acos(a);return b&&b/Math.sin(b)},t);(ig.geo.azimuthalEquidistant=function(){return gc($h)}).raw=$h,(ig.geo.conicConformal=function(){return Tb(yc)}).raw=yc,(ig.geo.conicEquidistant=function(){return Tb(zc)}).raw=zc;var _h=xc(function(a){return 1/a},Math.atan);(ig.geo.gnomonic=function(){return gc(_h)}).raw=_h,Ac.invert=function(a,b){return[a,2*Math.atan(Math.exp(b))-Pg]},(ig.geo.mercator=function(){return Bc(Ac)}).raw=Ac;var ai=xc(function(){return 1},Math.asin);(ig.geo.orthographic=function(){return gc(ai)}).raw=ai;var bi=xc(function(a){return 1/(1+a)},function(a){return 2*Math.atan(a)});(ig.geo.stereographic=function(){return gc(bi)}).raw=bi,Cc.invert=function(a,b){return[-b,2*Math.atan(Math.exp(a))-Pg]},(ig.geo.transverseMercator=function(){var a=Bc(Cc),b=a.center,c=a.rotate;return a.center=function(a){return a?b([-a[1],a[0]]):(a=b(),[a[1],-a[0]])},a.rotate=function(a){return a?c([a[0],a[1],a.length>2?a[2]+90:90]):(a=c(),[a[0],a[1],a[2]-90])},c([0,0,90])}).raw=Cc,ig.geom={},ig.geom.hull=function(a){function b(a){if(a.length<3)return[];var b,e=Ba(c),f=Ba(d),g=a.length,h=[],i=[];for(b=0;g>b;b++)h.push([+e.call(this,a[b],b),+f.call(this,a[b],b),b]);for(h.sort(Gc),b=0;g>b;b++)i.push([h[b][0],-h[b][1]]);var j=Fc(h),k=Fc(i),l=k[0]===j[0],m=k[k.length-1]===j[j.length-1],n=[];for(b=j.length-1;b>=0;--b)n.push(a[h[j[b]][2]]);for(b=+l;b<k.length-m;++b)n.push(a[h[k[b]][2]]);return n}var c=Dc,d=Ec;return arguments.length?b(a):(b.x=function(a){return arguments.length?(c=a,b):c},b.y=function(a){return arguments.length?(d=a,b):d},b)},ig.geom.polygon=function(a){return zg(a,ci),a};var ci=ig.geom.polygon.prototype=[];ci.area=function(){for(var a,b=-1,c=this.length,d=this[c-1],e=0;++b<c;)a=d,d=this[b],e+=a[1]*d[0]-a[0]*d[1];return.5*e},ci.centroid=function(a){var b,c,d=-1,e=this.length,f=0,g=0,h=this[e-1];for(arguments.length||(a=-1/(6*this.area()));++d<e;)b=h,h=this[d],c=b[0]*h[1]-h[0]*b[1],f+=(b[0]+h[0])*c,g+=(b[1]+h[1])*c;return[f*a,g*a]},ci.clip=function(a){for(var b,c,d,e,f,g,h=Jc(a),i=-1,j=this.length-Jc(this),k=this[j-1];++i<j;){for(b=a.slice(),a.length=0,e=this[i],f=b[(d=b.length-h)-1],c=-1;++c<d;)g=b[c],Hc(g,k,e)?(Hc(f,k,e)||a.push(Ic(f,g,k,e)),a.push(g)):Hc(f,k,e)&&a.push(Ic(f,g,k,e)),f=g;h&&a.push(a[0]),k=e}return a};var di,ei,fi,gi,hi,ii=[],ji=[];Rc.prototype.prepare=function(){for(var a,b=this.edges,c=b.length;c--;)a=b[c].edge,a.b&&a.a||b.splice(c,1);return b.sort(Tc),b.length},bd.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},cd.prototype={insert:function(a,b){var c,d,e;if(a){if(b.P=a,b.N=a.N,a.N&&(a.N.P=b),a.N=b,a.R){for(a=a.R;a.L;)a=a.L;a.L=b}else a.R=b;c=a}else this._?(a=gd(this._),b.P=null,b.N=a,a.P=a.L=b,c=a):(b.P=b.N=null,this._=b,c=null);for(b.L=b.R=null,b.U=c,b.C=!0,a=b;c&&c.C;)d=c.U,c===d.L?(e=d.R,e&&e.C?(c.C=e.C=!1,d.C=!0,a=d):(a===c.R&&(ed(this,c),a=c,c=a.U),c.C=!1,d.C=!0,fd(this,d))):(e=d.L,e&&e.C?(c.C=e.C=!1,d.C=!0,a=d):(a===c.L&&(fd(this,c),a=c,c=a.U),c.C=!1,d.C=!0,ed(this,d))),c=a.U;this._.C=!1},remove:function(a){a.N&&(a.N.P=a.P),a.P&&(a.P.N=a.N),a.N=a.P=null;var b,c,d,e=a.U,f=a.L,g=a.R;if(c=f?g?gd(g):f:g,e?e.L===a?e.L=c:e.R=c:this._=c,f&&g?(d=c.C,c.C=a.C,c.L=f,f.U=c,c!==g?(e=c.U,c.U=a.U,a=c.R,e.L=a,c.R=g,g.U=c):(c.U=e,e=c,a=c.R)):(d=a.C,a=c),a&&(a.U=e),!d){if(a&&a.C)return void(a.C=!1);do{if(a===this._)break;if(a===e.L){if(b=e.R,b.C&&(b.C=!1,e.C=!0,ed(this,e),b=e.R),b.L&&b.L.C||b.R&&b.R.C){b.R&&b.R.C||(b.L.C=!1,b.C=!0,fd(this,b),b=e.R),b.C=e.C,e.C=b.R.C=!1,ed(this,e),a=this._;break}}else if(b=e.L,b.C&&(b.C=!1,e.C=!0,fd(this,e),b=e.L),b.L&&b.L.C||b.R&&b.R.C){b.L&&b.L.C||(b.R.C=!1,b.C=!0,ed(this,b),b=e.L),b.C=e.C,e.C=b.L.C=!1,fd(this,e),a=this._;break}b.C=!0,a=e,e=e.U}while(!a.C);a&&(a.C=!1)}}},ig.geom.voronoi=function(a){function b(a){var b=new Array(a.length),d=h[0][0],e=h[0][1],f=h[1][0],g=h[1][1];return hd(c(a),h).cells.forEach(function(c,h){var i=c.edges,j=c.site,k=b[h]=i.length?i.map(function(a){var b=a.start();return[b.x,b.y]}):j.x>=d&&j.x<=f&&j.y>=e&&j.y<=g?[[d,g],[f,g],[f,e],[d,e]]:[];k.point=a[h]}),b}function c(a){return a.map(function(a,b){return{x:Math.round(f(a,b)/Kg)*Kg,y:Math.round(g(a,b)/Kg)*Kg,i:b}})}var d=Dc,e=Ec,f=d,g=e,h=ki;return a?b(a):(b.links=function(a){return hd(c(a)).edges.filter(function(a){return a.l&&a.r}).map(function(b){return{source:a[b.l.i],target:a[b.r.i]}})},b.triangles=function(a){var b=[];
return hd(c(a)).cells.forEach(function(c,d){for(var e,f,g=c.site,h=c.edges.sort(Tc),i=-1,j=h.length,k=h[j-1].edge,l=k.l===g?k.r:k.l;++i<j;)e=k,f=l,k=h[i].edge,l=k.l===g?k.r:k.l,d<f.i&&d<l.i&&jd(g,f,l)<0&&b.push([a[d],a[f.i],a[l.i]])}),b},b.x=function(a){return arguments.length?(f=Ba(d=a),b):d},b.y=function(a){return arguments.length?(g=Ba(e=a),b):e},b.clipExtent=function(a){return arguments.length?(h=null==a?ki:a,b):h===ki?null:h},b.size=function(a){return arguments.length?b.clipExtent(a&&[[0,0],a]):h===ki?null:h&&h[1]},b)};var ki=[[-1e6,-1e6],[1e6,1e6]];ig.geom.delaunay=function(a){return ig.geom.voronoi().triangles(a)},ig.geom.quadtree=function(a,b,c,d,e){function f(a){function f(a,b,c,d,e,f,g,h){if(!isNaN(c)&&!isNaN(d))if(a.leaf){var i=a.x,k=a.y;if(null!=i)if(ug(i-c)+ug(k-d)<.01)j(a,b,c,d,e,f,g,h);else{var l=a.point;a.x=a.y=a.point=null,j(a,l,i,k,e,f,g,h),j(a,b,c,d,e,f,g,h)}else a.x=c,a.y=d,a.point=b}else j(a,b,c,d,e,f,g,h)}function j(a,b,c,d,e,g,h,i){var j=.5*(e+h),k=.5*(g+i),l=c>=j,m=d>=k,n=m<<1|l;a.leaf=!1,a=a.nodes[n]||(a.nodes[n]=md()),l?e=j:h=j,m?g=k:i=k,f(a,b,c,d,e,g,h,i)}var k,l,m,n,o,p,q,r,s,t=Ba(h),u=Ba(i);if(null!=b)p=b,q=c,r=d,s=e;else if(r=s=-(p=q=1/0),l=[],m=[],o=a.length,g)for(n=0;o>n;++n)k=a[n],k.x<p&&(p=k.x),k.y<q&&(q=k.y),k.x>r&&(r=k.x),k.y>s&&(s=k.y),l.push(k.x),m.push(k.y);else for(n=0;o>n;++n){var v=+t(k=a[n],n),w=+u(k,n);p>v&&(p=v),q>w&&(q=w),v>r&&(r=v),w>s&&(s=w),l.push(v),m.push(w)}var x=r-p,y=s-q;x>y?s=q+x:r=p+y;var z=md();if(z.add=function(a){f(z,a,+t(a,++n),+u(a,n),p,q,r,s)},z.visit=function(a){nd(a,z,p,q,r,s)},z.find=function(a){return od(z,a[0],a[1],p,q,r,s)},n=-1,null==b){for(;++n<o;)f(z,a[n],l[n],m[n],p,q,r,s);--n}else a.forEach(z.add);return l=m=a=k=null,z}var g,h=Dc,i=Ec;return(g=arguments.length)?(h=kd,i=ld,3===g&&(e=c,d=b,c=b=0),f(a)):(f.x=function(a){return arguments.length?(h=a,f):h},f.y=function(a){return arguments.length?(i=a,f):i},f.extent=function(a){return arguments.length?(null==a?b=c=d=e=null:(b=+a[0][0],c=+a[0][1],d=+a[1][0],e=+a[1][1]),f):null==b?null:[[b,c],[d,e]]},f.size=function(a){return arguments.length?(null==a?b=c=d=e=null:(b=c=0,d=+a[0],e=+a[1]),f):null==b?null:[d-b,e-c]},f)},ig.interpolateRgb=pd,ig.interpolateObject=qd,ig.interpolateNumber=rd,ig.interpolateString=sd;var li=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,mi=new RegExp(li.source,"g");ig.interpolate=td,ig.interpolators=[function(a,b){var c=typeof b;return("string"===c?eh.has(b.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(b)?pd:sd:b instanceof ha?pd:Array.isArray(b)?ud:"object"===c&&isNaN(b)?qd:rd)(a,b)}],ig.interpolateArray=ud;var ni=function(){return t},oi=ig.map({linear:ni,poly:Bd,quad:function(){return yd},cubic:function(){return zd},sin:function(){return Cd},exp:function(){return Dd},circle:function(){return Ed},elastic:Fd,back:Gd,bounce:function(){return Hd}}),pi=ig.map({"in":t,out:wd,"in-out":xd,"out-in":function(a){return xd(wd(a))}});ig.ease=function(a){var b=a.indexOf("-"),c=b>=0?a.slice(0,b):a,d=b>=0?a.slice(b+1):"in";return c=oi.get(c)||ni,d=pi.get(d)||t,vd(d(c.apply(null,jg.call(arguments,1))))},ig.interpolateHcl=Id,ig.interpolateHsl=Jd,ig.interpolateLab=Kd,ig.interpolateRound=Ld,ig.transform=function(a){var b=lg.createElementNS(ig.ns.prefix.svg,"g");return(ig.transform=function(a){if(null!=a){b.setAttribute("transform",a);var c=b.transform.baseVal.consolidate()}return new Md(c?c.matrix:qi)})(a)},Md.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var qi={a:1,b:0,c:0,d:1,e:0,f:0};ig.interpolateTransform=Vd,ig.layout={},ig.layout.bundle=function(){return function(a){for(var b=[],c=-1,d=a.length;++c<d;)b.push(Yd(a[c]));return b}},ig.layout.chord=function(){function a(){var a,j,l,m,n,o={},p=[],q=ig.range(f),r=[];for(c=[],d=[],a=0,m=-1;++m<f;){for(j=0,n=-1;++n<f;)j+=e[m][n];p.push(j),r.push(ig.range(f)),a+=j}for(g&&q.sort(function(a,b){return g(p[a],p[b])}),h&&r.forEach(function(a,b){a.sort(function(a,c){return h(e[b][a],e[b][c])})}),a=(Ng-k*f)/a,j=0,m=-1;++m<f;){for(l=j,n=-1;++n<f;){var s=q[m],t=r[s][n],u=e[s][t],v=j,w=j+=u*a;o[s+"-"+t]={index:s,subindex:t,startAngle:v,endAngle:w,value:u}}d[s]={index:s,startAngle:l,endAngle:j,value:(j-l)/a},j+=k}for(m=-1;++m<f;)for(n=m-1;++n<f;){var x=o[m+"-"+n],y=o[n+"-"+m];(x.value||y.value)&&c.push(x.value<y.value?{source:y,target:x}:{source:x,target:y})}i&&b()}function b(){c.sort(function(a,b){return i((a.source.value+a.target.value)/2,(b.source.value+b.target.value)/2)})}var c,d,e,f,g,h,i,j={},k=0;return j.matrix=function(a){return arguments.length?(f=(e=a)&&e.length,c=d=null,j):e},j.padding=function(a){return arguments.length?(k=a,c=d=null,j):k},j.sortGroups=function(a){return arguments.length?(g=a,c=d=null,j):g},j.sortSubgroups=function(a){return arguments.length?(h=a,c=null,j):h},j.sortChords=function(a){return arguments.length?(i=a,c&&b(),j):i},j.chords=function(){return c||a(),c},j.groups=function(){return d||a(),d},j},ig.layout.force=function(){function a(a){return function(b,c,d,e){if(b.point!==a){var f=b.cx-a.x,g=b.cy-a.y,h=e-c,i=f*f+g*g;if(i>h*h/r){if(p>i){var j=b.charge/i;a.px-=f*j,a.py-=g*j}return!0}if(b.point&&i&&p>i){var j=b.pointCharge/i;a.px-=f*j,a.py-=g*j}}return!b.charge}}function b(a){a.px=ig.event.x,a.py=ig.event.y,i.resume()}var c,d,e,f,g,h,i={},j=ig.dispatch("start","tick","end"),k=[1,1],l=.9,m=ri,n=si,o=-30,p=ti,q=.1,r=.64,s=[],u=[];return i.tick=function(){if((e*=.99)<.005)return c=null,j.end({type:"end",alpha:e=0}),!0;var b,d,i,m,n,p,r,t,v,w=s.length,x=u.length;for(d=0;x>d;++d)i=u[d],m=i.source,n=i.target,t=n.x-m.x,v=n.y-m.y,(p=t*t+v*v)&&(p=e*g[d]*((p=Math.sqrt(p))-f[d])/p,t*=p,v*=p,n.x-=t*(r=m.weight+n.weight?m.weight/(m.weight+n.weight):.5),n.y-=v*r,m.x+=t*(r=1-r),m.y+=v*r);if((r=e*q)&&(t=k[0]/2,v=k[1]/2,d=-1,r))for(;++d<w;)i=s[d],i.x+=(t-i.x)*r,i.y+=(v-i.y)*r;if(o)for(de(b=ig.geom.quadtree(s),e,h),d=-1;++d<w;)(i=s[d]).fixed||b.visit(a(i));for(d=-1;++d<w;)i=s[d],i.fixed?(i.x=i.px,i.y=i.py):(i.x-=(i.px-(i.px=i.x))*l,i.y-=(i.py-(i.py=i.y))*l);j.tick({type:"tick",alpha:e})},i.nodes=function(a){return arguments.length?(s=a,i):s},i.links=function(a){return arguments.length?(u=a,i):u},i.size=function(a){return arguments.length?(k=a,i):k},i.linkDistance=function(a){return arguments.length?(m="function"==typeof a?a:+a,i):m},i.distance=i.linkDistance,i.linkStrength=function(a){return arguments.length?(n="function"==typeof a?a:+a,i):n},i.friction=function(a){return arguments.length?(l=+a,i):l},i.charge=function(a){return arguments.length?(o="function"==typeof a?a:+a,i):o},i.chargeDistance=function(a){return arguments.length?(p=a*a,i):Math.sqrt(p)},i.gravity=function(a){return arguments.length?(q=+a,i):q},i.theta=function(a){return arguments.length?(r=a*a,i):Math.sqrt(r)},i.alpha=function(a){return arguments.length?(a=+a,e?a>0?e=a:(c.c=null,c.t=NaN,c=null,j.start({type:"end",alpha:e=0})):a>0&&(j.start({type:"start",alpha:e=a}),c=Ga(i.tick)),i):e},i.start=function(){function a(a,d){if(!c){for(c=new Array(e),i=0;e>i;++i)c[i]=[];for(i=0;j>i;++i){var f=u[i];c[f.source.index].push(f.target),c[f.target.index].push(f.source)}}for(var g,h=c[b],i=-1,k=h.length;++i<k;)if(!isNaN(g=h[i][a]))return g;return Math.random()*d}var b,c,d,e=s.length,j=u.length,l=k[0],p=k[1];for(b=0;e>b;++b)(d=s[b]).index=b,d.weight=0;for(b=0;j>b;++b)d=u[b],"number"==typeof d.source&&(d.source=s[d.source]),"number"==typeof d.target&&(d.target=s[d.target]),++d.source.weight,++d.target.weight;for(b=0;e>b;++b)d=s[b],isNaN(d.x)&&(d.x=a("x",l)),isNaN(d.y)&&(d.y=a("y",p)),isNaN(d.px)&&(d.px=d.x),isNaN(d.py)&&(d.py=d.y);if(f=[],"function"==typeof m)for(b=0;j>b;++b)f[b]=+m.call(this,u[b],b);else for(b=0;j>b;++b)f[b]=m;if(g=[],"function"==typeof n)for(b=0;j>b;++b)g[b]=+n.call(this,u[b],b);else for(b=0;j>b;++b)g[b]=n;if(h=[],"function"==typeof o)for(b=0;e>b;++b)h[b]=+o.call(this,s[b],b);else for(b=0;e>b;++b)h[b]=o;return i.resume()},i.resume=function(){return i.alpha(.1)},i.stop=function(){return i.alpha(0)},i.drag=function(){return d||(d=ig.behavior.drag().origin(t).on("dragstart.force",_d).on("drag.force",b).on("dragend.force",ae)),arguments.length?void this.on("mouseover.force",be).on("mouseout.force",ce).call(d):d},ig.rebind(i,j,"on")};var ri=20,si=1,ti=1/0;ig.layout.hierarchy=function(){function a(e){var f,g=[e],h=[];for(e.depth=0;null!=(f=g.pop());)if(h.push(f),(j=c.call(a,f,f.depth))&&(i=j.length)){for(var i,j,k;--i>=0;)g.push(k=j[i]),k.parent=f,k.depth=f.depth+1;d&&(f.value=0),f.children=j}else d&&(f.value=+d.call(a,f,f.depth)||0),delete f.children;return ge(e,function(a){var c,e;b&&(c=a.children)&&c.sort(b),d&&(e=a.parent)&&(e.value+=a.value)}),h}var b=je,c=he,d=ie;return a.sort=function(c){return arguments.length?(b=c,a):b},a.children=function(b){return arguments.length?(c=b,a):c},a.value=function(b){return arguments.length?(d=b,a):d},a.revalue=function(b){return d&&(fe(b,function(a){a.children&&(a.value=0)}),ge(b,function(b){var c;b.children||(b.value=+d.call(a,b,b.depth)||0),(c=b.parent)&&(c.value+=b.value)})),b},a},ig.layout.partition=function(){function a(b,c,d,e){var f=b.children;if(b.x=c,b.y=b.depth*e,b.dx=d,b.dy=e,f&&(g=f.length)){var g,h,i,j=-1;for(d=b.value?d/b.value:0;++j<g;)a(h=f[j],c,i=h.value*d,e),c+=i}}function b(a){var c=a.children,d=0;if(c&&(e=c.length))for(var e,f=-1;++f<e;)d=Math.max(d,b(c[f]));return 1+d}function c(c,f){var g=d.call(this,c,f);return a(g[0],0,e[0],e[1]/b(g[0])),g}var d=ig.layout.hierarchy(),e=[1,1];return c.size=function(a){return arguments.length?(e=a,c):e},ee(c,d)},ig.layout.pie=function(){function a(g){var h,i=g.length,j=g.map(function(c,d){return+b.call(a,c,d)}),k=+("function"==typeof d?d.apply(this,arguments):d),l=("function"==typeof e?e.apply(this,arguments):e)-k,m=Math.min(Math.abs(l)/i,+("function"==typeof f?f.apply(this,arguments):f)),n=m*(0>l?-1:1),o=ig.sum(j),p=o?(l-i*n)/o:0,q=ig.range(i),r=[];return null!=c&&q.sort(c===ui?function(a,b){return j[b]-j[a]}:function(a,b){return c(g[a],g[b])}),q.forEach(function(a){r[a]={data:g[a],value:h=j[a],startAngle:k,endAngle:k+=h*p+n,padAngle:m}}),r}var b=Number,c=ui,d=0,e=Ng,f=0;return a.value=function(c){return arguments.length?(b=c,a):b},a.sort=function(b){return arguments.length?(c=b,a):c},a.startAngle=function(b){return arguments.length?(d=b,a):d},a.endAngle=function(b){return arguments.length?(e=b,a):e},a.padAngle=function(b){return arguments.length?(f=b,a):f},a};var ui={};ig.layout.stack=function(){function a(h,i){if(!(m=h.length))return h;var j=h.map(function(c,d){return b.call(a,c,d)}),k=j.map(function(b){return b.map(function(b,c){return[f.call(a,b,c),g.call(a,b,c)]})}),l=c.call(a,k,i);j=ig.permute(j,l),k=ig.permute(k,l);var m,n,o,p,q=d.call(a,k,i),r=j[0].length;for(o=0;r>o;++o)for(e.call(a,j[0][o],p=q[o],k[0][o][1]),n=1;m>n;++n)e.call(a,j[n][o],p+=k[n-1][o][1],k[n][o][1]);return h}var b=t,c=oe,d=pe,e=ne,f=le,g=me;return a.values=function(c){return arguments.length?(b=c,a):b},a.order=function(b){return arguments.length?(c="function"==typeof b?b:vi.get(b)||oe,a):c},a.offset=function(b){return arguments.length?(d="function"==typeof b?b:wi.get(b)||pe,a):d},a.x=function(b){return arguments.length?(f=b,a):f},a.y=function(b){return arguments.length?(g=b,a):g},a.out=function(b){return arguments.length?(e=b,a):e},a};var vi=ig.map({"inside-out":function(a){var b,c,d=a.length,e=a.map(qe),f=a.map(re),g=ig.range(d).sort(function(a,b){return e[a]-e[b]}),h=0,i=0,j=[],k=[];for(b=0;d>b;++b)c=g[b],i>h?(h+=f[c],j.push(c)):(i+=f[c],k.push(c));return k.reverse().concat(j)},reverse:function(a){return ig.range(a.length).reverse()},"default":oe}),wi=ig.map({silhouette:function(a){var b,c,d,e=a.length,f=a[0].length,g=[],h=0,i=[];for(c=0;f>c;++c){for(b=0,d=0;e>b;b++)d+=a[b][c][1];d>h&&(h=d),g.push(d)}for(c=0;f>c;++c)i[c]=(h-g[c])/2;return i},wiggle:function(a){var b,c,d,e,f,g,h,i,j,k=a.length,l=a[0],m=l.length,n=[];for(n[0]=i=j=0,c=1;m>c;++c){for(b=0,e=0;k>b;++b)e+=a[b][c][1];for(b=0,f=0,h=l[c][0]-l[c-1][0];k>b;++b){for(d=0,g=(a[b][c][1]-a[b][c-1][1])/(2*h);b>d;++d)g+=(a[d][c][1]-a[d][c-1][1])/h;f+=g*a[b][c][1]}n[c]=i-=e?f/e*h:0,j>i&&(j=i)}for(c=0;m>c;++c)n[c]-=j;return n},expand:function(a){var b,c,d,e=a.length,f=a[0].length,g=1/e,h=[];for(c=0;f>c;++c){for(b=0,d=0;e>b;b++)d+=a[b][c][1];if(d)for(b=0;e>b;b++)a[b][c][1]/=d;else for(b=0;e>b;b++)a[b][c][1]=g}for(c=0;f>c;++c)h[c]=0;return h},zero:pe});ig.layout.histogram=function(){function a(a,f){for(var g,h,i=[],j=a.map(c,this),k=d.call(this,j,f),l=e.call(this,k,j,f),f=-1,m=j.length,n=l.length-1,o=b?1:1/m;++f<n;)g=i[f]=[],g.dx=l[f+1]-(g.x=l[f]),g.y=0;if(n>0)for(f=-1;++f<m;)h=j[f],h>=k[0]&&h<=k[1]&&(g=i[ig.bisect(l,h,1,n)-1],g.y+=o,g.push(a[f]));return i}var b=!0,c=Number,d=ve,e=te;return a.value=function(b){return arguments.length?(c=b,a):c},a.range=function(b){return arguments.length?(d=Ba(b),a):d},a.bins=function(b){return arguments.length?(e="number"==typeof b?function(a){return ue(a,b)}:Ba(b),a):e},a.frequency=function(c){return arguments.length?(b=!!c,a):b},a},ig.layout.pack=function(){function a(a,f){var g=c.call(this,a,f),h=g[0],i=e[0],j=e[1],k=null==b?Math.sqrt:"function"==typeof b?b:function(){return b};if(h.x=h.y=0,ge(h,function(a){a.r=+k(a.value)}),ge(h,Ae),d){var l=d*(b?1:Math.max(2*h.r/i,2*h.r/j))/2;ge(h,function(a){a.r+=l}),ge(h,Ae),ge(h,function(a){a.r-=l})}return De(h,i/2,j/2,b?1:1/Math.max(2*h.r/i,2*h.r/j)),g}var b,c=ig.layout.hierarchy().sort(we),d=0,e=[1,1];return a.size=function(b){return arguments.length?(e=b,a):e},a.radius=function(c){return arguments.length?(b=null==c||"function"==typeof c?c:+c,a):b},a.padding=function(b){return arguments.length?(d=+b,a):d},ee(a,c)},ig.layout.tree=function(){function a(a,e){var k=g.call(this,a,e),l=k[0],m=b(l);if(ge(m,c),m.parent.m=-m.z,fe(m,d),j)fe(l,f);else{var n=l,o=l,p=l;fe(l,function(a){a.x<n.x&&(n=a),a.x>o.x&&(o=a),a.depth>p.depth&&(p=a)});var q=h(n,o)/2-n.x,r=i[0]/(o.x+h(o,n)/2+q),s=i[1]/(p.depth||1);fe(l,function(a){a.x=(a.x+q)*r,a.y=a.depth*s})}return k}function b(a){for(var b,c={A:null,children:[a]},d=[c];null!=(b=d.pop());)for(var e,f=b.children,g=0,h=f.length;h>g;++g)d.push((f[g]=e={_:f[g],parent:b,children:(e=f[g].children)&&e.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:g}).a=e);return c.children[0]}function c(a){var b=a.children,c=a.parent.children,d=a.i?c[a.i-1]:null;if(b.length){Je(a);var f=(b[0].z+b[b.length-1].z)/2;d?(a.z=d.z+h(a._,d._),a.m=a.z-f):a.z=f}else d&&(a.z=d.z+h(a._,d._));a.parent.A=e(a,d,a.parent.A||c[0])}function d(a){a._.x=a.z+a.parent.m,a.m+=a.parent.m}function e(a,b,c){if(b){for(var d,e=a,f=a,g=b,i=e.parent.children[0],j=e.m,k=f.m,l=g.m,m=i.m;g=He(g),e=Ge(e),g&&e;)i=Ge(i),f=He(f),f.a=a,d=g.z+l-e.z-j+h(g._,e._),d>0&&(Ie(Ke(g,a,c),a,d),j+=d,k+=d),l+=g.m,j+=e.m,m+=i.m,k+=f.m;g&&!He(f)&&(f.t=g,f.m+=l-k),e&&!Ge(i)&&(i.t=e,i.m+=j-m,c=a)}return c}function f(a){a.x*=i[0],a.y=a.depth*i[1]}var g=ig.layout.hierarchy().sort(null).value(null),h=Fe,i=[1,1],j=null;return a.separation=function(b){return arguments.length?(h=b,a):h},a.size=function(b){return arguments.length?(j=null==(i=b)?f:null,a):j?null:i},a.nodeSize=function(b){return arguments.length?(j=null==(i=b)?null:f,a):j?i:null},ee(a,g)},ig.layout.cluster=function(){function a(a,f){var g,h=b.call(this,a,f),i=h[0],j=0;ge(i,function(a){var b=a.children;b&&b.length?(a.x=Me(b),a.y=Le(b)):(a.x=g?j+=c(a,g):0,a.y=0,g=a)});var k=Ne(i),l=Oe(i),m=k.x-c(k,l)/2,n=l.x+c(l,k)/2;return ge(i,e?function(a){a.x=(a.x-i.x)*d[0],a.y=(i.y-a.y)*d[1]}:function(a){a.x=(a.x-m)/(n-m)*d[0],a.y=(1-(i.y?a.y/i.y:1))*d[1]}),h}var b=ig.layout.hierarchy().sort(null).value(null),c=Fe,d=[1,1],e=!1;return a.separation=function(b){return arguments.length?(c=b,a):c},a.size=function(b){return arguments.length?(e=null==(d=b),a):e?null:d},a.nodeSize=function(b){return arguments.length?(e=null!=(d=b),a):e?d:null},ee(a,b)},ig.layout.treemap=function(){function a(a,b){for(var c,d,e=-1,f=a.length;++e<f;)d=(c=a[e]).value*(0>b?0:b),c.area=isNaN(d)||0>=d?0:d}function b(c){var f=c.children;if(f&&f.length){var g,h,i,j=l(c),k=[],m=f.slice(),o=1/0,p="slice"===n?j.dx:"dice"===n?j.dy:"slice-dice"===n?1&c.depth?j.dy:j.dx:Math.min(j.dx,j.dy);for(a(m,j.dx*j.dy/c.value),k.area=0;(i=m.length)>0;)k.push(g=m[i-1]),k.area+=g.area,"squarify"!==n||(h=d(k,p))<=o?(m.pop(),o=h):(k.area-=k.pop().area,e(k,p,j,!1),p=Math.min(j.dx,j.dy),k.length=k.area=0,o=1/0);k.length&&(e(k,p,j,!0),k.length=k.area=0),f.forEach(b)}}function c(b){var d=b.children;if(d&&d.length){var f,g=l(b),h=d.slice(),i=[];for(a(h,g.dx*g.dy/b.value),i.area=0;f=h.pop();)i.push(f),i.area+=f.area,null!=f.z&&(e(i,f.z?g.dx:g.dy,g,!h.length),i.length=i.area=0);d.forEach(c)}}function d(a,b){for(var c,d=a.area,e=0,f=1/0,g=-1,h=a.length;++g<h;)(c=a[g].area)&&(f>c&&(f=c),c>e&&(e=c));return d*=d,b*=b,d?Math.max(b*e*o/d,d/(b*f*o)):1/0}function e(a,b,c,d){var e,f=-1,g=a.length,h=c.x,j=c.y,k=b?i(a.area/b):0;if(b==c.dx){for((d||k>c.dy)&&(k=c.dy);++f<g;)e=a[f],e.x=h,e.y=j,e.dy=k,h+=e.dx=Math.min(c.x+c.dx-h,k?i(e.area/k):0);e.z=!0,e.dx+=c.x+c.dx-h,c.y+=k,c.dy-=k}else{for((d||k>c.dx)&&(k=c.dx);++f<g;)e=a[f],e.x=h,e.y=j,e.dx=k,j+=e.dy=Math.min(c.y+c.dy-j,k?i(e.area/k):0);e.z=!1,e.dy+=c.y+c.dy-j,c.x+=k,c.dx-=k}}function f(d){var e=g||h(d),f=e[0];return f.x=f.y=0,f.value?(f.dx=j[0],f.dy=j[1]):f.dx=f.dy=0,g&&h.revalue(f),a([f],f.dx*f.dy/f.value),(g?c:b)(f),m&&(g=e),e}var g,h=ig.layout.hierarchy(),i=Math.round,j=[1,1],k=null,l=Pe,m=!1,n="squarify",o=.5*(1+Math.sqrt(5));return f.size=function(a){return arguments.length?(j=a,f):j},f.padding=function(a){function b(b){var c=a.call(f,b,b.depth);return null==c?Pe(b):Qe(b,"number"==typeof c?[c,c,c,c]:c)}function c(b){return Qe(b,a)}if(!arguments.length)return k;var d;return l=null==(k=a)?Pe:"function"==(d=typeof a)?b:"number"===d?(a=[a,a,a,a],c):c,f},f.round=function(a){return arguments.length?(i=a?Math.round:Number,f):i!=Number},f.sticky=function(a){return arguments.length?(m=a,g=null,f):m},f.ratio=function(a){return arguments.length?(o=a,f):o},f.mode=function(a){return arguments.length?(n=a+"",f):n},ee(f,h)},ig.random={normal:function(a,b){var c=arguments.length;return 2>c&&(b=1),1>c&&(a=0),function(){var c,d,e;do c=2*Math.random()-1,d=2*Math.random()-1,e=c*c+d*d;while(!e||e>1);return a+b*c*Math.sqrt(-2*Math.log(e)/e)}},logNormal:function(){var a=ig.random.normal.apply(ig,arguments);return function(){return Math.exp(a())}},bates:function(a){var b=ig.random.irwinHall(a);return function(){return b()/a}},irwinHall:function(a){return function(){for(var b=0,c=0;a>c;c++)b+=Math.random();return b}}},ig.scale={};var xi={floor:t,ceil:t};ig.scale.linear=function(){return Xe([0,1],[0,1],td,!1)};var yi={s:1,g:1,p:1,r:1,e:1};ig.scale.log=function(){return df(ig.scale.linear().domain([0,1]),10,!0,[1,10])};var zi=ig.format(".0e"),Ai={floor:function(a){return-Math.ceil(-a)},ceil:function(a){return-Math.floor(-a)}};ig.scale.pow=function(){return ef(ig.scale.linear(),1,[0,1])},ig.scale.sqrt=function(){return ig.scale.pow().exponent(.5)},ig.scale.ordinal=function(){return gf([],{t:"range",a:[[]]})},ig.scale.category10=function(){return ig.scale.ordinal().range(Bi)},ig.scale.category20=function(){return ig.scale.ordinal().range(Ci)},ig.scale.category20b=function(){return ig.scale.ordinal().range(Di)},ig.scale.category20c=function(){return ig.scale.ordinal().range(Ei)};var Bi=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(ua),Ci=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(ua),Di=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(ua),Ei=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(ua);ig.scale.quantile=function(){return hf([],[])},ig.scale.quantize=function(){return jf(0,1,[0,1])},ig.scale.threshold=function(){return kf([.5],[0,1])},ig.scale.identity=function(){return lf([0,1])},ig.svg={},ig.svg.arc=function(){function a(){var a=Math.max(0,+c.apply(this,arguments)),j=Math.max(0,+d.apply(this,arguments)),k=g.apply(this,arguments)-Pg,l=h.apply(this,arguments)-Pg,m=Math.abs(l-k),n=k>l?0:1;if(a>j&&(o=j,j=a,a=o),m>=Og)return b(j,n)+(a?b(a,1-n):"")+"Z";var o,p,q,r,s,t,u,v,w,x,y,z,A=0,B=0,C=[];if((r=(+i.apply(this,arguments)||0)/2)&&(q=f===Fi?Math.sqrt(a*a+j*j):+f.apply(this,arguments),n||(B*=-1),j&&(B=ca(q/j*Math.sin(r))),a&&(A=ca(q/a*Math.sin(r)))),j){s=j*Math.cos(k+B),t=j*Math.sin(k+B),u=j*Math.cos(l-B),v=j*Math.sin(l-B);var D=Math.abs(l-k-2*B)<=Mg?0:1;if(B&&sf(s,t,u,v)===n^D){var E=(k+l)/2;s=j*Math.cos(E),t=j*Math.sin(E),u=v=null}}else s=t=0;if(a){w=a*Math.cos(l-A),x=a*Math.sin(l-A),y=a*Math.cos(k+A),z=a*Math.sin(k+A);var F=Math.abs(k-l+2*A)<=Mg?0:1;if(A&&sf(w,x,y,z)===1-n^F){var G=(k+l)/2;w=a*Math.cos(G),x=a*Math.sin(G),y=z=null}}else w=x=0;if(m>Kg&&(o=Math.min(Math.abs(j-a)/2,+e.apply(this,arguments)))>.001){p=j>a^n?0:1;var H=o,I=o;if(Mg>m){var J=null==y?[w,x]:null==u?[s,t]:Ic([s,t],[y,z],[u,v],[w,x]),K=s-J[0],L=t-J[1],M=u-J[0],N=v-J[1],O=1/Math.sin(Math.acos((K*M+L*N)/(Math.sqrt(K*K+L*L)*Math.sqrt(M*M+N*N)))/2),P=Math.sqrt(J[0]*J[0]+J[1]*J[1]);I=Math.min(o,(a-P)/(O-1)),H=Math.min(o,(j-P)/(O+1))}if(null!=u){var Q=tf(null==y?[w,x]:[y,z],[s,t],j,H,n),R=tf([u,v],[w,x],j,H,n);o===H?C.push("M",Q[0],"A",H,",",H," 0 0,",p," ",Q[1],"A",j,",",j," 0 ",1-n^sf(Q[1][0],Q[1][1],R[1][0],R[1][1]),",",n," ",R[1],"A",H,",",H," 0 0,",p," ",R[0]):C.push("M",Q[0],"A",H,",",H," 0 1,",p," ",R[0])}else C.push("M",s,",",t);if(null!=y){var S=tf([s,t],[y,z],a,-I,n),T=tf([w,x],null==u?[s,t]:[u,v],a,-I,n);o===I?C.push("L",T[0],"A",I,",",I," 0 0,",p," ",T[1],"A",a,",",a," 0 ",n^sf(T[1][0],T[1][1],S[1][0],S[1][1]),",",1-n," ",S[1],"A",I,",",I," 0 0,",p," ",S[0]):C.push("L",T[0],"A",I,",",I," 0 0,",p," ",S[0])}else C.push("L",w,",",x)}else C.push("M",s,",",t),null!=u&&C.push("A",j,",",j," 0 ",D,",",n," ",u,",",v),C.push("L",w,",",x),null!=y&&C.push("A",a,",",a," 0 ",F,",",1-n," ",y,",",z);return C.push("Z"),C.join("")}function b(a,b){return"M0,"+a+"A"+a+","+a+" 0 1,"+b+" 0,"+-a+"A"+a+","+a+" 0 1,"+b+" 0,"+a}var c=nf,d=of,e=mf,f=Fi,g=pf,h=qf,i=rf;return a.innerRadius=function(b){return arguments.length?(c=Ba(b),a):c},a.outerRadius=function(b){return arguments.length?(d=Ba(b),a):d},a.cornerRadius=function(b){return arguments.length?(e=Ba(b),a):e},a.padRadius=function(b){return arguments.length?(f=b==Fi?Fi:Ba(b),a):f},a.startAngle=function(b){return arguments.length?(g=Ba(b),a):g},a.endAngle=function(b){return arguments.length?(h=Ba(b),a):h},a.padAngle=function(b){return arguments.length?(i=Ba(b),a):i},a.centroid=function(){var a=(+c.apply(this,arguments)+ +d.apply(this,arguments))/2,b=(+g.apply(this,arguments)+ +h.apply(this,arguments))/2-Pg;return[Math.cos(b)*a,Math.sin(b)*a]},a};var Fi="auto";ig.svg.line=function(){return uf(t)};var Gi=ig.map({linear:vf,"linear-closed":wf,step:xf,"step-before":yf,"step-after":zf,basis:Ff,"basis-open":Gf,"basis-closed":Hf,bundle:If,cardinal:Cf,"cardinal-open":Af,"cardinal-closed":Bf,monotone:Of});Gi.forEach(function(a,b){b.key=a,b.closed=/-closed$/.test(a)});var Hi=[0,2/3,1/3,0],Ii=[0,1/3,2/3,0],Ji=[0,1/6,2/3,1/6];ig.svg.line.radial=function(){var a=uf(Pf);return a.radius=a.x,delete a.x,a.angle=a.y,delete a.y,a},yf.reverse=zf,zf.reverse=yf,ig.svg.area=function(){return Qf(t)},ig.svg.area.radial=function(){var a=Qf(Pf);return a.radius=a.x,delete a.x,a.innerRadius=a.x0,delete a.x0,a.outerRadius=a.x1,delete a.x1,a.angle=a.y,delete a.y,a.startAngle=a.y0,delete a.y0,a.endAngle=a.y1,delete a.y1,a},ig.svg.chord=function(){function a(a,h){var i=b(this,f,a,h),j=b(this,g,a,h);return"M"+i.p0+d(i.r,i.p1,i.a1-i.a0)+(c(i,j)?e(i.r,i.p1,i.r,i.p0):e(i.r,i.p1,j.r,j.p0)+d(j.r,j.p1,j.a1-j.a0)+e(j.r,j.p1,i.r,i.p0))+"Z"}function b(a,b,c,d){var e=b.call(a,c,d),f=h.call(a,e,d),g=i.call(a,e,d)-Pg,k=j.call(a,e,d)-Pg;return{r:f,a0:g,a1:k,p0:[f*Math.cos(g),f*Math.sin(g)],p1:[f*Math.cos(k),f*Math.sin(k)]}}function c(a,b){return a.a0==b.a0&&a.a1==b.a1}function d(a,b,c){return"A"+a+","+a+" 0 "+ +(c>Mg)+",1 "+b}function e(a,b,c,d){return"Q 0,0 "+d}var f=tc,g=uc,h=Rf,i=pf,j=qf;return a.radius=function(b){return arguments.length?(h=Ba(b),a):h},a.source=function(b){return arguments.length?(f=Ba(b),a):f},a.target=function(b){return arguments.length?(g=Ba(b),a):g},a.startAngle=function(b){return arguments.length?(i=Ba(b),a):i},a.endAngle=function(b){return arguments.length?(j=Ba(b),a):j},a},ig.svg.diagonal=function(){function a(a,e){var f=b.call(this,a,e),g=c.call(this,a,e),h=(f.y+g.y)/2,i=[f,{x:f.x,y:h},{x:g.x,y:h},g];return i=i.map(d),"M"+i[0]+"C"+i[1]+" "+i[2]+" "+i[3]}var b=tc,c=uc,d=Sf;return a.source=function(c){return arguments.length?(b=Ba(c),a):b},a.target=function(b){return arguments.length?(c=Ba(b),a):c},a.projection=function(b){return arguments.length?(d=b,a):d},a},ig.svg.diagonal.radial=function(){var a=ig.svg.diagonal(),b=Sf,c=a.projection;return a.projection=function(a){return arguments.length?c(Tf(b=a)):b},a},ig.svg.symbol=function(){function a(a,d){return(Ki.get(b.call(this,a,d))||Wf)(c.call(this,a,d))}var b=Vf,c=Uf;return a.type=function(c){return arguments.length?(b=Ba(c),a):b},a.size=function(b){return arguments.length?(c=Ba(b),a):c},a};var Ki=ig.map({circle:Wf,cross:function(a){var b=Math.sqrt(a/5)/2;return"M"+-3*b+","+-b+"H"+-b+"V"+-3*b+"H"+b+"V"+-b+"H"+3*b+"V"+b+"H"+b+"V"+3*b+"H"+-b+"V"+b+"H"+-3*b+"Z"},diamond:function(a){var b=Math.sqrt(a/(2*Mi)),c=b*Mi;return"M0,"+-b+"L"+c+",0 0,"+b+" "+-c+",0Z"},square:function(a){var b=Math.sqrt(a)/2;return"M"+-b+","+-b+"L"+b+","+-b+" "+b+","+b+" "+-b+","+b+"Z"},"triangle-down":function(a){var b=Math.sqrt(a/Li),c=b*Li/2;return"M0,"+c+"L"+b+","+-c+" "+-b+","+-c+"Z"},"triangle-up":function(a){var b=Math.sqrt(a/Li),c=b*Li/2;return"M0,"+-c+"L"+b+","+c+" "+-b+","+c+"Z"}});ig.svg.symbolTypes=Ki.keys();var Li=Math.sqrt(3),Mi=Math.tan(30*Qg);Dg.transition=function(a){for(var b,c,d=Ni||++Ri,e=_f(a),f=[],g=Oi||{time:Date.now(),ease:Ad,delay:0,duration:250},h=-1,i=this.length;++h<i;){f.push(b=[]);for(var j=this[h],k=-1,l=j.length;++k<l;)(c=j[k])&&ag(c,k,e,d,g),b.push(c)}return Yf(f,e,d)},Dg.interrupt=function(a){return this.each(null==a?Pi:Xf(_f(a)))};var Ni,Oi,Pi=Xf(_f()),Qi=[],Ri=0;Qi.call=Dg.call,Qi.empty=Dg.empty,Qi.node=Dg.node,Qi.size=Dg.size,ig.transition=function(a,b){return a&&a.transition?Ni?a.transition(b):a:ig.selection().transition(a)},ig.transition.prototype=Qi,Qi.select=function(a){var b,c,d,e=this.id,f=this.namespace,g=[];a=D(a);for(var h=-1,i=this.length;++h<i;){g.push(b=[]);for(var j=this[h],k=-1,l=j.length;++k<l;)(d=j[k])&&(c=a.call(d,d.__data__,k,h))?("__data__"in d&&(c.__data__=d.__data__),ag(c,k,f,e,d[f][e]),b.push(c)):b.push(null)}return Yf(g,f,e)},Qi.selectAll=function(a){var b,c,d,e,f,g=this.id,h=this.namespace,i=[];a=E(a);for(var j=-1,k=this.length;++j<k;)for(var l=this[j],m=-1,n=l.length;++m<n;)if(d=l[m]){f=d[h][g],c=a.call(d,d.__data__,m,j),i.push(b=[]);for(var o=-1,p=c.length;++o<p;)(e=c[o])&&ag(e,o,h,g,f),b.push(e)}return Yf(i,h,g)},Qi.filter=function(a){var b,c,d,e=[];"function"!=typeof a&&(a=Q(a));for(var f=0,g=this.length;g>f;f++){e.push(b=[]);for(var c=this[f],h=0,i=c.length;i>h;h++)(d=c[h])&&a.call(d,d.__data__,h,f)&&b.push(d)}return Yf(e,this.namespace,this.id)},Qi.tween=function(a,b){var c=this.id,d=this.namespace;return arguments.length<2?this.node()[d][c].tween.get(a):S(this,null==b?function(b){b[d][c].tween.remove(a)}:function(e){e[d][c].tween.set(a,b)})},Qi.attr=function(a,b){function c(){this.removeAttribute(h)}function d(){this.removeAttributeNS(h.space,h.local)}function e(a){return null==a?c:(a+="",function(){var b,c=this.getAttribute(h);return c!==a&&(b=g(c,a),function(a){this.setAttribute(h,b(a))})})}function f(a){return null==a?d:(a+="",function(){var b,c=this.getAttributeNS(h.space,h.local);return c!==a&&(b=g(c,a),function(a){this.setAttributeNS(h.space,h.local,b(a))})})}if(arguments.length<2){for(b in a)this.attr(b,a[b]);return this}var g="transform"==a?Vd:td,h=ig.ns.qualify(a);return Zf(this,"attr."+a,b,h.local?f:e)},Qi.attrTween=function(a,b){function c(a,c){var d=b.call(this,a,c,this.getAttribute(e));return d&&function(a){this.setAttribute(e,d(a))}}function d(a,c){var d=b.call(this,a,c,this.getAttributeNS(e.space,e.local));return d&&function(a){this.setAttributeNS(e.space,e.local,d(a))}}var e=ig.ns.qualify(a);return this.tween("attr."+a,e.local?d:c)},Qi.style=function(a,b,d){function e(){this.style.removeProperty(a)}function f(b){return null==b?e:(b+="",function(){var e,f=c(this).getComputedStyle(this,null).getPropertyValue(a);return f!==b&&(e=td(f,b),function(b){this.style.setProperty(a,e(b),d)})})}var g=arguments.length;if(3>g){if("string"!=typeof a){2>g&&(b="");for(d in a)this.style(d,a[d],b);return this}d=""}return Zf(this,"style."+a,b,f)},Qi.styleTween=function(a,b,d){function e(e,f){var g=b.call(this,e,f,c(this).getComputedStyle(this,null).getPropertyValue(a));return g&&function(b){this.style.setProperty(a,g(b),d)}}return arguments.length<3&&(d=""),this.tween("style."+a,e)},Qi.text=function(a){return Zf(this,"text",a,$f)},Qi.remove=function(){var a=this.namespace;return this.each("end.transition",function(){var b;this[a].count<2&&(b=this.parentNode)&&b.removeChild(this)})},Qi.ease=function(a){var b=this.id,c=this.namespace;return arguments.length<1?this.node()[c][b].ease:("function"!=typeof a&&(a=ig.ease.apply(ig,arguments)),S(this,function(d){d[c][b].ease=a}))},Qi.delay=function(a){var b=this.id,c=this.namespace;return arguments.length<1?this.node()[c][b].delay:S(this,"function"==typeof a?function(d,e,f){d[c][b].delay=+a.call(d,d.__data__,e,f)}:(a=+a,function(d){d[c][b].delay=a}))},Qi.duration=function(a){var b=this.id,c=this.namespace;return arguments.length<1?this.node()[c][b].duration:S(this,"function"==typeof a?function(d,e,f){d[c][b].duration=Math.max(1,a.call(d,d.__data__,e,f))}:(a=Math.max(1,a),function(d){d[c][b].duration=a}))},Qi.each=function(a,b){var c=this.id,d=this.namespace;if(arguments.length<2){var e=Oi,f=Ni;try{Ni=c,S(this,function(b,e,f){Oi=b[d][c],a.call(b,b.__data__,e,f)})}finally{Oi=e,Ni=f}}else S(this,function(e){var f=e[d][c];(f.event||(f.event=ig.dispatch("start","end","interrupt"))).on(a,b)});return this},Qi.transition=function(){for(var a,b,c,d,e=this.id,f=++Ri,g=this.namespace,h=[],i=0,j=this.length;j>i;i++){h.push(a=[]);for(var b=this[i],k=0,l=b.length;l>k;k++)(c=b[k])&&(d=c[g][e],ag(c,k,g,f,{time:d.time,ease:d.ease,delay:d.delay+d.duration,duration:d.duration})),a.push(c)}return Yf(h,g,f)},ig.svg.axis=function(){function a(a){a.each(function(){var a,j=ig.select(this),k=this.__chart__||c,l=this.__chart__=c.copy(),m=null==i?l.ticks?l.ticks.apply(l,h):l.domain():i,n=null==b?l.tickFormat?l.tickFormat.apply(l,h):t:b,o=j.selectAll(".tick").data(m,l),p=o.enter().insert("g",".domain").attr("class","tick").style("opacity",Kg),q=ig.transition(o.exit()).style("opacity",Kg).remove(),r=ig.transition(o.order()).style("opacity",1),s=Math.max(e,0)+g,u=Se(l),v=j.selectAll(".domain").data([0]),w=(v.enter().append("path").attr("class","domain"),ig.transition(v));p.append("line"),p.append("text");var x,y,z,A,B=p.select("line"),C=r.select("line"),D=o.select("text").text(n),E=p.select("text"),F=r.select("text"),G="top"===d||"left"===d?-1:1;if("bottom"===d||"top"===d?(a=bg,x="x",z="y",y="x2",A="y2",D.attr("dy",0>G?"0em":".71em").style("text-anchor","middle"),w.attr("d","M"+u[0]+","+G*f+"V0H"+u[1]+"V"+G*f)):(a=cg,x="y",z="x",y="y2",A="x2",D.attr("dy",".32em").style("text-anchor",0>G?"end":"start"),w.attr("d","M"+G*f+","+u[0]+"H0V"+u[1]+"H"+G*f)),B.attr(A,G*e),E.attr(z,G*s),C.attr(y,0).attr(A,G*e),F.attr(x,0).attr(z,G*s),l.rangeBand){var H=l,I=H.rangeBand()/2;k=l=function(a){return H(a)+I}}else k.rangeBand?k=l:q.call(a,l,k);p.call(a,k,l),r.call(a,l,l)})}var b,c=ig.scale.linear(),d=Si,e=6,f=6,g=3,h=[10],i=null;return a.scale=function(b){return arguments.length?(c=b,a):c},a.orient=function(b){return arguments.length?(d=b in Ti?b+"":Si,
a):d},a.ticks=function(){return arguments.length?(h=kg(arguments),a):h},a.tickValues=function(b){return arguments.length?(i=b,a):i},a.tickFormat=function(c){return arguments.length?(b=c,a):b},a.tickSize=function(b){var c=arguments.length;return c?(e=+b,f=+arguments[c-1],a):e},a.innerTickSize=function(b){return arguments.length?(e=+b,a):e},a.outerTickSize=function(b){return arguments.length?(f=+b,a):f},a.tickPadding=function(b){return arguments.length?(g=+b,a):g},a.tickSubdivide=function(){return arguments.length&&a},a};var Si="bottom",Ti={top:1,right:1,bottom:1,left:1};ig.svg.brush=function(){function a(c){c.each(function(){var c=ig.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",f).on("touchstart.brush",f),g=c.selectAll(".background").data([0]);g.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),c.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var h=c.selectAll(".resize").data(p,t);h.exit().remove(),h.enter().append("g").attr("class",function(a){return"resize "+a}).style("cursor",function(a){return Ui[a]}).append("rect").attr("x",function(a){return/[ew]$/.test(a)?-3:null}).attr("y",function(a){return/^[ns]/.test(a)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),h.style("display",a.empty()?"none":null);var i,l=ig.transition(c),m=ig.transition(g);j&&(i=Se(j),m.attr("x",i[0]).attr("width",i[1]-i[0]),d(l)),k&&(i=Se(k),m.attr("y",i[0]).attr("height",i[1]-i[0]),e(l)),b(l)})}function b(a){a.selectAll(".resize").attr("transform",function(a){return"translate("+l[+/e$/.test(a)]+","+m[+/^s/.test(a)]+")"})}function d(a){a.select(".extent").attr("x",l[0]),a.selectAll(".extent,.n>rect,.s>rect").attr("width",l[1]-l[0])}function e(a){a.select(".extent").attr("y",m[0]),a.selectAll(".extent,.e>rect,.w>rect").attr("height",m[1]-m[0])}function f(){function f(){32==ig.event.keyCode&&(D||(t=null,F[0]-=l[1],F[1]-=m[1],D=2),z())}function p(){32==ig.event.keyCode&&2==D&&(F[0]+=l[1],F[1]+=m[1],D=0,z())}function q(){var a=ig.mouse(v),c=!1;u&&(a[0]+=u[0],a[1]+=u[1]),D||(ig.event.altKey?(t||(t=[(l[0]+l[1])/2,(m[0]+m[1])/2]),F[0]=l[+(a[0]<t[0])],F[1]=m[+(a[1]<t[1])]):t=null),B&&r(a,j,0)&&(d(y),c=!0),C&&r(a,k,1)&&(e(y),c=!0),c&&(b(y),x({type:"brush",mode:D?"move":"resize"}))}function r(a,b,c){var d,e,f=Se(b),i=f[0],j=f[1],k=F[c],p=c?m:l,q=p[1]-p[0];return D&&(i-=k,j-=q+k),d=(c?o:n)?Math.max(i,Math.min(j,a[c])):a[c],D?e=(d+=k)+q:(t&&(k=Math.max(i,Math.min(j,2*t[c]-d))),d>k?(e=d,d=k):e=k),p[0]!=d||p[1]!=e?(c?h=null:g=null,p[0]=d,p[1]=e,!0):void 0}function s(){q(),y.style("pointer-events","all").selectAll(".resize").style("display",a.empty()?"none":null),ig.select("body").style("cursor",null),G.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),E(),x({type:"brushend"})}var t,u,v=this,w=ig.select(ig.event.target),x=i.of(v,arguments),y=ig.select(v),A=w.datum(),B=!/^(n|s)$/.test(A)&&j,C=!/^(e|w)$/.test(A)&&k,D=w.classed("extent"),E=Y(v),F=ig.mouse(v),G=ig.select(c(v)).on("keydown.brush",f).on("keyup.brush",p);if(ig.event.changedTouches?G.on("touchmove.brush",q).on("touchend.brush",s):G.on("mousemove.brush",q).on("mouseup.brush",s),y.interrupt().selectAll("*").interrupt(),D)F[0]=l[0]-F[0],F[1]=m[0]-F[1];else if(A){var H=+/w$/.test(A),I=+/^n/.test(A);u=[l[1-H]-F[0],m[1-I]-F[1]],F[0]=l[H],F[1]=m[I]}else ig.event.altKey&&(t=F.slice());y.style("pointer-events","none").selectAll(".resize").style("display",null),ig.select("body").style("cursor",w.style("cursor")),x({type:"brushstart"}),q()}var g,h,i=B(a,"brushstart","brush","brushend"),j=null,k=null,l=[0,0],m=[0,0],n=!0,o=!0,p=Vi[0];return a.event=function(a){a.each(function(){var a=i.of(this,arguments),b={x:l,y:m,i:g,j:h},c=this.__chart__||b;this.__chart__=b,Ni?ig.select(this).transition().each("start.brush",function(){g=c.i,h=c.j,l=c.x,m=c.y,a({type:"brushstart"})}).tween("brush:brush",function(){var c=ud(l,b.x),d=ud(m,b.y);return g=h=null,function(e){l=b.x=c(e),m=b.y=d(e),a({type:"brush",mode:"resize"})}}).each("end.brush",function(){g=b.i,h=b.j,a({type:"brush",mode:"resize"}),a({type:"brushend"})}):(a({type:"brushstart"}),a({type:"brush",mode:"resize"}),a({type:"brushend"}))})},a.x=function(b){return arguments.length?(j=b,p=Vi[!j<<1|!k],a):j},a.y=function(b){return arguments.length?(k=b,p=Vi[!j<<1|!k],a):k},a.clamp=function(b){return arguments.length?(j&&k?(n=!!b[0],o=!!b[1]):j?n=!!b:k&&(o=!!b),a):j&&k?[n,o]:j?n:k?o:null},a.extent=function(b){var c,d,e,f,i;return arguments.length?(j&&(c=b[0],d=b[1],k&&(c=c[0],d=d[0]),g=[c,d],j.invert&&(c=j(c),d=j(d)),c>d&&(i=c,c=d,d=i),c==l[0]&&d==l[1]||(l=[c,d])),k&&(e=b[0],f=b[1],j&&(e=e[1],f=f[1]),h=[e,f],k.invert&&(e=k(e),f=k(f)),e>f&&(i=e,e=f,f=i),e==m[0]&&f==m[1]||(m=[e,f])),a):(j&&(g?(c=g[0],d=g[1]):(c=l[0],d=l[1],j.invert&&(c=j.invert(c),d=j.invert(d)),c>d&&(i=c,c=d,d=i))),k&&(h?(e=h[0],f=h[1]):(e=m[0],f=m[1],k.invert&&(e=k.invert(e),f=k.invert(f)),e>f&&(i=e,e=f,f=i))),j&&k?[[c,e],[d,f]]:j?[c,d]:k&&[e,f])},a.clear=function(){return a.empty()||(l=[0,0],m=[0,0],g=h=null),a},a.empty=function(){return!!j&&l[0]==l[1]||!!k&&m[0]==m[1]},ig.rebind(a,i,"on")};var Ui={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Vi=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Wi=nh.format=th.timeFormat,Xi=Wi.utc,Yi=Xi("%Y-%m-%dT%H:%M:%S.%LZ");Wi.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?dg:Yi,dg.parse=function(a){var b=new Date(a);return isNaN(b)?null:b},dg.toString=Yi.toString,nh.second=Pa(function(a){return new oh(1e3*Math.floor(a/1e3))},function(a,b){a.setTime(a.getTime()+1e3*Math.floor(b))},function(a){return a.getSeconds()}),nh.seconds=nh.second.range,nh.seconds.utc=nh.second.utc.range,nh.minute=Pa(function(a){return new oh(6e4*Math.floor(a/6e4))},function(a,b){a.setTime(a.getTime()+6e4*Math.floor(b))},function(a){return a.getMinutes()}),nh.minutes=nh.minute.range,nh.minutes.utc=nh.minute.utc.range,nh.hour=Pa(function(a){var b=a.getTimezoneOffset()/60;return new oh(36e5*(Math.floor(a/36e5-b)+b))},function(a,b){a.setTime(a.getTime()+36e5*Math.floor(b))},function(a){return a.getHours()}),nh.hours=nh.hour.range,nh.hours.utc=nh.hour.utc.range,nh.month=Pa(function(a){return a=nh.day(a),a.setDate(1),a},function(a,b){a.setMonth(a.getMonth()+b)},function(a){return a.getMonth()}),nh.months=nh.month.range,nh.months.utc=nh.month.utc.range;var Zi=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],$i=[[nh.second,1],[nh.second,5],[nh.second,15],[nh.second,30],[nh.minute,1],[nh.minute,5],[nh.minute,15],[nh.minute,30],[nh.hour,1],[nh.hour,3],[nh.hour,6],[nh.hour,12],[nh.day,1],[nh.day,2],[nh.week,1],[nh.month,1],[nh.month,3],[nh.year,1]],_i=Wi.multi([[".%L",function(a){return a.getMilliseconds()}],[":%S",function(a){return a.getSeconds()}],["%I:%M",function(a){return a.getMinutes()}],["%I %p",function(a){return a.getHours()}],["%a %d",function(a){return a.getDay()&&1!=a.getDate()}],["%b %d",function(a){return 1!=a.getDate()}],["%B",function(a){return a.getMonth()}],["%Y",Eb]]),aj={range:function(a,b,c){return ig.range(Math.ceil(a/c)*c,+b,c).map(fg)},floor:t,ceil:t};$i.year=nh.year,nh.scale=function(){return eg(ig.scale.linear(),$i,_i)};var bj=$i.map(function(a){return[a[0].utc,a[1]]}),cj=Xi.multi([[".%L",function(a){return a.getUTCMilliseconds()}],[":%S",function(a){return a.getUTCSeconds()}],["%I:%M",function(a){return a.getUTCMinutes()}],["%I %p",function(a){return a.getUTCHours()}],["%a %d",function(a){return a.getUTCDay()&&1!=a.getUTCDate()}],["%b %d",function(a){return 1!=a.getUTCDate()}],["%B",function(a){return a.getUTCMonth()}],["%Y",Eb]]);bj.year=nh.year.utc,nh.scale.utc=function(){return eg(ig.scale.linear(),bj,cj)},ig.text=Ca(function(a){return a.responseText}),ig.json=function(a,b){return Da(a,"application/json",gg,b)},ig.html=function(a,b){return Da(a,"text/html",hg,b)},ig.xml=Ca(function(a){return a.responseXML}),"function"==typeof define&&define.amd?define(this.d3=ig):"object"==typeof b&&b.exports?b.exports=ig:this.d3=ig}()},{}],57:[function(a,b,c){!function(a,c){"object"==typeof b&&"object"==typeof b.exports?b.exports=a.document?c(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return c(a)}:c(a)}("undefined"!=typeof window?window:this,function(a,b){function c(a){var b="length"in a&&a.length,c=_.type(a);return"function"===c||_.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}function d(a,b,c){if(_.isFunction(b))return _.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return _.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(ha.test(b))return _.filter(b,a,c);b=_.filter(b,a)}return _.grep(a,function(a){return U.call(b,a)>=0!==c})}function e(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function f(a){var b=oa[a]={};return _.each(a.match(na)||[],function(a,c){b[c]=!0}),b}function g(){Z.removeEventListener("DOMContentLoaded",g,!1),a.removeEventListener("load",g,!1),_.ready()}function h(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=_.expando+h.uid++}function i(a,b,c){var d;if(void 0===c&&1===a.nodeType)if(d="data-"+b.replace(ua,"-$1").toLowerCase(),c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:ta.test(c)?_.parseJSON(c):c}catch(e){}sa.set(a,b,c)}else c=void 0;return c}function j(){return!0}function k(){return!1}function l(){try{return Z.activeElement}catch(a){}}function m(a,b){return _.nodeName(a,"table")&&_.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function n(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function o(a){var b=Ka.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function p(a,b){for(var c=0,d=a.length;d>c;c++)ra.set(a[c],"globalEval",!b||ra.get(b[c],"globalEval"))}function q(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(ra.hasData(a)&&(f=ra.access(a),g=ra.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)_.event.add(b,e,j[e][c])}sa.hasData(a)&&(h=sa.access(a),i=_.extend({},h),sa.set(b,i))}}function r(a,b){var c=a.getElementsByTagName?a.getElementsByTagName(b||"*"):a.querySelectorAll?a.querySelectorAll(b||"*"):[];return void 0===b||b&&_.nodeName(a,b)?_.merge([a],c):c}function s(a,b){var c=b.nodeName.toLowerCase();"input"===c&&ya.test(a.type)?b.checked=a.checked:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}function t(b,c){var d,e=_(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:_.css(e[0],"display");return e.detach(),f}function u(a){var b=Z,c=Oa[a];return c||(c=t(a,b),"none"!==c&&c||(Na=(Na||_("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=Na[0].contentDocument,b.write(),b.close(),c=t(a,b),Na.detach()),Oa[a]=c),c}function v(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),c&&(g=c.getPropertyValue(b)||c[b]),c&&(""!==g||_.contains(a.ownerDocument,a)||(g=_.style(a,b)),Qa.test(g)&&Pa.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0!==g?g+"":g}function w(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}function x(a,b){if(b in a)return b;for(var c=b[0].toUpperCase()+b.slice(1),d=b,e=Xa.length;e--;)if(b=Xa[e]+c,b in a)return b;return d}function y(a,b,c){var d=Ta.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function z(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=_.css(a,c+wa[f],!0,e)),d?("content"===c&&(g-=_.css(a,"padding"+wa[f],!0,e)),"margin"!==c&&(g-=_.css(a,"border"+wa[f]+"Width",!0,e))):(g+=_.css(a,"padding"+wa[f],!0,e),"padding"!==c&&(g+=_.css(a,"border"+wa[f]+"Width",!0,e)));return g}function A(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ra(a),g="border-box"===_.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=v(a,b,f),(0>e||null==e)&&(e=a.style[b]),Qa.test(e))return e;d=g&&(Y.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+z(a,b,c||(g?"border":"content"),d,f)+"px"}function B(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=ra.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&xa(d)&&(f[g]=ra.access(d,"olddisplay",u(d.nodeName)))):(e=xa(d),"none"===c&&e||ra.set(d,"olddisplay",e?c:_.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function C(a,b,c,d,e){return new C.prototype.init(a,b,c,d,e)}function D(){return setTimeout(function(){Ya=void 0}),Ya=_.now()}function E(a,b){var c,d=0,e={height:a};for(b=b?1:0;4>d;d+=2-b)c=wa[d],e["margin"+c]=e["padding"+c]=a;return b&&(e.opacity=e.width=a),e}function F(a,b,c){for(var d,e=(cb[b]||[]).concat(cb["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function G(a,b,c){var d,e,f,g,h,i,j,k,l=this,m={},n=a.style,o=a.nodeType&&xa(a),p=ra.get(a,"fxshow");c.queue||(h=_._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,l.always(function(){l.always(function(){h.unqueued--,_.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[n.overflow,n.overflowX,n.overflowY],j=_.css(a,"display"),k="none"===j?ra.get(a,"olddisplay")||u(a.nodeName):j,"inline"===k&&"none"===_.css(a,"float")&&(n.display="inline-block")),c.overflow&&(n.overflow="hidden",l.always(function(){n.overflow=c.overflow[0],n.overflowX=c.overflow[1],n.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],$a.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(o?"hide":"show")){if("show"!==e||!p||void 0===p[d])continue;o=!0}m[d]=p&&p[d]||_.style(a,d)}else j=void 0;if(_.isEmptyObject(m))"inline"===("none"===j?u(a.nodeName):j)&&(n.display=j);else{p?"hidden"in p&&(o=p.hidden):p=ra.access(a,"fxshow",{}),f&&(p.hidden=!o),o?_(a).show():l.done(function(){_(a).hide()}),l.done(function(){var b;ra.remove(a,"fxshow");for(b in m)_.style(a,b,m[b])});for(d in m)g=F(o?p[d]:0,d,l),d in p||(p[d]=g.start,o&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function H(a,b){var c,d,e,f,g;for(c in a)if(d=_.camelCase(c),e=b[d],f=a[c],_.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=_.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function I(a,b,c){var d,e,f=0,g=bb.length,h=_.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Ya||D(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:_.extend({},b),opts:_.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Ya||D(),duration:c.duration,tweens:[],createTween:function(b,c){var d=_.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(H(k,j.opts.specialEasing);g>f;f++)if(d=bb[f].call(j,a,k,j.opts))return d;return _.map(k,F,j),_.isFunction(j.opts.start)&&j.opts.start.call(a,j),_.fx.timer(_.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function J(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(na)||[];if(_.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function K(a,b,c,d){function e(h){var i;return f[h]=!0,_.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===tb;return e(b.dataTypes[0])||!f["*"]&&e("*")}function L(a,b){var c,d,e=_.ajaxSettings.flatOptions||{};for(c in b)void 0!==b[c]&&((e[c]?a:d||(d={}))[c]=b[c]);return d&&_.extend(!0,a,d),a}function M(a,b,c){for(var d,e,f,g,h=a.contents,i=a.dataTypes;"*"===i[0];)i.shift(),void 0===d&&(d=a.mimeType||b.getResponseHeader("Content-Type"));if(d)for(e in h)if(h[e]&&h[e].test(d)){i.unshift(e);break}if(i[0]in c)f=i[0];else{for(e in c){if(!i[0]||a.converters[e+" "+i[0]]){f=e;break}g||(g=e)}f=f||g}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function N(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function O(a,b,c,d){var e;if(_.isArray(b))_.each(b,function(b,e){c||yb.test(a)?d(a,e):O(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==_.type(b))d(a,b);else for(e in b)O(a+"["+e+"]",b[e],c,d)}function P(a){return _.isWindow(a)?a:9===a.nodeType&&a.defaultView}var Q=[],R=Q.slice,S=Q.concat,T=Q.push,U=Q.indexOf,V={},W=V.toString,X=V.hasOwnProperty,Y={},Z=a.document,$="2.1.4",_=function(a,b){return new _.fn.init(a,b)},aa=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ba=/^-ms-/,ca=/-([\da-z])/gi,da=function(a,b){return b.toUpperCase()};_.fn=_.prototype={jquery:$,constructor:_,selector:"",length:0,toArray:function(){return R.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:R.call(this)},pushStack:function(a){var b=_.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return _.each(this,a,b)},map:function(a){return this.pushStack(_.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(R.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:T,sort:Q.sort,splice:Q.splice},_.extend=_.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||_.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(_.isPlainObject(d)||(e=_.isArray(d)))?(e?(e=!1,f=c&&_.isArray(c)?c:[]):f=c&&_.isPlainObject(c)?c:{},g[b]=_.extend(j,f,d)):void 0!==d&&(g[b]=d));return g},_.extend({expando:"jQuery"+($+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===_.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!_.isArray(a)&&a-parseFloat(a)+1>=0},isPlainObject:function(a){return"object"!==_.type(a)||a.nodeType||_.isWindow(a)?!1:!a.constructor||X.call(a.constructor.prototype,"isPrototypeOf")},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?V[W.call(a)]||"object":typeof a},globalEval:function(a){var b,c=eval;a=_.trim(a),a&&(1===a.indexOf("use strict")?(b=Z.createElement("script"),b.text=a,Z.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(ba,"ms-").replace(ca,da)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(aa,"")},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?_.merge(d,"string"==typeof a?[a]:a):T.call(d,a)),d},inArray:function(a,b,c){return null==b?-1:U.call(b,a,c)},merge:function(a,b){for(var c=+b.length,d=0,e=a.length;c>d;d++)a[e++]=b[d];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&i.push(e);else for(f in a)e=b(a[f],f,d),null!=e&&i.push(e);return S.apply([],i)},guid:1,proxy:function(a,b){var c,d,e;return"string"==typeof b&&(c=a[b],b=a,a=c),_.isFunction(a)?(d=R.call(arguments,2),e=function(){return a.apply(b||this,d.concat(R.call(arguments)))},e.guid=a.guid=a.guid||_.guid++,e):void 0},now:Date.now,support:Y}),_.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){V["[object "+b+"]"]=b.toLowerCase()});var ea=function(a){function b(a,b,c,d){var e,f,g,h,i,j,l,n,o,p;if((b?b.ownerDocument||b:O)!==G&&F(b),b=b||G,c=c||[],h=b.nodeType,"string"!=typeof a||!a||1!==h&&9!==h&&11!==h)return c;if(!d&&I){if(11!==h&&(e=sa.exec(a)))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&M(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return $.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&v.getElementsByClassName)return $.apply(c,b.getElementsByClassName(g)),c}if(v.qsa&&(!J||!J.test(a))){if(n=l=N,o=b,p=1!==h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=z(a),(l=b.getAttribute("id"))?n=l.replace(ua,"\\$&"):b.setAttribute("id",n),n="[id='"+n+"'] ",i=j.length;i--;)j[i]=n+m(j[i]);o=ta.test(a)&&k(b.parentNode)||b,p=j.join(",")}if(p)try{return $.apply(c,o.querySelectorAll(p)),c}catch(q){}finally{l||b.removeAttribute("id")}}}return B(a.replace(ia,"$1"),b,c,d)}function c(){function a(c,d){return b.push(c+" ")>w.cacheLength&&delete a[b.shift()],a[c+" "]=d}var b=[];return a}function d(a){return a[N]=!0,a}function e(a){var b=G.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function f(a,b){for(var c=a.split("|"),d=a.length;d--;)w.attrHandle[c[d]]=b}function g(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||V)-(~a.sourceIndex||V);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function h(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function i(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function j(a){return d(function(b){return b=+b,d(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function k(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}function l(){}function m(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function n(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=Q++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[P,f];if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e){if(i=b[N]||(b[N]={}),(h=i[d])&&h[0]===P&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function o(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function p(a,c,d){for(var e=0,f=c.length;f>e;e++)b(a,c[e],d);return d}function q(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function r(a,b,c,e,f,g){return e&&!e[N]&&(e=r(e)),f&&!f[N]&&(f=r(f,g)),d(function(d,g,h,i){var j,k,l,m=[],n=[],o=g.length,r=d||p(b||"*",h.nodeType?[h]:h,[]),s=!a||!d&&b?r:q(r,m,a,h,i),t=c?f||(d?a:o||e)?[]:g:s;if(c&&c(s,t,h,i),e)for(j=q(t,n),e(j,[],h,i),k=j.length;k--;)(l=j[k])&&(t[n[k]]=!(s[n[k]]=l));if(d){if(f||a){if(f){for(j=[],k=t.length;k--;)(l=t[k])&&j.push(s[k]=l);f(null,t=[],j,i)}for(k=t.length;k--;)(l=t[k])&&(j=f?aa(d,l):m[k])>-1&&(d[j]=!(g[j]=l))}}else t=q(t===g?t.splice(o,t.length):t),f?f(null,g,t,i):$.apply(g,t)})}function s(a){for(var b,c,d,e=a.length,f=w.relative[a[0].type],g=f||w.relative[" "],h=f?1:0,i=n(function(a){return a===b},g,!0),j=n(function(a){return aa(b,a)>-1},g,!0),k=[function(a,c,d){var e=!f&&(d||c!==C)||((b=c).nodeType?i(a,c,d):j(a,c,d));return b=null,e}];e>h;h++)if(c=w.relative[a[h].type])k=[n(o(k),c)];else{if(c=w.filter[a[h].type].apply(null,a[h].matches),c[N]){for(d=++h;e>d&&!w.relative[a[d].type];d++);return r(h>1&&o(k),h>1&&m(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(ia,"$1"),c,d>h&&s(a.slice(h,d)),e>d&&s(a=a.slice(d)),e>d&&m(a))}k.push(c)}return o(k)}function t(a,c){var e=c.length>0,f=a.length>0,g=function(d,g,h,i,j){var k,l,m,n=0,o="0",p=d&&[],r=[],s=C,t=d||f&&w.find.TAG("*",j),u=P+=null==s?1:Math.random()||.1,v=t.length;for(j&&(C=g!==G&&g);o!==v&&null!=(k=t[o]);o++){if(f&&k){for(l=0;m=a[l++];)if(m(k,g,h)){i.push(k);break}j&&(P=u)}e&&((k=!m&&k)&&n--,d&&p.push(k))}if(n+=o,e&&o!==n){for(l=0;m=c[l++];)m(p,r,g,h);if(d){if(n>0)for(;o--;)p[o]||r[o]||(r[o]=Y.call(i));r=q(r)}$.apply(i,r),j&&!d&&r.length>0&&n+c.length>1&&b.uniqueSort(i)}return j&&(P=u,C=s),p};return e?d(g):g}var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N="sizzle"+1*new Date,O=a.document,P=0,Q=0,R=c(),S=c(),T=c(),U=function(a,b){return a===b&&(E=!0),0},V=1<<31,W={}.hasOwnProperty,X=[],Y=X.pop,Z=X.push,$=X.push,_=X.slice,aa=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},ba="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ca="[\\x20\\t\\r\\n\\f]",da="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ea=da.replace("w","w#"),fa="\\["+ca+"*("+da+")(?:"+ca+"*([*^$|!~]?=)"+ca+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ea+"))|)"+ca+"*\\]",ga=":("+da+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+fa+")*)|.*)\\)|)",ha=new RegExp(ca+"+","g"),ia=new RegExp("^"+ca+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ca+"+$","g"),ja=new RegExp("^"+ca+"*,"+ca+"*"),ka=new RegExp("^"+ca+"*([>+~]|"+ca+")"+ca+"*"),la=new RegExp("="+ca+"*([^\\]'\"]*?)"+ca+"*\\]","g"),ma=new RegExp(ga),na=new RegExp("^"+ea+"$"),oa={ID:new RegExp("^#("+da+")"),CLASS:new RegExp("^\\.("+da+")"),TAG:new RegExp("^("+da.replace("w","w*")+")"),ATTR:new RegExp("^"+fa),PSEUDO:new RegExp("^"+ga),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ca+"*(even|odd|(([+-]|)(\\d*)n|)"+ca+"*(?:([+-]|)"+ca+"*(\\d+)|))"+ca+"*\\)|)","i"),bool:new RegExp("^(?:"+ba+")$","i"),needsContext:new RegExp("^"+ca+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ca+"*((?:-\\d)?\\d*)"+ca+"*\\)|)(?=[^-]|$)","i")},pa=/^(?:input|select|textarea|button)$/i,qa=/^h\d$/i,ra=/^[^{]+\{\s*\[native \w/,sa=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ta=/[+~]/,ua=/'|\\/g,va=new RegExp("\\\\([\\da-f]{1,6}"+ca+"?|("+ca+")|.)","ig"),wa=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},xa=function(){F()};try{$.apply(X=_.call(O.childNodes),O.childNodes),X[O.childNodes.length].nodeType}catch(ya){$={apply:X.length?function(a,b){Z.apply(a,_.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}v=b.support={},y=b.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},F=b.setDocument=function(a){var b,c,d=a?a.ownerDocument||a:O;return d!==G&&9===d.nodeType&&d.documentElement?(G=d,H=d.documentElement,c=d.defaultView,c&&c!==c.top&&(c.addEventListener?c.addEventListener("unload",xa,!1):c.attachEvent&&c.attachEvent("onunload",xa)),I=!y(d),v.attributes=e(function(a){return a.className="i",!a.getAttribute("className")}),v.getElementsByTagName=e(function(a){return a.appendChild(d.createComment("")),!a.getElementsByTagName("*").length}),v.getElementsByClassName=ra.test(d.getElementsByClassName),v.getById=e(function(a){return H.appendChild(a).id=N,!d.getElementsByName||!d.getElementsByName(N).length}),v.getById?(w.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&I){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},w.filter.ID=function(a){var b=a.replace(va,wa);return function(a){return a.getAttribute("id")===b}}):(delete w.find.ID,w.filter.ID=function(a){var b=a.replace(va,wa);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),w.find.TAG=v.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):v.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},w.find.CLASS=v.getElementsByClassName&&function(a,b){return I?b.getElementsByClassName(a):void 0},K=[],J=[],(v.qsa=ra.test(d.querySelectorAll))&&(e(function(a){H.appendChild(a).innerHTML="<a id='"+N+"'></a><select id='"+N+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&J.push("[*^$]="+ca+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||J.push("\\["+ca+"*(?:value|"+ba+")"),a.querySelectorAll("[id~="+N+"-]").length||J.push("~="),a.querySelectorAll(":checked").length||J.push(":checked"),a.querySelectorAll("a#"+N+"+*").length||J.push(".#.+[+~]")}),e(function(a){var b=d.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&J.push("name"+ca+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||J.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),J.push(",.*:")})),(v.matchesSelector=ra.test(L=H.matches||H.webkitMatchesSelector||H.mozMatchesSelector||H.oMatchesSelector||H.msMatchesSelector))&&e(function(a){v.disconnectedMatch=L.call(a,"div"),L.call(a,"[s!='']:x"),K.push("!=",ga)}),J=J.length&&new RegExp(J.join("|")),K=K.length&&new RegExp(K.join("|")),b=ra.test(H.compareDocumentPosition),M=b||ra.test(H.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},U=b?function(a,b){if(a===b)return E=!0,0;var c=!a.compareDocumentPosition-!b.compareDocumentPosition;return c?c:(c=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&c||!v.sortDetached&&b.compareDocumentPosition(a)===c?a===d||a.ownerDocument===O&&M(O,a)?-1:b===d||b.ownerDocument===O&&M(O,b)?1:D?aa(D,a)-aa(D,b):0:4&c?-1:1)}:function(a,b){if(a===b)return E=!0,0;var c,e=0,f=a.parentNode,h=b.parentNode,i=[a],j=[b];if(!f||!h)return a===d?-1:b===d?1:f?-1:h?1:D?aa(D,a)-aa(D,b):0;if(f===h)return g(a,b);for(c=a;c=c.parentNode;)i.unshift(c);for(c=b;c=c.parentNode;)j.unshift(c);for(;i[e]===j[e];)e++;return e?g(i[e],j[e]):i[e]===O?-1:j[e]===O?1:0},d):G},b.matches=function(a,c){return b(a,null,null,c)},b.matchesSelector=function(a,c){if((a.ownerDocument||a)!==G&&F(a),c=c.replace(la,"='$1']"),v.matchesSelector&&I&&(!K||!K.test(c))&&(!J||!J.test(c)))try{var d=L.call(a,c);if(d||v.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return b(c,G,null,[a]).length>0},b.contains=function(a,b){return(a.ownerDocument||a)!==G&&F(a),
M(a,b)},b.attr=function(a,b){(a.ownerDocument||a)!==G&&F(a);var c=w.attrHandle[b.toLowerCase()],d=c&&W.call(w.attrHandle,b.toLowerCase())?c(a,b,!I):void 0;return void 0!==d?d:v.attributes||!I?a.getAttribute(b):(d=a.getAttributeNode(b))&&d.specified?d.value:null},b.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},b.uniqueSort=function(a){var b,c=[],d=0,e=0;if(E=!v.detectDuplicates,D=!v.sortStable&&a.slice(0),a.sort(U),E){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return D=null,a},x=b.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=x(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d++];)c+=x(b);return c},w=b.selectors={cacheLength:50,createPseudo:d,match:oa,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(va,wa),a[3]=(a[3]||a[4]||a[5]||"").replace(va,wa),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||b.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&b.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return oa.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&ma.test(c)&&(b=z(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(va,wa).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=R[a+" "];return b||(b=new RegExp("(^|"+ca+")"+a+"("+ca+"|$)"))&&R(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,c,d){return function(e){var f=b.attr(e,a);return null==f?"!="===c:c?(f+="","="===c?f===d:"!="===c?f!==d:"^="===c?d&&0===f.indexOf(d):"*="===c?d&&f.indexOf(d)>-1:"$="===c?d&&f.slice(-d.length)===d:"~="===c?(" "+f.replace(ha," ")+" ").indexOf(d)>-1:"|="===c?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[N]||(q[N]={}),j=k[a]||[],n=j[0]===P&&j[1],m=j[0]===P&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[P,n,m];break}}else if(s&&(j=(b[N]||(b[N]={}))[a])&&j[0]===P)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[N]||(l[N]={}))[a]=[P,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,c){var e,f=w.pseudos[a]||w.setFilters[a.toLowerCase()]||b.error("unsupported pseudo: "+a);return f[N]?f(c):f.length>1?(e=[a,a,"",c],w.setFilters.hasOwnProperty(a.toLowerCase())?d(function(a,b){for(var d,e=f(a,c),g=e.length;g--;)d=aa(a,e[g]),a[d]=!(b[d]=e[g])}):function(a){return f(a,0,e)}):f}},pseudos:{not:d(function(a){var b=[],c=[],e=A(a.replace(ia,"$1"));return e[N]?d(function(a,b,c,d){for(var f,g=e(a,null,d,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,d,f){return b[0]=a,e(b,null,f,c),b[0]=null,!c.pop()}}),has:d(function(a){return function(c){return b(a,c).length>0}}),contains:d(function(a){return a=a.replace(va,wa),function(b){return(b.textContent||b.innerText||x(b)).indexOf(a)>-1}}),lang:d(function(a){return na.test(a||"")||b.error("unsupported lang: "+a),a=a.replace(va,wa).toLowerCase(),function(b){var c;do if(c=I?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===H},focus:function(a){return a===G.activeElement&&(!G.hasFocus||G.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!w.pseudos.empty(a)},header:function(a){return qa.test(a.nodeName)},input:function(a){return pa.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:j(function(){return[0]}),last:j(function(a,b){return[b-1]}),eq:j(function(a,b,c){return[0>c?c+b:c]}),even:j(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:j(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:j(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:j(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},w.pseudos.nth=w.pseudos.eq;for(u in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[u]=h(u);for(u in{submit:!0,reset:!0})w.pseudos[u]=i(u);return l.prototype=w.filters=w.pseudos,w.setFilters=new l,z=b.tokenize=function(a,c){var d,e,f,g,h,i,j,k=S[a+" "];if(k)return c?0:k.slice(0);for(h=a,i=[],j=w.preFilter;h;){d&&!(e=ja.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=ka.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(ia," ")}),h=h.slice(d.length));for(g in w.filter)!(e=oa[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return c?h.length:h?b.error(a):S(a,i).slice(0)},A=b.compile=function(a,b){var c,d=[],e=[],f=T[a+" "];if(!f){for(b||(b=z(a)),c=b.length;c--;)f=s(b[c]),f[N]?d.push(f):e.push(f);f=T(a,t(e,d)),f.selector=a}return f},B=b.select=function(a,b,c,d){var e,f,g,h,i,j="function"==typeof a&&a,l=!d&&z(a=j.selector||a);if(c=c||[],1===l.length){if(f=l[0]=l[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&v.getById&&9===b.nodeType&&I&&w.relative[f[1].type]){if(b=(w.find.ID(g.matches[0].replace(va,wa),b)||[])[0],!b)return c;j&&(b=b.parentNode),a=a.slice(f.shift().value.length)}for(e=oa.needsContext.test(a)?0:f.length;e--&&(g=f[e],!w.relative[h=g.type]);)if((i=w.find[h])&&(d=i(g.matches[0].replace(va,wa),ta.test(f[0].type)&&k(b.parentNode)||b))){if(f.splice(e,1),a=d.length&&m(f),!a)return $.apply(c,d),c;break}}return(j||A(a,l))(d,b,!I,c,ta.test(a)&&k(b.parentNode)||b),c},v.sortStable=N.split("").sort(U).join("")===N,v.detectDuplicates=!!E,F(),v.sortDetached=e(function(a){return 1&a.compareDocumentPosition(G.createElement("div"))}),e(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||f("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),v.attributes&&e(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||f("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),e(function(a){return null==a.getAttribute("disabled")})||f(ba,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),b}(a);_.find=ea,_.expr=ea.selectors,_.expr[":"]=_.expr.pseudos,_.unique=ea.uniqueSort,_.text=ea.getText,_.isXMLDoc=ea.isXML,_.contains=ea.contains;var fa=_.expr.match.needsContext,ga=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ha=/^.[^:#\[\.,]*$/;_.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?_.find.matchesSelector(d,a)?[d]:[]:_.find.matches(a,_.grep(b,function(a){return 1===a.nodeType}))},_.fn.extend({find:function(a){var b,c=this.length,d=[],e=this;if("string"!=typeof a)return this.pushStack(_(a).filter(function(){for(b=0;c>b;b++)if(_.contains(e[b],this))return!0}));for(b=0;c>b;b++)_.find(a,e[b],d);return d=this.pushStack(c>1?_.unique(d):d),d.selector=this.selector?this.selector+" "+a:a,d},filter:function(a){return this.pushStack(d(this,a||[],!1))},not:function(a){return this.pushStack(d(this,a||[],!0))},is:function(a){return!!d(this,"string"==typeof a&&fa.test(a)?_(a):a||[],!1).length}});var ia,ja=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ka=_.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a[0]&&">"===a[a.length-1]&&a.length>=3?[null,a,null]:ja.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||ia).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof _?b[0]:b,_.merge(this,_.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:Z,!0)),ga.test(c[1])&&_.isPlainObject(b))for(c in b)_.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}return d=Z.getElementById(c[2]),d&&d.parentNode&&(this.length=1,this[0]=d),this.context=Z,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):_.isFunction(a)?"undefined"!=typeof ia.ready?ia.ready(a):a(_):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),_.makeArray(a,this))};ka.prototype=_.fn,ia=_(Z);var la=/^(?:parents|prev(?:Until|All))/,ma={children:!0,contents:!0,next:!0,prev:!0};_.extend({dir:function(a,b,c){for(var d=[],e=void 0!==c;(a=a[b])&&9!==a.nodeType;)if(1===a.nodeType){if(e&&_(a).is(c))break;d.push(a)}return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),_.fn.extend({has:function(a){var b=_(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(_.contains(this,b[a]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=fa.test(a)||"string"!=typeof a?_(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&_.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?_.unique(f):f)},index:function(a){return a?"string"==typeof a?U.call(_(a),this[0]):U.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(_.unique(_.merge(this.get(),_(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),_.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return _.dir(a,"parentNode")},parentsUntil:function(a,b,c){return _.dir(a,"parentNode",c)},next:function(a){return e(a,"nextSibling")},prev:function(a){return e(a,"previousSibling")},nextAll:function(a){return _.dir(a,"nextSibling")},prevAll:function(a){return _.dir(a,"previousSibling")},nextUntil:function(a,b,c){return _.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return _.dir(a,"previousSibling",c)},siblings:function(a){return _.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return _.sibling(a.firstChild)},contents:function(a){return a.contentDocument||_.merge([],a.childNodes)}},function(a,b){_.fn[a]=function(c,d){var e=_.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=_.filter(d,e)),this.length>1&&(ma[a]||_.unique(e),la.test(a)&&e.reverse()),this.pushStack(e)}});var na=/\S+/g,oa={};_.Callbacks=function(a){a="string"==typeof a?oa[a]||f(a):_.extend({},a);var b,c,d,e,g,h,i=[],j=!a.once&&[],k=function(f){for(b=a.memory&&f,c=!0,h=e||0,e=0,g=i.length,d=!0;i&&g>h;h++)if(i[h].apply(f[0],f[1])===!1&&a.stopOnFalse){b=!1;break}d=!1,i&&(j?j.length&&k(j.shift()):b?i=[]:l.disable())},l={add:function(){if(i){var c=i.length;!function f(b){_.each(b,function(b,c){var d=_.type(c);"function"===d?a.unique&&l.has(c)||i.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),d?g=i.length:b&&(e=c,k(b))}return this},remove:function(){return i&&_.each(arguments,function(a,b){for(var c;(c=_.inArray(b,i,c))>-1;)i.splice(c,1),d&&(g>=c&&g--,h>=c&&h--)}),this},has:function(a){return a?_.inArray(a,i)>-1:!(!i||!i.length)},empty:function(){return i=[],g=0,this},disable:function(){return i=j=b=void 0,this},disabled:function(){return!i},lock:function(){return j=void 0,b||l.disable(),this},locked:function(){return!j},fireWith:function(a,b){return!i||c&&!j||(b=b||[],b=[a,b.slice?b.slice():b],d?j.push(b):k(b)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!c}};return l},_.extend({Deferred:function(a){var b=[["resolve","done",_.Callbacks("once memory"),"resolved"],["reject","fail",_.Callbacks("once memory"),"rejected"],["notify","progress",_.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return _.Deferred(function(c){_.each(b,function(b,f){var g=_.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&_.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?_.extend(a,d):d}},e={};return d.pipe=d.then,_.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=R.call(arguments),g=f.length,h=1!==g||a&&_.isFunction(a.promise)?g:0,i=1===h?a:_.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?R.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&_.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}});var pa;_.fn.ready=function(a){return _.ready.promise().done(a),this},_.extend({isReady:!1,readyWait:1,holdReady:function(a){a?_.readyWait++:_.ready(!0)},ready:function(a){(a===!0?--_.readyWait:_.isReady)||(_.isReady=!0,a!==!0&&--_.readyWait>0||(pa.resolveWith(Z,[_]),_.fn.triggerHandler&&(_(Z).triggerHandler("ready"),_(Z).off("ready"))))}}),_.ready.promise=function(b){return pa||(pa=_.Deferred(),"complete"===Z.readyState?setTimeout(_.ready):(Z.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1))),pa.promise(b)},_.ready.promise();var qa=_.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===_.type(c)){e=!0;for(h in c)_.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,_.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(_(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f};_.acceptData=function(a){return 1===a.nodeType||9===a.nodeType||!+a.nodeType},h.uid=1,h.accepts=_.acceptData,h.prototype={key:function(a){if(!h.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=h.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,_.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(_.isEmptyObject(f))_.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,b){var c=this.cache[this.key(a)];return void 0===b?c:c[b]},access:function(a,b,c){var d;return void 0===b||b&&"string"==typeof b&&void 0===c?(d=this.get(a,b),void 0!==d?d:this.get(a,_.camelCase(b))):(this.set(a,b,c),void 0!==c?c:b)},remove:function(a,b){var c,d,e,f=this.key(a),g=this.cache[f];if(void 0===b)this.cache[f]={};else{_.isArray(b)?d=b.concat(b.map(_.camelCase)):(e=_.camelCase(b),b in g?d=[b,e]:(d=e,d=d in g?[d]:d.match(na)||[])),c=d.length;for(;c--;)delete g[d[c]]}},hasData:function(a){return!_.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}};var ra=new h,sa=new h,ta=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ua=/([A-Z])/g;_.extend({hasData:function(a){return sa.hasData(a)||ra.hasData(a)},data:function(a,b,c){return sa.access(a,b,c)},removeData:function(a,b){sa.remove(a,b)},_data:function(a,b,c){return ra.access(a,b,c)},_removeData:function(a,b){ra.remove(a,b)}}),_.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=sa.get(f),1===f.nodeType&&!ra.get(f,"hasDataAttrs"))){for(c=g.length;c--;)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=_.camelCase(d.slice(5)),i(f,d,e[d])));ra.set(f,"hasDataAttrs",!0)}return e}return"object"==typeof a?this.each(function(){sa.set(this,a)}):qa(this,function(b){var c,d=_.camelCase(a);if(f&&void 0===b){if(c=sa.get(f,a),void 0!==c)return c;if(c=sa.get(f,d),void 0!==c)return c;if(c=i(f,d,void 0),void 0!==c)return c}else this.each(function(){var c=sa.get(this,d);sa.set(this,d,b),-1!==a.indexOf("-")&&void 0!==c&&sa.set(this,a,b)})},null,b,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){sa.remove(this,a)})}}),_.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=ra.get(a,b),c&&(!d||_.isArray(c)?d=ra.access(a,b,_.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=_.queue(a,b),d=c.length,e=c.shift(),f=_._queueHooks(a,b),g=function(){_.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return ra.get(a,c)||ra.access(a,c,{empty:_.Callbacks("once memory").add(function(){ra.remove(a,[b+"queue",c])})})}}),_.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?_.queue(this[0],a):void 0===b?this:this.each(function(){var c=_.queue(this,a,b);_._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&_.dequeue(this,a)})},dequeue:function(a){return this.each(function(){_.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=_.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};for("string"!=typeof a&&(b=a,a=void 0),a=a||"fx";g--;)c=ra.get(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var va=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,wa=["Top","Right","Bottom","Left"],xa=function(a,b){return a=b||a,"none"===_.css(a,"display")||!_.contains(a.ownerDocument,a)},ya=/^(?:checkbox|radio)$/i;!function(){var a=Z.createDocumentFragment(),b=a.appendChild(Z.createElement("div")),c=Z.createElement("input");c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),b.appendChild(c),Y.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,b.innerHTML="<textarea>x</textarea>",Y.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var za="undefined";Y.focusinBubbles="onfocusin"in a;var Aa=/^key/,Ba=/^(?:mouse|pointer|contextmenu)|click/,Ca=/^(?:focusinfocus|focusoutblur)$/,Da=/^([^.]*)(?:\.(.+)|)$/;_.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=ra.get(a);if(q)for(c.handler&&(f=c,c=f.handler,e=f.selector),c.guid||(c.guid=_.guid++),(i=q.events)||(i=q.events={}),(g=q.handle)||(g=q.handle=function(b){return typeof _!==za&&_.event.triggered!==b.type?_.event.dispatch.apply(a,arguments):void 0}),b=(b||"").match(na)||[""],j=b.length;j--;)h=Da.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n&&(l=_.event.special[n]||{},n=(e?l.delegateType:l.bindType)||n,l=_.event.special[n]||{},k=_.extend({type:n,origType:p,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&_.expr.match.needsContext.test(e),namespace:o.join(".")},f),(m=i[n])||(m=i[n]=[],m.delegateCount=0,l.setup&&l.setup.call(a,d,o,g)!==!1||a.addEventListener&&a.addEventListener(n,g,!1)),l.add&&(l.add.call(a,k),k.handler.guid||(k.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,k):m.push(k),_.event.global[n]=!0)},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=ra.hasData(a)&&ra.get(a);if(q&&(i=q.events)){for(b=(b||"").match(na)||[""],j=b.length;j--;)if(h=Da.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=_.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||_.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)_.event.remove(a,n+b[j],c,d,!0);_.isEmptyObject(i)&&(delete q.handle,ra.remove(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,j,k,l,m=[d||Z],n=X.call(b,"type")?b.type:b,o=X.call(b,"namespace")?b.namespace.split("."):[];if(g=h=d=d||Z,3!==d.nodeType&&8!==d.nodeType&&!Ca.test(n+_.event.triggered)&&(n.indexOf(".")>=0&&(o=n.split("."),n=o.shift(),o.sort()),j=n.indexOf(":")<0&&"on"+n,b=b[_.expando]?b:new _.Event(n,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=o.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:_.makeArray(c,[b]),l=_.event.special[n]||{},e||!l.trigger||l.trigger.apply(d,c)!==!1)){if(!e&&!l.noBubble&&!_.isWindow(d)){for(i=l.delegateType||n,Ca.test(i+n)||(g=g.parentNode);g;g=g.parentNode)m.push(g),h=g;h===(d.ownerDocument||Z)&&m.push(h.defaultView||h.parentWindow||a)}for(f=0;(g=m[f++])&&!b.isPropagationStopped();)b.type=f>1?i:l.bindType||n,k=(ra.get(g,"events")||{})[b.type]&&ra.get(g,"handle"),k&&k.apply(g,c),k=j&&g[j],k&&k.apply&&_.acceptData(g)&&(b.result=k.apply(g,c),b.result===!1&&b.preventDefault());return b.type=n,e||b.isDefaultPrevented()||l._default&&l._default.apply(m.pop(),c)!==!1||!_.acceptData(d)||j&&_.isFunction(d[n])&&!_.isWindow(d)&&(h=d[j],h&&(d[j]=null),_.event.triggered=n,d[n](),_.event.triggered=void 0,h&&(d[j]=h)),b.result}},dispatch:function(a){a=_.event.fix(a);var b,c,d,e,f,g=[],h=R.call(arguments),i=(ra.get(this,"events")||{})[a.type]||[],j=_.event.special[a.type]||{};if(h[0]=a,a.delegateTarget=this,!j.preDispatch||j.preDispatch.call(this,a)!==!1){for(g=_.event.handlers.call(this,a,i),b=0;(e=g[b++])&&!a.isPropagationStopped();)for(a.currentTarget=e.elem,c=0;(f=e.handlers[c++])&&!a.isImmediatePropagationStopped();)a.namespace_re&&!a.namespace_re.test(f.namespace)||(a.handleObj=f,a.data=f.data,d=((_.event.special[f.origType]||{}).handle||f.handler).apply(e.elem,h),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()));return j.postDispatch&&j.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!==this;i=i.parentNode||this)if(i.disabled!==!0||"click"!==a.type){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?_(e,this).index(i)>=0:_.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button;return null==a.pageX&&null!=b.clientX&&(c=a.target.ownerDocument||Z,d=c.documentElement,e=c.body,a.pageX=b.clientX+(d&&d.scrollLeft||e&&e.scrollLeft||0)-(d&&d.clientLeft||e&&e.clientLeft||0),a.pageY=b.clientY+(d&&d.scrollTop||e&&e.scrollTop||0)-(d&&d.clientTop||e&&e.clientTop||0)),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},fix:function(a){if(a[_.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=Ba.test(e)?this.mouseHooks:Aa.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new _.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=Z),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==l()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===l()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&_.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return _.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=_.extend(new _.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?_.event.trigger(e,null,b):_.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},_.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},_.Event=function(a,b){return this instanceof _.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?j:k):this.type=a,b&&_.extend(this,b),this.timeStamp=a&&a.timeStamp||_.now(),void(this[_.expando]=!0)):new _.Event(a,b)},_.Event.prototype={isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=j,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=j,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=j,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},_.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){_.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||_.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),Y.focusinBubbles||_.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){_.event.simulate(b,a.target,_.event.fix(a),!0)};_.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=ra.access(d,b);e||d.addEventListener(a,c,!0),ra.access(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=ra.access(d,b)-1;e?ra.access(d,b,e):(d.removeEventListener(a,c,!0),ra.remove(d,b))}}}),_.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(g in a)this.on(g,b,c,a[g],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=k;else if(!d)return this;return 1===e&&(f=d,d=function(a){return _().off(a),f.apply(this,arguments)},d.guid=f.guid||(f.guid=_.guid++)),this.each(function(){_.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,_(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=k),this.each(function(){_.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){_.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?_.event.trigger(a,b,c,!0):void 0}});var Ea=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Fa=/<([\w:]+)/,Ga=/<|&#?\w+;/,Ha=/<(?:script|style|link)/i,Ia=/checked\s*(?:[^=]|=\s*.checked.)/i,Ja=/^$|\/(?:java|ecma)script/i,Ka=/^true\/(.*)/,La=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ma={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ma.optgroup=Ma.option,Ma.tbody=Ma.tfoot=Ma.colgroup=Ma.caption=Ma.thead,Ma.th=Ma.td,_.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=_.contains(a.ownerDocument,a);if(!(Y.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||_.isXMLDoc(a)))for(g=r(h),f=r(a),d=0,e=f.length;e>d;d++)s(f[d],g[d]);if(b)if(c)for(f=f||r(a),g=g||r(h),d=0,e=f.length;e>d;d++)q(f[d],g[d]);else q(a,h);return g=r(h,"script"),g.length>0&&p(g,!i&&r(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=b.createDocumentFragment(),l=[],m=0,n=a.length;n>m;m++)if(e=a[m],e||0===e)if("object"===_.type(e))_.merge(l,e.nodeType?[e]:e);else if(Ga.test(e)){for(f=f||k.appendChild(b.createElement("div")),g=(Fa.exec(e)||["",""])[1].toLowerCase(),h=Ma[g]||Ma._default,f.innerHTML=h[1]+e.replace(Ea,"<$1></$2>")+h[2],j=h[0];j--;)f=f.lastChild;_.merge(l,f.childNodes),f=k.firstChild,f.textContent=""}else l.push(b.createTextNode(e));for(k.textContent="",m=0;e=l[m++];)if((!d||-1===_.inArray(e,d))&&(i=_.contains(e.ownerDocument,e),f=r(k.appendChild(e),"script"),i&&p(f),c))for(j=0;e=f[j++];)Ja.test(e.type||"")&&c.push(e);return k},cleanData:function(a){for(var b,c,d,e,f=_.event.special,g=0;void 0!==(c=a[g]);g++){if(_.acceptData(c)&&(e=c[ra.expando],e&&(b=ra.cache[e]))){if(b.events)for(d in b.events)f[d]?_.event.remove(c,d):_.removeEvent(c,d,b.handle);ra.cache[e]&&delete ra.cache[e]}delete sa.cache[c[sa.expando]]}}}),_.fn.extend({text:function(a){return qa(this,function(a){return void 0===a?_.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=a)})},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=m(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?_.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||_.cleanData(r(c)),c.parentNode&&(b&&_.contains(c.ownerDocument,c)&&p(r(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(_.cleanData(r(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return _.clone(this,a,b)})},html:function(a){return qa(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a&&1===b.nodeType)return b.innerHTML;if("string"==typeof a&&!Ha.test(a)&&!Ma[(Fa.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Ea,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(_.cleanData(r(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,_.cleanData(r(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=S.apply([],a);var c,d,e,f,g,h,i=0,j=this.length,k=this,l=j-1,m=a[0],p=_.isFunction(m);if(p||j>1&&"string"==typeof m&&!Y.checkClone&&Ia.test(m))return this.each(function(c){
var d=k.eq(c);p&&(a[0]=m.call(this,c,d.html())),d.domManip(a,b)});if(j&&(c=_.buildFragment(a,this[0].ownerDocument,!1,this),d=c.firstChild,1===c.childNodes.length&&(c=d),d)){for(e=_.map(r(c,"script"),n),f=e.length;j>i;i++)g=c,i!==l&&(g=_.clone(g,!0,!0),f&&_.merge(e,r(g,"script"))),b.call(this[i],g,i);if(f)for(h=e[e.length-1].ownerDocument,_.map(e,o),i=0;f>i;i++)g=e[i],Ja.test(g.type||"")&&!ra.access(g,"globalEval")&&_.contains(h,g)&&(g.src?_._evalUrl&&_._evalUrl(g.src):_.globalEval(g.textContent.replace(La,"")))}return this}}),_.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){_.fn[a]=function(a){for(var c,d=[],e=_(a),f=e.length-1,g=0;f>=g;g++)c=g===f?this:this.clone(!0),_(e[g])[b](c),T.apply(d,c.get());return this.pushStack(d)}});var Na,Oa={},Pa=/^margin/,Qa=new RegExp("^("+va+")(?!px)[a-z%]+$","i"),Ra=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)};!function(){function b(){g.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",g.innerHTML="",e.appendChild(f);var b=a.getComputedStyle(g,null);c="1%"!==b.top,d="4px"===b.width,e.removeChild(f)}var c,d,e=Z.documentElement,f=Z.createElement("div"),g=Z.createElement("div");g.style&&(g.style.backgroundClip="content-box",g.cloneNode(!0).style.backgroundClip="",Y.clearCloneStyle="content-box"===g.style.backgroundClip,f.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",f.appendChild(g),a.getComputedStyle&&_.extend(Y,{pixelPosition:function(){return b(),c},boxSizingReliable:function(){return null==d&&b(),d},reliableMarginRight:function(){var b,c=g.appendChild(Z.createElement("div"));return c.style.cssText=g.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",c.style.marginRight=c.style.width="0",g.style.width="1px",e.appendChild(f),b=!parseFloat(a.getComputedStyle(c,null).marginRight),e.removeChild(f),g.removeChild(c),b}}))}(),_.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Sa=/^(none|table(?!-c[ea]).+)/,Ta=new RegExp("^("+va+")(.*)$","i"),Ua=new RegExp("^([+-])=("+va+")","i"),Va={position:"absolute",visibility:"hidden",display:"block"},Wa={letterSpacing:"0",fontWeight:"400"},Xa=["Webkit","O","Moz","ms"];_.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=v(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=_.camelCase(b),i=a.style;return b=_.cssProps[h]||(_.cssProps[h]=x(i,h)),g=_.cssHooks[b]||_.cssHooks[h],void 0===c?g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b]:(f=typeof c,"string"===f&&(e=Ua.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(_.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||_.cssNumber[h]||(c+="px"),Y.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),g&&"set"in g&&void 0===(c=g.set(a,c,d))||(i[b]=c)),void 0)}},css:function(a,b,c,d){var e,f,g,h=_.camelCase(b);return b=_.cssProps[h]||(_.cssProps[h]=x(a.style,h)),g=_.cssHooks[b]||_.cssHooks[h],g&&"get"in g&&(e=g.get(a,!0,c)),void 0===e&&(e=v(a,b,d)),"normal"===e&&b in Wa&&(e=Wa[b]),""===c||c?(f=parseFloat(e),c===!0||_.isNumeric(f)?f||0:e):e}}),_.each(["height","width"],function(a,b){_.cssHooks[b]={get:function(a,c,d){return c?Sa.test(_.css(a,"display"))&&0===a.offsetWidth?_.swap(a,Va,function(){return A(a,b,d)}):A(a,b,d):void 0},set:function(a,c,d){var e=d&&Ra(a);return y(a,c,d?z(a,b,d,"border-box"===_.css(a,"boxSizing",!1,e),e):0)}}}),_.cssHooks.marginRight=w(Y.reliableMarginRight,function(a,b){return b?_.swap(a,{display:"inline-block"},v,[a,"marginRight"]):void 0}),_.each({margin:"",padding:"",border:"Width"},function(a,b){_.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+wa[d]+b]=f[d]||f[d-2]||f[0];return e}},Pa.test(a)||(_.cssHooks[a+b].set=y)}),_.fn.extend({css:function(a,b){return qa(this,function(a,b,c){var d,e,f={},g=0;if(_.isArray(b)){for(d=Ra(a),e=b.length;e>g;g++)f[b[g]]=_.css(a,b[g],!1,d);return f}return void 0!==c?_.style(a,b,c):_.css(a,b)},a,b,arguments.length>1)},show:function(){return B(this,!0)},hide:function(){return B(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){xa(this)?_(this).show():_(this).hide()})}}),_.Tween=C,C.prototype={constructor:C,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(_.cssNumber[c]?"":"px")},cur:function(){var a=C.propHooks[this.prop];return a&&a.get?a.get(this):C.propHooks._default.get(this)},run:function(a){var b,c=C.propHooks[this.prop];return this.options.duration?this.pos=b=_.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):C.propHooks._default.set(this),this}},C.prototype.init.prototype=C.prototype,C.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=_.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){_.fx.step[a.prop]?_.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[_.cssProps[a.prop]]||_.cssHooks[a.prop])?_.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},C.propHooks.scrollTop=C.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},_.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},_.fx=C.prototype.init,_.fx.step={};var Ya,Za,$a=/^(?:toggle|show|hide)$/,_a=new RegExp("^(?:([+-])=|)("+va+")([a-z%]*)$","i"),ab=/queueHooks$/,bb=[G],cb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=_a.exec(b),f=e&&e[3]||(_.cssNumber[a]?"":"px"),g=(_.cssNumber[a]||"px"!==f&&+d)&&_a.exec(_.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,_.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};_.Animation=_.extend(I,{tweener:function(a,b){_.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],cb[c]=cb[c]||[],cb[c].unshift(b)},prefilter:function(a,b){b?bb.unshift(a):bb.push(a)}}),_.speed=function(a,b,c){var d=a&&"object"==typeof a?_.extend({},a):{complete:c||!c&&b||_.isFunction(a)&&a,duration:a,easing:c&&b||b&&!_.isFunction(b)&&b};return d.duration=_.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in _.fx.speeds?_.fx.speeds[d.duration]:_.fx.speeds._default,null!=d.queue&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){_.isFunction(d.old)&&d.old.call(this),d.queue&&_.dequeue(this,d.queue)},d},_.fn.extend({fadeTo:function(a,b,c,d){return this.filter(xa).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=_.isEmptyObject(a),f=_.speed(b,c,d),g=function(){var b=I(this,_.extend({},a),f);(e||ra.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=_.timers,g=ra.get(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&ab.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||_.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=ra.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=_.timers,g=d?d.length:0;for(c.finish=!0,_.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),_.each(["toggle","show","hide"],function(a,b){var c=_.fn[b];_.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(E(b,!0),a,d,e)}}),_.each({slideDown:E("show"),slideUp:E("hide"),slideToggle:E("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){_.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),_.timers=[],_.fx.tick=function(){var a,b=0,c=_.timers;for(Ya=_.now();b<c.length;b++)a=c[b],a()||c[b]!==a||c.splice(b--,1);c.length||_.fx.stop(),Ya=void 0},_.fx.timer=function(a){_.timers.push(a),a()?_.fx.start():_.timers.pop()},_.fx.interval=13,_.fx.start=function(){Za||(Za=setInterval(_.fx.tick,_.fx.interval))},_.fx.stop=function(){clearInterval(Za),Za=null},_.fx.speeds={slow:600,fast:200,_default:400},_.fn.delay=function(a,b){return a=_.fx?_.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a=Z.createElement("input"),b=Z.createElement("select"),c=b.appendChild(Z.createElement("option"));a.type="checkbox",Y.checkOn=""!==a.value,Y.optSelected=c.selected,b.disabled=!0,Y.optDisabled=!c.disabled,a=Z.createElement("input"),a.value="t",a.type="radio",Y.radioValue="t"===a.value}();var db,eb,fb=_.expr.attrHandle;_.fn.extend({attr:function(a,b){return qa(this,_.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){_.removeAttr(this,a)})}}),_.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===za?_.prop(a,b,c):(1===f&&_.isXMLDoc(a)||(b=b.toLowerCase(),d=_.attrHooks[b]||(_.expr.match.bool.test(b)?eb:db)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=_.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void _.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(na);if(f&&1===a.nodeType)for(;c=f[e++];)d=_.propFix[c]||c,_.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!Y.radioValue&&"radio"===b&&_.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),eb={set:function(a,b,c){return b===!1?_.removeAttr(a,c):a.setAttribute(c,c),c}},_.each(_.expr.match.bool.source.match(/\w+/g),function(a,b){var c=fb[b]||_.find.attr;fb[b]=function(a,b,d){var e,f;return d||(f=fb[b],fb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,fb[b]=f),e}});var gb=/^(?:input|select|textarea|button)$/i;_.fn.extend({prop:function(a,b){return qa(this,_.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[_.propFix[a]||a]})}}),_.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!_.isXMLDoc(a),f&&(b=_.propFix[b]||b,e=_.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||gb.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),Y.optSelected||(_.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),_.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){_.propFix[this.toLowerCase()]=this});var hb=/[\t\r\n\f]/g;_.fn.extend({addClass:function(a){var b,c,d,e,f,g,h="string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).addClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(na)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hb," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=_.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0===arguments.length||"string"==typeof a&&a,i=0,j=this.length;if(_.isFunction(a))return this.each(function(b){_(this).removeClass(a.call(this,b,this.className))});if(h)for(b=(a||"").match(na)||[];j>i;i++)if(c=this[i],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(hb," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");g=a?_.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):_.isFunction(a)?this.each(function(c){_(this).toggleClass(a.call(this,c,this.className,b),b)}):this.each(function(){if("string"===c)for(var b,d=0,e=_(this),f=a.match(na)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else c!==za&&"boolean"!==c||(this.className&&ra.set(this,"__className__",this.className),this.className=this.className||a===!1?"":ra.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(hb," ").indexOf(b)>=0)return!0;return!1}});var ib=/\r/g;_.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=_.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,_(this).val()):a,null==e?e="":"number"==typeof e?e+="":_.isArray(e)&&(e=_.map(e,function(a){return null==a?"":a+""})),b=_.valHooks[this.type]||_.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=_.valHooks[e.type]||_.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(ib,""):null==c?"":c)}}}),_.extend({valHooks:{option:{get:function(a){var b=_.find.attr(a,"value");return null!=b?b:_.trim(_.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&(Y.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!_.nodeName(c.parentNode,"optgroup"))){if(b=_(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=_.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=_.inArray(d.value,f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}}}),_.each(["radio","checkbox"],function(){_.valHooks[this]={set:function(a,b){return _.isArray(b)?a.checked=_.inArray(_(a).val(),b)>=0:void 0}},Y.checkOn||(_.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})}),_.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){_.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),_.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var jb=_.now(),kb=/\?/;_.parseJSON=function(a){return JSON.parse(a+"")},_.parseXML=function(a){var b,c;if(!a||"string"!=typeof a)return null;try{c=new DOMParser,b=c.parseFromString(a,"text/xml")}catch(d){b=void 0}return b&&!b.getElementsByTagName("parsererror").length||_.error("Invalid XML: "+a),b};var lb=/#.*$/,mb=/([?&])_=[^&]*/,nb=/^(.*?):[ \t]*([^\r\n]*)$/gm,ob=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,pb=/^(?:GET|HEAD)$/,qb=/^\/\//,rb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,sb={},tb={},ub="*/".concat("*"),vb=a.location.href,wb=rb.exec(vb.toLowerCase())||[];_.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:vb,type:"GET",isLocal:ob.test(wb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":ub,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":_.parseJSON,"text xml":_.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?L(L(a,_.ajaxSettings),b):L(_.ajaxSettings,a)},ajaxPrefilter:J(sb),ajaxTransport:J(tb),ajax:function(a,b){function c(a,b,c,g){var i,k,r,s,u,w=b;2!==t&&(t=2,h&&clearTimeout(h),d=void 0,f=g||"",v.readyState=a>0?4:0,i=a>=200&&300>a||304===a,c&&(s=M(l,v,c)),s=N(l,s,v,i),i?(l.ifModified&&(u=v.getResponseHeader("Last-Modified"),u&&(_.lastModified[e]=u),u=v.getResponseHeader("etag"),u&&(_.etag[e]=u)),204===a||"HEAD"===l.type?w="nocontent":304===a?w="notmodified":(w=s.state,k=s.data,r=s.error,i=!r)):(r=w,!a&&w||(w="error",0>a&&(a=0))),v.status=a,v.statusText=(b||w)+"",i?o.resolveWith(m,[k,w,v]):o.rejectWith(m,[v,w,r]),v.statusCode(q),q=void 0,j&&n.trigger(i?"ajaxSuccess":"ajaxError",[v,l,i?k:r]),p.fireWith(m,[v,w]),j&&(n.trigger("ajaxComplete",[v,l]),--_.active||_.event.trigger("ajaxStop")))}"object"==typeof a&&(b=a,a=void 0),b=b||{};var d,e,f,g,h,i,j,k,l=_.ajaxSetup({},b),m=l.context||l,n=l.context&&(m.nodeType||m.jquery)?_(m):_.event,o=_.Deferred(),p=_.Callbacks("once memory"),q=l.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!g)for(g={};b=nb.exec(f);)g[b[1].toLowerCase()]=b[2];b=g[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return d&&d.abort(b),c(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,l.url=((a||l.url||vb)+"").replace(lb,"").replace(qb,wb[1]+"//"),l.type=b.method||b.type||l.method||l.type,l.dataTypes=_.trim(l.dataType||"*").toLowerCase().match(na)||[""],null==l.crossDomain&&(i=rb.exec(l.url.toLowerCase()),l.crossDomain=!(!i||i[1]===wb[1]&&i[2]===wb[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(wb[3]||("http:"===wb[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=_.param(l.data,l.traditional)),K(sb,l,b,v),2===t)return v;j=_.event&&l.global,j&&0===_.active++&&_.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!pb.test(l.type),e=l.url,l.hasContent||(l.data&&(e=l.url+=(kb.test(e)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=mb.test(e)?e.replace(mb,"$1_="+jb++):e+(kb.test(e)?"&":"?")+"_="+jb++)),l.ifModified&&(_.lastModified[e]&&v.setRequestHeader("If-Modified-Since",_.lastModified[e]),_.etag[e]&&v.setRequestHeader("If-None-Match",_.etag[e])),(l.data&&l.hasContent&&l.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",l.contentType),v.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+ub+"; q=0.01":""):l.accepts["*"]);for(k in l.headers)v.setRequestHeader(k,l.headers[k]);if(l.beforeSend&&(l.beforeSend.call(m,v,l)===!1||2===t))return v.abort();u="abort";for(k in{success:1,error:1,complete:1})v[k](l[k]);if(d=K(tb,l,b,v)){v.readyState=1,j&&n.trigger("ajaxSend",[v,l]),l.async&&l.timeout>0&&(h=setTimeout(function(){v.abort("timeout")},l.timeout));try{t=1,d.send(r,c)}catch(w){if(!(2>t))throw w;c(-1,w)}}else c(-1,"No Transport");return v},getJSON:function(a,b,c){return _.get(a,b,c,"json")},getScript:function(a,b){return _.get(a,void 0,b,"script")}}),_.each(["get","post"],function(a,b){_[b]=function(a,c,d,e){return _.isFunction(c)&&(e=e||d,d=c,c=void 0),_.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),_._evalUrl=function(a){return _.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},_.fn.extend({wrapAll:function(a){var b;return _.isFunction(a)?this.each(function(b){_(this).wrapAll(a.call(this,b))}):(this[0]&&(b=_(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return _.isFunction(a)?this.each(function(b){_(this).wrapInner(a.call(this,b))}):this.each(function(){var b=_(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=_.isFunction(a);return this.each(function(c){_(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){_.nodeName(this,"body")||_(this).replaceWith(this.childNodes)}).end()}}),_.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},_.expr.filters.visible=function(a){return!_.expr.filters.hidden(a)};var xb=/%20/g,yb=/\[\]$/,zb=/\r?\n/g,Ab=/^(?:submit|button|image|reset|file)$/i,Bb=/^(?:input|select|textarea|keygen)/i;_.param=function(a,b){var c,d=[],e=function(a,b){b=_.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=_.ajaxSettings&&_.ajaxSettings.traditional),_.isArray(a)||a.jquery&&!_.isPlainObject(a))_.each(a,function(){e(this.name,this.value)});else for(c in a)O(c,a[c],b,e);return d.join("&").replace(xb,"+")},_.fn.extend({serialize:function(){return _.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=_.prop(this,"elements");return a?_.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!_(this).is(":disabled")&&Bb.test(this.nodeName)&&!Ab.test(a)&&(this.checked||!ya.test(a))}).map(function(a,b){var c=_(this).val();return null==c?null:_.isArray(c)?_.map(c,function(a){return{name:b.name,value:a.replace(zb,"\r\n")}}):{name:b.name,value:c.replace(zb,"\r\n")}}).get()}}),_.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var Cb=0,Db={},Eb={0:200,1223:204},Fb=_.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Db)Db[a]()}),Y.cors=!!Fb&&"withCredentials"in Fb,Y.ajax=Fb=!!Fb,_.ajaxTransport(function(a){var b;return Y.cors||Fb&&!a.crossDomain?{send:function(c,d){var e,f=a.xhr(),g=++Cb;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)f.setRequestHeader(e,c[e]);b=function(a){return function(){b&&(delete Db[g],b=f.onload=f.onerror=null,"abort"===a?f.abort():"error"===a?d(f.status,f.statusText):d(Eb[f.status]||f.status,f.statusText,"string"==typeof f.responseText?{text:f.responseText}:void 0,f.getAllResponseHeaders()))}},f.onload=b(),f.onerror=b("error"),b=Db[g]=b("abort");try{f.send(a.hasContent&&a.data||null)}catch(h){if(b)throw h}},abort:function(){b&&b()}}:void 0}),_.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return _.globalEval(a),a}}}),_.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),_.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=_("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),Z.head.appendChild(b[0])},abort:function(){c&&c()}}}});var Gb=[],Hb=/(=)\?(?=&|$)|\?\?/;_.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=Gb.pop()||_.expando+"_"+jb++;return this[a]=!0,a}}),_.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(Hb.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&Hb.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=_.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(Hb,"$1"+e):b.jsonp!==!1&&(b.url+=(kb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||_.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,Gb.push(e)),g&&_.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),_.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||Z;var d=ga.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=_.buildFragment([a],b,e),e&&e.length&&_(e).remove(),_.merge([],d.childNodes))};var Ib=_.fn.load;_.fn.load=function(a,b,c){if("string"!=typeof a&&Ib)return Ib.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=_.trim(a.slice(h)),a=a.slice(0,h)),_.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&_.ajax({url:a,type:e,dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?_("<div>").append(_.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,f||[a.responseText,b,a])}),this},_.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){_.fn[b]=function(a){return this.on(b,a)}}),_.expr.filters.animated=function(a){return _.grep(_.timers,function(b){return a===b.elem}).length};var Jb=a.document.documentElement;_.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=_.css(a,"position"),l=_(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=_.css(a,"top"),i=_.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),_.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},_.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){_.offset.setOffset(this,a,b)});var b,c,d=this[0],e={top:0,left:0},f=d&&d.ownerDocument;if(f)return b=f.documentElement,_.contains(b,d)?(typeof d.getBoundingClientRect!==za&&(e=d.getBoundingClientRect()),c=P(f),{top:e.top+c.pageYOffset-b.clientTop,left:e.left+c.pageXOffset-b.clientLeft}):e},position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===_.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),_.nodeName(a[0],"html")||(d=a.offset()),d.top+=_.css(a[0],"borderTopWidth",!0),d.left+=_.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-_.css(c,"marginTop",!0),left:b.left-d.left-_.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||Jb;a&&!_.nodeName(a,"html")&&"static"===_.css(a,"position");)a=a.offsetParent;return a||Jb})}}),_.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,c){var d="pageYOffset"===c;_.fn[b]=function(e){return qa(this,function(b,e,f){var g=P(b);return void 0===f?g?g[c]:b[e]:void(g?g.scrollTo(d?a.pageXOffset:f,d?f:a.pageYOffset):b[e]=f)},b,e,arguments.length,null)}}),_.each(["top","left"],function(a,b){_.cssHooks[b]=w(Y.pixelPosition,function(a,c){return c?(c=v(a,b),Qa.test(c)?_(a).position()[b]+"px":c):void 0})}),_.each({Height:"height",Width:"width"},function(a,b){_.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){_.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return qa(this,function(b,c,d){var e;return _.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?_.css(b,c,g):_.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),_.fn.size=function(){return this.length},_.fn.andSelf=_.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return _});var Kb=a.jQuery,Lb=a.$;return _.noConflict=function(b){return a.$===_&&(a.$=Lb),b&&a.jQuery===_&&(a.jQuery=Kb),_},typeof b===za&&(a.jQuery=a.$=_),_})},{}],58:[function(a,b,c){!function(a,c,d){var e=a.L,f={};f.version="0.7.2","object"==typeof b&&"object"==typeof b.exports?b.exports=f:"function"==typeof define&&define.amd&&define(f),f.noConflict=function(){return a.L=e,this},a.L=f,f.Util={extend:function(a){var b,c,d,e,f=Array.prototype.slice.call(arguments,1);for(c=0,d=f.length;d>c;c++){e=f[c]||{};for(b in e)e.hasOwnProperty(b)&&(a[b]=e[b])}return a},bind:function(a,b){var c=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return a.apply(b,c||arguments)}},stamp:function(){var a=0,b="_leaflet_id";return function(c){return c[b]=c[b]||++a,c[b]}}(),invokeEach:function(a,b,c){var d,e;if("object"==typeof a){e=Array.prototype.slice.call(arguments,3);for(d in a)b.apply(c,[d,a[d]].concat(e));return!0}return!1},limitExecByInterval:function(a,b,c){var d,e;return function f(){var g=arguments;return d?void(e=!0):(d=!0,setTimeout(function(){d=!1,e&&(f.apply(c,g),e=!1)},b),void a.apply(c,g))}},falseFn:function(){return!1},formatNum:function(a,b){var c=Math.pow(10,b||5);return Math.round(a*c)/c},trim:function(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},splitWords:function(a){return f.Util.trim(a).split(/\s+/)},setOptions:function(a,b){return a.options=f.extend({},a.options,b),a.options},getParamString:function(a,b,c){var d=[];for(var e in a)d.push(encodeURIComponent(c?e.toUpperCase():e)+"="+encodeURIComponent(a[e]));return(b&&-1!==b.indexOf("?")?"&":"?")+d.join("&")},template:function(a,b){return a.replace(/\{ *([\w_]+) *\}/g,function(a,c){var e=b[c];if(e===d)throw new Error("No value provided for variable "+a);return"function"==typeof e&&(e=e(b)),e})},isArray:Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function b(b){var c,d,e=["webkit","moz","o","ms"];for(c=0;c<e.length&&!d;c++)d=a[e[c]+b];return d}function c(b){var c=+new Date,e=Math.max(0,16-(c-d));return d=c+e,a.setTimeout(b,e)}var d=0,e=a.requestAnimationFrame||b("RequestAnimationFrame")||c,g=a.cancelAnimationFrame||b("CancelAnimationFrame")||b("CancelRequestAnimationFrame")||function(b){a.clearTimeout(b)};f.Util.requestAnimFrame=function(b,d,g,h){return b=f.bind(b,d),g&&e===c?void b():e.call(a,b,h)},f.Util.cancelAnimFrame=function(b){b&&g.call(a,b)}}(),f.extend=f.Util.extend,f.bind=f.Util.bind,f.stamp=f.Util.stamp,f.setOptions=f.Util.setOptions,f.Class=function(){},f.Class.extend=function(a){var b=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},c=function(){};c.prototype=this.prototype;var d=new c;d.constructor=b,b.prototype=d;for(var e in this)this.hasOwnProperty(e)&&"prototype"!==e&&(b[e]=this[e]);a.statics&&(f.extend(b,a.statics),delete a.statics),a.includes&&(f.Util.extend.apply(null,[d].concat(a.includes)),delete a.includes),a.options&&d.options&&(a.options=f.extend({},d.options,a.options)),f.extend(d,a),d._initHooks=[];var g=this;return b.__super__=g.prototype,d.callInitHooks=function(){if(!this._initHooksCalled){g.prototype.callInitHooks&&g.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var a=0,b=d._initHooks.length;b>a;a++)d._initHooks[a].call(this)}},b},f.Class.include=function(a){f.extend(this.prototype,a)},f.Class.mergeOptions=function(a){f.extend(this.prototype.options,a)},f.Class.addInitHook=function(a){var b=Array.prototype.slice.call(arguments,1),c="function"==typeof a?a:function(){this[a].apply(this,b)};this.prototype._initHooks=this.prototype._initHooks||[],
this.prototype._initHooks.push(c)};var g="_leaflet_events";f.Mixin={},f.Mixin.Events={addEventListener:function(a,b,c){if(f.Util.invokeEach(a,this.addEventListener,this,b,c))return this;var d,e,h,i,j,k,l,m=this[g]=this[g]||{},n=c&&c!==this&&f.stamp(c);for(a=f.Util.splitWords(a),d=0,e=a.length;e>d;d++)h={action:b,context:c||this},i=a[d],n?(j=i+"_idx",k=j+"_len",l=m[j]=m[j]||{},l[n]||(l[n]=[],m[k]=(m[k]||0)+1),l[n].push(h)):(m[i]=m[i]||[],m[i].push(h));return this},hasEventListeners:function(a){var b=this[g];return!!b&&(a in b&&b[a].length>0||a+"_idx"in b&&b[a+"_idx_len"]>0)},removeEventListener:function(a,b,c){if(!this[g])return this;if(!a)return this.clearAllEventListeners();if(f.Util.invokeEach(a,this.removeEventListener,this,b,c))return this;var d,e,h,i,j,k,l,m,n,o=this[g],p=c&&c!==this&&f.stamp(c);for(a=f.Util.splitWords(a),d=0,e=a.length;e>d;d++)if(h=a[d],k=h+"_idx",l=k+"_len",m=o[k],b){if(i=p&&m?m[p]:o[h]){for(j=i.length-1;j>=0;j--)i[j].action!==b||c&&i[j].context!==c||(n=i.splice(j,1),n[0].action=f.Util.falseFn);c&&m&&0===i.length&&(delete m[p],o[l]--)}}else delete o[h],delete o[k],delete o[l];return this},clearAllEventListeners:function(){return delete this[g],this},fireEvent:function(a,b){if(!this.hasEventListeners(a))return this;var c,d,e,h,i,j=f.Util.extend({},b,{type:a,target:this}),k=this[g];if(k[a])for(c=k[a].slice(),d=0,e=c.length;e>d;d++)c[d].action.call(c[d].context,j);h=k[a+"_idx"];for(i in h)if(c=h[i].slice())for(d=0,e=c.length;e>d;d++)c[d].action.call(c[d].context,j);return this},addOneTimeEventListener:function(a,b,c){if(f.Util.invokeEach(a,this.addOneTimeEventListener,this,b,c))return this;var d=f.bind(function(){this.removeEventListener(a,b,c).removeEventListener(a,d,c)},this);return this.addEventListener(a,b,c).addEventListener(a,d,c)}},f.Mixin.Events.on=f.Mixin.Events.addEventListener,f.Mixin.Events.off=f.Mixin.Events.removeEventListener,f.Mixin.Events.once=f.Mixin.Events.addOneTimeEventListener,f.Mixin.Events.fire=f.Mixin.Events.fireEvent,function(){var b="ActiveXObject"in a,e=b&&!c.addEventListener,g=navigator.userAgent.toLowerCase(),h=-1!==g.indexOf("webkit"),i=-1!==g.indexOf("chrome"),j=-1!==g.indexOf("phantom"),k=-1!==g.indexOf("android"),l=-1!==g.search("android [23]"),m=-1!==g.indexOf("gecko"),n=typeof orientation!=d+"",o=a.navigator&&a.navigator.msPointerEnabled&&a.navigator.msMaxTouchPoints&&!a.PointerEvent,p=a.PointerEvent&&a.navigator.pointerEnabled&&a.navigator.maxTouchPoints||o,q="devicePixelRatio"in a&&a.devicePixelRatio>1||"matchMedia"in a&&a.matchMedia("(min-resolution:144dpi)")&&a.matchMedia("(min-resolution:144dpi)").matches,r=c.documentElement,s=b&&"transition"in r.style,t="WebKitCSSMatrix"in a&&"m11"in new a.WebKitCSSMatrix&&!l,u="MozPerspective"in r.style,v="OTransition"in r.style,w=!a.L_DISABLE_3D&&(s||t||u||v)&&!j,x=!a.L_NO_TOUCH&&!j&&function(){var a="ontouchstart";if(p||a in r)return!0;var b=c.createElement("div"),d=!1;return b.setAttribute?(b.setAttribute(a,"return;"),"function"==typeof b[a]&&(d=!0),b.removeAttribute(a),b=null,d):!1}();f.Browser={ie:b,ielt9:e,webkit:h,gecko:m&&!h&&!a.opera&&!b,android:k,android23:l,chrome:i,ie3d:s,webkit3d:t,gecko3d:u,opera3d:v,any3d:w,mobile:n,mobileWebkit:n&&h,mobileWebkit3d:n&&t,mobileOpera:n&&a.opera,touch:x,msPointer:o,pointer:p,retina:q}}(),f.Point=function(a,b,c){this.x=c?Math.round(a):a,this.y=c?Math.round(b):b},f.Point.prototype={clone:function(){return new f.Point(this.x,this.y)},add:function(a){return this.clone()._add(f.point(a))},_add:function(a){return this.x+=a.x,this.y+=a.y,this},subtract:function(a){return this.clone()._subtract(f.point(a))},_subtract:function(a){return this.x-=a.x,this.y-=a.y,this},divideBy:function(a){return this.clone()._divideBy(a)},_divideBy:function(a){return this.x/=a,this.y/=a,this},multiplyBy:function(a){return this.clone()._multiplyBy(a)},_multiplyBy:function(a){return this.x*=a,this.y*=a,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},distanceTo:function(a){a=f.point(a);var b=a.x-this.x,c=a.y-this.y;return Math.sqrt(b*b+c*c)},equals:function(a){return a=f.point(a),a.x===this.x&&a.y===this.y},contains:function(a){return a=f.point(a),Math.abs(a.x)<=Math.abs(this.x)&&Math.abs(a.y)<=Math.abs(this.y)},toString:function(){return"Point("+f.Util.formatNum(this.x)+", "+f.Util.formatNum(this.y)+")"}},f.point=function(a,b,c){return a instanceof f.Point?a:f.Util.isArray(a)?new f.Point(a[0],a[1]):a===d||null===a?a:new f.Point(a,b,c)},f.Bounds=function(a,b){if(a)for(var c=b?[a,b]:a,d=0,e=c.length;e>d;d++)this.extend(c[d])},f.Bounds.prototype={extend:function(a){return a=f.point(a),this.min||this.max?(this.min.x=Math.min(a.x,this.min.x),this.max.x=Math.max(a.x,this.max.x),this.min.y=Math.min(a.y,this.min.y),this.max.y=Math.max(a.y,this.max.y)):(this.min=a.clone(),this.max=a.clone()),this},getCenter:function(a){return new f.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,a)},getBottomLeft:function(){return new f.Point(this.min.x,this.max.y)},getTopRight:function(){return new f.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(a){var b,c;return a="number"==typeof a[0]||a instanceof f.Point?f.point(a):f.bounds(a),a instanceof f.Bounds?(b=a.min,c=a.max):b=c=a,b.x>=this.min.x&&c.x<=this.max.x&&b.y>=this.min.y&&c.y<=this.max.y},intersects:function(a){a=f.bounds(a);var b=this.min,c=this.max,d=a.min,e=a.max,g=e.x>=b.x&&d.x<=c.x,h=e.y>=b.y&&d.y<=c.y;return g&&h},isValid:function(){return!(!this.min||!this.max)}},f.bounds=function(a,b){return!a||a instanceof f.Bounds?a:new f.Bounds(a,b)},f.Transformation=function(a,b,c,d){this._a=a,this._b=b,this._c=c,this._d=d},f.Transformation.prototype={transform:function(a,b){return this._transform(a.clone(),b)},_transform:function(a,b){return b=b||1,a.x=b*(this._a*a.x+this._b),a.y=b*(this._c*a.y+this._d),a},untransform:function(a,b){return b=b||1,new f.Point((a.x/b-this._b)/this._a,(a.y/b-this._d)/this._c)}},f.DomUtil={get:function(a){return"string"==typeof a?c.getElementById(a):a},getStyle:function(a,b){var d=a.style[b];if(!d&&a.currentStyle&&(d=a.currentStyle[b]),(!d||"auto"===d)&&c.defaultView){var e=c.defaultView.getComputedStyle(a,null);d=e?e[b]:null}return"auto"===d?null:d},getViewportOffset:function(a){var b,d=0,e=0,g=a,h=c.body,i=c.documentElement;do{if(d+=g.offsetTop||0,e+=g.offsetLeft||0,d+=parseInt(f.DomUtil.getStyle(g,"borderTopWidth"),10)||0,e+=parseInt(f.DomUtil.getStyle(g,"borderLeftWidth"),10)||0,b=f.DomUtil.getStyle(g,"position"),g.offsetParent===h&&"absolute"===b)break;if("fixed"===b){d+=h.scrollTop||i.scrollTop||0,e+=h.scrollLeft||i.scrollLeft||0;break}if("relative"===b&&!g.offsetLeft){var j=f.DomUtil.getStyle(g,"width"),k=f.DomUtil.getStyle(g,"max-width"),l=g.getBoundingClientRect();"none"===j&&"none"===k||(e+=l.left+g.clientLeft),d+=l.top+(h.scrollTop||i.scrollTop||0);break}g=g.offsetParent}while(g);g=a;do{if(g===h)break;d-=g.scrollTop||0,e-=g.scrollLeft||0,g=g.parentNode}while(g);return new f.Point(e,d)},documentIsLtr:function(){return f.DomUtil._docIsLtrCached||(f.DomUtil._docIsLtrCached=!0,f.DomUtil._docIsLtr="ltr"===f.DomUtil.getStyle(c.body,"direction")),f.DomUtil._docIsLtr},create:function(a,b,d){var e=c.createElement(a);return e.className=b,d&&d.appendChild(e),e},hasClass:function(a,b){if(a.classList!==d)return a.classList.contains(b);var c=f.DomUtil._getClass(a);return c.length>0&&new RegExp("(^|\\s)"+b+"(\\s|$)").test(c)},addClass:function(a,b){if(a.classList!==d)for(var c=f.Util.splitWords(b),e=0,g=c.length;g>e;e++)a.classList.add(c[e]);else if(!f.DomUtil.hasClass(a,b)){var h=f.DomUtil._getClass(a);f.DomUtil._setClass(a,(h?h+" ":"")+b)}},removeClass:function(a,b){a.classList!==d?a.classList.remove(b):f.DomUtil._setClass(a,f.Util.trim((" "+f.DomUtil._getClass(a)+" ").replace(" "+b+" "," ")))},_setClass:function(a,b){a.className.baseVal===d?a.className=b:a.className.baseVal=b},_getClass:function(a){return a.className.baseVal===d?a.className:a.className.baseVal},setOpacity:function(a,b){if("opacity"in a.style)a.style.opacity=b;else if("filter"in a.style){var c=!1,d="DXImageTransform.Microsoft.Alpha";try{c=a.filters.item(d)}catch(e){if(1===b)return}b=Math.round(100*b),c?(c.Enabled=100!==b,c.Opacity=b):a.style.filter+=" progid:"+d+"(opacity="+b+")"}},testProp:function(a){for(var b=c.documentElement.style,d=0;d<a.length;d++)if(a[d]in b)return a[d];return!1},getTranslateString:function(a){var b=f.Browser.webkit3d,c="translate"+(b?"3d":"")+"(",d=(b?",0":"")+")";return c+a.x+"px,"+a.y+"px"+d},getScaleString:function(a,b){var c=f.DomUtil.getTranslateString(b.add(b.multiplyBy(-1*a))),d=" scale("+a+") ";return c+d},setPosition:function(a,b,c){a._leaflet_pos=b,!c&&f.Browser.any3d?a.style[f.DomUtil.TRANSFORM]=f.DomUtil.getTranslateString(b):(a.style.left=b.x+"px",a.style.top=b.y+"px")},getPosition:function(a){return a._leaflet_pos}},f.DomUtil.TRANSFORM=f.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),f.DomUtil.TRANSITION=f.DomUtil.testProp(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),f.DomUtil.TRANSITION_END="webkitTransition"===f.DomUtil.TRANSITION||"OTransition"===f.DomUtil.TRANSITION?f.DomUtil.TRANSITION+"End":"transitionend",function(){if("onselectstart"in c)f.extend(f.DomUtil,{disableTextSelection:function(){f.DomEvent.on(a,"selectstart",f.DomEvent.preventDefault)},enableTextSelection:function(){f.DomEvent.off(a,"selectstart",f.DomEvent.preventDefault)}});else{var b=f.DomUtil.testProp(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);f.extend(f.DomUtil,{disableTextSelection:function(){if(b){var a=c.documentElement.style;this._userSelect=a[b],a[b]="none"}},enableTextSelection:function(){b&&(c.documentElement.style[b]=this._userSelect,delete this._userSelect)}})}f.extend(f.DomUtil,{disableImageDrag:function(){f.DomEvent.on(a,"dragstart",f.DomEvent.preventDefault)},enableImageDrag:function(){f.DomEvent.off(a,"dragstart",f.DomEvent.preventDefault)}})}(),f.LatLng=function(a,b,c){if(a=parseFloat(a),b=parseFloat(b),isNaN(a)||isNaN(b))throw new Error("Invalid LatLng object: ("+a+", "+b+")");this.lat=a,this.lng=b,c!==d&&(this.alt=parseFloat(c))},f.extend(f.LatLng,{DEG_TO_RAD:Math.PI/180,RAD_TO_DEG:180/Math.PI,MAX_MARGIN:1e-9}),f.LatLng.prototype={equals:function(a){if(!a)return!1;a=f.latLng(a);var b=Math.max(Math.abs(this.lat-a.lat),Math.abs(this.lng-a.lng));return b<=f.LatLng.MAX_MARGIN},toString:function(a){return"LatLng("+f.Util.formatNum(this.lat,a)+", "+f.Util.formatNum(this.lng,a)+")"},distanceTo:function(a){a=f.latLng(a);var b=6378137,c=f.LatLng.DEG_TO_RAD,d=(a.lat-this.lat)*c,e=(a.lng-this.lng)*c,g=this.lat*c,h=a.lat*c,i=Math.sin(d/2),j=Math.sin(e/2),k=i*i+j*j*Math.cos(g)*Math.cos(h);return 2*b*Math.atan2(Math.sqrt(k),Math.sqrt(1-k))},wrap:function(a,b){var c=this.lng;return a=a||-180,b=b||180,c=(c+b)%(b-a)+(a>c||c===b?b:a),new f.LatLng(this.lat,c)}},f.latLng=function(a,b){return a instanceof f.LatLng?a:f.Util.isArray(a)?"number"==typeof a[0]||"string"==typeof a[0]?new f.LatLng(a[0],a[1],a[2]):null:a===d||null===a?a:"object"==typeof a&&"lat"in a?new f.LatLng(a.lat,"lng"in a?a.lng:a.lon):b===d?null:new f.LatLng(a,b)},f.LatLngBounds=function(a,b){if(a)for(var c=b?[a,b]:a,d=0,e=c.length;e>d;d++)this.extend(c[d])},f.LatLngBounds.prototype={extend:function(a){if(!a)return this;var b=f.latLng(a);return a=null!==b?b:f.latLngBounds(a),a instanceof f.LatLng?this._southWest||this._northEast?(this._southWest.lat=Math.min(a.lat,this._southWest.lat),this._southWest.lng=Math.min(a.lng,this._southWest.lng),this._northEast.lat=Math.max(a.lat,this._northEast.lat),this._northEast.lng=Math.max(a.lng,this._northEast.lng)):(this._southWest=new f.LatLng(a.lat,a.lng),this._northEast=new f.LatLng(a.lat,a.lng)):a instanceof f.LatLngBounds&&(this.extend(a._southWest),this.extend(a._northEast)),this},pad:function(a){var b=this._southWest,c=this._northEast,d=Math.abs(b.lat-c.lat)*a,e=Math.abs(b.lng-c.lng)*a;return new f.LatLngBounds(new f.LatLng(b.lat-d,b.lng-e),new f.LatLng(c.lat+d,c.lng+e))},getCenter:function(){return new f.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new f.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new f.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(a){a="number"==typeof a[0]||a instanceof f.LatLng?f.latLng(a):f.latLngBounds(a);var b,c,d=this._southWest,e=this._northEast;return a instanceof f.LatLngBounds?(b=a.getSouthWest(),c=a.getNorthEast()):b=c=a,b.lat>=d.lat&&c.lat<=e.lat&&b.lng>=d.lng&&c.lng<=e.lng},intersects:function(a){a=f.latLngBounds(a);var b=this._southWest,c=this._northEast,d=a.getSouthWest(),e=a.getNorthEast(),g=e.lat>=b.lat&&d.lat<=c.lat,h=e.lng>=b.lng&&d.lng<=c.lng;return g&&h},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(a){return a?(a=f.latLngBounds(a),this._southWest.equals(a.getSouthWest())&&this._northEast.equals(a.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},f.latLngBounds=function(a,b){return!a||a instanceof f.LatLngBounds?a:new f.LatLngBounds(a,b)},f.Projection={},f.Projection.SphericalMercator={MAX_LATITUDE:85.0511287798,project:function(a){var b=f.LatLng.DEG_TO_RAD,c=this.MAX_LATITUDE,d=Math.max(Math.min(c,a.lat),-c),e=a.lng*b,g=d*b;return g=Math.log(Math.tan(Math.PI/4+g/2)),new f.Point(e,g)},unproject:function(a){var b=f.LatLng.RAD_TO_DEG,c=a.x*b,d=(2*Math.atan(Math.exp(a.y))-Math.PI/2)*b;return new f.LatLng(d,c)}},f.Projection.LonLat={project:function(a){return new f.Point(a.lng,a.lat)},unproject:function(a){return new f.LatLng(a.y,a.x)}},f.CRS={latLngToPoint:function(a,b){var c=this.projection.project(a),d=this.scale(b);return this.transformation._transform(c,d)},pointToLatLng:function(a,b){var c=this.scale(b),d=this.transformation.untransform(a,c);return this.projection.unproject(d)},project:function(a){return this.projection.project(a)},scale:function(a){return 256*Math.pow(2,a)},getSize:function(a){var b=this.scale(a);return f.point(b,b)}},f.CRS.Simple=f.extend({},f.CRS,{projection:f.Projection.LonLat,transformation:new f.Transformation(1,0,-1,0),scale:function(a){return Math.pow(2,a)}}),f.CRS.EPSG3857=f.extend({},f.CRS,{code:"EPSG:3857",projection:f.Projection.SphericalMercator,transformation:new f.Transformation(.5/Math.PI,.5,-.5/Math.PI,.5),project:function(a){var b=this.projection.project(a),c=6378137;return b.multiplyBy(c)}}),f.CRS.EPSG900913=f.extend({},f.CRS.EPSG3857,{code:"EPSG:900913"}),f.CRS.EPSG4326=f.extend({},f.CRS,{code:"EPSG:4326",projection:f.Projection.LonLat,transformation:new f.Transformation(1/360,.5,-1/360,.5)}),f.Map=f.Class.extend({includes:f.Mixin.Events,options:{crs:f.CRS.EPSG3857,fadeAnimation:f.DomUtil.TRANSITION&&!f.Browser.android23,trackResize:!0,markerZoomAnimation:f.DomUtil.TRANSITION&&f.Browser.any3d},initialize:function(a,b){b=f.setOptions(this,b),this._initContainer(a),this._initLayout(),this._onResize=f.bind(this._onResize,this),this._initEvents(),b.maxBounds&&this.setMaxBounds(b.maxBounds),b.center&&b.zoom!==d&&this.setView(f.latLng(b.center),b.zoom,{reset:!0}),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._tileLayersNum=0,this.callInitHooks(),this._addLayers(b.layers)},setView:function(a,b){return b=b===d?this.getZoom():b,this._resetView(f.latLng(a),this._limitZoom(b)),this},setZoom:function(a,b){return this._loaded?this.setView(this.getCenter(),a,{zoom:b}):(this._zoom=this._limitZoom(a),this)},zoomIn:function(a,b){return this.setZoom(this._zoom+(a||1),b)},zoomOut:function(a,b){return this.setZoom(this._zoom-(a||1),b)},setZoomAround:function(a,b,c){var d=this.getZoomScale(b),e=this.getSize().divideBy(2),g=a instanceof f.Point?a:this.latLngToContainerPoint(a),h=g.subtract(e).multiplyBy(1-1/d),i=this.containerPointToLatLng(e.add(h));return this.setView(i,b,{zoom:c})},fitBounds:function(a,b){b=b||{},a=a.getBounds?a.getBounds():f.latLngBounds(a);var c=f.point(b.paddingTopLeft||b.padding||[0,0]),d=f.point(b.paddingBottomRight||b.padding||[0,0]),e=this.getBoundsZoom(a,!1,c.add(d)),g=d.subtract(c).divideBy(2),h=this.project(a.getSouthWest(),e),i=this.project(a.getNorthEast(),e),j=this.unproject(h.add(i).divideBy(2).add(g),e);return e=b&&b.maxZoom?Math.min(b.maxZoom,e):e,this.setView(j,e,b)},fitWorld:function(a){return this.fitBounds([[-90,-180],[90,180]],a)},panTo:function(a,b){return this.setView(a,this._zoom,{pan:b})},panBy:function(a){return this.fire("movestart"),this._rawPanBy(f.point(a)),this.fire("move"),this.fire("moveend")},setMaxBounds:function(a){return a=f.latLngBounds(a),this.options.maxBounds=a,a?(this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds,this)):this.off("moveend",this._panInsideMaxBounds,this)},panInsideBounds:function(a,b){var c=this.getCenter(),d=this._limitCenter(c,this._zoom,a);return c.equals(d)?this:this.panTo(d,b)},addLayer:function(a){var b=f.stamp(a);return this._layers[b]?this:(this._layers[b]=a,!a.options||isNaN(a.options.maxZoom)&&isNaN(a.options.minZoom)||(this._zoomBoundLayers[b]=a,this._updateZoomLevels()),this.options.zoomAnimation&&f.TileLayer&&a instanceof f.TileLayer&&(this._tileLayersNum++,this._tileLayersToLoad++,a.on("load",this._onTileLayerLoad,this)),this._loaded&&this._layerAdd(a),this)},removeLayer:function(a){var b=f.stamp(a);return this._layers[b]?(this._loaded&&a.onRemove(this),delete this._layers[b],this._loaded&&this.fire("layerremove",{layer:a}),this._zoomBoundLayers[b]&&(delete this._zoomBoundLayers[b],this._updateZoomLevels()),this.options.zoomAnimation&&f.TileLayer&&a instanceof f.TileLayer&&(this._tileLayersNum--,this._tileLayersToLoad--,a.off("load",this._onTileLayerLoad,this)),this):this},hasLayer:function(a){return a?f.stamp(a)in this._layers:!1},eachLayer:function(a,b){for(var c in this._layers)a.call(b,this._layers[c]);return this},invalidateSize:function(a){if(!this._loaded)return this;a=f.extend({animate:!1,pan:!0},a===!0?{animate:!0}:a);var b=this.getSize();this._sizeChanged=!0,this._initialCenter=null;var c=this.getSize(),d=b.divideBy(2).round(),e=c.divideBy(2).round(),g=d.subtract(e);return g.x||g.y?(a.animate&&a.pan?this.panBy(g):(a.pan&&this._rawPanBy(g),this.fire("move"),a.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(f.bind(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:b,newSize:c})):this},addHandler:function(a,b){if(!b)return this;var c=this[a]=new b(this);return this._handlers.push(c),this.options[a]&&c.enable(),this},remove:function(){this._loaded&&this.fire("unload"),this._initEvents("off");try{delete this._container._leaflet}catch(a){this._container._leaflet=d}return this._clearPanes(),this._clearControlPos&&this._clearControlPos(),this._clearHandlers(),this},getCenter:function(){return this._checkIfLoaded(),this._initialCenter&&!this._moved()?this._initialCenter:this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var a=this.getPixelBounds(),b=this.unproject(a.getBottomLeft()),c=this.unproject(a.getTopRight());return new f.LatLngBounds(b,c)},getMinZoom:function(){return this.options.minZoom===d?this._layersMinZoom===d?0:this._layersMinZoom:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===d?this._layersMaxZoom===d?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(a,b,c){a=f.latLngBounds(a);var d,e=this.getMinZoom()-(b?1:0),g=this.getMaxZoom(),h=this.getSize(),i=a.getNorthWest(),j=a.getSouthEast(),k=!0;c=f.point(c||[0,0]);do e++,d=this.project(j,e).subtract(this.project(i,e)).add(c),k=b?d.x<h.x||d.y<h.y:h.contains(d);while(k&&g>=e);return k&&b?null:b?e:e-1},getSize:function(){return this._size&&!this._sizeChanged||(this._size=new f.Point(this._container.clientWidth,this._container.clientHeight),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(){var a=this._getTopLeftPoint();return new f.Bounds(a,a.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._initialTopLeftPoint},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(a){var b=this.options.crs;return b.scale(a)/b.scale(this._zoom)},getScaleZoom:function(a){return this._zoom+Math.log(a)/Math.LN2},project:function(a,b){return b=b===d?this._zoom:b,this.options.crs.latLngToPoint(f.latLng(a),b)},unproject:function(a,b){return b=b===d?this._zoom:b,this.options.crs.pointToLatLng(f.point(a),b)},layerPointToLatLng:function(a){var b=f.point(a).add(this.getPixelOrigin());return this.unproject(b)},latLngToLayerPoint:function(a){var b=this.project(f.latLng(a))._round();return b._subtract(this.getPixelOrigin())},containerPointToLayerPoint:function(a){return f.point(a).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(a){return f.point(a).add(this._getMapPanePos())},containerPointToLatLng:function(a){var b=this.containerPointToLayerPoint(f.point(a));return this.layerPointToLatLng(b)},latLngToContainerPoint:function(a){return this.layerPointToContainerPoint(this.latLngToLayerPoint(f.latLng(a)))},mouseEventToContainerPoint:function(a){return f.DomEvent.getMousePosition(a,this._container)},mouseEventToLayerPoint:function(a){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(a))},mouseEventToLatLng:function(a){return this.layerPointToLatLng(this.mouseEventToLayerPoint(a))},_initContainer:function(a){var b=this._container=f.DomUtil.get(a);if(!b)throw new Error("Map container not found.");if(b._leaflet)throw new Error("Map container is already initialized.");b._leaflet=!0},_initLayout:function(){var a=this._container;f.DomUtil.addClass(a,"leaflet-container"+(f.Browser.touch?" leaflet-touch":"")+(f.Browser.retina?" leaflet-retina":"")+(f.Browser.ielt9?" leaflet-oldie":"")+(this.options.fadeAnimation?" leaflet-fade-anim":""));var b=f.DomUtil.getStyle(a,"position");"absolute"!==b&&"relative"!==b&&"fixed"!==b&&(a.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var a=this._panes={};this._mapPane=a.mapPane=this._createPane("leaflet-map-pane",this._container),this._tilePane=a.tilePane=this._createPane("leaflet-tile-pane",this._mapPane),a.objectsPane=this._createPane("leaflet-objects-pane",this._mapPane),a.shadowPane=this._createPane("leaflet-shadow-pane"),a.overlayPane=this._createPane("leaflet-overlay-pane"),a.markerPane=this._createPane("leaflet-marker-pane"),a.popupPane=this._createPane("leaflet-popup-pane");var b=" leaflet-zoom-hide";this.options.markerZoomAnimation||(f.DomUtil.addClass(a.markerPane,b),f.DomUtil.addClass(a.shadowPane,b),f.DomUtil.addClass(a.popupPane,b))},_createPane:function(a,b){return f.DomUtil.create("div",a,b||this._panes.objectsPane)},_clearPanes:function(){this._container.removeChild(this._mapPane)},_addLayers:function(a){a=a?f.Util.isArray(a)?a:[a]:[];for(var b=0,c=a.length;c>b;b++)this.addLayer(a[b])},_resetView:function(a,b,c,d){var e=this._zoom!==b;d||(this.fire("movestart"),e&&this.fire("zoomstart")),this._zoom=b,this._initialCenter=a,this._initialTopLeftPoint=this._getNewTopLeftPoint(a),c?this._initialTopLeftPoint._add(this._getMapPanePos()):f.DomUtil.setPosition(this._mapPane,new f.Point(0,0)),this._tileLayersToLoad=this._tileLayersNum;var g=!this._loaded;this._loaded=!0,this.fire("viewreset",{hard:!c}),g&&(this.fire("load"),this.eachLayer(this._layerAdd,this)),this.fire("move"),(e||d)&&this.fire("zoomend"),this.fire("moveend",{hard:!c})},_rawPanBy:function(a){f.DomUtil.setPosition(this._mapPane,this._getMapPanePos().subtract(a))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_updateZoomLevels:function(){var a,b=1/0,c=-(1/0),e=this._getZoomSpan();for(a in this._zoomBoundLayers){var f=this._zoomBoundLayers[a];isNaN(f.options.minZoom)||(b=Math.min(b,f.options.minZoom)),isNaN(f.options.maxZoom)||(c=Math.max(c,f.options.maxZoom))}a===d?this._layersMaxZoom=this._layersMinZoom=d:(this._layersMaxZoom=c,this._layersMinZoom=b),e!==this._getZoomSpan()&&this.fire("zoomlevelschange")},_panInsideMaxBounds:function(){this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(b){if(f.DomEvent){b=b||"on",f.DomEvent[b](this._container,"click",this._onMouseClick,this);var c,d,e=["dblclick","mousedown","mouseup","mouseenter","mouseleave","mousemove","contextmenu"];for(c=0,d=e.length;d>c;c++)f.DomEvent[b](this._container,e[c],this._fireMouseEvent,this);this.options.trackResize&&f.DomEvent[b](a,"resize",this._onResize,this)}},_onResize:function(){f.Util.cancelAnimFrame(this._resizeRequest),this._resizeRequest=f.Util.requestAnimFrame(function(){this.invalidateSize({debounceMoveend:!0})},this,!1,this._container)},_onMouseClick:function(a){!this._loaded||!a._simulated&&(this.dragging&&this.dragging.moved()||this.boxZoom&&this.boxZoom.moved())||f.DomEvent._skipped(a)||(this.fire("preclick"),this._fireMouseEvent(a))},_fireMouseEvent:function(a){if(this._loaded&&!f.DomEvent._skipped(a)){var b=a.type;if(b="mouseenter"===b?"mouseover":"mouseleave"===b?"mouseout":b,this.hasEventListeners(b)){"contextmenu"===b&&f.DomEvent.preventDefault(a);var c=this.mouseEventToContainerPoint(a),d=this.containerPointToLayerPoint(c),e=this.layerPointToLatLng(d);this.fire(b,{latlng:e,layerPoint:d,containerPoint:c,originalEvent:a})}}},_onTileLayerLoad:function(){this._tileLayersToLoad--,this._tileLayersNum&&!this._tileLayersToLoad&&this.fire("tilelayersload")},_clearHandlers:function(){for(var a=0,b=this._handlers.length;b>a;a++)this._handlers[a].disable()},whenReady:function(a,b){return this._loaded?a.call(b||this,this):this.on("load",a,b),this},_layerAdd:function(a){a.onAdd(this),this.fire("layeradd",{layer:a})},_getMapPanePos:function(){return f.DomUtil.getPosition(this._mapPane)},_moved:function(){var a=this._getMapPanePos();return a&&!a.equals([0,0])},_getTopLeftPoint:function(){return this.getPixelOrigin().subtract(this._getMapPanePos())},_getNewTopLeftPoint:function(a,b){var c=this.getSize()._divideBy(2);return this.project(a,b)._subtract(c)._round()},_latLngToNewLayerPoint:function(a,b,c){var d=this._getNewTopLeftPoint(c,b).add(this._getMapPanePos());return this.project(a,b)._subtract(d)},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(a){return this.latLngToLayerPoint(a).subtract(this._getCenterLayerPoint())},_limitCenter:function(a,b,c){if(!c)return a;var d=this.project(a,b),e=this.getSize().divideBy(2),g=new f.Bounds(d.subtract(e),d.add(e)),h=this._getBoundsOffset(g,c,b);return this.unproject(d.add(h),b)},_limitOffset:function(a,b){if(!b)return a;var c=this.getPixelBounds(),d=new f.Bounds(c.min.add(a),c.max.add(a));return a.add(this._getBoundsOffset(d,b))},_getBoundsOffset:function(a,b,c){var d=this.project(b.getNorthWest(),c).subtract(a.min),e=this.project(b.getSouthEast(),c).subtract(a.max),g=this._rebound(d.x,-e.x),h=this._rebound(d.y,-e.y);return new f.Point(g,h)},_rebound:function(a,b){return a+b>0?Math.round(a-b)/2:Math.max(0,Math.ceil(a))-Math.max(0,Math.floor(b))},_limitZoom:function(a){var b=this.getMinZoom(),c=this.getMaxZoom();return Math.max(b,Math.min(c,a))}}),f.map=function(a,b){return new f.Map(a,b)},f.Projection.Mercator={MAX_LATITUDE:85.0840591556,R_MINOR:6356752.314245179,R_MAJOR:6378137,project:function(a){var b=f.LatLng.DEG_TO_RAD,c=this.MAX_LATITUDE,d=Math.max(Math.min(c,a.lat),-c),e=this.R_MAJOR,g=this.R_MINOR,h=a.lng*b*e,i=d*b,j=g/e,k=Math.sqrt(1-j*j),l=k*Math.sin(i);l=Math.pow((1-l)/(1+l),.5*k);var m=Math.tan(.5*(.5*Math.PI-i))/l;return i=-e*Math.log(m),new f.Point(h,i)},unproject:function(a){for(var b,c=f.LatLng.RAD_TO_DEG,d=this.R_MAJOR,e=this.R_MINOR,g=a.x*c/d,h=e/d,i=Math.sqrt(1-h*h),j=Math.exp(-a.y/d),k=Math.PI/2-2*Math.atan(j),l=15,m=1e-7,n=l,o=.1;Math.abs(o)>m&&--n>0;)b=i*Math.sin(k),o=Math.PI/2-2*Math.atan(j*Math.pow((1-b)/(1+b),.5*i))-k,k+=o;return new f.LatLng(k*c,g)}},f.CRS.EPSG3395=f.extend({},f.CRS,{code:"EPSG:3395",projection:f.Projection.Mercator,transformation:function(){var a=f.Projection.Mercator,b=a.R_MAJOR,c=.5/(Math.PI*b);return new f.Transformation(c,.5,-c,.5)}()}),f.TileLayer=f.Class.extend({includes:f.Mixin.Events,options:{minZoom:0,maxZoom:18,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:f.Browser.mobile,updateWhenIdle:f.Browser.mobile},initialize:function(a,b){b=f.setOptions(this,b),b.detectRetina&&f.Browser.retina&&b.maxZoom>0&&(b.tileSize=Math.floor(b.tileSize/2),b.zoomOffset++,b.minZoom>0&&b.minZoom--,this.options.maxZoom--),b.bounds&&(b.bounds=f.latLngBounds(b.bounds)),this._url=a;var c=this.options.subdomains;"string"==typeof c&&(this.options.subdomains=c.split(""))},onAdd:function(a){this._map=a,this._animated=a._zoomAnimated,this._initContainer(),a.on({viewreset:this._reset,moveend:this._update},this),this._animated&&a.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||(this._limitedUpdate=f.Util.limitExecByInterval(this._update,150,this),a.on("move",this._limitedUpdate,this)),this._reset(),this._update()},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){this._container.parentNode.removeChild(this._container),a.off({viewreset:this._reset,moveend:this._update},this),this._animated&&a.off({zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this),this.options.updateWhenIdle||a.off("move",this._limitedUpdate,this),this._container=null,this._map=null},bringToFront:function(){var a=this._map._panes.tilePane;return this._container&&(a.appendChild(this._container),this._setAutoZIndex(a,Math.max)),this},bringToBack:function(){var a=this._map._panes.tilePane;return this._container&&(a.insertBefore(this._container,a.firstChild),this._setAutoZIndex(a,Math.min)),this},getAttribution:function(){return this.options.attribution},getContainer:function(){return this._container},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this},setZIndex:function(a){return this.options.zIndex=a,this._updateZIndex(),this},setUrl:function(a,b){return this._url=a,b||this.redraw(),this},redraw:function(){return this._map&&(this._reset({hard:!0}),this._update()),this},_updateZIndex:function(){this._container&&this.options.zIndex!==d&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(a,b){var c,d,e,f=a.children,g=-b(1/0,-(1/0));for(d=0,e=f.length;e>d;d++)f[d]!==this._container&&(c=parseInt(f[d].style.zIndex,10),isNaN(c)||(g=b(g,c)));this.options.zIndex=this._container.style.zIndex=(isFinite(g)?g:0)+b(1,-1)},_updateOpacity:function(){var a,b=this._tiles;if(f.Browser.ielt9)for(a in b)f.DomUtil.setOpacity(b[a],this.options.opacity);else f.DomUtil.setOpacity(this._container,this.options.opacity)},_initContainer:function(){var a=this._map._panes.tilePane;if(!this._container){if(this._container=f.DomUtil.create("div","leaflet-layer"),this._updateZIndex(),this._animated){var b="leaflet-tile-container";this._bgBuffer=f.DomUtil.create("div",b,this._container),this._tileContainer=f.DomUtil.create("div",b,this._container)}else this._tileContainer=this._container;a.appendChild(this._container),this.options.opacity<1&&this._updateOpacity()}},_reset:function(a){for(var b in this._tiles)this.fire("tileunload",{tile:this._tiles[b]});this._tiles={},this._tilesToLoad=0,
this.options.reuseTiles&&(this._unusedTiles=[]),this._tileContainer.innerHTML="",this._animated&&a&&a.hard&&this._clearBgBuffer(),this._initContainer()},_getTileSize:function(){var a=this._map,b=a.getZoom()+this.options.zoomOffset,c=this.options.maxNativeZoom,d=this.options.tileSize;return c&&b>c&&(d=Math.round(a.getZoomScale(b)/a.getZoomScale(c)*d)),d},_update:function(){if(this._map){var a=this._map,b=a.getPixelBounds(),c=a.getZoom(),d=this._getTileSize();if(!(c>this.options.maxZoom||c<this.options.minZoom)){var e=f.bounds(b.min.divideBy(d)._floor(),b.max.divideBy(d)._floor());this._addTilesFromCenterOut(e),(this.options.unloadInvisibleTiles||this.options.reuseTiles)&&this._removeOtherTiles(e)}}},_addTilesFromCenterOut:function(a){var b,d,e,g=[],h=a.getCenter();for(b=a.min.y;b<=a.max.y;b++)for(d=a.min.x;d<=a.max.x;d++)e=new f.Point(d,b),this._tileShouldBeLoaded(e)&&g.push(e);var i=g.length;if(0!==i){g.sort(function(a,b){return a.distanceTo(h)-b.distanceTo(h)});var j=c.createDocumentFragment();for(this._tilesToLoad||this.fire("loading"),this._tilesToLoad+=i,d=0;i>d;d++)this._addTile(g[d],j);this._tileContainer.appendChild(j)}},_tileShouldBeLoaded:function(a){if(a.x+":"+a.y in this._tiles)return!1;var b=this.options;if(!b.continuousWorld){var c=this._getWrapTileNum();if(b.noWrap&&(a.x<0||a.x>=c.x)||a.y<0||a.y>=c.y)return!1}if(b.bounds){var d=b.tileSize,e=a.multiplyBy(d),f=e.add([d,d]),g=this._map.unproject(e),h=this._map.unproject(f);if(b.continuousWorld||b.noWrap||(g=g.wrap(),h=h.wrap()),!b.bounds.intersects([g,h]))return!1}return!0},_removeOtherTiles:function(a){var b,c,d,e;for(e in this._tiles)b=e.split(":"),c=parseInt(b[0],10),d=parseInt(b[1],10),(c<a.min.x||c>a.max.x||d<a.min.y||d>a.max.y)&&this._removeTile(e)},_removeTile:function(a){var b=this._tiles[a];this.fire("tileunload",{tile:b,url:b.src}),this.options.reuseTiles?(f.DomUtil.removeClass(b,"leaflet-tile-loaded"),this._unusedTiles.push(b)):b.parentNode===this._tileContainer&&this._tileContainer.removeChild(b),f.Browser.android||(b.onload=null,b.src=f.Util.emptyImageUrl),delete this._tiles[a]},_addTile:function(a,b){var c=this._getTilePos(a),d=this._getTile();f.DomUtil.setPosition(d,c,f.Browser.chrome),this._tiles[a.x+":"+a.y]=d,this._loadTile(d,a),d.parentNode!==this._tileContainer&&b.appendChild(d)},_getZoomForUrl:function(){var a=this.options,b=this._map.getZoom();return a.zoomReverse&&(b=a.maxZoom-b),b+=a.zoomOffset,a.maxNativeZoom?Math.min(b,a.maxNativeZoom):b},_getTilePos:function(a){var b=this._map.getPixelOrigin(),c=this._getTileSize();return a.multiplyBy(c).subtract(b)},getTileUrl:function(a){return f.Util.template(this._url,f.extend({s:this._getSubdomain(a),z:a.z,x:a.x,y:a.y},this.options))},_getWrapTileNum:function(){var a=this._map.options.crs,b=a.getSize(this._map.getZoom());return b.divideBy(this._getTileSize())._floor()},_adjustTilePoint:function(a){var b=this._getWrapTileNum();this.options.continuousWorld||this.options.noWrap||(a.x=(a.x%b.x+b.x)%b.x),this.options.tms&&(a.y=b.y-a.y-1),a.z=this._getZoomForUrl()},_getSubdomain:function(a){var b=Math.abs(a.x+a.y)%this.options.subdomains.length;return this.options.subdomains[b]},_getTile:function(){if(this.options.reuseTiles&&this._unusedTiles.length>0){var a=this._unusedTiles.pop();return this._resetTile(a),a}return this._createTile()},_resetTile:function(){},_createTile:function(){var a=f.DomUtil.create("img","leaflet-tile");return a.style.width=a.style.height=this._getTileSize()+"px",a.galleryimg="no",a.onselectstart=a.onmousemove=f.Util.falseFn,f.Browser.ielt9&&this.options.opacity!==d&&f.DomUtil.setOpacity(a,this.options.opacity),f.Browser.mobileWebkit3d&&(a.style.WebkitBackfaceVisibility="hidden"),a},_loadTile:function(a,b){a._layer=this,a.onload=this._tileOnLoad,a.onerror=this._tileOnError,this._adjustTilePoint(b),a.src=this.getTileUrl(b),this.fire("tileloadstart",{tile:a,url:a.src})},_tileLoaded:function(){this._tilesToLoad--,this._animated&&f.DomUtil.addClass(this._tileContainer,"leaflet-zoom-animated"),this._tilesToLoad||(this.fire("load"),this._animated&&(clearTimeout(this._clearBgBufferTimer),this._clearBgBufferTimer=setTimeout(f.bind(this._clearBgBuffer,this),500)))},_tileOnLoad:function(){var a=this._layer;this.src!==f.Util.emptyImageUrl&&(f.DomUtil.addClass(this,"leaflet-tile-loaded"),a.fire("tileload",{tile:this,url:this.src})),a._tileLoaded()},_tileOnError:function(){var a=this._layer;a.fire("tileerror",{tile:this,url:this.src});var b=a.options.errorTileUrl;b&&(this.src=b),a._tileLoaded()}}),f.tileLayer=function(a,b){return new f.TileLayer(a,b)},f.TileLayer.WMS=f.TileLayer.extend({defaultWmsParams:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1},initialize:function(a,b){this._url=a;var c=f.extend({},this.defaultWmsParams),d=b.tileSize||this.options.tileSize;b.detectRetina&&f.Browser.retina?c.width=c.height=2*d:c.width=c.height=d;for(var e in b)this.options.hasOwnProperty(e)||"crs"===e||(c[e]=b[e]);this.wmsParams=c,f.setOptions(this,b)},onAdd:function(a){this._crs=this.options.crs||a.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var b=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[b]=this._crs.code,f.TileLayer.prototype.onAdd.call(this,a)},getTileUrl:function(a){var b=this._map,c=this.options.tileSize,d=a.multiplyBy(c),e=d.add([c,c]),g=this._crs.project(b.unproject(d,a.z)),h=this._crs.project(b.unproject(e,a.z)),i=this._wmsVersion>=1.3&&this._crs===f.CRS.EPSG4326?[h.y,g.x,g.y,h.x].join(","):[g.x,h.y,h.x,g.y].join(","),j=f.Util.template(this._url,{s:this._getSubdomain(a)});return j+f.Util.getParamString(this.wmsParams,j,!0)+"&BBOX="+i},setParams:function(a,b){return f.extend(this.wmsParams,a),b||this.redraw(),this}}),f.tileLayer.wms=function(a,b){return new f.TileLayer.WMS(a,b)},f.TileLayer.Canvas=f.TileLayer.extend({options:{async:!1},initialize:function(a){f.setOptions(this,a)},redraw:function(){this._map&&(this._reset({hard:!0}),this._update());for(var a in this._tiles)this._redrawTile(this._tiles[a]);return this},_redrawTile:function(a){this.drawTile(a,a._tilePoint,this._map._zoom)},_createTile:function(){var a=f.DomUtil.create("canvas","leaflet-tile");return a.width=a.height=this.options.tileSize,a.onselectstart=a.onmousemove=f.Util.falseFn,a},_loadTile:function(a,b){a._layer=this,a._tilePoint=b,this._redrawTile(a),this.options.async||this.tileDrawn(a)},drawTile:function(){},tileDrawn:function(a){this._tileOnLoad.call(a)}}),f.tileLayer.canvas=function(a){return new f.TileLayer.Canvas(a)},f.ImageOverlay=f.Class.extend({includes:f.Mixin.Events,options:{opacity:1},initialize:function(a,b,c){this._url=a,this._bounds=f.latLngBounds(b),f.setOptions(this,c)},onAdd:function(a){this._map=a,this._image||this._initImage(),a._panes.overlayPane.appendChild(this._image),a.on("viewreset",this._reset,this),a.options.zoomAnimation&&f.Browser.any3d&&a.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(a){a.getPanes().overlayPane.removeChild(this._image),a.off("viewreset",this._reset,this),a.options.zoomAnimation&&a.off("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},setOpacity:function(a){return this.options.opacity=a,this._updateOpacity(),this},bringToFront:function(){return this._image&&this._map._panes.overlayPane.appendChild(this._image),this},bringToBack:function(){var a=this._map._panes.overlayPane;return this._image&&a.insertBefore(this._image,a.firstChild),this},setUrl:function(a){this._url=a,this._image.src=this._url},getAttribution:function(){return this.options.attribution},_initImage:function(){this._image=f.DomUtil.create("img","leaflet-image-layer"),this._map.options.zoomAnimation&&f.Browser.any3d?f.DomUtil.addClass(this._image,"leaflet-zoom-animated"):f.DomUtil.addClass(this._image,"leaflet-zoom-hide"),this._updateOpacity(),f.extend(this._image,{galleryimg:"no",onselectstart:f.Util.falseFn,onmousemove:f.Util.falseFn,onload:f.bind(this._onImageLoad,this),src:this._url})},_animateZoom:function(a){var b=this._map,c=this._image,d=b.getZoomScale(a.zoom),e=this._bounds.getNorthWest(),g=this._bounds.getSouthEast(),h=b._latLngToNewLayerPoint(e,a.zoom,a.center),i=b._latLngToNewLayerPoint(g,a.zoom,a.center)._subtract(h),j=h._add(i._multiplyBy(.5*(1-1/d)));c.style[f.DomUtil.TRANSFORM]=f.DomUtil.getTranslateString(j)+" scale("+d+") "},_reset:function(){var a=this._image,b=this._map.latLngToLayerPoint(this._bounds.getNorthWest()),c=this._map.latLngToLayerPoint(this._bounds.getSouthEast())._subtract(b);f.DomUtil.setPosition(a,b),a.style.width=c.x+"px",a.style.height=c.y+"px"},_onImageLoad:function(){this.fire("load")},_updateOpacity:function(){f.DomUtil.setOpacity(this._image,this.options.opacity)}}),f.imageOverlay=function(a,b,c){return new f.ImageOverlay(a,b,c)},f.Icon=f.Class.extend({options:{className:""},initialize:function(a){f.setOptions(this,a)},createIcon:function(a){return this._createIcon("icon",a)},createShadow:function(a){return this._createIcon("shadow",a)},_createIcon:function(a,b){var c=this._getIconUrl(a);if(!c){if("icon"===a)throw new Error("iconUrl not set in Icon options (see the docs).");return null}var d;return d=b&&"IMG"===b.tagName?this._createImg(c,b):this._createImg(c),this._setIconStyles(d,a),d},_setIconStyles:function(a,b){var c,d=this.options,e=f.point(d[b+"Size"]);c="shadow"===b?f.point(d.shadowAnchor||d.iconAnchor):f.point(d.iconAnchor),!c&&e&&(c=e.divideBy(2,!0)),a.className="leaflet-marker-"+b+" "+d.className,c&&(a.style.marginLeft=-c.x+"px",a.style.marginTop=-c.y+"px"),e&&(a.style.width=e.x+"px",a.style.height=e.y+"px")},_createImg:function(a,b){return b=b||c.createElement("img"),b.src=a,b},_getIconUrl:function(a){return f.Browser.retina&&this.options[a+"RetinaUrl"]?this.options[a+"RetinaUrl"]:this.options[a+"Url"]}}),f.icon=function(a){return new f.Icon(a)},f.Icon.Default=f.Icon.extend({options:{iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]},_getIconUrl:function(a){var b=a+"Url";if(this.options[b])return this.options[b];f.Browser.retina&&"icon"===a&&(a+="-2x");var c=f.Icon.Default.imagePath;if(!c)throw new Error("Couldn't autodetect L.Icon.Default.imagePath, set it manually.");return c+"/marker-"+a+".png"}}),f.Icon.Default.imagePath=function(){var a,b,d,e,f,g=c.getElementsByTagName("script"),h=/[\/^]leaflet[\-\._]?([\w\-\._]*)\.js\??/;for(a=0,b=g.length;b>a;a++)if(d=g[a].src,e=d.match(h))return f=d.split(h)[0],(f?f+"/":"")+"images"}(),f.Marker=f.Class.extend({includes:f.Mixin.Events,options:{icon:new f.Icon.Default,title:"",alt:"",clickable:!0,draggable:!1,keyboard:!0,zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250},initialize:function(a,b){f.setOptions(this,b),this._latlng=f.latLng(a)},onAdd:function(a){this._map=a,a.on("viewreset",this.update,this),this._initIcon(),this.update(),this.fire("add"),a.options.zoomAnimation&&a.options.markerZoomAnimation&&a.on("zoomanim",this._animateZoom,this)},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){this.dragging&&this.dragging.disable(),this._removeIcon(),this._removeShadow(),this.fire("remove"),a.off({viewreset:this.update,zoomanim:this._animateZoom},this),this._map=null},getLatLng:function(){return this._latlng},setLatLng:function(a){return this._latlng=f.latLng(a),this.update(),this.fire("move",{latlng:this._latlng})},setZIndexOffset:function(a){return this.options.zIndexOffset=a,this.update(),this},setIcon:function(a){return this.options.icon=a,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup),this},update:function(){if(this._icon){var a=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(a)}return this},_initIcon:function(){var a=this.options,b=this._map,c=b.options.zoomAnimation&&b.options.markerZoomAnimation,d=c?"leaflet-zoom-animated":"leaflet-zoom-hide",e=a.icon.createIcon(this._icon),g=!1;e!==this._icon&&(this._icon&&this._removeIcon(),g=!0,a.title&&(e.title=a.title),a.alt&&(e.alt=a.alt)),f.DomUtil.addClass(e,d),a.keyboard&&(e.tabIndex="0"),this._icon=e,this._initInteraction(),a.riseOnHover&&f.DomEvent.on(e,"mouseover",this._bringToFront,this).on(e,"mouseout",this._resetZIndex,this);var h=a.icon.createShadow(this._shadow),i=!1;h!==this._shadow&&(this._removeShadow(),i=!0),h&&f.DomUtil.addClass(h,d),this._shadow=h,a.opacity<1&&this._updateOpacity();var j=this._map._panes;g&&j.markerPane.appendChild(this._icon),h&&i&&j.shadowPane.appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&f.DomEvent.off(this._icon,"mouseover",this._bringToFront).off(this._icon,"mouseout",this._resetZIndex),this._map._panes.markerPane.removeChild(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&this._map._panes.shadowPane.removeChild(this._shadow),this._shadow=null},_setPos:function(a){f.DomUtil.setPosition(this._icon,a),this._shadow&&f.DomUtil.setPosition(this._shadow,a),this._zIndex=a.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(a){this._icon.style.zIndex=this._zIndex+a},_animateZoom:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center).round();this._setPos(b)},_initInteraction:function(){if(this.options.clickable){var a=this._icon,b=["dblclick","mousedown","mouseover","mouseout","contextmenu"];f.DomUtil.addClass(a,"leaflet-clickable"),f.DomEvent.on(a,"click",this._onMouseClick,this),f.DomEvent.on(a,"keypress",this._onKeyPress,this);for(var c=0;c<b.length;c++)f.DomEvent.on(a,b[c],this._fireMouseEvent,this);f.Handler.MarkerDrag&&(this.dragging=new f.Handler.MarkerDrag(this),this.options.draggable&&this.dragging.enable())}},_onMouseClick:function(a){var b=this.dragging&&this.dragging.moved();(this.hasEventListeners(a.type)||b)&&f.DomEvent.stopPropagation(a),b||(this.dragging&&this.dragging._enabled||!this._map.dragging||!this._map.dragging.moved())&&this.fire(a.type,{originalEvent:a,latlng:this._latlng})},_onKeyPress:function(a){13===a.keyCode&&this.fire("click",{originalEvent:a,latlng:this._latlng})},_fireMouseEvent:function(a){this.fire(a.type,{originalEvent:a,latlng:this._latlng}),"contextmenu"===a.type&&this.hasEventListeners(a.type)&&f.DomEvent.preventDefault(a),"mousedown"!==a.type?f.DomEvent.stopPropagation(a):f.DomEvent.preventDefault(a)},setOpacity:function(a){return this.options.opacity=a,this._map&&this._updateOpacity(),this},_updateOpacity:function(){f.DomUtil.setOpacity(this._icon,this.options.opacity),this._shadow&&f.DomUtil.setOpacity(this._shadow,this.options.opacity)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)}}),f.marker=function(a,b){return new f.Marker(a,b)},f.DivIcon=f.Icon.extend({options:{iconSize:[12,12],className:"leaflet-div-icon",html:!1},createIcon:function(a){var b=a&&"DIV"===a.tagName?a:c.createElement("div"),d=this.options;return d.html!==!1?b.innerHTML=d.html:b.innerHTML="",d.bgPos&&(b.style.backgroundPosition=-d.bgPos.x+"px "+-d.bgPos.y+"px"),this._setIconStyles(b,"icon"),b},createShadow:function(){return null}}),f.divIcon=function(a){return new f.DivIcon(a)},f.Map.mergeOptions({closePopupOnClick:!0}),f.Popup=f.Class.extend({includes:f.Mixin.Events,options:{minWidth:50,maxWidth:300,autoPan:!0,closeButton:!0,offset:[0,7],autoPanPadding:[5,5],keepInView:!1,className:"",zoomAnimation:!0},initialize:function(a,b){f.setOptions(this,a),this._source=b,this._animated=f.Browser.any3d&&this.options.zoomAnimation,this._isOpen=!1},onAdd:function(a){this._map=a,this._container||this._initLayout();var b=a.options.fadeAnimation;b&&f.DomUtil.setOpacity(this._container,0),a._panes.popupPane.appendChild(this._container),a.on(this._getEvents(),this),this.update(),b&&f.DomUtil.setOpacity(this._container,1),this.fire("open"),a.fire("popupopen",{popup:this}),this._source&&this._source.fire("popupopen",{popup:this})},addTo:function(a){return a.addLayer(this),this},openOn:function(a){return a.openPopup(this),this},onRemove:function(a){a._panes.popupPane.removeChild(this._container),f.Util.falseFn(this._container.offsetWidth),a.off(this._getEvents(),this),a.options.fadeAnimation&&f.DomUtil.setOpacity(this._container,0),this._map=null,this.fire("close"),a.fire("popupclose",{popup:this}),this._source&&this._source.fire("popupclose",{popup:this})},getLatLng:function(){return this._latlng},setLatLng:function(a){return this._latlng=f.latLng(a),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(a){return this._content=a,this.update(),this},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},_getEvents:function(){var a={viewreset:this._updatePosition};return this._animated&&(a.zoomanim=this._zoomAnimation),("closeOnClick"in this.options?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(a.preclick=this._close),this.options.keepInView&&(a.moveend=this._adjustPan),a},_close:function(){this._map&&this._map.closePopup(this)},_initLayout:function(){var a,b="leaflet-popup",c=b+" "+this.options.className+" leaflet-zoom-"+(this._animated?"animated":"hide"),d=this._container=f.DomUtil.create("div",c);this.options.closeButton&&(a=this._closeButton=f.DomUtil.create("a",b+"-close-button",d),a.href="#close",a.innerHTML="&#215;",f.DomEvent.disableClickPropagation(a),f.DomEvent.on(a,"click",this._onCloseButtonClick,this));var e=this._wrapper=f.DomUtil.create("div",b+"-content-wrapper",d);f.DomEvent.disableClickPropagation(e),this._contentNode=f.DomUtil.create("div",b+"-content",e),f.DomEvent.disableScrollPropagation(this._contentNode),f.DomEvent.on(e,"contextmenu",f.DomEvent.stopPropagation),this._tipContainer=f.DomUtil.create("div",b+"-tip-container",d),this._tip=f.DomUtil.create("div",b+"-tip",this._tipContainer)},_updateContent:function(){if(this._content){if("string"==typeof this._content)this._contentNode.innerHTML=this._content;else{for(;this._contentNode.hasChildNodes();)this._contentNode.removeChild(this._contentNode.firstChild);this._contentNode.appendChild(this._content)}this.fire("contentupdate")}},_updateLayout:function(){var a=this._contentNode,b=a.style;b.width="",b.whiteSpace="nowrap";var c=a.offsetWidth;c=Math.min(c,this.options.maxWidth),c=Math.max(c,this.options.minWidth),b.width=c+1+"px",b.whiteSpace="",b.height="";var d=a.offsetHeight,e=this.options.maxHeight,g="leaflet-popup-scrolled";e&&d>e?(b.height=e+"px",f.DomUtil.addClass(a,g)):f.DomUtil.removeClass(a,g),this._containerWidth=this._container.offsetWidth},_updatePosition:function(){if(this._map){var a=this._map.latLngToLayerPoint(this._latlng),b=this._animated,c=f.point(this.options.offset);b&&f.DomUtil.setPosition(this._container,a),this._containerBottom=-c.y-(b?0:a.y),this._containerLeft=-Math.round(this._containerWidth/2)+c.x+(b?0:a.x),this._container.style.bottom=this._containerBottom+"px",this._container.style.left=this._containerLeft+"px"}},_zoomAnimation:function(a){var b=this._map._latLngToNewLayerPoint(this._latlng,a.zoom,a.center);f.DomUtil.setPosition(this._container,b)},_adjustPan:function(){if(this.options.autoPan){var a=this._map,b=this._container.offsetHeight,c=this._containerWidth,d=new f.Point(this._containerLeft,-b-this._containerBottom);this._animated&&d._add(f.DomUtil.getPosition(this._container));var e=a.layerPointToContainerPoint(d),g=f.point(this.options.autoPanPadding),h=f.point(this.options.autoPanPaddingTopLeft||g),i=f.point(this.options.autoPanPaddingBottomRight||g),j=a.getSize(),k=0,l=0;e.x+c+i.x>j.x&&(k=e.x+c-j.x+i.x),e.x-k-h.x<0&&(k=e.x-h.x),e.y+b+i.y>j.y&&(l=e.y+b-j.y+i.y),e.y-l-h.y<0&&(l=e.y-h.y),(k||l)&&a.fire("autopanstart").panBy([k,l])}},_onCloseButtonClick:function(a){this._close(),f.DomEvent.stop(a)}}),f.popup=function(a,b){return new f.Popup(a,b)},f.Map.include({openPopup:function(a,b,c){if(this.closePopup(),!(a instanceof f.Popup)){var d=a;a=new f.Popup(c).setLatLng(b).setContent(d)}return a._isOpen=!0,this._popup=a,this.addLayer(a)},closePopup:function(a){return a&&a!==this._popup||(a=this._popup,this._popup=null),a&&(this.removeLayer(a),a._isOpen=!1),this}}),f.Marker.include({openPopup:function(){return this._popup&&this._map&&!this._map.hasLayer(this._popup)&&(this._popup.setLatLng(this._latlng),this._map.openPopup(this._popup)),this},closePopup:function(){return this._popup&&this._popup._close(),this},togglePopup:function(){return this._popup&&(this._popup._isOpen?this.closePopup():this.openPopup()),this},bindPopup:function(a,b){var c=f.point(this.options.icon.options.popupAnchor||[0,0]);return c=c.add(f.Popup.prototype.options.offset),b&&b.offset&&(c=c.add(b.offset)),b=f.extend({offset:c},b),this._popupHandlersAdded||(this.on("click",this.togglePopup,this).on("remove",this.closePopup,this).on("move",this._movePopup,this),this._popupHandlersAdded=!0),a instanceof f.Popup?(f.setOptions(a,b),this._popup=a):this._popup=new f.Popup(b,this).setContent(a),this},setPopupContent:function(a){return this._popup&&this._popup.setContent(a),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this.togglePopup,this).off("remove",this.closePopup,this).off("move",this._movePopup,this),this._popupHandlersAdded=!1),this},getPopup:function(){return this._popup},_movePopup:function(a){this._popup.setLatLng(a.latlng)}}),f.LayerGroup=f.Class.extend({initialize:function(a){this._layers={};var b,c;if(a)for(b=0,c=a.length;c>b;b++)this.addLayer(a[b])},addLayer:function(a){var b=this.getLayerId(a);return this._layers[b]=a,this._map&&this._map.addLayer(a),this},removeLayer:function(a){var b=a in this._layers?a:this.getLayerId(a);return this._map&&this._layers[b]&&this._map.removeLayer(this._layers[b]),delete this._layers[b],this},hasLayer:function(a){return a?a in this._layers||this.getLayerId(a)in this._layers:!1},clearLayers:function(){return this.eachLayer(this.removeLayer,this),this},invoke:function(a){var b,c,d=Array.prototype.slice.call(arguments,1);for(b in this._layers)c=this._layers[b],c[a]&&c[a].apply(c,d);return this},onAdd:function(a){this._map=a,this.eachLayer(a.addLayer,a)},onRemove:function(a){this.eachLayer(a.removeLayer,a),this._map=null},addTo:function(a){return a.addLayer(this),this},eachLayer:function(a,b){for(var c in this._layers)a.call(b,this._layers[c]);return this},getLayer:function(a){return this._layers[a]},getLayers:function(){var a=[];for(var b in this._layers)a.push(this._layers[b]);return a},setZIndex:function(a){return this.invoke("setZIndex",a)},getLayerId:function(a){return f.stamp(a)}}),f.layerGroup=function(a){return new f.LayerGroup(a)},f.FeatureGroup=f.LayerGroup.extend({includes:f.Mixin.Events,statics:{EVENTS:"click dblclick mouseover mouseout mousemove contextmenu popupopen popupclose"},addLayer:function(a){return this.hasLayer(a)?this:("on"in a&&a.on(f.FeatureGroup.EVENTS,this._propagateEvent,this),f.LayerGroup.prototype.addLayer.call(this,a),this._popupContent&&a.bindPopup&&a.bindPopup(this._popupContent,this._popupOptions),this.fire("layeradd",{layer:a}))},removeLayer:function(a){return this.hasLayer(a)?(a in this._layers&&(a=this._layers[a]),a.off(f.FeatureGroup.EVENTS,this._propagateEvent,this),f.LayerGroup.prototype.removeLayer.call(this,a),this._popupContent&&this.invoke("unbindPopup"),this.fire("layerremove",{layer:a})):this},bindPopup:function(a,b){return this._popupContent=a,this._popupOptions=b,this.invoke("bindPopup",a,b)},openPopup:function(a){for(var b in this._layers){this._layers[b].openPopup(a);break}return this},setStyle:function(a){return this.invoke("setStyle",a)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var a=new f.LatLngBounds;return this.eachLayer(function(b){a.extend(b instanceof f.Marker?b.getLatLng():b.getBounds())}),a},_propagateEvent:function(a){a=f.extend({layer:a.target,target:this},a),this.fire(a.type,a)}}),f.featureGroup=function(a){return new f.FeatureGroup(a)},f.Path=f.Class.extend({includes:[f.Mixin.Events],statics:{CLIP_PADDING:function(){var b=f.Browser.mobile?1280:2e3,c=(b/Math.max(a.outerWidth,a.outerHeight)-1)/2;return Math.max(0,Math.min(.5,c))}()},options:{stroke:!0,color:"#0033ff",dashArray:null,lineCap:null,lineJoin:null,weight:5,opacity:.5,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0},initialize:function(a){f.setOptions(this,a)},onAdd:function(a){this._map=a,this._container||(this._initElements(),this._initEvents()),this.projectLatlngs(),this._updatePath(),this._container&&this._map._pathRoot.appendChild(this._container),this.fire("add"),a.on({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},addTo:function(a){return a.addLayer(this),this},onRemove:function(a){a._pathRoot.removeChild(this._container),this.fire("remove"),this._map=null,f.Browser.vml&&(this._container=null,this._stroke=null,this._fill=null),a.off({viewreset:this.projectLatlngs,moveend:this._updatePath},this)},projectLatlngs:function(){},setStyle:function(a){return f.setOptions(this,a),this._container&&this._updateStyle(),this},redraw:function(){return this._map&&(this.projectLatlngs(),this._updatePath()),this}}),f.Map.include({_updatePathViewport:function(){var a=f.Path.CLIP_PADDING,b=this.getSize(),c=f.DomUtil.getPosition(this._mapPane),d=c.multiplyBy(-1)._subtract(b.multiplyBy(a)._round()),e=d.add(b.multiplyBy(1+2*a)._round());this._pathViewport=new f.Bounds(d,e)}}),f.Path.SVG_NS="http://www.w3.org/2000/svg",f.Browser.svg=!(!c.createElementNS||!c.createElementNS(f.Path.SVG_NS,"svg").createSVGRect),f.Path=f.Path.extend({statics:{SVG:f.Browser.svg},bringToFront:function(){var a=this._map._pathRoot,b=this._container;return b&&a.lastChild!==b&&a.appendChild(b),this},bringToBack:function(){var a=this._map._pathRoot,b=this._container,c=a.firstChild;return b&&c!==b&&a.insertBefore(b,c),this},getPathString:function(){},_createElement:function(a){return c.createElementNS(f.Path.SVG_NS,a)},_initElements:function(){this._map._initPathRoot(),this._initPath(),this._initStyle()},_initPath:function(){this._container=this._createElement("g"),this._path=this._createElement("path"),this.options.className&&f.DomUtil.addClass(this._path,this.options.className),this._container.appendChild(this._path)},_initStyle:function(){this.options.stroke&&(this._path.setAttribute("stroke-linejoin","round"),this._path.setAttribute("stroke-linecap","round")),this.options.fill&&this._path.setAttribute("fill-rule","evenodd"),this.options.pointerEvents&&this._path.setAttribute("pointer-events",this.options.pointerEvents),this.options.clickable||this.options.pointerEvents||this._path.setAttribute("pointer-events","none"),this._updateStyle()},_updateStyle:function(){this.options.stroke?(this._path.setAttribute("stroke",this.options.color),this._path.setAttribute("stroke-opacity",this.options.opacity),this._path.setAttribute("stroke-width",this.options.weight),this.options.dashArray?this._path.setAttribute("stroke-dasharray",this.options.dashArray):this._path.removeAttribute("stroke-dasharray"),this.options.lineCap&&this._path.setAttribute("stroke-linecap",this.options.lineCap),this.options.lineJoin&&this._path.setAttribute("stroke-linejoin",this.options.lineJoin)):this._path.setAttribute("stroke","none"),this.options.fill?(this._path.setAttribute("fill",this.options.fillColor||this.options.color),this._path.setAttribute("fill-opacity",this.options.fillOpacity)):this._path.setAttribute("fill","none")},_updatePath:function(){var a=this.getPathString();a||(a="M0 0"),this._path.setAttribute("d",a)},_initEvents:function(){if(this.options.clickable){!f.Browser.svg&&f.Browser.vml||f.DomUtil.addClass(this._path,"leaflet-clickable"),f.DomEvent.on(this._container,"click",this._onMouseClick,this);for(var a=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],b=0;b<a.length;b++)f.DomEvent.on(this._container,a[b],this._fireMouseEvent,this)}},_onMouseClick:function(a){this._map.dragging&&this._map.dragging.moved()||this._fireMouseEvent(a)},_fireMouseEvent:function(a){if(this.hasEventListeners(a.type)){var b=this._map,c=b.mouseEventToContainerPoint(a),d=b.containerPointToLayerPoint(c),e=b.layerPointToLatLng(d);this.fire(a.type,{latlng:e,layerPoint:d,containerPoint:c,originalEvent:a}),"contextmenu"===a.type&&f.DomEvent.preventDefault(a),"mousemove"!==a.type&&f.DomEvent.stopPropagation(a)}}}),f.Map.include({_initPathRoot:function(){this._pathRoot||(this._pathRoot=f.Path.prototype._createElement("svg"),this._panes.overlayPane.appendChild(this._pathRoot),this.options.zoomAnimation&&f.Browser.any3d?(f.DomUtil.addClass(this._pathRoot,"leaflet-zoom-animated"),this.on({zoomanim:this._animatePathZoom,zoomend:this._endPathZoom})):f.DomUtil.addClass(this._pathRoot,"leaflet-zoom-hide"),this.on("moveend",this._updateSvgViewport),this._updateSvgViewport())},_animatePathZoom:function(a){var b=this.getZoomScale(a.zoom),c=this._getCenterOffset(a.center)._multiplyBy(-b)._add(this._pathViewport.min);this._pathRoot.style[f.DomUtil.TRANSFORM]=f.DomUtil.getTranslateString(c)+" scale("+b+") ",this._pathZooming=!0},_endPathZoom:function(){this._pathZooming=!1},_updateSvgViewport:function(){if(!this._pathZooming){this._updatePathViewport();var a=this._pathViewport,b=a.min,c=a.max,d=c.x-b.x,e=c.y-b.y,g=this._pathRoot,h=this._panes.overlayPane;f.Browser.mobileWebkit&&h.removeChild(g),f.DomUtil.setPosition(g,b),g.setAttribute("width",d),g.setAttribute("height",e),g.setAttribute("viewBox",[b.x,b.y,d,e].join(" ")),f.Browser.mobileWebkit&&h.appendChild(g)}}}),f.Path.include({bindPopup:function(a,b){return a instanceof f.Popup?this._popup=a:(this._popup&&!b||(this._popup=new f.Popup(b,this)),this._popup.setContent(a)),this._popupHandlersAdded||(this.on("click",this._openPopup,this).on("remove",this.closePopup,this),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this._popup=null,this.off("click",this._openPopup).off("remove",this.closePopup),this._popupHandlersAdded=!1),this},openPopup:function(a){return this._popup&&(a=a||this._latlng||this._latlngs[Math.floor(this._latlngs.length/2)],this._openPopup({latlng:a})),this},closePopup:function(){return this._popup&&this._popup._close(),this},_openPopup:function(a){this._popup.setLatLng(a.latlng),this._map.openPopup(this._popup)}}),f.Browser.vml=!f.Browser.svg&&function(){try{var a=c.createElement("div");a.innerHTML='<v:shape adj="1"/>';var b=a.firstChild;return b.style.behavior="url(#default#VML)",b&&"object"==typeof b.adj}catch(d){return!1}}(),f.Path=f.Browser.svg||!f.Browser.vml?f.Path:f.Path.extend({statics:{VML:!0,CLIP_PADDING:.02},_createElement:function(){try{return c.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(a){return c.createElement("<lvml:"+a+' class="lvml">')}}catch(a){return function(a){return c.createElement("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}}(),_initPath:function(){var a=this._container=this._createElement("shape");f.DomUtil.addClass(a,"leaflet-vml-shape"+(this.options.className?" "+this.options.className:"")),this.options.clickable&&f.DomUtil.addClass(a,"leaflet-clickable"),a.coordsize="1 1",this._path=this._createElement("path"),a.appendChild(this._path),this._map._pathRoot.appendChild(a)},_initStyle:function(){this._updateStyle()},_updateStyle:function(){var a=this._stroke,b=this._fill,c=this.options,d=this._container;d.stroked=c.stroke,d.filled=c.fill,c.stroke?(a||(a=this._stroke=this._createElement("stroke"),a.endcap="round",d.appendChild(a)),a.weight=c.weight+"px",a.color=c.color,a.opacity=c.opacity,c.dashArray?a.dashStyle=f.Util.isArray(c.dashArray)?c.dashArray.join(" "):c.dashArray.replace(/( *, *)/g," "):a.dashStyle="",c.lineCap&&(a.endcap=c.lineCap.replace("butt","flat")),c.lineJoin&&(a.joinstyle=c.lineJoin)):a&&(d.removeChild(a),this._stroke=null),c.fill?(b||(b=this._fill=this._createElement("fill"),d.appendChild(b)),b.color=c.fillColor||c.color,b.opacity=c.fillOpacity):b&&(d.removeChild(b),this._fill=null)},_updatePath:function(){
var a=this._container.style;a.display="none",this._path.v=this.getPathString()+" ",a.display=""}}),f.Map.include(f.Browser.svg||!f.Browser.vml?{}:{_initPathRoot:function(){if(!this._pathRoot){var a=this._pathRoot=c.createElement("div");a.className="leaflet-vml-container",this._panes.overlayPane.appendChild(a),this.on("moveend",this._updatePathViewport),this._updatePathViewport()}}}),f.Browser.canvas=function(){return!!c.createElement("canvas").getContext}(),f.Path=f.Path.SVG&&!a.L_PREFER_CANVAS||!f.Browser.canvas?f.Path:f.Path.extend({statics:{CANVAS:!0,SVG:!1},redraw:function(){return this._map&&(this.projectLatlngs(),this._requestUpdate()),this},setStyle:function(a){return f.setOptions(this,a),this._map&&(this._updateStyle(),this._requestUpdate()),this},onRemove:function(a){a.off("viewreset",this.projectLatlngs,this).off("moveend",this._updatePath,this),this.options.clickable&&(this._map.off("click",this._onClick,this),this._map.off("mousemove",this._onMouseMove,this)),this._requestUpdate(),this.fire("remove"),this._map=null},_requestUpdate:function(){this._map&&!f.Path._updateRequest&&(f.Path._updateRequest=f.Util.requestAnimFrame(this._fireMapMoveEnd,this._map))},_fireMapMoveEnd:function(){f.Path._updateRequest=null,this.fire("moveend")},_initElements:function(){this._map._initPathRoot(),this._ctx=this._map._canvasCtx},_updateStyle:function(){var a=this.options;a.stroke&&(this._ctx.lineWidth=a.weight,this._ctx.strokeStyle=a.color),a.fill&&(this._ctx.fillStyle=a.fillColor||a.color)},_drawPath:function(){var a,b,c,d,e,g;for(this._ctx.beginPath(),a=0,c=this._parts.length;c>a;a++){for(b=0,d=this._parts[a].length;d>b;b++)e=this._parts[a][b],g=(0===b?"move":"line")+"To",this._ctx[g](e.x,e.y);this instanceof f.Polygon&&this._ctx.closePath()}},_checkIfEmpty:function(){return!this._parts.length},_updatePath:function(){if(!this._checkIfEmpty()){var a=this._ctx,b=this.options;this._drawPath(),a.save(),this._updateStyle(),b.fill&&(a.globalAlpha=b.fillOpacity,a.fill()),b.stroke&&(a.globalAlpha=b.opacity,a.stroke()),a.restore()}},_initEvents:function(){this.options.clickable&&(this._map.on("mousemove",this._onMouseMove,this),this._map.on("click",this._onClick,this))},_onClick:function(a){this._containsPoint(a.layerPoint)&&this.fire("click",a)},_onMouseMove:function(a){this._map&&!this._map._animatingZoom&&(this._containsPoint(a.layerPoint)?(this._ctx.canvas.style.cursor="pointer",this._mouseInside=!0,this.fire("mouseover",a)):this._mouseInside&&(this._ctx.canvas.style.cursor="",this._mouseInside=!1,this.fire("mouseout",a)))}}),f.Map.include(f.Path.SVG&&!a.L_PREFER_CANVAS||!f.Browser.canvas?{}:{_initPathRoot:function(){var a,b=this._pathRoot;b||(b=this._pathRoot=c.createElement("canvas"),b.style.position="absolute",a=this._canvasCtx=b.getContext("2d"),a.lineCap="round",a.lineJoin="round",this._panes.overlayPane.appendChild(b),this.options.zoomAnimation&&(this._pathRoot.className="leaflet-zoom-animated",this.on("zoomanim",this._animatePathZoom),this.on("zoomend",this._endPathZoom)),this.on("moveend",this._updateCanvasViewport),this._updateCanvasViewport())},_updateCanvasViewport:function(){if(!this._pathZooming){this._updatePathViewport();var a=this._pathViewport,b=a.min,c=a.max.subtract(b),d=this._pathRoot;f.DomUtil.setPosition(d,b),d.width=c.x,d.height=c.y,d.getContext("2d").translate(-b.x,-b.y)}}}),f.LineUtil={simplify:function(a,b){if(!b||!a.length)return a.slice();var c=b*b;return a=this._reducePoints(a,c),a=this._simplifyDP(a,c)},pointToSegmentDistance:function(a,b,c){return Math.sqrt(this._sqClosestPointOnSegment(a,b,c,!0))},closestPointOnSegment:function(a,b,c){return this._sqClosestPointOnSegment(a,b,c)},_simplifyDP:function(a,b){var c=a.length,e=typeof Uint8Array!=d+""?Uint8Array:Array,f=new e(c);f[0]=f[c-1]=1,this._simplifyDPStep(a,f,b,0,c-1);var g,h=[];for(g=0;c>g;g++)f[g]&&h.push(a[g]);return h},_simplifyDPStep:function(a,b,c,d,e){var f,g,h,i=0;for(g=d+1;e-1>=g;g++)h=this._sqClosestPointOnSegment(a[g],a[d],a[e],!0),h>i&&(f=g,i=h);i>c&&(b[f]=1,this._simplifyDPStep(a,b,c,d,f),this._simplifyDPStep(a,b,c,f,e))},_reducePoints:function(a,b){for(var c=[a[0]],d=1,e=0,f=a.length;f>d;d++)this._sqDist(a[d],a[e])>b&&(c.push(a[d]),e=d);return f-1>e&&c.push(a[f-1]),c},clipSegment:function(a,b,c,d){var e,f,g,h=d?this._lastCode:this._getBitCode(a,c),i=this._getBitCode(b,c);for(this._lastCode=i;;){if(!(h|i))return[a,b];if(h&i)return!1;e=h||i,f=this._getEdgeIntersection(a,b,e,c),g=this._getBitCode(f,c),e===h?(a=f,h=g):(b=f,i=g)}},_getEdgeIntersection:function(a,b,c,d){var e=b.x-a.x,g=b.y-a.y,h=d.min,i=d.max;return 8&c?new f.Point(a.x+e*(i.y-a.y)/g,i.y):4&c?new f.Point(a.x+e*(h.y-a.y)/g,h.y):2&c?new f.Point(i.x,a.y+g*(i.x-a.x)/e):1&c?new f.Point(h.x,a.y+g*(h.x-a.x)/e):void 0},_getBitCode:function(a,b){var c=0;return a.x<b.min.x?c|=1:a.x>b.max.x&&(c|=2),a.y<b.min.y?c|=4:a.y>b.max.y&&(c|=8),c},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d},_sqClosestPointOnSegment:function(a,b,c,d){var e,g=b.x,h=b.y,i=c.x-g,j=c.y-h,k=i*i+j*j;return k>0&&(e=((a.x-g)*i+(a.y-h)*j)/k,e>1?(g=c.x,h=c.y):e>0&&(g+=i*e,h+=j*e)),i=a.x-g,j=a.y-h,d?i*i+j*j:new f.Point(g,h)}},f.Polyline=f.Path.extend({initialize:function(a,b){f.Path.prototype.initialize.call(this,b),this._latlngs=this._convertLatLngs(a)},options:{smoothFactor:1,noClip:!1},projectLatlngs:function(){this._originalPoints=[];for(var a=0,b=this._latlngs.length;b>a;a++)this._originalPoints[a]=this._map.latLngToLayerPoint(this._latlngs[a])},getPathString:function(){for(var a=0,b=this._parts.length,c="";b>a;a++)c+=this._getPathPartStr(this._parts[a]);return c},getLatLngs:function(){return this._latlngs},setLatLngs:function(a){return this._latlngs=this._convertLatLngs(a),this.redraw()},addLatLng:function(a){return this._latlngs.push(f.latLng(a)),this.redraw()},spliceLatLngs:function(){var a=[].splice.apply(this._latlngs,arguments);return this._convertLatLngs(this._latlngs,!0),this.redraw(),a},closestLayerPoint:function(a){for(var b,c,d=1/0,e=this._parts,g=null,h=0,i=e.length;i>h;h++)for(var j=e[h],k=1,l=j.length;l>k;k++){b=j[k-1],c=j[k];var m=f.LineUtil._sqClosestPointOnSegment(a,b,c,!0);d>m&&(d=m,g=f.LineUtil._sqClosestPointOnSegment(a,b,c))}return g&&(g.distance=Math.sqrt(d)),g},getBounds:function(){return new f.LatLngBounds(this.getLatLngs())},_convertLatLngs:function(a,b){var c,d,e=b?a:[];for(c=0,d=a.length;d>c;c++){if(f.Util.isArray(a[c])&&"number"!=typeof a[c][0])return;e[c]=f.latLng(a[c])}return e},_initEvents:function(){f.Path.prototype._initEvents.call(this)},_getPathPartStr:function(a){for(var b,c=f.Path.VML,d=0,e=a.length,g="";e>d;d++)b=a[d],c&&b._round(),g+=(d?"L":"M")+b.x+" "+b.y;return g},_clipPoints:function(){var a,b,c,d=this._originalPoints,e=d.length;if(this.options.noClip)return void(this._parts=[d]);this._parts=[];var g=this._parts,h=this._map._pathViewport,i=f.LineUtil;for(a=0,b=0;e-1>a;a++)c=i.clipSegment(d[a],d[a+1],h,a),c&&(g[b]=g[b]||[],g[b].push(c[0]),c[1]===d[a+1]&&a!==e-2||(g[b].push(c[1]),b++))},_simplifyPoints:function(){for(var a=this._parts,b=f.LineUtil,c=0,d=a.length;d>c;c++)a[c]=b.simplify(a[c],this.options.smoothFactor)},_updatePath:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),f.Path.prototype._updatePath.call(this))}}),f.polyline=function(a,b){return new f.Polyline(a,b)},f.PolyUtil={},f.PolyUtil.clipPolygon=function(a,b){var c,d,e,g,h,i,j,k,l,m=[1,4,2,8],n=f.LineUtil;for(d=0,j=a.length;j>d;d++)a[d]._code=n._getBitCode(a[d],b);for(g=0;4>g;g++){for(k=m[g],c=[],d=0,j=a.length,e=j-1;j>d;e=d++)h=a[d],i=a[e],h._code&k?i._code&k||(l=n._getEdgeIntersection(i,h,k,b),l._code=n._getBitCode(l,b),c.push(l)):(i._code&k&&(l=n._getEdgeIntersection(i,h,k,b),l._code=n._getBitCode(l,b),c.push(l)),c.push(h));a=c}return a},f.Polygon=f.Polyline.extend({options:{fill:!0},initialize:function(a,b){f.Polyline.prototype.initialize.call(this,a,b),this._initWithHoles(a)},_initWithHoles:function(a){var b,c,d;if(a&&f.Util.isArray(a[0])&&"number"!=typeof a[0][0])for(this._latlngs=this._convertLatLngs(a[0]),this._holes=a.slice(1),b=0,c=this._holes.length;c>b;b++)d=this._holes[b]=this._convertLatLngs(this._holes[b]),d[0].equals(d[d.length-1])&&d.pop();a=this._latlngs,a.length>=2&&a[0].equals(a[a.length-1])&&a.pop()},projectLatlngs:function(){if(f.Polyline.prototype.projectLatlngs.call(this),this._holePoints=[],this._holes){var a,b,c,d;for(a=0,c=this._holes.length;c>a;a++)for(this._holePoints[a]=[],b=0,d=this._holes[a].length;d>b;b++)this._holePoints[a][b]=this._map.latLngToLayerPoint(this._holes[a][b])}},setLatLngs:function(a){return a&&f.Util.isArray(a[0])&&"number"!=typeof a[0][0]?(this._initWithHoles(a),this.redraw()):f.Polyline.prototype.setLatLngs.call(this,a)},_clipPoints:function(){var a=this._originalPoints,b=[];if(this._parts=[a].concat(this._holePoints),!this.options.noClip){for(var c=0,d=this._parts.length;d>c;c++){var e=f.PolyUtil.clipPolygon(this._parts[c],this._map._pathViewport);e.length&&b.push(e)}this._parts=b}},_getPathPartStr:function(a){var b=f.Polyline.prototype._getPathPartStr.call(this,a);return b+(f.Browser.svg?"z":"x")}}),f.polygon=function(a,b){return new f.Polygon(a,b)},function(){function a(a){return f.FeatureGroup.extend({initialize:function(a,b){this._layers={},this._options=b,this.setLatLngs(a)},setLatLngs:function(b){var c=0,d=b.length;for(this.eachLayer(function(a){d>c?a.setLatLngs(b[c++]):this.removeLayer(a)},this);d>c;)this.addLayer(new a(b[c++],this._options));return this},getLatLngs:function(){var a=[];return this.eachLayer(function(b){a.push(b.getLatLngs())}),a}})}f.MultiPolyline=a(f.Polyline),f.MultiPolygon=a(f.Polygon),f.multiPolyline=function(a,b){return new f.MultiPolyline(a,b)},f.multiPolygon=function(a,b){return new f.MultiPolygon(a,b)}}(),f.Rectangle=f.Polygon.extend({initialize:function(a,b){f.Polygon.prototype.initialize.call(this,this._boundsToLatLngs(a),b)},setBounds:function(a){this.setLatLngs(this._boundsToLatLngs(a))},_boundsToLatLngs:function(a){return a=f.latLngBounds(a),[a.getSouthWest(),a.getNorthWest(),a.getNorthEast(),a.getSouthEast()]}}),f.rectangle=function(a,b){return new f.Rectangle(a,b)},f.Circle=f.Path.extend({initialize:function(a,b,c){f.Path.prototype.initialize.call(this,c),this._latlng=f.latLng(a),this._mRadius=b},options:{fill:!0},setLatLng:function(a){return this._latlng=f.latLng(a),this.redraw()},setRadius:function(a){return this._mRadius=a,this.redraw()},projectLatlngs:function(){var a=this._getLngRadius(),b=this._latlng,c=this._map.latLngToLayerPoint([b.lat,b.lng-a]);this._point=this._map.latLngToLayerPoint(b),this._radius=Math.max(this._point.x-c.x,1)},getBounds:function(){var a=this._getLngRadius(),b=this._mRadius/40075017*360,c=this._latlng;return new f.LatLngBounds([c.lat-b,c.lng-a],[c.lat+b,c.lng+a])},getLatLng:function(){return this._latlng},getPathString:function(){var a=this._point,b=this._radius;return this._checkIfEmpty()?"":f.Browser.svg?"M"+a.x+","+(a.y-b)+"A"+b+","+b+",0,1,1,"+(a.x-.1)+","+(a.y-b)+" z":(a._round(),b=Math.round(b),"AL "+a.x+","+a.y+" "+b+","+b+" 0,23592600")},getRadius:function(){return this._mRadius},_getLatRadius:function(){return this._mRadius/40075017*360},_getLngRadius:function(){return this._getLatRadius()/Math.cos(f.LatLng.DEG_TO_RAD*this._latlng.lat)},_checkIfEmpty:function(){if(!this._map)return!1;var a=this._map._pathViewport,b=this._radius,c=this._point;return c.x-b>a.max.x||c.y-b>a.max.y||c.x+b<a.min.x||c.y+b<a.min.y}}),f.circle=function(a,b,c){return new f.Circle(a,b,c)},f.CircleMarker=f.Circle.extend({options:{radius:10,weight:2},initialize:function(a,b){f.Circle.prototype.initialize.call(this,a,null,b),this._radius=this.options.radius},projectLatlngs:function(){this._point=this._map.latLngToLayerPoint(this._latlng)},_updateStyle:function(){f.Circle.prototype._updateStyle.call(this),this.setRadius(this.options.radius)},setLatLng:function(a){return f.Circle.prototype.setLatLng.call(this,a),this._popup&&this._popup._isOpen&&this._popup.setLatLng(a),this},setRadius:function(a){return this.options.radius=this._radius=a,this.redraw()},getRadius:function(){return this._radius}}),f.circleMarker=function(a,b){return new f.CircleMarker(a,b)},f.Polyline.include(f.Path.CANVAS?{_containsPoint:function(a,b){var c,d,e,g,h,i,j,k=this.options.weight/2;for(f.Browser.touch&&(k+=10),c=0,g=this._parts.length;g>c;c++)for(j=this._parts[c],d=0,h=j.length,e=h-1;h>d;e=d++)if((b||0!==d)&&(i=f.LineUtil.pointToSegmentDistance(a,j[e],j[d]),k>=i))return!0;return!1}}:{}),f.Polygon.include(f.Path.CANVAS?{_containsPoint:function(a){var b,c,d,e,g,h,i,j,k=!1;if(f.Polyline.prototype._containsPoint.call(this,a,!0))return!0;for(e=0,i=this._parts.length;i>e;e++)for(b=this._parts[e],g=0,j=b.length,h=j-1;j>g;h=g++)c=b[g],d=b[h],c.y>a.y!=d.y>a.y&&a.x<(d.x-c.x)*(a.y-c.y)/(d.y-c.y)+c.x&&(k=!k);return k}}:{}),f.Circle.include(f.Path.CANVAS?{_drawPath:function(){var a=this._point;this._ctx.beginPath(),this._ctx.arc(a.x,a.y,this._radius,0,2*Math.PI,!1)},_containsPoint:function(a){var b=this._point,c=this.options.stroke?this.options.weight/2:0;return a.distanceTo(b)<=this._radius+c}}:{}),f.CircleMarker.include(f.Path.CANVAS?{_updateStyle:function(){f.Path.prototype._updateStyle.call(this)}}:{}),f.GeoJSON=f.FeatureGroup.extend({initialize:function(a,b){f.setOptions(this,b),this._layers={},a&&this.addData(a)},addData:function(a){var b,c,d,e=f.Util.isArray(a)?a:a.features;if(e){for(b=0,c=e.length;c>b;b++)d=e[b],(d.geometries||d.geometry||d.features||d.coordinates)&&this.addData(e[b]);return this}var g=this.options;if(!g.filter||g.filter(a)){var h=f.GeoJSON.geometryToLayer(a,g.pointToLayer,g.coordsToLatLng,g);return h.feature=f.GeoJSON.asFeature(a),h.defaultOptions=h.options,this.resetStyle(h),g.onEachFeature&&g.onEachFeature(a,h),this.addLayer(h)}},resetStyle:function(a){var b=this.options.style;b&&(f.Util.extend(a.options,a.defaultOptions),this._setLayerStyle(a,b))},setStyle:function(a){this.eachLayer(function(b){this._setLayerStyle(b,a)},this)},_setLayerStyle:function(a,b){"function"==typeof b&&(b=b(a.feature)),a.setStyle&&a.setStyle(b)}}),f.extend(f.GeoJSON,{geometryToLayer:function(a,b,c,d){var e,g,h,i,j="Feature"===a.type?a.geometry:a,k=j.coordinates,l=[];switch(c=c||this.coordsToLatLng,j.type){case"Point":return e=c(k),b?b(a,e):new f.Marker(e);case"MultiPoint":for(h=0,i=k.length;i>h;h++)e=c(k[h]),l.push(b?b(a,e):new f.Marker(e));return new f.FeatureGroup(l);case"LineString":return g=this.coordsToLatLngs(k,0,c),new f.Polyline(g,d);case"Polygon":if(2===k.length&&!k[1].length)throw new Error("Invalid GeoJSON object.");return g=this.coordsToLatLngs(k,1,c),new f.Polygon(g,d);case"MultiLineString":return g=this.coordsToLatLngs(k,1,c),new f.MultiPolyline(g,d);case"MultiPolygon":return g=this.coordsToLatLngs(k,2,c),new f.MultiPolygon(g,d);case"GeometryCollection":for(h=0,i=j.geometries.length;i>h;h++)l.push(this.geometryToLayer({geometry:j.geometries[h],type:"Feature",properties:a.properties},b,c,d));return new f.FeatureGroup(l);default:throw new Error("Invalid GeoJSON object.")}},coordsToLatLng:function(a){return new f.LatLng(a[1],a[0],a[2])},coordsToLatLngs:function(a,b,c){var d,e,f,g=[];for(e=0,f=a.length;f>e;e++)d=b?this.coordsToLatLngs(a[e],b-1,c):(c||this.coordsToLatLng)(a[e]),g.push(d);return g},latLngToCoords:function(a){var b=[a.lng,a.lat];return a.alt!==d&&b.push(a.alt),b},latLngsToCoords:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(f.GeoJSON.latLngToCoords(a[c]));return b},getFeature:function(a,b){return a.feature?f.extend({},a.feature,{geometry:b}):f.GeoJSON.asFeature(b)},asFeature:function(a){return"Feature"===a.type?a:{type:"Feature",properties:{},geometry:a}}});var h={toGeoJSON:function(){return f.GeoJSON.getFeature(this,{type:"Point",coordinates:f.GeoJSON.latLngToCoords(this.getLatLng())})}};f.Marker.include(h),f.Circle.include(h),f.CircleMarker.include(h),f.Polyline.include({toGeoJSON:function(){return f.GeoJSON.getFeature(this,{type:"LineString",coordinates:f.GeoJSON.latLngsToCoords(this.getLatLngs())})}}),f.Polygon.include({toGeoJSON:function(){var a,b,c,d=[f.GeoJSON.latLngsToCoords(this.getLatLngs())];if(d[0].push(d[0][0]),this._holes)for(a=0,b=this._holes.length;b>a;a++)c=f.GeoJSON.latLngsToCoords(this._holes[a]),c.push(c[0]),d.push(c);return f.GeoJSON.getFeature(this,{type:"Polygon",coordinates:d})}}),function(){function a(a){return function(){var b=[];return this.eachLayer(function(a){b.push(a.toGeoJSON().geometry.coordinates)}),f.GeoJSON.getFeature(this,{type:a,coordinates:b})}}f.MultiPolyline.include({toGeoJSON:a("MultiLineString")}),f.MultiPolygon.include({toGeoJSON:a("MultiPolygon")}),f.LayerGroup.include({toGeoJSON:function(){var b,c=this.feature&&this.feature.geometry,d=[];if(c&&"MultiPoint"===c.type)return a("MultiPoint").call(this);var e=c&&"GeometryCollection"===c.type;return this.eachLayer(function(a){a.toGeoJSON&&(b=a.toGeoJSON(),d.push(e?b.geometry:f.GeoJSON.asFeature(b)))}),e?f.GeoJSON.getFeature(this,{geometries:d,type:"GeometryCollection"}):{type:"FeatureCollection",features:d}}})}(),f.geoJson=function(a,b){return new f.GeoJSON(a,b)},f.DomEvent={addListener:function(a,b,c,d){var e,g,h,i=f.stamp(c),j="_leaflet_"+b+i;return a[j]?this:(e=function(b){return c.call(d||a,b||f.DomEvent._getEvent())},f.Browser.pointer&&0===b.indexOf("touch")?this.addPointerListener(a,b,e,i):(f.Browser.touch&&"dblclick"===b&&this.addDoubleTapListener&&this.addDoubleTapListener(a,e,i),"addEventListener"in a?"mousewheel"===b?(a.addEventListener("DOMMouseScroll",e,!1),a.addEventListener(b,e,!1)):"mouseenter"===b||"mouseleave"===b?(g=e,h="mouseenter"===b?"mouseover":"mouseout",e=function(b){return f.DomEvent._checkMouse(a,b)?g(b):void 0},a.addEventListener(h,e,!1)):"click"===b&&f.Browser.android?(g=e,e=function(a){return f.DomEvent._filterClick(a,g)},a.addEventListener(b,e,!1)):a.addEventListener(b,e,!1):"attachEvent"in a&&a.attachEvent("on"+b,e),a[j]=e,this))},removeListener:function(a,b,c){var d=f.stamp(c),e="_leaflet_"+b+d,g=a[e];return g?(f.Browser.pointer&&0===b.indexOf("touch")?this.removePointerListener(a,b,d):f.Browser.touch&&"dblclick"===b&&this.removeDoubleTapListener?this.removeDoubleTapListener(a,d):"removeEventListener"in a?"mousewheel"===b?(a.removeEventListener("DOMMouseScroll",g,!1),a.removeEventListener(b,g,!1)):"mouseenter"===b||"mouseleave"===b?a.removeEventListener("mouseenter"===b?"mouseover":"mouseout",g,!1):a.removeEventListener(b,g,!1):"detachEvent"in a&&a.detachEvent("on"+b,g),a[e]=null,this):this},stopPropagation:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,f.DomEvent._skipped(a),this},disableScrollPropagation:function(a){var b=f.DomEvent.stopPropagation;return f.DomEvent.on(a,"mousewheel",b).on(a,"MozMousePixelScroll",b)},disableClickPropagation:function(a){for(var b=f.DomEvent.stopPropagation,c=f.Draggable.START.length-1;c>=0;c--)f.DomEvent.on(a,f.Draggable.START[c],b);return f.DomEvent.on(a,"click",f.DomEvent._fakeStop).on(a,"dblclick",b)},preventDefault:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,this},stop:function(a){return f.DomEvent.preventDefault(a).stopPropagation(a)},getMousePosition:function(a,b){if(!b)return new f.Point(a.clientX,a.clientY);var c=b.getBoundingClientRect();return new f.Point(a.clientX-c.left-b.clientLeft,a.clientY-c.top-b.clientTop)},getWheelDelta:function(a){var b=0;return a.wheelDelta&&(b=a.wheelDelta/120),a.detail&&(b=-a.detail/3),b},_skipEvents:{},_fakeStop:function(a){f.DomEvent._skipEvents[a.type]=!0},_skipped:function(a){var b=this._skipEvents[a.type];return this._skipEvents[a.type]=!1,b},_checkMouse:function(a,b){var c=b.relatedTarget;if(!c)return!0;try{for(;c&&c!==a;)c=c.parentNode}catch(d){return!1}return c!==a},_getEvent:function(){var b=a.event;if(!b)for(var c=arguments.callee.caller;c&&(b=c.arguments[0],!b||a.Event!==b.constructor);)c=c.caller;return b},_filterClick:function(a,b){var c=a.timeStamp||a.originalEvent.timeStamp,d=f.DomEvent._lastClick&&c-f.DomEvent._lastClick;return d&&d>100&&500>d||a.target._simulatedClick&&!a._simulated?void f.DomEvent.stop(a):(f.DomEvent._lastClick=c,b(a))}},f.DomEvent.on=f.DomEvent.addListener,f.DomEvent.off=f.DomEvent.removeListener,f.Draggable=f.Class.extend({includes:f.Mixin.Events,statics:{START:f.Browser.touch?["touchstart","mousedown"]:["mousedown"],END:{mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},MOVE:{mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"}},initialize:function(a,b){this._element=a,this._dragStartTarget=b||a},enable:function(){if(!this._enabled){for(var a=f.Draggable.START.length-1;a>=0;a--)f.DomEvent.on(this._dragStartTarget,f.Draggable.START[a],this._onDown,this);this._enabled=!0}},disable:function(){if(this._enabled){for(var a=f.Draggable.START.length-1;a>=0;a--)f.DomEvent.off(this._dragStartTarget,f.Draggable.START[a],this._onDown,this);this._enabled=!1,this._moved=!1}},_onDown:function(a){if(this._moved=!1,!a.shiftKey&&(1===a.which||1===a.button||a.touches)&&(f.DomEvent.stopPropagation(a),!f.Draggable._disabled&&(f.DomUtil.disableImageDrag(),f.DomUtil.disableTextSelection(),!this._moving))){var b=a.touches?a.touches[0]:a;this._startPoint=new f.Point(b.clientX,b.clientY),this._startPos=this._newPos=f.DomUtil.getPosition(this._element),f.DomEvent.on(c,f.Draggable.MOVE[a.type],this._onMove,this).on(c,f.Draggable.END[a.type],this._onUp,this)}},_onMove:function(a){if(a.touches&&a.touches.length>1)return void(this._moved=!0);var b=a.touches&&1===a.touches.length?a.touches[0]:a,d=new f.Point(b.clientX,b.clientY),e=d.subtract(this._startPoint);(e.x||e.y)&&(f.Browser.touch&&Math.abs(e.x)+Math.abs(e.y)<3||(f.DomEvent.preventDefault(a),this._moved||(this.fire("dragstart"),this._moved=!0,this._startPos=f.DomUtil.getPosition(this._element).subtract(e),f.DomUtil.addClass(c.body,"leaflet-dragging"),this._lastTarget=a.target||a.srcElement,f.DomUtil.addClass(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(e),this._moving=!0,f.Util.cancelAnimFrame(this._animRequest),this._animRequest=f.Util.requestAnimFrame(this._updatePosition,this,!0,this._dragStartTarget)))},_updatePosition:function(){this.fire("predrag"),f.DomUtil.setPosition(this._element,this._newPos),this.fire("drag")},_onUp:function(){f.DomUtil.removeClass(c.body,"leaflet-dragging"),this._lastTarget&&(f.DomUtil.removeClass(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null);for(var a in f.Draggable.MOVE)f.DomEvent.off(c,f.Draggable.MOVE[a],this._onMove).off(c,f.Draggable.END[a],this._onUp);f.DomUtil.enableImageDrag(),f.DomUtil.enableTextSelection(),this._moved&&this._moving&&(f.Util.cancelAnimFrame(this._animRequest),this.fire("dragend",{distance:this._newPos.distanceTo(this._startPos)})),this._moving=!1}}),f.Handler=f.Class.extend({initialize:function(a){this._map=a},enable:function(){this._enabled||(this._enabled=!0,this.addHooks())},disable:function(){this._enabled&&(this._enabled=!1,this.removeHooks())},enabled:function(){return!!this._enabled}}),f.Map.mergeOptions({dragging:!0,inertia:!f.Browser.android23,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,inertiaThreshold:f.Browser.touch?32:18,easeLinearity:.25,worldCopyJump:!1}),f.Map.Drag=f.Handler.extend({addHooks:function(){if(!this._draggable){var a=this._map;this._draggable=new f.Draggable(a._mapPane,a._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),a.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDrag,this),a.on("viewreset",this._onViewReset,this),a.whenReady(this._onViewReset,this))}this._draggable.enable()},removeHooks:function(){this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){var a=this._map;a._panAnim&&a._panAnim.stop(),a.fire("movestart").fire("dragstart"),a.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(){if(this._map.options.inertia){var a=this._lastTime=+new Date,b=this._lastPos=this._draggable._newPos;this._positions.push(b),this._times.push(a),a-this._times[0]>200&&(this._positions.shift(),this._times.shift())}this._map.fire("move").fire("drag")},_onViewReset:function(){var a=this._map.getSize()._divideBy(2),b=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=b.subtract(a).x,this._worldWidth=this._map.project([0,180]).x},_onPreDrag:function(){var a=this._worldWidth,b=Math.round(a/2),c=this._initialWorldOffset,d=this._draggable._newPos.x,e=(d-b+c)%a+b-c,f=(d+b+c)%a-b-c,g=Math.abs(e+c)<Math.abs(f+c)?e:f;this._draggable._newPos.x=g},_onDragEnd:function(a){var b=this._map,c=b.options,d=+new Date-this._lastTime,e=!c.inertia||d>c.inertiaThreshold||!this._positions[0];if(b.fire("dragend",a),e)b.fire("moveend");else{var g=this._lastPos.subtract(this._positions[0]),h=(this._lastTime+d-this._times[0])/1e3,i=c.easeLinearity,j=g.multiplyBy(i/h),k=j.distanceTo([0,0]),l=Math.min(c.inertiaMaxSpeed,k),m=j.multiplyBy(l/k),n=l/(c.inertiaDeceleration*i),o=m.multiplyBy(-n/2).round();o.x&&o.y?(o=b._limitOffset(o,b.options.maxBounds),f.Util.requestAnimFrame(function(){b.panBy(o,{duration:n,easeLinearity:i,noMoveStart:!0})})):b.fire("moveend")}}}),f.Map.addInitHook("addHandler","dragging",f.Map.Drag),f.Map.mergeOptions({doubleClickZoom:!0}),f.Map.DoubleClickZoom=f.Handler.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(a){var b=this._map,c=b.getZoom()+(a.originalEvent.shiftKey?-1:1);"center"===b.options.doubleClickZoom?b.setZoom(c):b.setZoomAround(a.containerPoint,c)}}),f.Map.addInitHook("addHandler","doubleClickZoom",f.Map.DoubleClickZoom),f.Map.mergeOptions({scrollWheelZoom:!0}),f.Map.ScrollWheelZoom=f.Handler.extend({addHooks:function(){f.DomEvent.on(this._map._container,"mousewheel",this._onWheelScroll,this),f.DomEvent.on(this._map._container,"MozMousePixelScroll",f.DomEvent.preventDefault),this._delta=0},removeHooks:function(){f.DomEvent.off(this._map._container,"mousewheel",this._onWheelScroll),f.DomEvent.off(this._map._container,"MozMousePixelScroll",f.DomEvent.preventDefault)},_onWheelScroll:function(a){var b=f.DomEvent.getWheelDelta(a);this._delta+=b,this._lastMousePos=this._map.mouseEventToContainerPoint(a),this._startTime||(this._startTime=+new Date);var c=Math.max(40-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(f.bind(this._performZoom,this),c),f.DomEvent.preventDefault(a),f.DomEvent.stopPropagation(a)},_performZoom:function(){var a=this._map,b=this._delta,c=a.getZoom();b=b>0?Math.ceil(b):Math.floor(b),b=Math.max(Math.min(b,4),-4),b=a._limitZoom(c+b)-c,this._delta=0,this._startTime=null,b&&("center"===a.options.scrollWheelZoom?a.setZoom(c+b):a.setZoomAround(this._lastMousePos,c+b))}}),f.Map.addInitHook("addHandler","scrollWheelZoom",f.Map.ScrollWheelZoom),f.extend(f.DomEvent,{_touchstart:f.Browser.msPointer?"MSPointerDown":f.Browser.pointer?"pointerdown":"touchstart",_touchend:f.Browser.msPointer?"MSPointerUp":f.Browser.pointer?"pointerup":"touchend",addDoubleTapListener:function(a,b,d){function e(a){var b;if(f.Browser.pointer?(o.push(a.pointerId),b=o.length):b=a.touches.length,!(b>1)){var c=Date.now(),d=c-(h||c);i=a.touches?a.touches[0]:a,j=d>0&&k>=d,h=c}}function g(a){if(f.Browser.pointer){var c=o.indexOf(a.pointerId);if(-1===c)return;o.splice(c,1)}if(j){if(f.Browser.pointer){var d,e={};for(var g in i)d=i[g],"function"==typeof d?e[g]=d.bind(i):e[g]=d;i=e}i.type="dblclick",b(i),h=null}}var h,i,j=!1,k=250,l="_leaflet_",m=this._touchstart,n=this._touchend,o=[];a[l+m+d]=e,a[l+n+d]=g;var p=f.Browser.pointer?c.documentElement:a;return a.addEventListener(m,e,!1),p.addEventListener(n,g,!1),f.Browser.pointer&&p.addEventListener(f.DomEvent.POINTER_CANCEL,g,!1),this},removeDoubleTapListener:function(a,b){var d="_leaflet_";return a.removeEventListener(this._touchstart,a[d+this._touchstart+b],!1),(f.Browser.pointer?c.documentElement:a).removeEventListener(this._touchend,a[d+this._touchend+b],!1),f.Browser.pointer&&c.documentElement.removeEventListener(f.DomEvent.POINTER_CANCEL,a[d+this._touchend+b],!1),this}}),f.extend(f.DomEvent,{POINTER_DOWN:f.Browser.msPointer?"MSPointerDown":"pointerdown",POINTER_MOVE:f.Browser.msPointer?"MSPointerMove":"pointermove",POINTER_UP:f.Browser.msPointer?"MSPointerUp":"pointerup",POINTER_CANCEL:f.Browser.msPointer?"MSPointerCancel":"pointercancel",_pointers:[],_pointerDocumentListener:!1,addPointerListener:function(a,b,c,d){switch(b){case"touchstart":return this.addPointerListenerStart(a,b,c,d);case"touchend":return this.addPointerListenerEnd(a,b,c,d);case"touchmove":return this.addPointerListenerMove(a,b,c,d);default:throw"Unknown touch event type"}},addPointerListenerStart:function(a,b,d,e){var g="_leaflet_",h=this._pointers,i=function(a){f.DomEvent.preventDefault(a);for(var b=!1,c=0;c<h.length;c++)if(h[c].pointerId===a.pointerId){b=!0;break}b||h.push(a),a.touches=h.slice(),a.changedTouches=[a],d(a)};if(a[g+"touchstart"+e]=i,a.addEventListener(this.POINTER_DOWN,i,!1),!this._pointerDocumentListener){var j=function(a){for(var b=0;b<h.length;b++)if(h[b].pointerId===a.pointerId){h.splice(b,1);break}};c.documentElement.addEventListener(this.POINTER_UP,j,!1),c.documentElement.addEventListener(this.POINTER_CANCEL,j,!1),this._pointerDocumentListener=!0}return this},addPointerListenerMove:function(a,b,c,d){function e(a){if(a.pointerType!==a.MSPOINTER_TYPE_MOUSE&&"mouse"!==a.pointerType||0!==a.buttons){for(var b=0;b<g.length;b++)if(g[b].pointerId===a.pointerId){g[b]=a;break}a.touches=g.slice(),a.changedTouches=[a],c(a)}}var f="_leaflet_",g=this._pointers;return a[f+"touchmove"+d]=e,a.addEventListener(this.POINTER_MOVE,e,!1),this},addPointerListenerEnd:function(a,b,c,d){var e="_leaflet_",f=this._pointers,g=function(a){for(var b=0;b<f.length;b++)if(f[b].pointerId===a.pointerId){f.splice(b,1);break}a.touches=f.slice(),a.changedTouches=[a],c(a)};return a[e+"touchend"+d]=g,a.addEventListener(this.POINTER_UP,g,!1),a.addEventListener(this.POINTER_CANCEL,g,!1),this},removePointerListener:function(a,b,c){var d="_leaflet_",e=a[d+b+c];switch(b){case"touchstart":a.removeEventListener(this.POINTER_DOWN,e,!1);break;case"touchmove":a.removeEventListener(this.POINTER_MOVE,e,!1);break;case"touchend":a.removeEventListener(this.POINTER_UP,e,!1),a.removeEventListener(this.POINTER_CANCEL,e,!1)}return this}}),f.Map.mergeOptions({touchZoom:f.Browser.touch&&!f.Browser.android23,bounceAtZoomLimits:!0}),f.Map.TouchZoom=f.Handler.extend({addHooks:function(){f.DomEvent.on(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){f.DomEvent.off(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(a){var b=this._map;if(a.touches&&2===a.touches.length&&!b._animatingZoom&&!this._zooming){var d=b.mouseEventToLayerPoint(a.touches[0]),e=b.mouseEventToLayerPoint(a.touches[1]),g=b._getCenterLayerPoint();this._startCenter=d.add(e)._divideBy(2),this._startDist=d.distanceTo(e),this._moved=!1,this._zooming=!0,this._centerOffset=g.subtract(this._startCenter),b._panAnim&&b._panAnim.stop(),f.DomEvent.on(c,"touchmove",this._onTouchMove,this).on(c,"touchend",this._onTouchEnd,this),f.DomEvent.preventDefault(a)}},_onTouchMove:function(a){var b=this._map;if(a.touches&&2===a.touches.length&&this._zooming){var c=b.mouseEventToLayerPoint(a.touches[0]),d=b.mouseEventToLayerPoint(a.touches[1]);this._scale=c.distanceTo(d)/this._startDist,this._delta=c._add(d)._divideBy(2)._subtract(this._startCenter),1!==this._scale&&(!b.options.bounceAtZoomLimits&&(b.getZoom()===b.getMinZoom()&&this._scale<1||b.getZoom()===b.getMaxZoom()&&this._scale>1)||(this._moved||(f.DomUtil.addClass(b._mapPane,"leaflet-touching"),b.fire("movestart").fire("zoomstart"),this._moved=!0),f.Util.cancelAnimFrame(this._animRequest),this._animRequest=f.Util.requestAnimFrame(this._updateOnMove,this,!0,this._map._container),f.DomEvent.preventDefault(a)))}},_updateOnMove:function(){var a=this._map,b=this._getScaleOrigin(),c=a.layerPointToLatLng(b),d=a.getScaleZoom(this._scale);
a._animateZoom(c,d,this._startCenter,this._scale,this._delta,!1,!0)},_onTouchEnd:function(){if(!this._moved||!this._zooming)return void(this._zooming=!1);var a=this._map;this._zooming=!1,f.DomUtil.removeClass(a._mapPane,"leaflet-touching"),f.Util.cancelAnimFrame(this._animRequest),f.DomEvent.off(c,"touchmove",this._onTouchMove).off(c,"touchend",this._onTouchEnd);var b=this._getScaleOrigin(),d=a.layerPointToLatLng(b),e=a.getZoom(),g=a.getScaleZoom(this._scale)-e,h=g>0?Math.ceil(g):Math.floor(g),i=a._limitZoom(e+h),j=a.getZoomScale(i)/this._scale;a._animateZoom(d,i,b,j)},_getScaleOrigin:function(){var a=this._centerOffset.subtract(this._delta).divideBy(this._scale);return this._startCenter.add(a)}}),f.Map.addInitHook("addHandler","touchZoom",f.Map.TouchZoom),f.Map.mergeOptions({tap:!0,tapTolerance:15}),f.Map.Tap=f.Handler.extend({addHooks:function(){f.DomEvent.on(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){f.DomEvent.off(this._map._container,"touchstart",this._onDown,this)},_onDown:function(a){if(a.touches){if(f.DomEvent.preventDefault(a),this._fireClick=!0,a.touches.length>1)return this._fireClick=!1,void clearTimeout(this._holdTimeout);var b=a.touches[0],d=b.target;this._startPos=this._newPos=new f.Point(b.clientX,b.clientY),d.tagName&&"a"===d.tagName.toLowerCase()&&f.DomUtil.addClass(d,"leaflet-active"),this._holdTimeout=setTimeout(f.bind(function(){this._isTapValid()&&(this._fireClick=!1,this._onUp(),this._simulateEvent("contextmenu",b))},this),1e3),f.DomEvent.on(c,"touchmove",this._onMove,this).on(c,"touchend",this._onUp,this)}},_onUp:function(a){if(clearTimeout(this._holdTimeout),f.DomEvent.off(c,"touchmove",this._onMove,this).off(c,"touchend",this._onUp,this),this._fireClick&&a&&a.changedTouches){var b=a.changedTouches[0],d=b.target;d&&d.tagName&&"a"===d.tagName.toLowerCase()&&f.DomUtil.removeClass(d,"leaflet-active"),this._isTapValid()&&this._simulateEvent("click",b)}},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_onMove:function(a){var b=a.touches[0];this._newPos=new f.Point(b.clientX,b.clientY)},_simulateEvent:function(b,d){var e=c.createEvent("MouseEvents");e._simulated=!0,d.target._simulatedClick=!0,e.initMouseEvent(b,!0,!0,a,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),d.target.dispatchEvent(e)}}),f.Browser.touch&&!f.Browser.pointer&&f.Map.addInitHook("addHandler","tap",f.Map.Tap),f.Map.mergeOptions({boxZoom:!0}),f.Map.BoxZoom=f.Handler.extend({initialize:function(a){this._map=a,this._container=a._container,this._pane=a._panes.overlayPane,this._moved=!1},addHooks:function(){f.DomEvent.on(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){f.DomEvent.off(this._container,"mousedown",this._onMouseDown),this._moved=!1},moved:function(){return this._moved},_onMouseDown:function(a){return this._moved=!1,!a.shiftKey||1!==a.which&&1!==a.button?!1:(f.DomUtil.disableTextSelection(),f.DomUtil.disableImageDrag(),this._startLayerPoint=this._map.mouseEventToLayerPoint(a),void f.DomEvent.on(c,"mousemove",this._onMouseMove,this).on(c,"mouseup",this._onMouseUp,this).on(c,"keydown",this._onKeyDown,this))},_onMouseMove:function(a){this._moved||(this._box=f.DomUtil.create("div","leaflet-zoom-box",this._pane),f.DomUtil.setPosition(this._box,this._startLayerPoint),this._container.style.cursor="crosshair",this._map.fire("boxzoomstart"));var b=this._startLayerPoint,c=this._box,d=this._map.mouseEventToLayerPoint(a),e=d.subtract(b),g=new f.Point(Math.min(d.x,b.x),Math.min(d.y,b.y));f.DomUtil.setPosition(c,g),this._moved=!0,c.style.width=Math.max(0,Math.abs(e.x)-4)+"px",c.style.height=Math.max(0,Math.abs(e.y)-4)+"px"},_finish:function(){this._moved&&(this._pane.removeChild(this._box),this._container.style.cursor=""),f.DomUtil.enableTextSelection(),f.DomUtil.enableImageDrag(),f.DomEvent.off(c,"mousemove",this._onMouseMove).off(c,"mouseup",this._onMouseUp).off(c,"keydown",this._onKeyDown)},_onMouseUp:function(a){this._finish();var b=this._map,c=b.mouseEventToLayerPoint(a);if(!this._startLayerPoint.equals(c)){var d=new f.LatLngBounds(b.layerPointToLatLng(this._startLayerPoint),b.layerPointToLatLng(c));b.fitBounds(d),b.fire("boxzoomend",{boxZoomBounds:d})}},_onKeyDown:function(a){27===a.keyCode&&this._finish()}}),f.Map.addInitHook("addHandler","boxZoom",f.Map.BoxZoom),f.Map.mergeOptions({keyboard:!0,keyboardPanOffset:80,keyboardZoomOffset:1}),f.Map.Keyboard=f.Handler.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,173]},initialize:function(a){this._map=a,this._setPanOffset(a.options.keyboardPanOffset),this._setZoomOffset(a.options.keyboardZoomOffset)},addHooks:function(){var a=this._map._container;-1===a.tabIndex&&(a.tabIndex="0"),f.DomEvent.on(a,"focus",this._onFocus,this).on(a,"blur",this._onBlur,this).on(a,"mousedown",this._onMouseDown,this),this._map.on("focus",this._addHooks,this).on("blur",this._removeHooks,this)},removeHooks:function(){this._removeHooks();var a=this._map._container;f.DomEvent.off(a,"focus",this._onFocus,this).off(a,"blur",this._onBlur,this).off(a,"mousedown",this._onMouseDown,this),this._map.off("focus",this._addHooks,this).off("blur",this._removeHooks,this)},_onMouseDown:function(){if(!this._focused){var b=c.body,d=c.documentElement,e=b.scrollTop||d.scrollTop,f=b.scrollLeft||d.scrollLeft;this._map._container.focus(),a.scrollTo(f,e)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanOffset:function(a){var b,c,d=this._panKeys={},e=this.keyCodes;for(b=0,c=e.left.length;c>b;b++)d[e.left[b]]=[-1*a,0];for(b=0,c=e.right.length;c>b;b++)d[e.right[b]]=[a,0];for(b=0,c=e.down.length;c>b;b++)d[e.down[b]]=[0,a];for(b=0,c=e.up.length;c>b;b++)d[e.up[b]]=[0,-1*a]},_setZoomOffset:function(a){var b,c,d=this._zoomKeys={},e=this.keyCodes;for(b=0,c=e.zoomIn.length;c>b;b++)d[e.zoomIn[b]]=a;for(b=0,c=e.zoomOut.length;c>b;b++)d[e.zoomOut[b]]=-a},_addHooks:function(){f.DomEvent.on(c,"keydown",this._onKeyDown,this)},_removeHooks:function(){f.DomEvent.off(c,"keydown",this._onKeyDown,this)},_onKeyDown:function(a){var b=a.keyCode,c=this._map;if(b in this._panKeys){if(c._panAnim&&c._panAnim._inProgress)return;c.panBy(this._panKeys[b]),c.options.maxBounds&&c.panInsideBounds(c.options.maxBounds)}else{if(!(b in this._zoomKeys))return;c.setZoom(c.getZoom()+this._zoomKeys[b])}f.DomEvent.stop(a)}}),f.Map.addInitHook("addHandler","keyboard",f.Map.Keyboard),f.Handler.MarkerDrag=f.Handler.extend({initialize:function(a){this._marker=a},addHooks:function(){var a=this._marker._icon;this._draggable||(this._draggable=new f.Draggable(a,a)),this._draggable.on("dragstart",this._onDragStart,this).on("drag",this._onDrag,this).on("dragend",this._onDragEnd,this),this._draggable.enable(),f.DomUtil.addClass(this._marker._icon,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off("dragstart",this._onDragStart,this).off("drag",this._onDrag,this).off("dragend",this._onDragEnd,this),this._draggable.disable(),f.DomUtil.removeClass(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_onDragStart:function(){this._marker.closePopup().fire("movestart").fire("dragstart")},_onDrag:function(){var a=this._marker,b=a._shadow,c=f.DomUtil.getPosition(a._icon),d=a._map.layerPointToLatLng(c);b&&f.DomUtil.setPosition(b,c),a._latlng=d,a.fire("move",{latlng:d}).fire("drag")},_onDragEnd:function(a){this._marker.fire("moveend").fire("dragend",a)}}),f.Control=f.Class.extend({options:{position:"topright"},initialize:function(a){f.setOptions(this,a)},getPosition:function(){return this.options.position},setPosition:function(a){var b=this._map;return b&&b.removeControl(this),this.options.position=a,b&&b.addControl(this),this},getContainer:function(){return this._container},addTo:function(a){this._map=a;var b=this._container=this.onAdd(a),c=this.getPosition(),d=a._controlCorners[c];return f.DomUtil.addClass(b,"leaflet-control"),-1!==c.indexOf("bottom")?d.insertBefore(b,d.firstChild):d.appendChild(b),this},removeFrom:function(a){var b=this.getPosition(),c=a._controlCorners[b];return c.removeChild(this._container),this._map=null,this.onRemove&&this.onRemove(a),this},_refocusOnMap:function(){this._map&&this._map.getContainer().focus()}}),f.control=function(a){return new f.Control(a)},f.Map.include({addControl:function(a){return a.addTo(this),this},removeControl:function(a){return a.removeFrom(this),this},_initControlPos:function(){function a(a,e){var g=c+a+" "+c+e;b[a+e]=f.DomUtil.create("div",g,d)}var b=this._controlCorners={},c="leaflet-",d=this._controlContainer=f.DomUtil.create("div",c+"control-container",this._container);a("top","left"),a("top","right"),a("bottom","left"),a("bottom","right")},_clearControlPos:function(){this._container.removeChild(this._controlContainer)}}),f.Control.Zoom=f.Control.extend({options:{position:"topleft",zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"-",zoomOutTitle:"Zoom out"},onAdd:function(a){var b="leaflet-control-zoom",c=f.DomUtil.create("div",b+" leaflet-bar");return this._map=a,this._zoomInButton=this._createButton(this.options.zoomInText,this.options.zoomInTitle,b+"-in",c,this._zoomIn,this),this._zoomOutButton=this._createButton(this.options.zoomOutText,this.options.zoomOutTitle,b+"-out",c,this._zoomOut,this),this._updateDisabled(),a.on("zoomend zoomlevelschange",this._updateDisabled,this),c},onRemove:function(a){a.off("zoomend zoomlevelschange",this._updateDisabled,this)},_zoomIn:function(a){this._map.zoomIn(a.shiftKey?3:1)},_zoomOut:function(a){this._map.zoomOut(a.shiftKey?3:1)},_createButton:function(a,b,c,d,e,g){var h=f.DomUtil.create("a",c,d);h.innerHTML=a,h.href="#",h.title=b;var i=f.DomEvent.stopPropagation;return f.DomEvent.on(h,"click",i).on(h,"mousedown",i).on(h,"dblclick",i).on(h,"click",f.DomEvent.preventDefault).on(h,"click",e,g).on(h,"click",this._refocusOnMap,g),h},_updateDisabled:function(){var a=this._map,b="leaflet-disabled";f.DomUtil.removeClass(this._zoomInButton,b),f.DomUtil.removeClass(this._zoomOutButton,b),a._zoom===a.getMinZoom()&&f.DomUtil.addClass(this._zoomOutButton,b),a._zoom===a.getMaxZoom()&&f.DomUtil.addClass(this._zoomInButton,b)}}),f.Map.mergeOptions({zoomControl:!0}),f.Map.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new f.Control.Zoom,this.addControl(this.zoomControl))}),f.control.zoom=function(a){return new f.Control.Zoom(a)},f.Control.Attribution=f.Control.extend({options:{position:"bottomright",prefix:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>'},initialize:function(a){f.setOptions(this,a),this._attributions={}},onAdd:function(a){this._container=f.DomUtil.create("div","leaflet-control-attribution"),f.DomEvent.disableClickPropagation(this._container);for(var b in a._layers)a._layers[b].getAttribution&&this.addAttribution(a._layers[b].getAttribution());return a.on("layeradd",this._onLayerAdd,this).on("layerremove",this._onLayerRemove,this),this._update(),this._container},onRemove:function(a){a.off("layeradd",this._onLayerAdd).off("layerremove",this._onLayerRemove)},setPrefix:function(a){return this.options.prefix=a,this._update(),this},addAttribution:function(a){return a?(this._attributions[a]||(this._attributions[a]=0),this._attributions[a]++,this._update(),this):void 0},removeAttribution:function(a){return a?(this._attributions[a]&&(this._attributions[a]--,this._update()),this):void 0},_update:function(){if(this._map){var a=[];for(var b in this._attributions)this._attributions[b]&&a.push(b);var c=[];this.options.prefix&&c.push(this.options.prefix),a.length&&c.push(a.join(", ")),this._container.innerHTML=c.join(" | ")}},_onLayerAdd:function(a){a.layer.getAttribution&&this.addAttribution(a.layer.getAttribution())},_onLayerRemove:function(a){a.layer.getAttribution&&this.removeAttribution(a.layer.getAttribution())}}),f.Map.mergeOptions({attributionControl:!0}),f.Map.addInitHook(function(){this.options.attributionControl&&(this.attributionControl=(new f.Control.Attribution).addTo(this))}),f.control.attribution=function(a){return new f.Control.Attribution(a)},f.Control.Scale=f.Control.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0,updateWhenIdle:!1},onAdd:function(a){this._map=a;var b="leaflet-control-scale",c=f.DomUtil.create("div",b),d=this.options;return this._addScales(d,b,c),a.on(d.updateWhenIdle?"moveend":"move",this._update,this),a.whenReady(this._update,this),c},onRemove:function(a){a.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(a,b,c){a.metric&&(this._mScale=f.DomUtil.create("div",b+"-line",c)),a.imperial&&(this._iScale=f.DomUtil.create("div",b+"-line",c))},_update:function(){var a=this._map.getBounds(),b=a.getCenter().lat,c=6378137*Math.PI*Math.cos(b*Math.PI/180),d=c*(a.getNorthEast().lng-a.getSouthWest().lng)/180,e=this._map.getSize(),f=this.options,g=0;e.x>0&&(g=d*(f.maxWidth/e.x)),this._updateScales(f,g)},_updateScales:function(a,b){a.metric&&b&&this._updateMetric(b),a.imperial&&b&&this._updateImperial(b)},_updateMetric:function(a){var b=this._getRoundNum(a);this._mScale.style.width=this._getScaleWidth(b/a)+"px",this._mScale.innerHTML=1e3>b?b+" m":b/1e3+" km"},_updateImperial:function(a){var b,c,d,e=3.2808399*a,f=this._iScale;e>5280?(b=e/5280,c=this._getRoundNum(b),f.style.width=this._getScaleWidth(c/b)+"px",f.innerHTML=c+" mi"):(d=this._getRoundNum(e),f.style.width=this._getScaleWidth(d/e)+"px",f.innerHTML=d+" ft")},_getScaleWidth:function(a){return Math.round(this.options.maxWidth*a)-10},_getRoundNum:function(a){var b=Math.pow(10,(Math.floor(a)+"").length-1),c=a/b;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:1,b*c}}),f.control.scale=function(a){return new f.Control.Scale(a)},f.Control.Layers=f.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0},initialize:function(a,b,c){f.setOptions(this,c),this._layers={},this._lastZIndex=0,this._handlingClick=!1;for(var d in a)this._addLayer(a[d],d);for(d in b)this._addLayer(b[d],d,!0)},onAdd:function(a){return this._initLayout(),this._update(),a.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this),this._container},onRemove:function(a){a.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(a,b){return this._addLayer(a,b),this._update(),this},addOverlay:function(a,b){return this._addLayer(a,b,!0),this._update(),this},removeLayer:function(a){var b=f.stamp(a);return delete this._layers[b],this._update(),this},_initLayout:function(){var a="leaflet-control-layers",b=this._container=f.DomUtil.create("div",a);b.setAttribute("aria-haspopup",!0),f.Browser.touch?f.DomEvent.on(b,"click",f.DomEvent.stopPropagation):f.DomEvent.disableClickPropagation(b).disableScrollPropagation(b);var c=this._form=f.DomUtil.create("form",a+"-list");if(this.options.collapsed){f.Browser.android||f.DomEvent.on(b,"mouseover",this._expand,this).on(b,"mouseout",this._collapse,this);var d=this._layersLink=f.DomUtil.create("a",a+"-toggle",b);d.href="#",d.title="Layers",f.Browser.touch?f.DomEvent.on(d,"click",f.DomEvent.stop).on(d,"click",this._expand,this):f.DomEvent.on(d,"focus",this._expand,this),f.DomEvent.on(c,"click",function(){setTimeout(f.bind(this._onInputClick,this),0)},this),this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=f.DomUtil.create("div",a+"-base",c),this._separator=f.DomUtil.create("div",a+"-separator",c),this._overlaysList=f.DomUtil.create("div",a+"-overlays",c),b.appendChild(c)},_addLayer:function(a,b,c){var d=f.stamp(a);this._layers[d]={layer:a,name:b,overlay:c},this.options.autoZIndex&&a.setZIndex&&(this._lastZIndex++,a.setZIndex(this._lastZIndex))},_update:function(){if(this._container){this._baseLayersList.innerHTML="",this._overlaysList.innerHTML="";var a,b,c=!1,d=!1;for(a in this._layers)b=this._layers[a],this._addItem(b),d=d||b.overlay,c=c||!b.overlay;this._separator.style.display=d&&c?"":"none"}},_onLayerChange:function(a){var b=this._layers[f.stamp(a.layer)];if(b){this._handlingClick||this._update();var c=b.overlay?"layeradd"===a.type?"overlayadd":"overlayremove":"layeradd"===a.type?"baselayerchange":null;c&&this._map.fire(c,b)}},_createRadioElement:function(a,b){var d='<input type="radio" class="leaflet-control-layers-selector" name="'+a+'"';b&&(d+=' checked="checked"'),d+="/>";var e=c.createElement("div");return e.innerHTML=d,e.firstChild},_addItem:function(a){var b,d=c.createElement("label"),e=this._map.hasLayer(a.layer);a.overlay?(b=c.createElement("input"),b.type="checkbox",b.className="leaflet-control-layers-selector",b.defaultChecked=e):b=this._createRadioElement("leaflet-base-layers",e),b.layerId=f.stamp(a.layer),f.DomEvent.on(b,"click",this._onInputClick,this);var g=c.createElement("span");g.innerHTML=" "+a.name,d.appendChild(b),d.appendChild(g);var h=a.overlay?this._overlaysList:this._baseLayersList;return h.appendChild(d),d},_onInputClick:function(){var a,b,c,d=this._form.getElementsByTagName("input"),e=d.length;for(this._handlingClick=!0,a=0;e>a;a++)b=d[a],c=this._layers[b.layerId],b.checked&&!this._map.hasLayer(c.layer)?this._map.addLayer(c.layer):!b.checked&&this._map.hasLayer(c.layer)&&this._map.removeLayer(c.layer);this._handlingClick=!1,this._refocusOnMap()},_expand:function(){f.DomUtil.addClass(this._container,"leaflet-control-layers-expanded")},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")}}),f.control.layers=function(a,b,c){return new f.Control.Layers(a,b,c)},f.PosAnimation=f.Class.extend({includes:f.Mixin.Events,run:function(a,b,c,d){this.stop(),this._el=a,this._inProgress=!0,this._newPos=b,this.fire("start"),a.style[f.DomUtil.TRANSITION]="all "+(c||.25)+"s cubic-bezier(0,0,"+(d||.5)+",1)",f.DomEvent.on(a,f.DomUtil.TRANSITION_END,this._onTransitionEnd,this),f.DomUtil.setPosition(a,b),f.Util.falseFn(a.offsetWidth),this._stepTimer=setInterval(f.bind(this._onStep,this),50)},stop:function(){this._inProgress&&(f.DomUtil.setPosition(this._el,this._getPos()),this._onTransitionEnd(),f.Util.falseFn(this._el.offsetWidth))},_onStep:function(){var a=this._getPos();return a?(this._el._leaflet_pos=a,void this.fire("step")):void this._onTransitionEnd()},_transformRe:/([-+]?(?:\d*\.)?\d+)\D*, ([-+]?(?:\d*\.)?\d+)\D*\)/,_getPos:function(){var b,c,d,e=this._el,g=a.getComputedStyle(e);if(f.Browser.any3d){if(d=g[f.DomUtil.TRANSFORM].match(this._transformRe),!d)return;b=parseFloat(d[1]),c=parseFloat(d[2])}else b=parseFloat(g.left),c=parseFloat(g.top);return new f.Point(b,c,!0)},_onTransitionEnd:function(){f.DomEvent.off(this._el,f.DomUtil.TRANSITION_END,this._onTransitionEnd,this),this._inProgress&&(this._inProgress=!1,this._el.style[f.DomUtil.TRANSITION]="",this._el._leaflet_pos=this._newPos,clearInterval(this._stepTimer),this.fire("step").fire("end"))}}),f.Map.include({setView:function(a,b,c){if(b=b===d?this._zoom:this._limitZoom(b),a=this._limitCenter(f.latLng(a),b,this.options.maxBounds),c=c||{},this._panAnim&&this._panAnim.stop(),this._loaded&&!c.reset&&c!==!0){c.animate!==d&&(c.zoom=f.extend({animate:c.animate},c.zoom),c.pan=f.extend({animate:c.animate},c.pan));var e=this._zoom!==b?this._tryAnimatedZoom&&this._tryAnimatedZoom(a,b,c.zoom):this._tryAnimatedPan(a,c.pan);if(e)return clearTimeout(this._sizeTimer),this}return this._resetView(a,b),this},panBy:function(a,b){if(a=f.point(a).round(),b=b||{},!a.x&&!a.y)return this;if(this._panAnim||(this._panAnim=new f.PosAnimation,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),b.noMoveStart||this.fire("movestart"),b.animate!==!1){f.DomUtil.addClass(this._mapPane,"leaflet-pan-anim");var c=this._getMapPanePos().subtract(a);this._panAnim.run(this._mapPane,c,b.duration||.25,b.easeLinearity)}else this._rawPanBy(a),this.fire("move").fire("moveend");return this},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){f.DomUtil.removeClass(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(a,b){var c=this._getCenterOffset(a)._floor();return(b&&b.animate)===!0||this.getSize().contains(c)?(this.panBy(c,b),!0):!1}}),f.PosAnimation=f.DomUtil.TRANSITION?f.PosAnimation:f.PosAnimation.extend({run:function(a,b,c,d){this.stop(),this._el=a,this._inProgress=!0,this._duration=c||.25,this._easeOutPower=1/Math.max(d||.5,.2),this._startPos=f.DomUtil.getPosition(a),this._offset=b.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(),this._complete())},_animate:function(){this._animId=f.Util.requestAnimFrame(this._animate,this),this._step()},_step:function(){var a=+new Date-this._startTime,b=1e3*this._duration;b>a?this._runFrame(this._easeOut(a/b)):(this._runFrame(1),this._complete())},_runFrame:function(a){var b=this._startPos.add(this._offset.multiplyBy(a));f.DomUtil.setPosition(this._el,b),this.fire("step")},_complete:function(){f.Util.cancelAnimFrame(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(a){return 1-Math.pow(1-a,this._easeOutPower)}}),f.Map.mergeOptions({zoomAnimation:!0,zoomAnimationThreshold:4}),f.DomUtil.TRANSITION&&f.Map.addInitHook(function(){this._zoomAnimated=this.options.zoomAnimation&&f.DomUtil.TRANSITION&&f.Browser.any3d&&!f.Browser.android23&&!f.Browser.mobileOpera,this._zoomAnimated&&f.DomEvent.on(this._mapPane,f.DomUtil.TRANSITION_END,this._catchTransitionEnd,this)}),f.Map.include(f.DomUtil.TRANSITION?{_catchTransitionEnd:function(a){this._animatingZoom&&a.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(a,b,c){if(this._animatingZoom)return!0;if(c=c||{},!this._zoomAnimated||c.animate===!1||this._nothingToAnimate()||Math.abs(b-this._zoom)>this.options.zoomAnimationThreshold)return!1;var d=this.getZoomScale(b),e=this._getCenterOffset(a)._divideBy(1-1/d),f=this._getCenterLayerPoint()._add(e);return c.animate===!0||this.getSize().contains(e)?(this.fire("movestart").fire("zoomstart"),this._animateZoom(a,b,f,d,null,!0),!0):!1},_animateZoom:function(a,b,c,d,e,g,h){h||(this._animatingZoom=!0),f.DomUtil.addClass(this._mapPane,"leaflet-zoom-anim"),this._animateToCenter=a,this._animateToZoom=b,f.Draggable&&(f.Draggable._disabled=!0),f.Util.requestAnimFrame(function(){this.fire("zoomanim",{center:a,zoom:b,origin:c,scale:d,delta:e,backwards:g})},this)},_onZoomTransitionEnd:function(){this._animatingZoom=!1,f.DomUtil.removeClass(this._mapPane,"leaflet-zoom-anim"),this._resetView(this._animateToCenter,this._animateToZoom,!0,!0),f.Draggable&&(f.Draggable._disabled=!1)}}:{}),f.TileLayer.include({_animateZoom:function(a){this._animating||(this._animating=!0,this._prepareBgBuffer());var b=this._bgBuffer,c=f.DomUtil.TRANSFORM,d=a.delta?f.DomUtil.getTranslateString(a.delta):b.style[c],e=f.DomUtil.getScaleString(a.scale,a.origin);b.style[c]=a.backwards?e+" "+d:d+" "+e},_endZoomAnim:function(){var a=this._tileContainer,b=this._bgBuffer;a.style.visibility="",a.parentNode.appendChild(a),f.Util.falseFn(b.offsetWidth),this._animating=!1},_clearBgBuffer:function(){var a=this._map;!a||a._animatingZoom||a.touchZoom._zooming||(this._bgBuffer.innerHTML="",this._bgBuffer.style[f.DomUtil.TRANSFORM]="")},_prepareBgBuffer:function(){var a=this._tileContainer,b=this._bgBuffer,c=this._getLoadedTilesPercentage(b),d=this._getLoadedTilesPercentage(a);return b&&c>.5&&.5>d?(a.style.visibility="hidden",void this._stopLoadingImages(a)):(b.style.visibility="hidden",b.style[f.DomUtil.TRANSFORM]="",this._tileContainer=b,b=this._bgBuffer=a,this._stopLoadingImages(b),void clearTimeout(this._clearBgBufferTimer))},_getLoadedTilesPercentage:function(a){var b,c,d=a.getElementsByTagName("img"),e=0;for(b=0,c=d.length;c>b;b++)d[b].complete&&e++;return e/c},_stopLoadingImages:function(a){var b,c,d,e=Array.prototype.slice.call(a.getElementsByTagName("img"));for(b=0,c=e.length;c>b;b++)d=e[b],d.complete||(d.onload=f.Util.falseFn,d.onerror=f.Util.falseFn,d.src=f.Util.emptyImageUrl,d.parentNode.removeChild(d))}}),f.Map.include({_defaultLocateOptions:{watch:!1,setView:!1,maxZoom:1/0,timeout:1e4,maximumAge:0,enableHighAccuracy:!1},locate:function(a){if(a=this._locateOptions=f.extend(this._defaultLocateOptions,a),!navigator.geolocation)return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var b=f.bind(this._handleGeolocationResponse,this),c=f.bind(this._handleGeolocationError,this);return a.watch?this._locationWatchId=navigator.geolocation.watchPosition(b,c,a):navigator.geolocation.getCurrentPosition(b,c,a),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(a){var b=a.code,c=a.message||(1===b?"permission denied":2===b?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:b,message:"Geolocation error: "+c+"."})},_handleGeolocationResponse:function(a){var b=a.coords.latitude,c=a.coords.longitude,d=new f.LatLng(b,c),e=180*a.coords.accuracy/40075017,g=e/Math.cos(f.LatLng.DEG_TO_RAD*b),h=f.latLngBounds([b-e,c-g],[b+e,c+g]),i=this._locateOptions;if(i.setView){var j=Math.min(this.getBoundsZoom(h),i.maxZoom);this.setView(d,j)}var k={latlng:d,bounds:h,timestamp:a.timestamp};for(var l in a.coords)"number"==typeof a.coords[l]&&(k[l]=a.coords[l]);this.fire("locationfound",k)}})}(window,document)},{}],59:[function(a,b,c){!function(a,b){"object"==typeof c&&c?b(c):"function"==typeof define&&define.amd?define(["exports"],b):b(a.Mustache={})}(this,function(a){function b(a){return"function"==typeof a}function c(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function d(a,b){return o.call(a,b)}function e(a){return!d(p,a)}function f(a){return String(a).replace(/[&<>"'\/]/g,function(a){return q[a]})}function g(b,d){function f(){if(w&&!x)for(;q.length;)delete p[q.pop()];else q=[];w=!1,x=!1}function g(a){if("string"==typeof a&&(a=a.split(s,2)),!n(a)||2!==a.length)throw new Error("Invalid tags: "+a);k=new RegExp(c(a[0])+"\\s*"),l=new RegExp("\\s*"+c(a[1])),m=new RegExp("\\s*"+c("}"+a[1]))}if(!b)return[];var k,l,m,o=[],p=[],q=[],w=!1,x=!1;g(d||a.tags);for(var y,z,A,B,C,D,E=new j(b);!E.eos();){if(y=E.pos,A=E.scanUntil(k))for(var F=0,G=A.length;G>F;++F)B=A.charAt(F),e(B)?q.push(p.length):x=!0,p.push(["text",B,y,y+1]),y+=1,"\n"===B&&f();if(!E.scan(k))break;if(w=!0,z=E.scan(v)||"name",E.scan(r),"="===z?(A=E.scanUntil(t),E.scan(t),E.scanUntil(l)):"{"===z?(A=E.scanUntil(m),E.scan(u),E.scanUntil(l),z="&"):A=E.scanUntil(l),!E.scan(l))throw new Error("Unclosed tag at "+E.pos);if(C=[z,A,y,E.pos],p.push(C),"#"===z||"^"===z)o.push(C);else if("/"===z){if(D=o.pop(),!D)throw new Error('Unopened section "'+A+'" at '+y);if(D[1]!==A)throw new Error('Unclosed section "'+D[1]+'" at '+y)}else"name"===z||"{"===z||"&"===z?x=!0:"="===z&&g(A)}if(D=o.pop())throw new Error('Unclosed section "'+D[1]+'" at '+E.pos);return i(h(p))}function h(a){for(var b,c,d=[],e=0,f=a.length;f>e;++e)b=a[e],b&&("text"===b[0]&&c&&"text"===c[0]?(c[1]+=b[1],c[3]=b[3]):(d.push(b),c=b));return d}function i(a){for(var b,c,d=[],e=d,f=[],g=0,h=a.length;h>g;++g)switch(b=a[g],b[0]){case"#":case"^":e.push(b),f.push(b),e=b[4]=[];break;case"/":c=f.pop(),c[5]=b[2],e=f.length>0?f[f.length-1][4]:d;break;default:e.push(b)}return d}function j(a){this.string=a,this.tail=a,this.pos=0}function k(a,b){this.view=null==a?{}:a,this.cache={".":this.view},this.parent=b}function l(){this.cache={}}var m=Object.prototype.toString,n=Array.isArray||function(a){return"[object Array]"===m.call(a)},o=RegExp.prototype.test,p=/\S/,q={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},r=/\s*/,s=/\s+/,t=/\s*=/,u=/\s*\}/,v=/#|\^|\/|>|\{|&|=|!/;j.prototype.eos=function(){return""===this.tail},j.prototype.scan=function(a){var b=this.tail.match(a);if(!b||0!==b.index)return"";var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,c},j.prototype.scanUntil=function(a){var b,c=this.tail.search(a);switch(c){case-1:b=this.tail,this.tail="";break;case 0:b="";break;default:b=this.tail.substring(0,c),this.tail=this.tail.substring(c)}return this.pos+=b.length,b},k.prototype.push=function(a){return new k(a,this)},k.prototype.lookup=function(a){var c,d=this.cache;if(a in d)c=d[a];else{for(var e,f,g=this;g;){if(a.indexOf(".")>0)for(c=g.view,e=a.split("."),f=0;null!=c&&f<e.length;)c=c[e[f++]];else"object"==typeof g.view&&(c=g.view[a]);if(null!=c)break;g=g.parent}d[a]=c}return b(c)&&(c=c.call(this.view)),c},l.prototype.clearCache=function(){this.cache={}},l.prototype.parse=function(a,b){var c=this.cache,d=c[a];return null==d&&(d=c[a]=g(a,b)),d},l.prototype.render=function(a,b,c){var d=this.parse(a),e=b instanceof k?b:new k(b);return this.renderTokens(d,e,c,a)},l.prototype.renderTokens=function(a,b,c,d){for(var e,f,g,h="",i=0,j=a.length;j>i;++i)g=void 0,e=a[i],f=e[0],"#"===f?g=this._renderSection(e,b,c,d):"^"===f?g=this._renderInverted(e,b,c,d):">"===f?g=this._renderPartial(e,b,c,d):"&"===f?g=this._unescapedValue(e,b):"name"===f?g=this._escapedValue(e,b):"text"===f&&(g=this._rawValue(e)),void 0!==g&&(h+=g);return h},l.prototype._renderSection=function(a,c,d,e){function f(a){return g.render(a,c,d)}var g=this,h="",i=c.lookup(a[1]);if(i){if(n(i))for(var j=0,k=i.length;k>j;++j)h+=this.renderTokens(a[4],c.push(i[j]),d,e);else if("object"==typeof i||"string"==typeof i)h+=this.renderTokens(a[4],c.push(i),d,e);else if(b(i)){if("string"!=typeof e)throw new Error("Cannot use higher-order sections without the original template");i=i.call(c.view,e.slice(a[3],a[5]),f),null!=i&&(h+=i)}else h+=this.renderTokens(a[4],c,d,e);return h}},l.prototype._renderInverted=function(a,b,c,d){var e=b.lookup(a[1]);return!e||n(e)&&0===e.length?this.renderTokens(a[4],b,c,d):void 0},l.prototype._renderPartial=function(a,c,d){if(d){var e=b(d)?d(a[1]):d[a[1]];return null!=e?this.renderTokens(this.parse(e),c,d,e):void 0}},l.prototype._unescapedValue=function(a,b){var c=b.lookup(a[1]);return null!=c?c:void 0},l.prototype._escapedValue=function(b,c){var d=c.lookup(b[1]);return null!=d?a.escape(d):void 0},l.prototype._rawValue=function(a){return a[1]},a.name="mustache.js",a.version="1.1.0",a.tags=["{{","}}"];var w=new l;a.clearCache=function(){return w.clearCache()},a.parse=function(a,b){return w.parse(a,b)},a.render=function(a,b,c){return w.render(a,b,c)},a.to_html=function(c,d,e,f){var g=a.render(c,d,e);return b(f)?void f(g):g},a.escape=f,a.Scanner=j,a.Context=k,a.Writer=l})},{}],60:[function(a,b,c){"use strict";b.exports=a("./src/js/main")},{"./src/js/main":66}],61:[function(a,b,c){"use strict";function d(a,b){var c=a.className.split(" ");c.indexOf(b)<0&&c.push(b),a.className=c.join(" ")}function e(a,b){var c=a.className.split(" "),d=c.indexOf(b);d>=0&&c.splice(d,1),a.className=c.join(" ")}c.add=function(a,b){a.classList?a.classList.add(b):d(a,b)},c.remove=function(a,b){a.classList?a.classList.remove(b):e(a,b)},c.list=function(a){return a.classList?Array.prototype.slice.apply(a.classList):a.className.split(" ")}},{}],62:[function(a,b,c){"use strict";function d(a,b){return window.getComputedStyle(a)[b]}function e(a,b,c){return"number"==typeof c&&(c=c.toString()+"px"),a.style[b]=c,a}function f(a,b){for(var c in b){var d=b[c];"number"==typeof d&&(d=d.toString()+"px"),a.style[c]=d}return a}var g={};g.e=function(a,b){var c=document.createElement(a);return c.className=b,c},g.appendTo=function(a,b){return b.appendChild(a),a},g.css=function(a,b,c){return"object"==typeof b?f(a,b):"undefined"==typeof c?d(a,b):e(a,b,c)},g.matches=function(a,b){return"undefined"!=typeof a.matches?a.matches(b):"undefined"!=typeof a.matchesSelector?a.matchesSelector(b):"undefined"!=typeof a.webkitMatchesSelector?a.webkitMatchesSelector(b):"undefined"!=typeof a.mozMatchesSelector?a.mozMatchesSelector(b):"undefined"!=typeof a.msMatchesSelector?a.msMatchesSelector(b):void 0;
},g.remove=function(a){"undefined"!=typeof a.remove?a.remove():a.parentNode&&a.parentNode.removeChild(a)},g.queryChildren=function(a,b){return Array.prototype.filter.call(a.childNodes,function(a){return g.matches(a,b)})},b.exports=g},{}],63:[function(a,b,c){"use strict";var d=function(a){this.element=a,this.events={}};d.prototype.bind=function(a,b){"undefined"==typeof this.events[a]&&(this.events[a]=[]),this.events[a].push(b),this.element.addEventListener(a,b,!1)},d.prototype.unbind=function(a,b){var c="undefined"!=typeof b;this.events[a]=this.events[a].filter(function(d){return c&&d!==b?!0:(this.element.removeEventListener(a,d,!1),!1)},this)},d.prototype.unbindAll=function(){for(var a in this.events)this.unbind(a)};var e=function(){this.eventElements=[]};e.prototype.eventElement=function(a){var b=this.eventElements.filter(function(b){return b.element===a})[0];return"undefined"==typeof b&&(b=new d(a),this.eventElements.push(b)),b},e.prototype.bind=function(a,b,c){this.eventElement(a).bind(b,c)},e.prototype.unbind=function(a,b,c){this.eventElement(a).unbind(b,c)},e.prototype.unbindAll=function(){for(var a=0;a<this.eventElements.length;a++)this.eventElements[a].unbindAll()},e.prototype.once=function(a,b,c){var d=this.eventElement(a),e=function(a){d.unbind(b,e),c(a)};d.bind(b,e)},b.exports=e},{}],64:[function(a,b,c){"use strict";b.exports=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}()},{}],65:[function(a,b,c){"use strict";var d=a("./class"),e=a("./dom");c.toInt=function(a){return parseInt(a,10)||0},c.clone=function(a){if(null===a)return null;if("object"==typeof a){var b={};for(var c in a)b[c]=this.clone(a[c]);return b}return a},c.extend=function(a,b){var c=this.clone(a);for(var d in b)c[d]=this.clone(b[d]);return c},c.isEditable=function(a){return e.matches(a,"input,[contenteditable]")||e.matches(a,"select,[contenteditable]")||e.matches(a,"textarea,[contenteditable]")||e.matches(a,"button,[contenteditable]")},c.removePsClasses=function(a){for(var b=d.list(a),c=0;c<b.length;c++){var e=b[c];0===e.indexOf("ps-")&&d.remove(a,e)}},c.outerWidth=function(a){return this.toInt(e.css(a,"width"))+this.toInt(e.css(a,"paddingLeft"))+this.toInt(e.css(a,"paddingRight"))+this.toInt(e.css(a,"borderLeftWidth"))+this.toInt(e.css(a,"borderRightWidth"))},c.startScrolling=function(a,b){d.add(a,"ps-in-scrolling"),"undefined"!=typeof b?d.add(a,"ps-"+b):(d.add(a,"ps-x"),d.add(a,"ps-y"))},c.stopScrolling=function(a,b){d.remove(a,"ps-in-scrolling"),"undefined"!=typeof b?d.remove(a,"ps-"+b):(d.remove(a,"ps-x"),d.remove(a,"ps-y"))},c.env={isWebKit:"WebkitAppearance"in document.documentElement.style,supportsTouch:"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,supportsIePointer:null!==window.navigator.msMaxTouchPoints}},{"./class":61,"./dom":62}],66:[function(a,b,c){"use strict";var d=a("./plugin/destroy"),e=a("./plugin/initialize"),f=a("./plugin/update");b.exports={initialize:e,update:f,destroy:d}},{"./plugin/destroy":68,"./plugin/initialize":76,"./plugin/update":80}],67:[function(a,b,c){"use strict";b.exports={maxScrollbarLength:null,minScrollbarLength:null,scrollXMarginOffset:0,scrollYMarginOffset:0,stopPropagationOnClick:!0,suppressScrollX:!1,suppressScrollY:!1,swipePropagation:!0,useBothWheelAxes:!1,useKeyboard:!0,useSelectionScroll:!1,wheelPropagation:!1,wheelSpeed:1}},{}],68:[function(a,b,c){"use strict";var d=a("../lib/dom"),e=a("../lib/helper"),f=a("./instances");b.exports=function(a){var b=f.get(a);b&&(b.event.unbindAll(),d.remove(b.scrollbarX),d.remove(b.scrollbarY),d.remove(b.scrollbarXRail),d.remove(b.scrollbarYRail),e.removePsClasses(a),f.remove(a))}},{"../lib/dom":62,"../lib/helper":65,"./instances":77}],69:[function(a,b,c){"use strict";function d(a,b){function c(a){return a.getBoundingClientRect()}var d=window.Event.prototype.stopPropagation.bind;b.settings.stopPropagationOnClick&&b.event.bind(b.scrollbarY,"click",d),b.event.bind(b.scrollbarYRail,"click",function(d){var f=e.toInt(b.scrollbarYHeight/2),i=b.railYRatio*(d.pageY-window.scrollY-c(b.scrollbarYRail).top-f),j=b.railYRatio*(b.railYHeight-b.scrollbarYHeight),k=i/j;0>k?k=0:k>1&&(k=1),h(a,"top",(b.contentHeight-b.containerHeight)*k),g(a),d.stopPropagation()}),b.settings.stopPropagationOnClick&&b.event.bind(b.scrollbarX,"click",d),b.event.bind(b.scrollbarXRail,"click",function(d){var f=e.toInt(b.scrollbarXWidth/2),i=b.railXRatio*(d.pageX-window.scrollX-c(b.scrollbarXRail).left-f),j=b.railXRatio*(b.railXWidth-b.scrollbarXWidth),k=i/j;0>k?k=0:k>1&&(k=1),h(a,"left",(b.contentWidth-b.containerWidth)*k-b.negativeScrollAdjustment),g(a),d.stopPropagation()})}var e=a("../../lib/helper"),f=a("../instances"),g=a("../update-geometry"),h=a("../update-scroll");b.exports=function(a){var b=f.get(a);d(a,b)}},{"../../lib/helper":65,"../instances":77,"../update-geometry":78,"../update-scroll":79}],70:[function(a,b,c){"use strict";function d(a,b){function c(c){var e=d+c*b.railXRatio,f=b.scrollbarXRail.getBoundingClientRect().left+b.railXRatio*(b.railXWidth-b.scrollbarXWidth);0>e?b.scrollbarXLeft=0:e>f?b.scrollbarXLeft=f:b.scrollbarXLeft=e;var h=g.toInt(b.scrollbarXLeft*(b.contentWidth-b.containerWidth)/(b.containerWidth-b.railXRatio*b.scrollbarXWidth))-b.negativeScrollAdjustment;j(a,"left",h)}var d=null,e=null,h=function(b){c(b.pageX-e),i(a),b.stopPropagation(),b.preventDefault()},k=function(){g.stopScrolling(a,"x"),b.event.unbind(b.ownerDocument,"mousemove",h)};b.event.bind(b.scrollbarX,"mousedown",function(c){e=c.pageX,d=g.toInt(f.css(b.scrollbarX,"left"))*b.railXRatio,g.startScrolling(a,"x"),b.event.bind(b.ownerDocument,"mousemove",h),b.event.once(b.ownerDocument,"mouseup",k),c.stopPropagation(),c.preventDefault()})}function e(a,b){function c(c){var e=d+c*b.railYRatio,f=b.scrollbarYRail.getBoundingClientRect().top+b.railYRatio*(b.railYHeight-b.scrollbarYHeight);0>e?b.scrollbarYTop=0:e>f?b.scrollbarYTop=f:b.scrollbarYTop=e;var h=g.toInt(b.scrollbarYTop*(b.contentHeight-b.containerHeight)/(b.containerHeight-b.railYRatio*b.scrollbarYHeight));j(a,"top",h)}var d=null,e=null,h=function(b){c(b.pageY-e),i(a),b.stopPropagation(),b.preventDefault()},k=function(){g.stopScrolling(a,"y"),b.event.unbind(b.ownerDocument,"mousemove",h)};b.event.bind(b.scrollbarY,"mousedown",function(c){e=c.pageY,d=g.toInt(f.css(b.scrollbarY,"top"))*b.railYRatio,g.startScrolling(a,"y"),b.event.bind(b.ownerDocument,"mousemove",h),b.event.once(b.ownerDocument,"mouseup",k),c.stopPropagation(),c.preventDefault()})}var f=a("../../lib/dom"),g=a("../../lib/helper"),h=a("../instances"),i=a("../update-geometry"),j=a("../update-scroll");b.exports=function(a){var b=h.get(a);d(a,b),e(a,b)}},{"../../lib/dom":62,"../../lib/helper":65,"../instances":77,"../update-geometry":78,"../update-scroll":79}],71:[function(a,b,c){"use strict";function d(a,b){function c(c,d){var e=a.scrollTop;if(0===c){if(!b.scrollbarYActive)return!1;if(0===e&&d>0||e>=b.contentHeight-b.containerHeight&&0>d)return!b.settings.wheelPropagation}var f=a.scrollLeft;if(0===d){if(!b.scrollbarXActive)return!1;if(0===f&&0>c||f>=b.contentWidth-b.containerWidth&&c>0)return!b.settings.wheelPropagation}return!0}var d=!1;b.event.bind(a,"mouseenter",function(){d=!0}),b.event.bind(a,"mouseleave",function(){d=!1});var f=!1;b.event.bind(b.ownerDocument,"keydown",function(i){if((!i.isDefaultPrevented||!i.isDefaultPrevented())&&d){var j=document.activeElement?document.activeElement:b.ownerDocument.activeElement;if(j){for(;j.shadowRoot;)j=j.shadowRoot.activeElement;if(e.isEditable(j))return}var k=0,l=0;switch(i.which){case 37:k=-30;break;case 38:l=30;break;case 39:k=30;break;case 40:l=-30;break;case 33:l=90;break;case 32:l=i.shiftKey?90:-90;break;case 34:l=-90;break;case 35:l=i.ctrlKey?-b.contentHeight:-b.containerHeight;break;case 36:l=i.ctrlKey?a.scrollTop:b.containerHeight;break;default:return}h(a,"top",a.scrollTop-l),h(a,"left",a.scrollLeft+k),g(a),f=c(k,l),f&&i.preventDefault()}})}var e=a("../../lib/helper"),f=a("../instances"),g=a("../update-geometry"),h=a("../update-scroll");b.exports=function(a){var b=f.get(a);d(a,b)}},{"../../lib/helper":65,"../instances":77,"../update-geometry":78,"../update-scroll":79}],72:[function(a,b,c){"use strict";function d(a,b){function c(c,d){var e=a.scrollTop;if(0===c){if(!b.scrollbarYActive)return!1;if(0===e&&d>0||e>=b.contentHeight-b.containerHeight&&0>d)return!b.settings.wheelPropagation}var f=a.scrollLeft;if(0===d){if(!b.scrollbarXActive)return!1;if(0===f&&0>c||f>=b.contentWidth-b.containerWidth&&c>0)return!b.settings.wheelPropagation}return!0}function d(a){var b=a.deltaX,c=-1*a.deltaY;return"undefined"!=typeof b&&"undefined"!=typeof c||(b=-1*a.wheelDeltaX/6,c=a.wheelDeltaY/6),a.deltaMode&&1===a.deltaMode&&(b*=10,c*=10),b!==b&&c!==c&&(b=0,c=a.wheelDelta),[b,c]}function f(b,c){var d=a.querySelector("textarea:hover");if(d){var e=d.scrollHeight-d.clientHeight;if(e>0&&!(0===d.scrollTop&&c>0||d.scrollTop===e&&0>c))return!0;var f=d.scrollLeft-d.clientWidth;if(f>0&&!(0===d.scrollLeft&&0>b||d.scrollLeft===f&&b>0))return!0}return!1}function i(i){if(e.env.isWebKit||!a.querySelector("select:focus")){var k=d(i),l=k[0],m=k[1];f(l,m)||(j=!1,b.settings.useBothWheelAxes?b.scrollbarYActive&&!b.scrollbarXActive?(m?h(a,"top",a.scrollTop-m*b.settings.wheelSpeed):h(a,"top",a.scrollTop+l*b.settings.wheelSpeed),j=!0):b.scrollbarXActive&&!b.scrollbarYActive&&(l?h(a,"left",a.scrollLeft+l*b.settings.wheelSpeed):h(a,"left",a.scrollLeft-m*b.settings.wheelSpeed),j=!0):(h(a,"top",a.scrollTop-m*b.settings.wheelSpeed),h(a,"left",a.scrollLeft+l*b.settings.wheelSpeed)),g(a),j=j||c(l,m),j&&(i.stopPropagation(),i.preventDefault()))}}var j=!1;"undefined"!=typeof window.onwheel?b.event.bind(a,"wheel",i):"undefined"!=typeof window.onmousewheel&&b.event.bind(a,"mousewheel",i)}var e=a("../../lib/helper"),f=a("../instances"),g=a("../update-geometry"),h=a("../update-scroll");b.exports=function(a){var b=f.get(a);d(a,b)}},{"../../lib/helper":65,"../instances":77,"../update-geometry":78,"../update-scroll":79}],73:[function(a,b,c){"use strict";function d(a,b){b.event.bind(a,"scroll",function(){f(a)})}var e=a("../instances"),f=a("../update-geometry");b.exports=function(a){var b=e.get(a);d(a,b)}},{"../instances":77,"../update-geometry":78}],74:[function(a,b,c){"use strict";function d(a,b){function c(){var a=window.getSelection?window.getSelection():document.getSelection?document.getSelection():"";return 0===a.toString().length?null:a.getRangeAt(0).commonAncestorContainer}function d(){j||(j=setInterval(function(){return f.get(a)?(h(a,"top",a.scrollTop+k.top),h(a,"left",a.scrollLeft+k.left),void g(a)):void clearInterval(j)},50))}function i(){j&&(clearInterval(j),j=null),e.stopScrolling(a)}var j=null,k={top:0,left:0},l=!1;b.event.bind(b.ownerDocument,"selectionchange",function(){a.contains(c())?l=!0:(l=!1,i())}),b.event.bind(window,"mouseup",function(){l&&(l=!1,i())}),b.event.bind(window,"mousemove",function(b){if(l){var c={x:b.pageX,y:b.pageY},f={left:a.offsetLeft,right:a.offsetLeft+a.offsetWidth,top:a.offsetTop,bottom:a.offsetTop+a.offsetHeight};c.x<f.left+3?(k.left=-5,e.startScrolling(a,"x")):c.x>f.right-3?(k.left=5,e.startScrolling(a,"x")):k.left=0,c.y<f.top+3?(f.top+3-c.y<5?k.top=-5:k.top=-20,e.startScrolling(a,"y")):c.y>f.bottom-3?(c.y-f.bottom+3<5?k.top=5:k.top=20,e.startScrolling(a,"y")):k.top=0,0===k.top&&0===k.left?i():d()}})}var e=a("../../lib/helper"),f=a("../instances"),g=a("../update-geometry"),h=a("../update-scroll");b.exports=function(a){var b=f.get(a);d(a,b)}},{"../../lib/helper":65,"../instances":77,"../update-geometry":78,"../update-scroll":79}],75:[function(a,b,c){"use strict";function d(a,b,c,d){function h(c,d){var e=a.scrollTop,f=a.scrollLeft,g=Math.abs(c),h=Math.abs(d);if(h>g){if(0>d&&e===b.contentHeight-b.containerHeight||d>0&&0===e)return!b.settings.swipePropagation}else if(g>h&&(0>c&&f===b.contentWidth-b.containerWidth||c>0&&0===f))return!b.settings.swipePropagation;return!0}function i(b,c){g(a,"top",a.scrollTop-c),g(a,"left",a.scrollLeft-b),f(a)}function j(){u=!0}function k(){u=!1}function l(a){return a.targetTouches?a.targetTouches[0]:a}function m(a){return a.targetTouches&&1===a.targetTouches.length?!0:!(!a.pointerType||"mouse"===a.pointerType||a.pointerType===a.MSPOINTER_TYPE_MOUSE)}function n(a){if(m(a)){v=!0;var b=l(a);q.pageX=b.pageX,q.pageY=b.pageY,r=(new Date).getTime(),null!==t&&clearInterval(t),a.stopPropagation()}}function o(a){if(!u&&v&&m(a)){var b=l(a),c={pageX:b.pageX,pageY:b.pageY},d=c.pageX-q.pageX,e=c.pageY-q.pageY;i(d,e),q=c;var f=(new Date).getTime(),g=f-r;g>0&&(s.x=d/g,s.y=e/g,r=f),h(d,e)&&(a.stopPropagation(),a.preventDefault())}}function p(){!u&&v&&(v=!1,clearInterval(t),t=setInterval(function(){return e.get(a)?Math.abs(s.x)<.01&&Math.abs(s.y)<.01?void clearInterval(t):(i(30*s.x,30*s.y),s.x*=.8,void(s.y*=.8)):void clearInterval(t)},10))}var q={},r=0,s={},t=null,u=!1,v=!1;c&&(b.event.bind(window,"touchstart",j),b.event.bind(window,"touchend",k),b.event.bind(a,"touchstart",n),b.event.bind(a,"touchmove",o),b.event.bind(a,"touchend",p)),d&&(window.PointerEvent?(b.event.bind(window,"pointerdown",j),b.event.bind(window,"pointerup",k),b.event.bind(a,"pointerdown",n),b.event.bind(a,"pointermove",o),b.event.bind(a,"pointerup",p)):window.MSPointerEvent&&(b.event.bind(window,"MSPointerDown",j),b.event.bind(window,"MSPointerUp",k),b.event.bind(a,"MSPointerDown",n),b.event.bind(a,"MSPointerMove",o),b.event.bind(a,"MSPointerUp",p)))}var e=a("../instances"),f=a("../update-geometry"),g=a("../update-scroll");b.exports=function(a,b,c){var f=e.get(a);d(a,f,b,c)}},{"../instances":77,"../update-geometry":78,"../update-scroll":79}],76:[function(a,b,c){"use strict";var d=a("../lib/class"),e=a("../lib/helper"),f=a("./instances"),g=a("./update-geometry"),h=a("./handler/click-rail"),i=a("./handler/drag-scrollbar"),j=a("./handler/keyboard"),k=a("./handler/mouse-wheel"),l=a("./handler/native-scroll"),m=a("./handler/selection"),n=a("./handler/touch");b.exports=function(a,b){b="object"==typeof b?b:{},d.add(a,"ps-container");var c=f.add(a);c.settings=e.extend(c.settings,b),h(a),i(a),k(a),l(a),c.settings.useSelectionScroll&&m(a),(e.env.supportsTouch||e.env.supportsIePointer)&&n(a,e.env.supportsTouch,e.env.supportsIePointer),c.settings.useKeyboard&&j(a),g(a)}},{"../lib/class":61,"../lib/helper":65,"./handler/click-rail":69,"./handler/drag-scrollbar":70,"./handler/keyboard":71,"./handler/mouse-wheel":72,"./handler/native-scroll":73,"./handler/selection":74,"./handler/touch":75,"./instances":77,"./update-geometry":78}],77:[function(a,b,c){"use strict";function d(a){var b=this;b.settings=l.clone(i),b.containerWidth=null,b.containerHeight=null,b.contentWidth=null,b.contentHeight=null,b.isRtl="rtl"===h.css(a,"direction"),b.isNegativeScroll=function(){var b=a.scrollLeft,c=null;return a.scrollLeft=-1,c=a.scrollLeft<0,a.scrollLeft=b,c}(),b.negativeScrollAdjustment=b.isNegativeScroll?a.scrollWidth-a.clientWidth:0,b.event=new j,b.ownerDocument=a.ownerDocument||document,b.scrollbarXRail=h.appendTo(h.e("div","ps-scrollbar-x-rail"),a),b.scrollbarX=h.appendTo(h.e("div","ps-scrollbar-x"),b.scrollbarXRail),b.scrollbarXActive=null,b.scrollbarXWidth=null,b.scrollbarXLeft=null,b.scrollbarXBottom=l.toInt(h.css(b.scrollbarXRail,"bottom")),b.isScrollbarXUsingBottom=b.scrollbarXBottom===b.scrollbarXBottom,b.scrollbarXTop=b.isScrollbarXUsingBottom?null:l.toInt(h.css(b.scrollbarXRail,"top")),b.railBorderXWidth=l.toInt(h.css(b.scrollbarXRail,"borderLeftWidth"))+l.toInt(h.css(b.scrollbarXRail,"borderRightWidth")),h.css(b.scrollbarXRail,"display","block"),b.railXMarginWidth=l.toInt(h.css(b.scrollbarXRail,"marginLeft"))+l.toInt(h.css(b.scrollbarXRail,"marginRight")),h.css(b.scrollbarXRail,"display",""),b.railXWidth=null,b.railXRatio=null,b.scrollbarYRail=h.appendTo(h.e("div","ps-scrollbar-y-rail"),a),b.scrollbarY=h.appendTo(h.e("div","ps-scrollbar-y"),b.scrollbarYRail),b.scrollbarYActive=null,b.scrollbarYHeight=null,b.scrollbarYTop=null,b.scrollbarYRight=l.toInt(h.css(b.scrollbarYRail,"right")),b.isScrollbarYUsingRight=b.scrollbarYRight===b.scrollbarYRight,b.scrollbarYLeft=b.isScrollbarYUsingRight?null:l.toInt(h.css(b.scrollbarYRail,"left")),b.scrollbarYOuterWidth=b.isRtl?l.outerWidth(b.scrollbarY):null,b.railBorderYWidth=l.toInt(h.css(b.scrollbarYRail,"borderTopWidth"))+l.toInt(h.css(b.scrollbarYRail,"borderBottomWidth")),h.css(b.scrollbarYRail,"display","block"),b.railYMarginHeight=l.toInt(h.css(b.scrollbarYRail,"marginTop"))+l.toInt(h.css(b.scrollbarYRail,"marginBottom")),h.css(b.scrollbarYRail,"display",""),b.railYHeight=null,b.railYRatio=null}function e(a){return"undefined"==typeof a.dataset?a.getAttribute("data-ps-id"):a.dataset.psId}function f(a,b){"undefined"==typeof a.dataset?a.setAttribute("data-ps-id",b):a.dataset.psId=b}function g(a){"undefined"==typeof a.dataset?a.removeAttribute("data-ps-id"):delete a.dataset.psId}var h=a("../lib/dom"),i=a("./default-setting"),j=a("../lib/event-manager"),k=a("../lib/guid"),l=a("../lib/helper"),m={};c.add=function(a){var b=k();return f(a,b),m[b]=new d(a),m[b]},c.remove=function(a){delete m[e(a)],g(a)},c.get=function(a){return m[e(a)]}},{"../lib/dom":62,"../lib/event-manager":63,"../lib/guid":64,"../lib/helper":65,"./default-setting":67}],78:[function(a,b,c){"use strict";function d(a,b){return a.settings.minScrollbarLength&&(b=Math.max(b,a.settings.minScrollbarLength)),a.settings.maxScrollbarLength&&(b=Math.min(b,a.settings.maxScrollbarLength)),b}function e(a,b){var c={width:b.railXWidth};b.isRtl?c.left=b.negativeScrollAdjustment+a.scrollLeft+b.containerWidth-b.contentWidth:c.left=a.scrollLeft,b.isScrollbarXUsingBottom?c.bottom=b.scrollbarXBottom-a.scrollTop:c.top=b.scrollbarXTop+a.scrollTop,g.css(b.scrollbarXRail,c);var d={top:a.scrollTop,height:b.railYHeight};b.isScrollbarYUsingRight?b.isRtl?d.right=b.contentWidth-(b.negativeScrollAdjustment+a.scrollLeft)-b.scrollbarYRight-b.scrollbarYOuterWidth:d.right=b.scrollbarYRight-a.scrollLeft:b.isRtl?d.left=b.negativeScrollAdjustment+a.scrollLeft+2*b.containerWidth-b.contentWidth-b.scrollbarYLeft-b.scrollbarYOuterWidth:d.left=b.scrollbarYLeft+a.scrollLeft,g.css(b.scrollbarYRail,d),g.css(b.scrollbarX,{left:b.scrollbarXLeft,width:b.scrollbarXWidth-b.railBorderXWidth}),g.css(b.scrollbarY,{top:b.scrollbarYTop,height:b.scrollbarYHeight-b.railBorderYWidth})}var f=a("../lib/class"),g=a("../lib/dom"),h=a("../lib/helper"),i=a("./instances"),j=a("./update-scroll");b.exports=function(a){var b=i.get(a);b.containerWidth=a.clientWidth,b.containerHeight=a.clientHeight,b.contentWidth=a.scrollWidth,b.contentHeight=a.scrollHeight;var c;a.contains(b.scrollbarXRail)||(c=g.queryChildren(a,".ps-scrollbar-x-rail"),c.length>0&&c.forEach(function(a){g.remove(a)}),g.appendTo(b.scrollbarXRail,a)),a.contains(b.scrollbarYRail)||(c=g.queryChildren(a,".ps-scrollbar-y-rail"),c.length>0&&c.forEach(function(a){g.remove(a)}),g.appendTo(b.scrollbarYRail,a)),!b.settings.suppressScrollX&&b.containerWidth+b.settings.scrollXMarginOffset<b.contentWidth?(b.scrollbarXActive=!0,b.railXWidth=b.containerWidth-b.railXMarginWidth,b.railXRatio=b.containerWidth/b.railXWidth,b.scrollbarXWidth=d(b,h.toInt(b.railXWidth*b.containerWidth/b.contentWidth)),b.scrollbarXLeft=h.toInt((b.negativeScrollAdjustment+a.scrollLeft)*(b.railXWidth-b.scrollbarXWidth)/(b.contentWidth-b.containerWidth))):(b.scrollbarXActive=!1,b.scrollbarXWidth=0,b.scrollbarXLeft=0,a.scrollLeft=0),!b.settings.suppressScrollY&&b.containerHeight+b.settings.scrollYMarginOffset<b.contentHeight?(b.scrollbarYActive=!0,b.railYHeight=b.containerHeight-b.railYMarginHeight,b.railYRatio=b.containerHeight/b.railYHeight,b.scrollbarYHeight=d(b,h.toInt(b.railYHeight*b.containerHeight/b.contentHeight)),b.scrollbarYTop=h.toInt(a.scrollTop*(b.railYHeight-b.scrollbarYHeight)/(b.contentHeight-b.containerHeight))):(b.scrollbarYActive=!1,b.scrollbarYHeight=0,b.scrollbarYTop=0,j(a,"top",0)),b.scrollbarXLeft>=b.railXWidth-b.scrollbarXWidth&&(b.scrollbarXLeft=b.railXWidth-b.scrollbarXWidth),b.scrollbarYTop>=b.railYHeight-b.scrollbarYHeight&&(b.scrollbarYTop=b.railYHeight-b.scrollbarYHeight),e(a,b),f[b.scrollbarXActive?"add":"remove"](a,"ps-active-x"),f[b.scrollbarYActive?"add":"remove"](a,"ps-active-y")}},{"../lib/class":61,"../lib/dom":62,"../lib/helper":65,"./instances":77,"./update-scroll":79}],79:[function(a,b,c){"use strict";var d,e,f=a("./instances"),g=document.createEvent("Event"),h=document.createEvent("Event"),i=document.createEvent("Event"),j=document.createEvent("Event"),k=document.createEvent("Event"),l=document.createEvent("Event"),m=document.createEvent("Event"),n=document.createEvent("Event"),o=document.createEvent("Event"),p=document.createEvent("Event");g.initEvent("ps-scroll-up",!0,!0),h.initEvent("ps-scroll-down",!0,!0),i.initEvent("ps-scroll-left",!0,!0),j.initEvent("ps-scroll-right",!0,!0),k.initEvent("ps-scroll-y",!0,!0),l.initEvent("ps-scroll-x",!0,!0),m.initEvent("ps-x-reach-start",!0,!0),n.initEvent("ps-x-reach-end",!0,!0),o.initEvent("ps-y-reach-start",!0,!0),p.initEvent("ps-y-reach-end",!0,!0),b.exports=function(a,b,c){if("undefined"==typeof a)throw"You must provide an element to the update-scroll function";if("undefined"==typeof b)throw"You must provide an axis to the update-scroll function";if("undefined"==typeof c)throw"You must provide a value to the update-scroll function";if("top"===b&&0>=c)return a.scrollTop=0,void a.dispatchEvent(o);if("left"===b&&0>=c)return a.scrollLeft=0,void a.dispatchEvent(m);var q=f.get(a);return"top"===b&&c>q.contentHeight-q.containerHeight?(a.scrollTop=q.contentHeight-q.containerHeight,void a.dispatchEvent(p)):"left"===b&&c>q.contentWidth-q.containerWidth?(a.scrollLeft=q.contentWidth-q.containerWidth,void a.dispatchEvent(n)):(d||(d=a.scrollTop),e||(e=a.scrollLeft),"top"===b&&d>c&&a.dispatchEvent(g),"top"===b&&c>d&&a.dispatchEvent(h),"left"===b&&e>c&&a.dispatchEvent(i),"left"===b&&c>e&&a.dispatchEvent(j),"top"===b&&(a.scrollTop=d=c,a.dispatchEvent(k)),void("left"===b&&(a.scrollLeft=e=c,a.dispatchEvent(l))))}},{"./instances":77}],80:[function(a,b,c){"use strict";var d=a("../lib/dom"),e=a("../lib/helper"),f=a("./instances"),g=a("./update-geometry");b.exports=function(a){var b=f.get(a);b&&(b.negativeScrollAdjustment=b.isNegativeScroll?a.scrollWidth-a.clientWidth:0,d.css(b.scrollbarXRail,"display","block"),d.css(b.scrollbarYRail,"display","block"),b.railXMarginWidth=e.toInt(d.css(b.scrollbarXRail,"marginLeft"))+e.toInt(d.css(b.scrollbarXRail,"marginRight")),b.railYMarginHeight=e.toInt(d.css(b.scrollbarYRail,"marginTop"))+e.toInt(d.css(b.scrollbarYRail,"marginBottom")),d.css(b.scrollbarXRail,"display","none"),d.css(b.scrollbarYRail,"display","none"),g(a),d.css(b.scrollbarXRail,"display",""),d.css(b.scrollbarYRail,"display",""))}},{"../lib/dom":62,"../lib/helper":65,"./instances":77,"./update-geometry":78}],81:[function(a,b,c){var d=function(a,b){if(0>a)throw new Error("start must be a positive number");if(a>=b)throw new Error("start must be smaller than end");this.start=a,this.end=b};d.prototype={diff:function(){return this.end-this.start},isLast:function(a){return(0|a)===this.end}},b.exports=d},{}],82:[function(a,b,c){(function(c){function d(a,b){if(!b.steps)throw new Error("steps option missing");this.options=b,this.running=!1,this._tick=this._tick.bind(this),this._t0=+new Date,this.callback=a,this._time=0,this.itemsReady=!1,this.options=e.extend({animationDelay:0,maxDelta:.2,loop:void 0===b.loop?!0:b.loop},this.options),this.steps(b.steps)}var e=a("./"),f=a("./animator-steps-range"),g=c.requestAnimationFrame||c.mozRequestAnimationFrame||c.webkitRequestAnimationFrame||c.msRequestAnimationFrame||function(a){return c.setTimeout(a,1e3/60)},h=c.cancelAnimationFrame||c.mozCancelAnimationFrame||c.webkitCancelAnimationFrame||c.msCancelAnimationFrame||function(a){clearTimeout(a)};d.prototype={start:function(){this.running=!0,g(this._tick),this.options.onStart&&this.options.onStart(),1===this.stepsRange().diff()&&(this.running=!1)},isRunning:function(){return this.running},stop:function(){this.pause(),this.time(this.stepsRange().start),this.options.onStop&&this.options.onStop()},time:function(a){if(!arguments.length)return this._time;this._time=a;var b=this.range(this.domain(this._time));this.callback(b)},toggle:function(){this.running?this.pause():this.start()},rescale:function(){return this.domainInv=e.math.linear(this.options.animationDelay,this.options.animationDelay+this.options.animationDuration),this.domain=this.domainInv.invert(),this.range=e.math.linear(0,this._defaultStepsRange.end),this.rangeInv=this.range.invert(),this.time(this._time),this.running?this.start():this.pause(),this},duration:function(a){return arguments.length?(this.options.animationDuration=a,this.time()>a&&this.time(0),this.rescale(),this):this.options.animationDuration},steps:function(a){return this.options.steps=a,this._defaultStepsRange=new f(0,a),this.rescale()},stepsRange:function(a,b){if(2===arguments.length){if(a<this._defaultStepsRange.start)throw new Error("start must be within default steps range");if(b>this._defaultStepsRange.end)throw new Error("end must be within default steps range");this._customStepsRange=new f(a,b),this.options.onStepsRange&&this.options.onStepsRange();var c=0|this.step();(a>c||c>b)&&this.step(a)}return this._customStepsRange||this._defaultStepsRange},removeCustomStepsRange:function(){this._customStepsRange=void 0,this.options.onStepsRange&&this.options.onStepsRange()},step:function(a){return 0===arguments.length?this.range(this.domain(this._time)):void(this._time=this.domainInv(this.rangeInv(a)))},pause:function(){this.running=!1,h(this._tick),this.options.onPause&&this.options.onPause()},_tick:function(){var a=+new Date,b=.001*(a-this._t0);b=Math.min(this.options.maxDelta,b),this._t0=a,this._time+=b;var c=this.stepsRange();c.isLast(this.step())&&(this.options.loop?this.step(c.start):(this.time(this.options.animationDuration),this.pause())),this.running&&(this.time(this._time),g(this._tick))}},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./":91,"./animator-steps-range":81}],83:[function(a,b,c){var d={version:"1.0.0",style:{"comp-op":{css:"comp-op","default-value":"src-over","default-meaning":"add the current layer on top of other layers",doc:"Composite operation. This defines how this layer should behave relative to layers atop or below it.",type:["src","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","darken","lighten"]}},layer:{"buffer-size":{"default-value":"0",type:"float","default-meaning":"No buffer will be used",doc:"Extra tolerance around the Layer extent (in pixels) used to when querying and (potentially) clipping the layer data during rendering"},"-torque-clear-color":{css:"-torque-clear-color",type:"color","default-value":"rgba(255, 255, 255, 0)","default-meaning":"full clear",doc:"color used to clear canvas on each frame"},"-torque-frame-count":{css:"-torque-frame-count","default-value":"128",type:"number","default-meaning":"the data is broken into 128 time frames",doc:"Number of animation steps/frames used in the animation. If the data contains a fewere number of total frames, the lesser value will be used."},"-torque-resolution":{css:"-torque-resolution","default-value":"2",type:"number","default-meaning":"",doc:"Spatial resolution in pixels. A resolution of 1 means no spatial aggregation of the data. Any other resolution of N results in spatial aggregation into cells of NxN pixels. The value N must be power of 2"},"-torque-animation-duration":{css:"-torque-animation-duration","default-value":"30",type:"number","default-meaning":"the animation lasts 30 seconds",doc:"Animation duration in seconds"},"-torque-aggregation-function":{css:"-torque-aggregation-function","default-value":"count(cartodb_id)",type:"string","default-meaning":"the value for each cell is the count of points in that cell",doc:"A function used to calculate a value from the aggregate data for each cell. See -torque-resolution"},"-torque-time-attribute":{css:"-torque-time-attribute","default-value":"time",type:"string","default-meaning":"the data column in your table that is of a time based type",doc:"The table column that contains the time information used create the animation"},"-torque-data-aggregation":{css:"-torque-data-aggregation","default-value":"linear",type:["cumulative"],"default-meaning":"previous values are discarded",doc:"A linear animation will discard previous values while a cumulative animation will accumulate them until it restarts"}},symbolizers:{"*":{"comp-op":{css:"comp-op","default-value":"src-over","default-meaning":"add the current layer on top of other layers",doc:"Composite operation. This defines how this layer should behave relative to layers atop or below it.",type:["src","src-over","dst-over","src-in","dst-in","src-out","dst-out","src-atop","dst-atop","xor","darken","lighten"]},opacity:{css:"opacity",type:"float",doc:"An alpha value for the style (which means an alpha applied to all features in separate buffer and then composited back to main buffer)","default-value":1,"default-meaning":"no separate buffer will be used and no alpha will be applied to the style after rendering"}},trail:{steps:{css:"trail-steps",type:"float","default-value":1,"default-meaning":"no trail steps",doc:"How many steps of trails are going to be rendered"}},polygon:{fill:{css:"polygon-fill",type:"color","default-value":"rgba(128,128,128,1)","default-meaning":"gray and fully opaque (alpha = 1), same as rgb(128,128,128)",doc:"Fill color to assign to a polygon"},"fill-opacity":{css:"polygon-opacity",type:"float",doc:"The opacity of the polygon","default-value":1,"default-meaning":"opaque"}},line:{stroke:{css:"line-color","default-value":"rgba(0,0,0,1)",type:"color","default-meaning":"black and fully opaque (alpha = 1), same as rgb(0,0,0)",doc:"The color of a drawn line"},"stroke-width":{css:"line-width","default-value":1,type:"float",doc:"The width of a line in pixels"},"stroke-opacity":{css:"line-opacity","default-value":1,type:"float","default-meaning":"opaque",doc:"The opacity of a line"},"stroke-linejoin":{css:"line-join","default-value":"miter",type:["miter","round","bevel"],doc:"The behavior of lines when joining"},"stroke-linecap":{css:"line-cap","default-value":"butt",type:["butt","round","square"],doc:"The display of line endings"}},markers:{file:{css:"marker-file",doc:"An SVG file that this marker shows at each placement. If no file is given, the marker will show an ellipse.","default-value":"","default-meaning":"An ellipse or circle, if width equals height",type:"uri"},opacity:{css:"marker-opacity",doc:"The overall opacity of the marker, if set, overrides both the opacity of both the fill and stroke","default-value":1,"default-meaning":"The stroke-opacity and fill-opacity will be used",type:"float"},"fill-opacity":{css:"marker-fill-opacity",doc:"The fill opacity of the marker","default-value":1,"default-meaning":"opaque",type:"float"},stroke:{css:"marker-line-color",doc:"The color of the stroke around a marker shape.","default-value":"black",type:"color"},"stroke-width":{css:"marker-line-width",doc:"The width of the stroke around a marker shape, in pixels. This is positioned on the boundary, so high values can cover the area itself.",type:"float"},"stroke-opacity":{css:"marker-line-opacity","default-value":1,"default-meaning":"opaque",doc:"The opacity of a line",type:"float"},fill:{css:"marker-fill","default-value":"blue",doc:"The color of the area of the marker.",type:"color"},"marker-type":{css:"marker-type",type:["rectangle","ellipse"],"default-value":"ellipse",doc:"The default marker-type. If a SVG file is not given as the marker-file parameter, the renderer provides either an rectangle or an ellipse (a circle if height is equal to width)"},width:{css:"marker-width","default-value":10,doc:"The width of the marker, if using one of the default types.",type:"float"}},point:{
file:{css:"point-file",type:"uri",required:!1,"default-value":"none",doc:"Image file to represent a point"},opacity:{css:"point-opacity",type:"float","default-value":1,"default-meaning":"Fully opaque",doc:"A value from 0 to 1 to control the opacity of the point"}}},colors:{aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50],transparent:[0,0,0,0]}};b.exports={version:{latest:d,"1.0.0":d}}},{}],84:[function(a,b,c){(function(c){function d(){}var e=c.carto||a("carto");d.prototype={},d.optionsFromLayer=function(a){var b={};if(!a)return b;var c={"buffer-size":"buffer-size","-torque-frame-count":"steps","-torque-resolution":"resolution","-torque-animation-duration":"animationDuration","-torque-aggregation-function":"countby","-torque-time-attribute":"column","-torque-data-aggregation":"data_aggregation"};for(var d in c){var e=a.eval(d);if(void 0!==e){var f=c[d];b[f]=e}}return b},d.optionsFromCartoCSS=function(a){var b=(new e.RendererJS).render(a),c=b.findLayer({name:"Map"});return d.optionsFromLayer(c)},b.exports.TorqueLayer=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{carto:111}],85:[function(a,b,c){(function(a){function c(){for(var a=arguments,b=a[0],c=1;c<a.length;++c){var d=a[c];for(var e in d)b[e]=d[e]}return b}function d(a){return c({},a)}function e(a){return"function"==typeof a||!1}function f(a){return a&&"object"==typeof a&&"[object Array]"==Object.prototype.toString.call(a)}function g(){return!!document.createElement("canvas")}function h(){return"undefined"!=typeof navigator?navigator.userAgent:""}var i={};i.on=function(a,b){var c=this._evt_callbacks=this._evt_callbacks||{},d=c[a]||(c[a]=[]);return d.push(b),this},i.trigger=function(a){for(var b=this._evt_callbacks&&this._evt_callbacks[a],c=0;b&&c<b.length;++c)b[c].apply(this,Array.prototype.slice.call(arguments,1));return this},i.fire=i.trigger,i.off=function(a,b){var c=this._evt_callbacks&&this._evt_callbacks[a];if(c&&!b)return delete this._evt_callbacks[a],this;for(var d=[],e=0;c&&e<c.length;++e)c[e]===b&&d.push(e);for(;void 0!==(e=d.pop());)c.splice(e,1);return this},i.callbacks=function(a){return this._evt_callbacks&&this._evt_callbacks[a]||[]};var j={Uint8Array:"undefined"!=typeof a.Uint8Array?a.Uint8Array:Array,Uint8ClampedArray:"undefined"!=typeof a.Uint8ClampedArray?a.Uint8ClampedArray:Array,Uint32Array:"undefined"!=typeof a.Uint32Array?a.Uint32Array:Array,Int16Array:"undefined"!=typeof a.Int16Array?a.Int16Array:Array,Int32Array:"undefined"!=typeof a.Int32Array?a.Int32Array:Array},k={sprites_to_images:-1===h().indexOf("Safari")&&-1===h().indexOf("Firefox")};b.exports={Event:i,extend:c,clone:d,isFunction:e,isArray:f,types:j,isBrowserSupported:g,flags:k}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],86:[function(a,b,c){function d(a){function b(a,b){return function(){b.apply(a)}}this.isAdded_=!1,this.isAnimated_=!1,this.paneName_=d.DEFAULT_PANE_NAME_,this.updateHandler_=null,this.resizeHandler_=null,this.topLeft_=null,this.centerListener_=null,this.resizeListener_=null,this.needsResize_=!0,this.requestAnimationFrameId_=null;var c=document.createElement("canvas");c.style.position="absolute",c.style.top=0,c.style.left=0,c.style.pointerEvents="none",this.canvas=c,this.repositionFunction_=b(this,this.repositionCanvas_),this.resizeFunction_=b(this,this.resize_),this.requestUpdateFunction_=b(this,this.update_),a&&this.setOptions(a)}d.prototype=new google.maps.OverlayView,d.DEFAULT_PANE_NAME_="overlayLayer",d.CSS_TRANSFORM_=function(){for(var a=document.createElement("div"),b=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],c=0;c<b.length;c++){var d=b[c];if(void 0!==a.style[d])return d}return b[0]}(),d.prototype.requestAnimFrame_=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)},d.prototype.cancelAnimFrame_=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(a){},d.prototype.setOptions=function(a){void 0!==a.animate&&this.setAnimate(a.animate),void 0!==a.paneName&&this.setPane(a.paneName),void 0!==a.updateHandler&&this.setUpdateHandler(a.updateHandler),void 0!==a.resizeHandler&&this.setResizeHandler(a.resizeHandler),a.readyHandler&&(this.readyHandler=a.readyHandler)},d.prototype.setAnimate=function(a){this.isAnimated_=!!a,this.isAnimated_&&this.scheduleUpdate()},d.prototype.isAnimated=function(){return this.isAnimated_},d.prototype.setPaneName=function(a){this.paneName_=a,this.setPane_()},d.prototype.setOpacity=function(a){this.canvas.style.opacity=a},d.prototype.getOpacity=function(){return this.canvas.style.opacity},d.prototype.getPaneName=function(){return this.paneName_},d.prototype.setPane_=function(){if(this.isAdded_){var a=this.getPanes();if(!a[this.paneName_])throw new Error('"'+this.paneName_+'" is not a valid MapPane name.');a[this.paneName_].appendChild(this.canvas)}},d.prototype.setResizeHandler=function(a){this.resizeHandler_=a},d.prototype.setUpdateHandler=function(a){this.updateHandler_=a},d.prototype.onAdd=function(){this.isAdded_||(this.isAdded_=!0,this.setPane_(),this.resizeListener_=google.maps.event.addListener(this.getMap(),"resize",this.resizeFunction_),this.centerListener_=google.maps.event.addListener(this.getMap(),"center_changed",this.repositionFunction_),this.resize_(),this.repositionCanvas_(),this.readyHandler&&this.readyHandler())},d.prototype.onRemove=function(){this.isAdded_&&(this.isAdded_=!1,this.topLeft_=null,this.canvas.parentElement.removeChild(this.canvas),this.centerListener_&&(google.maps.event.removeListener(this.centerListener_),this.centerListener_=null),this.resizeListener_&&(google.maps.event.removeListener(this.resizeListener_),this.resizeListener_=null),this.requestAnimationFrameId_&&(this.cancelAnimFrame_.call(window,this.requestAnimationFrameId_),this.requestAnimationFrameId_=null))},d.prototype.resize_=function(){if(this.isAdded_){var a=this.getMap(),b=a.getDiv().offsetWidth,c=a.getDiv().offsetHeight,d=this.canvas.width,e=this.canvas.height;d===b&&e===c||(this.canvas.width=b,this.canvas.height=c,this.canvas.style.width=b+"px",this.canvas.style.height=c+"px",this.needsResize_=!0,this.scheduleUpdate())}},d.prototype.draw=function(){this.repositionCanvas_()},d.prototype.repositionCanvas_=function(){var a=this.getMap().getBounds();this.topLeft_=new google.maps.LatLng(a.getNorthEast().lat(),a.getSouthWest().lng());var b=this.getProjection(),c=b.fromLatLngToDivPixel(this.topLeft_),e=256*(1<<this.getMap().getZoom());Math.abs(c.x)>e&&(c.x-=e),this.canvas.style[d.CSS_TRANSFORM_]="translate("+Math.round(c.x)+"px,"+Math.round(c.y)+"px)",this.scheduleUpdate()},d.prototype.update_=function(){this.requestAnimationFrameId_=null,this.isAdded_&&(this.isAnimated_&&this.scheduleUpdate(),this.needsResize_&&this.resizeHandler_&&(this.needsResize_=!1,this.resizeHandler_()),this.updateHandler_&&this.updateHandler_())},d.prototype.getTopLeft=function(){return this.topLeft_},d.prototype.scheduleUpdate=function(){this.isAdded_&&!this.requestAnimationFrameId_&&(this.requestAnimationFrameId_=this.requestAnimFrame_.call(window,this.requestUpdateFunction_))},b.exports=d},{}],87:[function(a,b,c){function d(a,b){this.tileSize=new google.maps.Size(256,256),this.maxZoom=19,this.name="Tile #s",this.alt="Canvas tile layer",this.tiles={},this.canvas_setup=a,this.render=b,b||(this.render=a)}d.prototype.create_tile_canvas=function(a,b,c){var d=c.createElement("canvas"),e=c.createElement("canvas");d.style.border=e.style.border="none",d.style.margin=e.style.margin="0",d.style.padding=e.style.padding="0";var f=d.getContext("2d");f.width=d.width=this.tileSize.width,f.height=d.height=this.tileSize.height;var g=e.getContext("2d");e.width=g.width=this.tileSize.width,e.height=g.height=this.tileSize.height;var h=a.x+"_"+a.y+"_"+b;return d.setAttribute("id",h),e.setAttribute("id",h),h in this.tiles&&delete this.tiles[h],this.tiles[h]={canvas:d,ctx:f,hit_canvas:e,hit_ctx:g,coord:a,zoom:b,primitives:null},this.canvas_setup&&this.canvas_setup(this.tiles[h],a,b),d},d.prototype.each=function(a){for(var b in this.tiles){var c=this.tiles[b];a(c)}},d.prototype.recreate=function(){for(var a in this.tiles){var b=this.tiles[a];this.canvas_setup(b,b.coord,b.zoom)}},d.prototype.redraw_tile=function(a){this.render(a,a.coord,a.zoom)},d.prototype.redraw=function(){for(var a in this.tiles){var b=this.tiles[a];this.render(b,b.coord,b.zoom)}},d.prototype.getTile=function(a,b,c){return this.create_tile_canvas(a,b,c)},d.prototype.releaseTile=function(a){var b=a.getAttribute("id");delete this.tiles[b]},b.exports=d},{}],88:[function(a,b,c){function d(){}d.prototype={_initTileLoader:function(a,b){this._map=a,this._projection=b,this._tiles={},this._tilesLoading={},this._tilesToLoad=0,this._updateTiles=this._updateTiles.bind(this),this._listeners=[],this._listeners.push(google.maps.event.addListener(this._map,"dragend",this._updateTiles),google.maps.event.addListener(this._map,"zoom_changed",this._updateTiles)),this.tileSize=256,this._updateTiles()},_removeTileLoader:function(){this._listeners.forEach(function(a){google.maps.event.removeListener(a)}),this._removeTiles()},_removeTiles:function(){for(var a in this._tiles)this._removeTile(a)},_reloadTiles:function(){this._removeTiles(),this._updateTiles()},_updateTiles:function(){if(this._map){var a=this._map.getBounds(),b=this._map.getZoom(),c=this.tileSize,d=1<<b,e=new google.maps.LatLng(a.getNorthEast().lat(),a.getSouthWest().lng()),f=new google.maps.LatLng(a.getSouthWest().lat(),a.getNorthEast().lng());this._projection=this._map.getProjection();var g=this._projection.fromLatLngToPoint(e),h=this._projection.fromLatLngToPoint(f),i=new google.maps.Point(Math.floor(g.x*d/c),Math.floor(g.y*d/c)),j=new google.maps.Point(Math.floor(h.x*d/c),Math.floor(h.y*d/c));this._addTilesFromCenterOut(i,j),this._removeOtherTiles(i,j)}},_removeOtherTiles:function(a,b){var c,d,e,f,g=this._map.getZoom();for(f in this._tiles)this._tiles.hasOwnProperty(f)&&(c=f.split(":"),d=parseInt(c[0],10),e=parseInt(c[1],10),z=parseInt(c[2],10),(z!==g||d<a.x||d>b.x||e<a.y||e>b.y)&&this._removeTile(f))},_removeTile:function(a){this.onTileRemoved&&this.onTileRemoved(this._tiles[a]),delete this._tiles[a],delete this._tilesLoading[a]},_tileKey:function(a){return a.x+":"+a.y+":"+a.zoom},_tileShouldBeLoaded:function(a){var b=this._tileKey(a);return!(b in this._tiles||b in this._tilesLoading)},_tileLoaded:function(a,b){this._tilesToLoad--;var c=a.x+":"+a.y+":"+a.zoom;this._tiles[c]=b,delete this._tilesLoading[c],0===this._tilesToLoad&&this.onTilesLoaded&&this.onTilesLoaded()},getTilePos:function(a){var b=1<<this._map.getZoom();a={x:(a.x%b+b)%b,y:a.y},a=new google.maps.Point(a.x*this.tileSize,a.y*this.tileSize);var c=this._map.getBounds(),d=new google.maps.LatLng(c.getNorthEast().lat(),c.getSouthWest().lng()),e=this._map.getProjection().fromLatLngToPoint(d);return zoom=1<<this._map.getZoom(),e.x=e.x*zoom,e.y=e.y*zoom,new google.maps.Point(a.x-e.x,a.y-e.y)},_addTilesFromCenterOut:function(a,b){function c(a){var b=a.x-h.x,c=a.y-h.y;return b*b+c*c}var d,e,f,g=[],h=new google.maps.Point(.5*(a.x+b.x),.5*(a.y+b.y)),i=this._map.getZoom();for(d=a.y;d<=b.y;d++)for(e=a.x;e<=b.x;e++)f=new google.maps.Point(e,d),f.zoom=i,this._tileShouldBeLoaded(f)&&g.push(f);var j=g.length;if(0!==j){for(g.sort(function(a,b){return c(a)-c(b)}),this._tilesToLoad+=j,e=0;j>e;e++){var k=g[e],l=this._tileKey(k);this._tilesLoading[l]=k,this.onTileAdded&&this.onTileAdded(k)}this.onTilesLoading&&this.onTilesLoading()}}},b.exports=d},{}],89:[function(a,b,c){var d={};"undefined"!=typeof google&&"undefined"!=typeof google.maps&&(d=a("./torque"),d.GMapsTileLoader=a("./gmaps_tileloader_mixin")),b.exports=d},{"./gmaps_tileloader_mixin":88,"./torque":90}],90:[function(a,b,c){(function(c){function d(a){var b=this;if(!g.isBrowserSupported())throw new Error("browser is not supported by torque");this.keys=[0],Object.defineProperty(this,"key",{get:function(){return this.getKey()}}),this.shader=null,this.ready=!1,this.options=g.extend({},a),this.options=g.extend({provider:"windshaft",renderer:"point",resolution:2,steps:100,visible:!0},this.options),a.cartocss&&g.extend(this.options,g.common.TorqueLayer.optionsFromCartoCSS(a.cartocss)),a.tileJSON&&(this.options.provider="tileJSON"),this.hidden=!this.options.visible,this.animator=new g.Animator(function(a){var c=0|a;b.getKey()!==c&&b.setKey(c)},g.extend(g.clone(this.options),{onPause:function(){b.fire("pause")},onStop:function(){b.fire("stop")},onStart:function(){b.fire("play")},onStepsRange:function(){b.fire("change:stepsRange",b.animator.stepsRange())}})),this.play=this.animator.start.bind(this.animator),this.stop=this.animator.stop.bind(this.animator),this.pause=this.animator.pause.bind(this.animator),this.toggle=this.animator.toggle.bind(this.animator),this.setDuration=this.animator.duration.bind(this.animator),this.isRunning=this.animator.isRunning.bind(this.animator),h.call(this,{map:this.options.map,animate:!1,updateHandler:this.render,readyHandler:this.initialize})}function e(a){this.options=g.extend({},a),i.call(this,this._loadTile.bind(this),this.drawTile.bind(this)),this.initialize(a)}var f=c.carto||a("carto"),g=a("../"),h=a("./CanvasLayer"),i=a("./canvas_tile_layer"),j=a("./gmaps_tileloader_mixin");d.prototype=g.extend({},h.prototype,j.prototype,g.Event,{providers:{sql_api:g.providers.json,url_template:g.providers.JsonArray,windshaft:g.providers.windshaft,tileJSON:g.providers.tileJSON},renderers:{point:g.renderer.Point,pixel:g.renderer.Rectangle},initialize:function(){var a=this;this.onTileAdded=this.onTileAdded.bind(this),this.options.ready=function(){a.fire("change:bounds",{bounds:a.provider.getBounds()}),a.animator.steps(a.provider.getSteps()),a.animator.rescale(),a.fire("change:steps",{steps:a.provider.getSteps()}),a.setKeys(a.getKeys())},this.provider=new this.providers[this.options.provider](this.options),this.renderer=new this.renderers[this.options.renderer](this.getCanvas(),this.options),this.renderer.options.errorCallback=this.options.errorCallback,this._cacheListener=google.maps.event.addListener(this.options.map,"zoom_changed",function(){a.renderer&&a.renderer.clearSpriteCache()}),this._initTileLoader(this.options.map,this.getProjection()),this.shader&&this.renderer.setShader(this.shader)},hide:function(){return this.hidden?this:(this.pause(),this.clear(),this.hidden=!0,this)},show:function(){return this.hidden?(this.hidden=!1,this.play(),1===this.options.steps&&this.redraw(),this):this},setSQL:function(a){if(this.provider.options.named_map)throw new Error("SQL queries on named maps are read-only");if(!this.provider||!this.provider.setSQL)throw new Error("this provider does not support SQL");return this.provider.setSQL(a),this._reloadTiles(),this},setBlendMode:function(a){this.renderer&&this.renderer.setBlendMode(a),this.redraw()},setSteps:function(a){this.provider&&this.provider.setSteps(a),this.animator&&this.animator.steps(a),this._reloadTiles()},setColumn:function(a,b){this.provider&&this.provider.setColumn(a,b),this._reloadTiles()},getTimeBounds:function(){return this.provider&&this.provider.getKeySpan()},getCanvas:function(){return this.canvas},onTileAdded:function(a){var b=this;this.provider.getTileData(a,a.zoom,function(c){a.zoom===b.options.map.getZoom()&&(b._tileLoaded(a,c),b.fire("tileLoaded"),c&&b.redraw())})},clear:function(){var a=this.canvas;a.width=a.width},render:function(){if(!this.hidden){var a,b,c,d=this.canvas;this.renderer.clearCanvas();var e=d.getContext("2d");for(a in this._tiles)b=this._tiles[a],b&&(c=this.getTilePos(b.coord),e.setTransform(1,0,0,1,c.x,c.y),this.renderer.renderTile(b,this.keys));this.renderer.applyFilters()}},getActivePointsBBox:function(a){var b=[];this.options.resolution*(256/this.options.resolution-1);for(var c in this._tiles){var d=this._tiles[c];b=b.concat(this.renderer.getActivePointsBBox(d,a))}return b},setKey:function(a){this.setKeys([a])},getKeys:function(){return this.keys},setKeys:function(a){this.keys=a,this.animator.step(this.getKey()),this.redraw(),this.fire("change:time",{time:this.getTime(),step:this.getKey()})},getKey:function(){return this.keys[0]},setStep:function(a){if(void 0===a||void 0!==a.length)throw new Error("setTime only accept scalars");this.setKey(a)},renderRange:function(a,b){this.pause();for(var c=[],d=a;b>=d;d++)c.push(d);this.setKeys(c)},resetRenderRange:function(){this.stop(),this.play()},stepToTime:function(a){if(!this.provider)return 0;var b=this.provider.getKeySpan(),c=b.start+(b.end-b.start)*(a/this.provider.getSteps());return new Date(c)},timeToStep:function(a){if("Date"==typeof a&&(a=a.getTime()),!this.provider)return 0;var b=this.provider.getKeySpan(),c=this.provider.getSteps()*(a-b.start)/(b.end-b.start);return c},getStep:function(){return this.getKey()},getTime:function(){return this.stepToTime(this.getKey())},setCartoCSS:function(a){if(this.provider&&this.provider.options.named_map)throw new Error("CartoCSS style on named maps is read-only");var b=(new f.RendererJS).render(a);this.shader=b,this.renderer&&this.renderer.setShader(b);var c=g.common.TorqueLayer.optionsFromLayer(b.findLayer({name:"Map"}));return this.provider&&this.provider.setCartoCSS&&this.provider.setCartoCSS(a),this.provider&&this.provider.setOptions(c)&&this._reloadTiles(),g.extend(this.options,c),c.animationDuration&&this.animator.duration(c.animationDuration),this.redraw(),this},redraw:function(){this.scheduleUpdate()},onRemove:function(){this.fire("remove"),h.prototype.onRemove.call(this),this.animator.stop(),this._removeTileLoader(),google.maps.event.removeListener(this._cacheListener)},getValues:function(a){var b=[];a=void 0===a?this.getKey():a;var c,d;for(c in this._tiles)d=this._tiles[c],this.renderer.getValues(d,a,b);return b},getValueForPos:function(a,b,c){c=void 0===c?this.getKey():c;var d,e,f,g,h,i=null;for(d in this._tiles)if(e=this._tiles[d],f=this.getTilePos(e.coord),g=a-f.x,h=b-f.y,g>=0&&h>=0&&g<this.renderer.TILE_SIZE&&h<=this.renderer.TILE_SIZE&&(i=this.renderer.getValueFor(e,c,g,h)),null!==i)return i;return null},getValueForBBox:function(a,b,c,d){var e=a+c,f=b+d,g=0;for(_y=b;f>b;b+=this.options.resolution)for(_x=a;e>a;a+=this.options.resolution){var h=this.getValueForPos(_x,_y);if(h){var i=h.bbox,j=this.getProjection(),k=j.fromLatLngToContainerPixel(new google.maps.LatLng(i[1].lat,i[1].lon));k.x<e&&k.y<f&&(g+=h.value)}}return g},error:function(a){return this.options.errorCallback=a,this}}),e.prototype=g.extend({},i.prototype,{providers:{sql_api:g.providers.json,url_template:g.providers.JsonArray},renderers:{point:g.renderer.Point,pixel:g.renderer.Rectangle},initialize:function(a){this.keys=[0],this.options.renderer=this.options.renderer||"pixel",this.options.provider=this.options.provider||"sql_api",this.provider=new this.providers[this.options.provider](a),this.renderer=new this.renderers[this.options.renderer](null,a)},_tileLoaded:function(a,b){a.data=b,this.drawTile(a)},_loadTile:function(a,b,c){var d=this,e=1<<c,f={x:(b.x%e+e)%e,y:b.y};this.provider.getTileData(f,c,function(b){d._tileLoaded(a,b)})},drawTile:function(a){var b=a.canvas;if(a.data){b.width=b.width,this.renderer.setCanvas(b);var c=this.renderer.accumulate(a.data,this.getKey());this.renderer.renderTileAccum(c,0,0)}},setKey:function(a){this.keys=[a],this.redraw()},setCartoCSS:function(a){if(!this.renderer)throw new Error("renderer is not valid");return this.renderer.setCartoCSS(a)},setStepsRange:function(a,b){this.animator.stepsRange(a,b)},removeStepsRange:function(){this.animator.removeCustomStepsRange()},getStepsRange:function(){return this.animator.stepsRange()}}),b.exports={GMapsTiledTorqueLayer:e,GMapsTorqueLayer:d}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../":91,"./CanvasLayer":86,"./canvas_tile_layer":87,"./gmaps_tileloader_mixin":88,carto:111}],91:[function(a,b,c){b.exports=a("./core"),b.exports.Animator=a("./animator"),b.exports.cartocss_reference=a("./cartocss_reference"),b.exports.common=a("./common"),b.exports.math=a("./math"),b.exports.Mercator=a("./mercator"),b.exports.net=a("./request"),b.exports.renderer=a("./renderer"),b.exports.providers=a("./provider"),a("./leaflet");var d=a("./gmaps");b.exports.GMapsTileLoader=d.GMapsTileLoader,b.exports.GMapsTorqueLayer=d.GMapsTorqueLayer,b.exports.GMapsTiledTorqueLayer=d.GMapsTiledTorqueLayer},{"./animator":82,"./cartocss_reference":83,"./common":84,"./core":85,"./gmaps":89,"./leaflet":93,"./math":96,"./mercator":97,"./provider":99,"./renderer":105,"./request":109}],92:[function(a,b,c){a("./leaflet_tileloader_mixin"),L.CanvasLayer=L.Class.extend({includes:[L.Mixin.Events,L.Mixin.TileLoader],options:{minZoom:0,maxZoom:28,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",zoomOffset:0,opacity:1,unloadInvisibleTiles:L.Browser.mobile,updateWhenIdle:L.Browser.mobile,tileLoader:!1,zoomAnimation:!0},initialize:function(a){a=a||{},this.render=this.render.bind(this),L.Util.setOptions(this,a),this._canvas=this._createCanvas(),this.options.zoomAnimation&&(this._backCanvas=this._createCanvas()),this._ctx=this._canvas.getContext("2d"),this.currentAnimationFrame=-1,this.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)},this.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||function(a){clearTimeout(a)}},_createCanvas:function(){var a;a=document.createElement("canvas"),a.style.position="absolute",a.style.top=0,a.style.left=0,a.style.pointerEvents="none",a.style.zIndex=this.options.zIndex||0;var b="leaflet-tile-container";return this.options.zoomAnimation&&(b+=" leaflet-zoom-animated"),a.setAttribute("class",b),a},onAdd:function(a){this._map=a;var b=this._map._panes.tilePane,c=L.DomUtil.create("div","leaflet-layer");c.appendChild(this._canvas),this.options.zoomAnimation&&(c.appendChild(this._backCanvas),this._backCanvas.style.display="none"),b.appendChild(c),this._container=c,a.dragging._draggable.on("predrag",function(){var b=a.dragging._draggable;L.DomUtil.setPosition(this._canvas,{x:-b._newPos.x,y:-b._newPos.y})},this),a.on({viewreset:this._reset},this),a.on("move",this.redraw,this),a.on("resize",this._reset,this),this.options.zoomAnimation&&a.on({zoomanim:this._animateZoom,zoomend:this._endZoomAnim,moveend:this._reset},this),this.options.tileLoader&&this._initTileLoader(),this._reset()},_animateZoom:function(a){this._animating||(this._animating=!0);var b=this._backCanvas;b.width=this._canvas.width,b.height=this._canvas.height;var c=this._canvas._leaflet_pos||{x:0,y:0};b.getContext("2d").drawImage(this._canvas,0,0),L.DomUtil.setPosition(b,L.DomUtil.getPosition(this._canvas)),this._canvas.style.display="none",b.style.display="block";var d=this._map,e=(d.getZoomScale(a.zoom),d._latLngToNewLayerPoint(d.getCenter(),a.zoom,a.center)),f=d._latLngToNewLayerPoint(a.center,a.zoom,a.center),g={x:e.x-f.x+c.x,y:e.y-f.y+c.y},h=b,i=L.DomUtil.TRANSFORM;setTimeout(function(){h.style[i]=L.DomUtil.getTranslateString(g)+" scale("+a.scale+") "},0)},_endZoomAnim:function(){this._animating=!1,this._canvas.style.display="block",this._backCanvas.style.display="none",this._backCanvas.style[L.DomUtil.TRANSFORM]=""},getCanvas:function(){return this._canvas},getAttribution:function(){return this.options.attribution},draw:function(){return this._reset()},onRemove:function(a){this._container.parentNode.removeChild(this._container),a.off({viewreset:this._reset,move:this._render,moveend:this._reset,resize:this._reset,zoomanim:this._animateZoom,zoomend:this._endZoomAnim},this)},addTo:function(a){return a.addLayer(this),this},error:function(a){return this.provider.options.errorCallback=a,this},setOpacity:function(a){return this.options.opacity=a,this._updateOpacity(),this},setZIndex:function(a){this._canvas.style.zIndex=a,this.options.zoomAnimation&&(this._backCanvas.style.zIndex=a)},bringToFront:function(){return this},bringToBack:function(){return this},_reset:function(){var a=this._map.getSize();this._canvas.width=a.x,this._canvas.height=a.y;var b=L.DomUtil.getPosition(this._map.getPanes().mapPane);b&&L.DomUtil.setPosition(this._canvas,{x:-b.x,y:-b.y}),this.onResize(),this._render()},_updateOpacity:function(){},_render:function(){this.currentAnimationFrame>=0&&this.cancelAnimationFrame.call(window,this.currentAnimationFrame),this.currentAnimationFrame=this.requestAnimationFrame.call(window,this.render)},redraw:function(a){var b=L.DomUtil.getPosition(this._map.getPanes().mapPane);b&&L.DomUtil.setPosition(this._canvas,{x:-b.x,y:-b.y}),a?this.render():this._render()},onResize:function(){},render:function(){throw new Error("render function should be implemented")}})},{"./leaflet_tileloader_mixin":94}],93:[function(a,b,c){"undefined"!=typeof L&&a("./torque")},{"./torque":95}],94:[function(a,b,c){L.Mixin.TileLoader={_initTileLoader:function(){this._tiles={},this._tilesLoading={},this._tilesToLoad=0,this._map.on({moveend:this._updateTiles},this),this._updateTiles()},_removeTileLoader:function(){this._map.off({moveend:this._updateTiles},this),this._removeTiles()},_updateTiles:function(){if(this._map){var a=this._map.getPixelBounds(),b=this._map.getZoom(),c=this.options.tileSize;if(!(b>this.options.maxZoom||b<this.options.minZoom)){var d=new L.Point(Math.floor(a.min.x/c),Math.floor(a.min.y/c)),e=new L.Point(Math.floor(a.max.x/c),Math.floor(a.max.y/c)),f=new L.Bounds(d,e);this._addTilesFromCenterOut(f),this._removeOtherTiles(f)}}},_removeTiles:function(a){for(var b in this._tiles)this._removeTile(b)},_reloadTiles:function(){this._removeTiles(),this._updateTiles()},_removeOtherTiles:function(a){var b,c,d,e,f,g=this._map.getZoom();for(f in this._tiles)this._tiles.hasOwnProperty(f)&&(b=f.split(":"),c=parseInt(b[0],10),d=parseInt(b[1],10),e=parseInt(b[2],10),(g!==e||c<a.min.x||c>a.max.x||d<a.min.y||d>a.max.y)&&this._removeTile(f))},_removeTile:function(a){this.fire("tileRemoved",this._tiles[a]),delete this._tiles[a],delete this._tilesLoading[a]},_tileKey:function(a){return a.x+":"+a.y+":"+a.zoom},_tileShouldBeLoaded:function(a){var b=this._tileKey(a);return!(b in this._tiles||b in this._tilesLoading)},_tileLoaded:function(a,b){this._tilesToLoad--;var c=a.x+":"+a.y+":"+a.zoom;this._tiles[c]=b,delete this._tilesLoading[c],0===this._tilesToLoad&&this.fire("tilesLoaded")},getTilePos:function(a){a=new L.Point(a.x,a.y);var b=this._map._getNewTopLeftPoint(this._map.getCenter()),c=this.options.tileSize;return a.multiplyBy(c).subtract(b)},_addTilesFromCenterOut:function(a){var b,c,d,e=[],f=a.getCenter(),g=this._map.getZoom();for(b=a.min.y;b<=a.max.y;b++)for(c=a.min.x;c<=a.max.x;c++)d=new L.Point(c,b),d.zoom=g,this._tileShouldBeLoaded(d)&&e.push(d);var h=e.length;if(0!==h){for(e.sort(function(a,b){return a.distanceTo(f)-b.distanceTo(f)}),this._tilesToLoad+=h,c=0;h>c;c++){var i=e[c],j=this._tileKey(i);this._tilesLoading[j]=i,this.fire("tileAdded",i)}this.fire("tilesLoading")}}}},{}],95:[function(a,b,c){(function(b){var c=b.carto||a("carto"),d=a("../");a("./canvas_layer"),L.TorqueLayer=L.CanvasLayer.extend({providers:{sql_api:d.providers.json,url_template:d.providers.JsonArray,windshaft:d.providers.windshaft,tileJSON:d.providers.tileJSON},renderers:{point:d.renderer.Point,pixel:d.renderer.Rectangle},initialize:function(a){var b=this;if(!d.isBrowserSupported())throw new Error("browser is not supported by torque");a.tileLoader=!0,this.keys=[0],Object.defineProperty(this,"key",{get:function(){return this.getKey()}}),this.prevRenderedKey=0,a.cartocss&&d.extend(a,d.common.TorqueLayer.optionsFromCartoCSS(a.cartocss)),a.resolution=a.resolution||2,a.steps=a.steps||100,a.visible=void 0===a.visible?!0:a.visible,this.hidden=!a.visible,this.animator=new d.Animator(function(a){var c=0|a;b.getKey()!==c&&b.setKey(c,{direct:!0})},d.extend(d.clone(a),{onPause:function(){b.fire("pause")},onStop:function(){b.fire("stop")},onStart:function(){b.fire("play")},onStepsRange:function(){b.fire("change:stepsRange",b.animator.stepsRange())}})),this.play=this.animator.start.bind(this.animator),this.stop=this.animator.stop.bind(this.animator),this.pause=this.animator.pause.bind(this.animator),this.toggle=this.animator.toggle.bind(this.animator),this.setDuration=this.animator.duration.bind(this.animator),this.isRunning=this.animator.isRunning.bind(this.animator),
L.CanvasLayer.prototype.initialize.call(this,a),this.options.renderer=this.options.renderer||"point",this.options.provider=this.options.provider||"windshaft",this.options.tileJSON&&(this.options.provider="tileJSON"),this.provider=new this.providers[this.options.provider](a),this.renderer=new this.renderers[this.options.renderer](this.getCanvas(),a),a.ready=function(){b.fire("change:bounds",{bounds:b.provider.getBounds()}),b.animator.steps(b.provider.getSteps()),b.animator.rescale(),b.fire("change:steps",{steps:b.provider.getSteps()}),b.setKeys(b.getKeys())},this.renderer.on("allIconsLoaded",this.render.bind(this)),this.on("tileAdded",function(a){this.provider.getTileData(a,a.zoom,function(c){a.zoom===b._map.getZoom()&&(b._tileLoaded(a,c),b._clearTileCaches(),c&&b.redraw(),b.fire("tileLoaded"))})},this)},_clearTileCaches:function(){var a,b;for(a in this._tiles)b=this._tiles[a],b&&b._tileCache&&(b._tileCache=null)},_clearCaches:function(){this.renderer&&this.renderer.clearSpriteCache(),this._clearTileCaches()},onAdd:function(a){a.on({zoomend:this._clearCaches,zoomstart:this._pauseOnZoom},this),a.on({zoomend:this._resumeOnZoom},this),L.CanvasLayer.prototype.onAdd.call(this,a)},onRemove:function(a){this.fire("remove"),this._removeTileLoader(),a.off({zoomend:this._clearCaches,zoomstart:this._pauseOnZoom},this),a.off({zoomend:this._resumeOnZoom},this),L.CanvasLayer.prototype.onRemove.call(this,a)},_pauseOnZoom:function(){this.wasRunning=this.isRunning(),this.wasRunning&&this.pause()},_resumeOnZoom:function(){this.wasRunning&&this.play()},hide:function(){return this.hidden?this:(this.pause(),this.clear(),this.hidden=!0,this)},show:function(){return this.hidden?(this.hidden=!1,this.play(),1===this.options.steps&&this.redraw(),this):this},setSQL:function(a){if(this.provider.options.named_map)throw new Error("SQL queries on named maps are read-only");if(!this.provider||!this.provider.setSQL)throw new Error("this provider does not support SQL");return this.provider.setSQL(a),this._reloadTiles(),this},setBlendMode:function(a){this.renderer.setBlendMode(a),this.redraw()},setSteps:function(a){this.provider.setSteps(a),this._reloadTiles()},setColumn:function(a,b){this.provider.setColumn(a,b),this._reloadTiles()},getTimeBounds:function(){return this.provider&&this.provider.getKeySpan()},clear:function(){var a=this.getCanvas();a.width=a.width},render:function(){if(!this.hidden){var a,b,c,d=this.getCanvas();this.renderer.clearCanvas();var e=d.getContext("2d");for(a in this._tiles)b=this._tiles[a],b&&(this.animator.isRunning()&&(b._tileCache=null),c=this.getTilePos(b.coord),e.setTransform(1,0,0,1,c.x,c.y),b._tileCache?this.renderer._ctx.drawImage(b._tileCache,0,0):this.renderer.renderTile(b,this.keys));if(this.renderer.applyFilters(),!this.animator.isRunning()&&this.getKey()===this.prevRenderedKey){var f=this.renderer.TILE_SIZE;for(a in this._tiles)if(b=this._tiles[a],b&&!b._tileCache){var g=b._tileCache=document.createElement("canvas");g.width=g.height=f,c=this.getTilePos(b.coord);var h=Math.max(0,c.x),i=Math.max(0,c.y),j=Math.min(f,this.getCanvas().width-h),k=Math.min(f,this.getCanvas().height-i);j>0&&k>0&&g.getContext("2d").drawImage(this.getCanvas(),h,i,j,k,h-c.x,i-c.y,j,k)}}this.prevRenderedKey=this.getKey()}},setKey:function(a,b){this.setKeys([a],b)},getKeys:function(){return this.keys},setKeys:function(a,b){this.keys=a,this.animator.step(this.getKey()),this._clearTileCaches(),this.redraw(b&&b.direct),this.fire("change:time",{time:this.getTime(),step:this.getKey(),start:this.getKey(),end:this.getLastKey()})},getKey:function(){return this.keys[0]},getLastKey:function(){return this.keys[this.keys.length-1]},setStep:function(a){if(void 0===a||void 0!==a.length)throw new Error("setTime only accept scalars");this.setKey(a)},renderRange:function(a,b){this.pause();for(var c=[],d=a;b>=d;d++)c.push(d);this.setKeys(c)},resetRenderRange:function(){this.stop(),this.play()},stepToTime:function(a){var b=this.provider.getKeySpan(),c=b.start+(b.end-b.start)*(a/this.provider.getSteps());return new Date(c)},timeToStep:function(a){if("Date"==typeof a&&(a=a.getTime()),!this.provider)return 0;var b=this.provider.getKeySpan(),c=this.provider.getSteps()*(a-b.start)/(b.end-b.start);return c},getStep:function(){return this.getKey()},getTime:function(){return this.stepToTime(this.getKey())},getTimeSpan:function(){return this.provider.getKeySpan()},setCartoCSS:function(a){if(this.provider.options.named_map)throw new Error("CartoCSS style on named maps is read-only");if(!this.renderer)throw new Error("renderer is not valid");var b=(new c.RendererJS).render(a);this.renderer.setShader(b);var e=d.common.TorqueLayer.optionsFromLayer(b.findLayer({name:"Map"}));return this.provider.setCartoCSS&&this.provider.setCartoCSS(a),this.provider.setOptions(e)&&this._reloadTiles(),d.extend(this.options,e),e.animationDuration&&this.animator.duration(e.animationDuration),this._clearCaches(),this.redraw(),this},getActivePointsBBox:function(a){var b=[];for(var c in this._tiles){var d=this._tiles[c];b=b.concat(this.renderer.getActivePointsBBox(d,a))}return b},getValues:function(a){var b=[];a=void 0===a?this.getKey():a;var c,d;for(c in this._tiles)d=this._tiles[c],this.renderer.getValues(d,a,b);return b},getValueForPos:function(a,b,c){c=void 0===c?this.getKey():c;var d,e,f,g,h,i=null;for(d in this._tiles)if(e=this._tiles[d],f=this.getTilePos(e.coord),g=a-f.x,h=b-f.y,g>=0&&h>=0&&g<this.renderer.TILE_SIZE&&h<=this.renderer.TILE_SIZE&&(i=this.renderer.getValueFor(e,c,g,h)),null!==i)return i;return null},getValueForBBox:function(a,b,c,d){var e=a+c,f=b+d,g=a,h=0;for(_y=b;_y<f;_y+=this.options.resolution)for(g=a;e>g;g+=this.options.resolution){var i=this.getValueForPos(g,_y);if(i){var j=i.bbox,k=this._map.latLngToContainerPoint([j[1].lat,j[1].lon]);k.x<e&&k.y<f&&(h+=i.value)}}return h},invalidate:function(){this.provider.reload()},setStepsRange:function(a,b){this.animator.stepsRange(a,b)},removeStepsRange:function(){this.animator.removeCustomStepsRange()},getStepsRange:function(){return this.animator.stepsRange()}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../":91,"./canvas_layer":92,carto:111}],96:[function(a,b,c){function d(a,b){return function(c){return Math.max(Math.min(c,b),a)}}function e(a,b){var c=d(0,1);return function(d){return c((d-a)/(b-a))}}function f(a,b){function c(c){return f(a*(1-c)+c*b)}var f=d(a,b);return c.invert=function(){return e(a,b)},c}b.exports={clamp:d,linear:f,invLinear:e}},{}],97:[function(a,b,c){function d(a,b,c){return null!==b&&(a=Math.max(a,b)),null!==c&&(a=Math.min(a,c)),a}function e(a){return a*(Math.PI/180)}function f(a){return a/(Math.PI/180)}var g=function(a,b){this.x=a||0,this.y=b||0},h=function(){this._tileSize=256,this._pixelOrigin=new g(this._tileSize/2,this._tileSize/2),this._pixelsPerLonDegree=this._tileSize/360,this._pixelsPerLonRadian=this._tileSize/(2*Math.PI)};h.prototype._fromLatLonToPoint=function(a,b){var c=new g(0,0),f=this._pixelOrigin;c.x=f.x+b*this._pixelsPerLonDegree;var h=d(Math.sin(e(a)),-.9999,.9999);return c.y=f.y+.5*Math.log((1+h)/(1-h))*-this._pixelsPerLonRadian,c},h.prototype._fromPointToLatLon=function(a){var b=this,c=b._pixelOrigin,d=(a.x-c.x)/b._pixelsPerLonDegree,e=(a.y-c.y)/-b._pixelsPerLonRadian,g=f(2*Math.atan(Math.exp(e))-Math.PI/2);return{lat:g,lon:d}},h.prototype._tilePixelPos=function(a,b){return{x:a*this._tileSize,y:b*this._tileSize}},h.prototype.tilePixelBBox=function(a,b,c,d,e,f){f=f||1;var h=1<<c,i=f/h;return d=(a*this._tileSize+d)/h,e=(b*this._tileSize+e)/h,[this._fromPointToLatLon(new g(d,e+i)),this._fromPointToLatLon(new g(d+i,e))]},h.prototype.tileBBox=function(a,b,c,d){var e=1<<c;d=d||0;var f=(this._tileSize+2*d)/e,h=(a*this._tileSize-d)/e,i=(b*this._tileSize-d)/e;return[this._fromPointToLatLon(new g(h,i+f)),this._fromPointToLatLon(new g(h+f,i))]},h.prototype.latLonToTilePoint=function(a,b,c,d,e){var f=1<<e,h=this._fromLatLonToPoint(a,b),i=new g(h.x*f,h.y*f),j=this._tilePixelPos(c,d);return new g(Math.round(i.x-j.x),Math.round(i.y-j.y))},b.exports=h},{}],98:[function(a,b,c){function d(){}function e(a){this.t0=null,this.name=a,this.count=0}var f=1024;d.metrics={},d.get=function(a){return d.metrics[a]||{max:0,min:Number.MAX_VALUE,avg:0,total:0,count:0,history:"undefined"!=typeof Float32Array?new Float32Array(f):[]}},d.new_value=function(a,b){var c=d.metrics[a]=d.get(a);c.max=Math.max(c.max,b),c.min=Math.min(c.min,b),c.total+=b,++c.count,c.avg=c.total/c.count,c.history[c.count%f]=b},d.print_stats=function(){for(k in d.metrics){var a=d.metrics[k];console.log(" === "+k+" === "),console.log(" max: "+a.max),console.log(" min: "+a.min),console.log(" avg: "+a.avg),console.log(" count: "+a.count),console.log(" total: "+a.total)}},e.prototype={start:function(){return this.t0=+new Date,this},_elapsed:function(){return+new Date-this.t0},end:function(){null!==this.t0&&(d.new_value(this.name,this._elapsed()),this.t0=null)},inc:function(a){a=void 0===a?1:a,d.new_value(this.name,d.get(this.name).count+(a?a:0))},dec:function(a){a=void 0===a?1:a,this.inc(-a)},mark:function(){if(++this.count,null===this.t0)return void this.start();var a=this._elapsed();a>1&&(d.new_value(this.name,this.count),this.count=0,this.start())}},d.metric=function(a){return new e(a)},b.exports=d},{}],99:[function(a,b,c){b.exports={json:a("./json"),JsonArray:a("./jsonarray"),windshaft:a("./windshaft"),tileJSON:a("./tilejson")}},{"./json":100,"./jsonarray":101,"./tilejson":102,"./windshaft":103}],100:[function(a,b,c){function d(a){for(var b=1;b<arguments.length;++b){var c=arguments[b];for(var d in c)a=a.replace(RegExp("\\{"+d+"\\}","g"),c[d])}return a}var e=a("../"),f=a("../profiler"),g=e.types.Uint8Array,h=e.types.Int32Array,i=e.types.Uint32Array,j=function(a){if(this._ready=!1,this._tileQueue=[],this.options=a,this.options.is_time=void 0===this.options.is_time?!0:this.options.is_time,this.options.tiler_protocol=a.tiler_protocol||"http",this.options.tiler_domain=a.tiler_domain||"cartodb.com",this.options.tiler_port=a.tiler_port||80,this.options.data_aggregation&&(this.options.cumulative="cumulative"===this.options.data_aggregation),void 0===a.resolution)throw new Error("resolution should be provided");if(void 0===a.steps)throw new Error("steps should be provided");void 0===a.start?this._fetchKeySpan():this._setReady(!0)};j.prototype={proccessTile:function(a,b,c){var d,e=new g(a.length),j=new g(a.length),k=f.metric("ProviderJSON:mem"),l=f.metric("ProviderJSON:point_count"),m=f.metric("ProviderJSON:process_time").start(),n=0,o=-1;for(d=0;d<a.length;++d){var p=a[d];n+=p.dates__uint16.length;for(var q=0;q<p.dates__uint16.length;++q)o=Math.max(o,p.dates__uint16[q])}this.options.cumulative&&(n=(1+o)*a.length);var r=this.options.cumulative?i:g,s=new h(o+1),t=new h(o+1),u=new(this.options.valueDataType||r)(n),v=new i(n);k.inc(4*o+4*o+n+4*n),l.inc(a.length);for(var w={},d=0;d<a.length;++d){var p=a[d];e[d]=p.x__uint8*this.options.resolution,-1===p.y__uint8?j[d]=0:j[d]=p.y__uint8*this.options.resolution;var n=p.dates__uint16,x=p.vals__uint8;if(this.options.cumulative){for(var y={},z=0,A=n.length;A>z;++z)y[n[z]]=x[z];for(var B=0,z=n[0];o>=z;++z){var C=w[z]||(w[z]=[]),D=y[z];D&&(B+=D),C.push([d,B])}}else for(var z=0,A=n.length;A>z;++z){var C=w[n[z]]||(w[n[z]]=[]);this.options.cumulative&&(x[z]+=prev_val),prev_val=x[z],C.push([d,x[z]])}}for(var E=0,F=0,G=0,G=0;o>=G;++G){var H=0,I=w[G];if(I)for(var d=0;d<I.length;++d){var C=I[d];++H,v[E]=C[0],u[E]=C[1],++E}s[G]=F,t[G]=H,F+=H}return m.end(),{x:e,y:j,z:c,coord:{x:b.x,y:b.y,z:c},timeCount:t,timeIndex:s,renderDataPos:v,renderData:u,maxDate:o}},_host:function(){var a=this.options,b=a.sql_api_port,c=(a.user_name||a.user)+"."+(a.sql_api_domain||"cartodb.com")+(b?":"+b:""),d=a.sql_api_protocol||"http";return this.options.url||d+"://"+c+"/api/v2/sql"},url:function(a){var b=this.options,c=b.sql_api_protocol||"http";if(!this.options.cdn_url)return this._host();var d=c+"://";a&&(d+=a+".");var e=b.cdn_url;if(!e.http&&!e.https)throw new Error("cdn_host should contain http and/or https entries");return d+=e[c]+"/"+(b.user_name||b.user)+"/api/v2/sql"},_hash:function(a){var b=0;if(!a||0==a.length)return b;for(var c=0,d=a.length;d>c;++c)b=(b<<5)-b+a.charCodeAt(c)|0;return b},_extraParams:function(){if(this.options.extra_params){var a=[];for(var b in this.options.extra_params){var c=this.options.extra_params[b];c&&a.push(b+"="+encodeURIComponent(c))}return a.join("&")}return null},isHttps:function(){return this.options.sql_api_protocol&&"https"===this.options.sql_api_protocol},sql:function(a,b,c){c=c||{};var d=this.options.subdomains||"0123";this.isHttps()&&(d=[null]);var f;f=c.no_cdn?this._host():this.url(d[Math.abs(this._hash(a))%d.length]);var g=this._extraParams();e.net.get(f+"?q="+encodeURIComponent(a)+(g?"&"+g:""),function(a){c.parseJSON&&(a=JSON.parse(a&&a.responseText)),b&&b(a)})},getTileData:function(a,b,c){this._ready?this._getTileData(a,b,c):this._tileQueue.push([a,b,c])},_setReady:function(a){this._ready=!0,this._processQueue(),this.options.ready&&this.options.ready()},_processQueue:function(){for(var a;a=this._tileQueue.pop();)this._getTileData.apply(this,a)},_getTileData:function(a,b,c){var e=f.metric("ProviderJSON:tile_fetch_time").start();this.table=this.options.table;var g=this.options.column;this.options.is_time&&(g=d("date_part('epoch', {column})",this.options));var h="WITH par AS (  SELECT CDB_XYZ_Resolution({zoom})*{resolution} as res,  256/{resolution} as tile_size, CDB_XYZ_Extent({x}, {y}, {zoom}) as ext ),cte AS (   SELECT ST_SnapToGrid(i.the_geom_webmercator, p.res) g, {countby} c, floor(({column_conv} - {start})/{step}) d  FROM ({_sql}) i, par p   WHERE i.the_geom_webmercator && p.ext   GROUP BY g, d) SELECT (st_x(g)-st_xmin(p.ext))/p.res x__uint8,        (st_y(g)-st_ymin(p.ext))/p.res y__uint8, array_agg(c) vals__uint8, array_agg(d) dates__uint16 FROM cte, par p where (st_y(g)-st_ymin(p.ext))/p.res < tile_size and (st_x(g)-st_xmin(p.ext))/p.res < tile_size GROUP BY x__uint8, y__uint8",i=d(h,this.options,{zoom:b,x:a.x,y:a.y,column_conv:g,_sql:this.getSQL()}),j=this;this.sql(i,function(d){if(d){var f=JSON.parse(d.responseText).rows;c(j.proccessTile(f,a,b))}else c(null);e.end()})},getKeySpan:function(){return{start:1e3*this.options.start,end:1e3*this.options.end,step:this.options.step,steps:this.options.steps,columnType:this.options.is_time?"date":"number"}},setColumn:function(a,b){this.options.column=a,this.options.is_time=void 0===b,this.reload()},setResolution:function(a){this.options.resolution=a},setOptions:function(a){var b=!1;if(void 0!==a.resolution&&a.resolution!==this.options.resolution&&(this.options.resolution=a.resolution,b=!0),void 0!==a.steps&&a.steps!==this.options.steps&&(this.setSteps(a.steps,{silent:!0}),b=!0),void 0!==a.column&&a.column!==this.options.column&&(this.options.column=a.column,b=!0),void 0!==a.countby&&a.countby!==this.options.countby&&(this.options.countby=a.countby,b=!0),void 0!==a.data_aggregation){var c="cumulative"===a.data_aggregation;this.options.cumulative!==c&&(this.options.cumulative=c,b=!0)}return b&&this.reload(),b},reload:function(){this._ready=!1,this._fetchKeySpan()},setSQL:function(a){this.options.sql!=a&&(this.options.sql=a,this.reload())},getSteps:function(){return Math.min(this.options.steps,this.options.data_steps)},setSteps:function(a,b){b=b||{},this.options.steps!==a&&(this.options.steps=a,this.options.step=(this.options.end-this.options.start)/this.getSteps(),this.options.step=this.options.step||1,b.silent||this.reload())},getBounds:function(){return this.options.bounds},getSQL:function(){return this.options.sql||"select * from "+this.options.table},_tilerHost:function(){var a=this.options,b=a.user_name||a.user;return a.tiler_protocol+"://"+(b?b+".":"")+a.tiler_domain+(""!=a.tiler_port?":"+a.tiler_port:"")},_fetchUpdateAt:function(a){var b=this,c={version:"1.0.1",stat_tag:this.options.stat_tag||"torque",layers:[{type:"cartodb",options:{cartocss_version:"2.1.1",cartocss:"#layer {}",sql:this.getSQL()}}]},f=this._tilerHost()+"/tiles/layergroup",g=this._extraParams();g&&(g=g.replace("api_key=","map_key=")),f=f+"?config="+encodeURIComponent(JSON.stringify(c))+"&callback=?"+(g?"&"+g:""),e.net.jsonp(f,function(c){var e=d("select * from ({sql}) __torque_wrap_sql limit 0",{sql:b.getSQL()});b.sql(e,function(b){c&&b&&a({updated_at:c.last_updated,fields:b.fields})},{parseJSON:!0})})},_fetchKeySpan:function(){var a,b,c,e,f=this;this._fetchUpdateAt(function(g){if(g){f.options.extra_params=f.options.extra_params||{},f.options.extra_params.last_updated=g.updated_at||0,f.options.extra_params.cache_policy="persist",f.options.is_time="date"===g.fields[f.options.column].type;var h=f.options.column;f.options.is_time?(c="date_part('epoch', max({column}))",e="date_part('epoch', min({column}))",h=d("date_part('epoch', {column})",f.options)):(c="max({column})",e="min({column})"),a=d(c,{column:f.options.column}),b=d(e,{column:f.options.column});var i=" SELECT st_xmax(st_envelope(st_collect(the_geom))) xmax, st_ymax(st_envelope(st_collect(the_geom))) ymax, st_xmin(st_envelope(st_collect(the_geom))) xmin, st_ymin(st_envelope(st_collect(the_geom))) ymin, count(*) as num_steps, {max_col} max_date, {min_col} min_date FROM  ({sql}) __torque_wrap_sql ",j=d(i,{max_col:a,min_col:b,column:h,sql:f.getSQL()});f.sql(j,function(a){a=a.rows[0],f.options.start=a.min_date,f.options.end=a.max_date,f.options.step=(a.max_date-a.min_date)/Math.min(f.options.steps,a.num_steps>>0),f.options.data_steps=a.num_steps>>0,f.options.step=f.options.step||1,f.options.bounds=[[a.ymin,a.xmin],[a.ymax,a.xmax]],f._setReady(!0)},{parseJSON:!0,no_cdn:!0})}},{parseJSON:!0,no_cdn:!0})}},b.exports=j},{"../":91,"../profiler":98}],101:[function(a,b,c){var d=a("../"),e=a("../profiler"),f=d.types.Uint8Array,g=d.types.Int32Array,h=d.types.Uint32Array,i=function(a){this.options=a};i.prototype={aggregateByKey:function(a){function b(a){for(var b=3,c=a.data[2],d={},e=0;c>e;++e)d[a.data[b+e]]=a.data[b+c+e];return d}var c={};for(r=0;r<a.length;++r){var d=b(a[r]);for(var e in d)c[e]=c[e]||0,c[e]+=d[e]}return c},proccessTile:function(a,b,c){function d(a){for(var b=3,c={x:a.data[0]*k.options.resolution,y:a.data[1]*k.options.resolution,valuesCount:a.data[2],times:[],values:[]},d=0;d<c.valuesCount;++d)c.times.push(a.data[b+d]),c.values.push(a.data[b+c.valuesCount+d]);if(k.options.cumulative)for(var d=1;d<c.valuesCount;++d)c.values[d]+=c.values[d-1];return c}var e,i=new f(a.length),j=new f(a.length),k=this;for(e=0;e<a.length;++e)a[e]=d(a[e]);var l=0,m=0;for(e=0;e<a.length;++e){var n=a[e];l+=n.times.length;for(var o=0;o<n.times.length;++o)m=Math.max(m,n.times[o])}for(var p=new g(m+1),q=new g(m+1),r=new(this.options.valueDataType||f)(l),s=new h(l),t={},e=0;e<a.length;++e){var n=a[e];i[e]=n.x,j[e]=n.y;for(var l=n.times,u=n.values,v=0,w=l.length;w>v;++v){var x=t[l[v]]||(t[l[v]]=[]);x.push([e,u[v]])}}for(var y=0,z=0,A=0,A=0;m>=A;++A){var B=0,C=t[A];if(C)for(var e=0;e<C.length;++e){var x=C[e];++B,s[y]=x[0],r[y]=x[1],++y}p[A]=z,q[A]=B,z+=B}return{x:i,y:j,coord:{x:b.x,y:b.y,z:c},timeCount:q,timeIndex:p,renderDataPos:s,renderData:r}},url:function(){return this.options.url},tileUrl:function(a,b){var c=this.url(),d=(this.options.subdomains||"abcd")[(a.x+a.y+b)%4];return c.replace("{x}",a.x).replace("{y}",a.y).replace("{z}",b).replace("{s}",d)},getTile:function(a,b,c){var f=this.tileUrl(a,b),g=e.metric("jsonarray:fetch time");g.start(),d.net.get(f,function(a){g.end(),a&&(a=JSON.parse(a.responseText)),c(a)})},getTileData:function(a,b,c){var f=this.tileUrl(a,b),g=this,h=e.metric("jsonarray:fetch time");h.start(),d.net.get(f,function(d){h.end();var f=null,i=e.metric("jsonarray:processing time"),j=e.metric("jsonarray:parsing time");try{i.start(),j.start();var k=JSON.parse(d.responseText||d.response).rows;j.end(),f=g.proccessTile(k,a,b),i.end()}catch(l){console.error("problem parsing JSON on ",a,b)}c(f)})}},b.exports=i},{"../":91,"../profiler":98}],102:[function(a,b,c){var d=a("../"),e=d.types.Uint8Array,f=d.types.Int32Array,g=d.types.Uint32Array,h=d.types.Uint8ClampedArray,i=function(a){if(this._ready=!1,this._tileQueue=[],this.options=a,this.options.coordinates_data_type=this.options.coordinates_data_type||e,this.options.data_aggregation&&(this.options.cumulative="cumulative"===this.options.data_aggregation),this.options.auth_token){var b=this.options.extra_params||(this.options.extra_params={});b.auth_token=this.options.auth_token}this.options.no_fetch_map||this._fetchMap()};i.prototype={NAME:"tileJSON",proccessTile:function(a,b,c){var d,e=new this.options.coordinates_data_type(a.length),i=new this.options.coordinates_data_type(a.length),j=0,k=-1;for(d=0;d<a.length;++d){var l=a[d];j+=l.dates__uint16.length;for(var m=0;m<l.dates__uint16.length;++m)k=Math.max(k,l.dates__uint16[m])}this.options.cumulative&&(j=(1+k)*a.length);for(var n=this.options.cumulative?g:h,o=new f(k+1),p=new f(k+1),q=new(this.options.valueDataType||n)(j),r=new g(j),s={},d=0;d<a.length;++d){var l=a[d];e[d]=l.x__uint8*this.options.resolution,i[d]=l.y__uint8*this.options.resolution;var j=l.dates__uint16,t=l.vals__uint8;if(this.options.cumulative){for(var u={},v=0,w=j.length;w>v;++v)u[j[v]]=t[v];for(var x=0,v=j[0];k>=v;++v){var y=s[v]||(s[v]=[]),z=u[v];z&&(x+=z),y.push([d,x])}}else for(var v=0,w=j.length;w>v;++v){var y=s[j[v]]||(s[j[v]]=[]);this.options.cumulative&&(t[v]+=prev_val),prev_val=t[v],y.push([d,t[v]])}}for(var A=0,B=0,C=0,C=0;k>=C;++C){var D=0,E=s[C];if(E)for(var d=0;d<E.length;++d){var y=E[d];++D,r[A]=y[0],q[A]=y[1],++A}o[C]=B,p[C]=D,B+=D}return{x:e,y:i,z:c,coord:{x:b.x,y:b.y,z:c},timeCount:p,timeIndex:o,renderDataPos:r,renderData:q,maxDate:k}},setSteps:function(a,b){b=b||{},this.options.steps!==a&&(this.options.steps=a,this.options.step=(this.options.end-this.options.start)/this.getSteps(),this.options.step=this.options.step||1,b.silent||this.reload())},setOptions:function(a){var b=!1;if(void 0!==a.resolution&&a.resolution!==this.options.resolution&&(this.options.resolution=a.resolution,b=!0),void 0!==a.steps&&a.steps!==this.options.steps&&(this.setSteps(a.steps,{silent:!0}),b=!0),void 0!==a.column&&a.column!==this.options.column&&(this.options.column=a.column,b=!0),void 0!==a.countby&&a.countby!==this.options.countby&&(this.options.countby=a.countby,b=!0),void 0!==a.data_aggregation){var c="cumulative"===a.data_aggregation;this.options.cumulative!==c&&(this.options.cumulative=c,b=!0)}return b&&this.reload(),b},_extraParams:function(a){if(a=d.extend(d.extend({},a),this.options.extra_params)){var b=[];for(var c in a){var e=a[c];if(e)if(d.isArray(e))for(var f=0,g=e.length;g>f;f++)b.push(c+"[]="+encodeURIComponent(e[f]));else b.push(c+"="+encodeURIComponent(e))}return b.join("&")}return null},getTileData:function(a,b,c){this._ready?this._getTileData(a,b,c):this._tileQueue.push([a,b,c])},_setReady:function(a){this._ready=!0,this._processQueue(),this.options.ready&&this.options.ready()},_processQueue:function(){for(var a;a=this._tileQueue.pop();)this._getTileData.apply(this,a)},_getTileData:function(a,b,c){var e=this,f=this.options.subdomains||"0123",g=Math.pow(2,b),h=(a.x%g+g)%g,i=Math.abs(h+a.y)%f.length,j=this._extraParams(),k=this.templateUrl.replace("{x}",h).replace("{y}",a.y).replace("{z}",b).replace("{s}",f[i]);k+=j,d.net.get(k,function(d){if(d&&d.responseText){var f=JSON.parse(d.responseText);c(e.proccessTile(f,a,b))}else c(null)})},getKeySpan:function(){return{start:this.options.start,end:this.options.end,step:this.options.step,steps:this.options.steps,columnType:this.options.column_type}},setColumn:function(a,b){this.options.column=a,this.options.is_time=void 0===b,this.reload()},reload:function(){this._ready=!1,this._fetchMap()},getSteps:function(){return Math.min(this.options.steps,this.options.data_steps)},getBounds:function(){return this.options.bounds},getSQL:function(){return this.options.sql||"select * from "+this.options.table},setSQL:function(a){this.options.sql!=a&&(this.options.sql=a,this.reload())},_isUserTemplateUrl:function(a){return a&&-1!==a.indexOf("{user}")},isHttps:function(){return 0===this.options.maps_api_template.indexOf("https")},_fetchMap:function(a){var b=this;d.net.get(this.options.tileJSON,function(a){if(a=JSON.parse(a.response)){if(a.errors)return void(b.options.errorCallback&&b.options.errorCallback(a.errors));for(var c in a)b.options[c]=a[c];b.templateUrl=a.tiles[0],0!==b.templateUrl.indexOf("http")&&(b.templateUrl=b.options.tileJSON.substring(0,b.options.tileJSON.lastIndexOf("/")+1)+b.templateUrl),b._setReady(!0)}})}},b.exports=i},{"../":91}],103:[function(a,b,c){var d=a("../"),e=a("../profiler"),f=d.types.Uint8Array,g=d.types.Int32Array,h=d.types.Uint32Array,i=d.types.Uint8ClampedArray,j=function(a){if(this._ready=!1,this._tileQueue=[],this.options=a,this.options.is_time=void 0===this.options.is_time?!0:this.options.is_time,this.options.tiler_protocol=a.tiler_protocol||"http",this.options.tiler_domain=a.tiler_domain||"cartodb.com",this.options.tiler_port=a.tiler_port||80,a.maps_api_template?this.options.maps_api_template=a.maps_api_template:this._buildMapsApiTemplate(this.options),this.options.coordinates_data_type=this.options.coordinates_data_type||f,this.options.data_aggregation&&(this.options.cumulative="cumulative"===this.options.data_aggregation),this.options.auth_token){var b=this.options.extra_params||(this.options.extra_params={});b.auth_token=this.options.auth_token}this.options.no_fetch_map||this._fetchMap()};j.prototype={proccessTile:function(a,b,c){var d,f=new this.options.coordinates_data_type(a.length),j=new this.options.coordinates_data_type(a.length),k=e.metric("torque.provider.windshaft.mem"),l=e.metric("torque.provider.windshaft.points"),m=e.metric("torque.provider.windshaft.process_time").start(),n=0,o=-1;for(d=0;d<a.length;++d){var p=a[d];n+=p.dates__uint16.length;for(var q=0;q<p.dates__uint16.length;++q)o=Math.max(o,p.dates__uint16[q])}this.options.cumulative&&(n=(1+o)*a.length);var r=this.options.cumulative?h:i,s=new g(o+1),t=new g(o+1),u=new(this.options.valueDataType||r)(n),v=new h(n);k.inc(4*o+4*o+n+4*n),l.inc(a.length);for(var w={},d=0;d<a.length;++d){var p=a[d];f[d]=p.x__uint8*this.options.resolution,j[d]=p.y__uint8*this.options.resolution;var n=p.dates__uint16,x=p.vals__uint8;if(this.options.cumulative){for(var y={},z=0,A=n.length;A>z;++z)y[n[z]]=x[z];for(var B=0,z=n[0];o>=z;++z){var C=w[z]||(w[z]=[]),D=y[z];D&&(B+=D),C.push([d,B])}}else for(var z=0,A=n.length;A>z;++z){var C=w[n[z]]||(w[n[z]]=[]);this.options.cumulative&&(x[z]+=prev_val),prev_val=x[z],C.push([d,x[z]])}}for(var E=0,F=0,G=0,G=0;o>=G;++G){var H=0,I=w[G];if(I)for(var d=0;d<I.length;++d){var C=I[d];++H,v[E]=C[0],u[E]=C[1],++E}s[G]=F,t[G]=H,F+=H}return m.end(),{x:f,y:j,z:c,coord:{x:b.x,y:b.y,z:c},timeCount:t,timeIndex:s,renderDataPos:v,renderData:u,maxDate:o}},setSteps:function(a,b){b=b||{},this.options.steps!==a&&(this.options.steps=a,this.options.step=(this.options.end-this.options.start)/this.getSteps(),this.options.step=this.options.step||1,b.silent||this.reload())},setOptions:function(a){var b=!1;if(void 0!==a.resolution&&a.resolution!==this.options.resolution&&(this.options.resolution=a.resolution,b=!0),void 0!==a.steps&&a.steps!==this.options.steps&&(this.setSteps(a.steps,{silent:!0}),b=!0),void 0!==a.column&&a.column!==this.options.column&&(this.options.column=a.column,b=!0),void 0!==a.countby&&a.countby!==this.options.countby&&(this.options.countby=a.countby,b=!0),void 0!==a.data_aggregation){var c="cumulative"===a.data_aggregation;this.options.cumulative!==c&&(this.options.cumulative=c,b=!0)}return b&&this.reload(),b},_extraParams:function(a){if(a=d.extend(d.extend({},a),this.options.extra_params)){var b=[];for(var c in a){var e=a[c];if(e)if(d.isArray(e))for(var f=0,g=e.length;g>f;f++)b.push(c+"[]="+encodeURIComponent(e[f]));else b.push(c+"="+encodeURIComponent(e))}return b.join("&")}return null},getTileData:function(a,b,c){this._ready?this._getTileData(a,b,c):this._tileQueue.push([a,b,c])},_setReady:function(a){this._ready=!0,this._processQueue(),this.options.ready&&this.options.ready()},_processQueue:function(){for(var a;a=this._tileQueue.pop();)this._getTileData.apply(this,a)},_getTileData:function(a,b,c){var f=this,g=e.metric("torque.provider.windshaft.tile.fetch").start(),h=this.options.subdomains||"0123",i=Math.pow(2,b),j=(a.x%i+i)%i,k=Math.abs(j+a.y)%h.length,l=this.templateUrl.replace("{x}",j).replace("{y}",a.y).replace("{z}",b).replace("{s}",h[k]),m=this._extraParams();d.net.get(l+(m?"?"+m:""),function(d){if(g.end(),d&&d.responseText){var h=JSON.parse(d.responseText);c(f.proccessTile(h,a,b))}else e.metric("torque.provider.windshaft.tile.error").inc(),c(null)})},getKeySpan:function(){return{start:this.options.start,end:this.options.end,step:this.options.step,steps:this.options.steps,columnType:this.options.column_type}},setColumn:function(a,b){this.options.column=a,this.options.is_time=void 0===b,this.reload()},reload:function(){this._ready=!1,this._fetchMap()},getSteps:function(){return Math.min(this.options.steps,this.options.data_steps)},getBounds:function(){return this.options.bounds},getSQL:function(){return this.options.sql||"select * from "+this.options.table},setSQL:function(a){this.options.sql!=a&&(this.options.sql=a,this.reload())},_buildMapsApiTemplate:function(a){var b=a.user_name||a.user;a.maps_api_template=a.tiler_protocol+"://"+(b?"{user}.":"")+a.tiler_domain+(""!=a.tiler_port?":"+a.tiler_port:"")},_tilerHost:function(){var a=this.options,b=a.user_name||a.user;return a.maps_api_template.replace("{user}",b)},url:function(){var a=this.options,b=a.cdn_url,c=!b||b&&!b.http&&!b.https;if(a.no_cdn||c)return this._tilerHost();var d=this.isHttps()?"https":"http",e=d+"://";this.isHttps()||(e+="{s}.");var f=b[d];this._isUserTemplateUrl(f)||(f+="/{user}");var g=a.user_name||a.user;return e+=f.replace("{user}",g)},_isUserTemplateUrl:function(a){return a&&-1!==a.indexOf("{user}")},isHttps:function(){return 0===this.options.maps_api_template.indexOf("https")},_generateCartoCSS:function(){var a={"-torque-frame-count":this.options.steps,"-torque-resolution":this.options.resolution,"-torque-aggregation-function":"'"+this.options.countby+"'","-torque-time-attribute":"'"+this.options.column+"'","-torque-data-aggregation":this.options.cumulative?"cumulative":"linear"},b="Map{";for(var c in a)b+=c+":"+a[c]+";";return b+"}"},_fetchMap:function(a){var b=this,c={},f=this.options.dynamic_cdn?this.url().replace("{s}","0"):this._tilerHost(),g=f+"/api/v1/map",h=this.options.named_map,i={};h?(g=f+"/api/v1/map/named/"+h.name+"/jsonp","undefined"!=typeof h.params&&(c=h.params)):c={version:"1.0.1",stat_tag:this.options.stat_tag||"torque",layers:[{type:"torque",options:{cartocss_version:"1.0.0",cartocss:this._generateCartoCSS(),sql:this.getSQL()}}]},this.options.stat_tag&&(i.stat_tag=this.options.stat_tag),extra=this._extraParams(i),extra&&(extra=extra.replace("api_key=","map_key=")),g=g+"?config="+encodeURIComponent(JSON.stringify(c))+"&callback=?"+(extra?"&"+extra:"");var j=e.metric("torque.provider.windshaft.layergroup.time").start();d.net.jsonp(g,function(a){if(j.end(),a){if(a.errors)return void(b.options.errorCallback&&b.options.errorCallback(a.errors));var c=Object.keys(a.metadata.torque)[0],d=a.metadata.torque[c];for(var f in d)b.options[f]=d[f];if(a.cdn_url){var g=b.options.cdn_url=b.options.cdn_url||{};g.http=a.cdn_url.http||g.http,g.https=a.cdn_url.https||g.https}b.templateUrl=b.url()+"/api/v1/map/"+a.layergroupid+"/"+c+"/{z}/{x}/{y}.json.torque",b._setReady(!0)}else e.metric("torque.provider.windshaft.layergroup.error").inc()},{callbackName:b.options.instanciateCallback})}},b.exports=j},{"../":91,"../profiler":98}],104:[function(a,b,c){function d(a,b){a.fillStyle=b["marker-fill"];var c=b["marker-width"];a.beginPath(),a.arc(0,0,c,0,g,!0,!0),a.closePath(),void 0!==b["marker-opacity"]&&(b["marker-fill-opacity"]=b["marker-line-opacity"]=b["marker-opacity"]),b["marker-fill"]&&(a.globalAlpha=b["marker-fill-opacity"]>=0?b["marker-fill-opacity"]:1,
a.globalAlpha>0&&a.fill()),b["marker-line-color"]&&b["marker-line-width"]&&b["marker-line-width"]>h&&(a.globalAlpha=b["marker-line-opacity"]>=0?b["marker-line-opacity"]:1,void 0!==b["marker-line-width"]&&(a.lineWidth=b["marker-line-width"]),a.strokeStyle=b["marker-line-color"],a.globalAlpha>0&&a.stroke())}function e(a,b){a.fillStyle=b["marker-fill"];var c=b["marker-width"],d=2*c;b["marker-fill"]&&(void 0===b["marker-fill-opacity"]&&void 0===b["marker-opacity"]||(a.globalAlpha=b["marker-fill-opacity"]||b["marker-opacity"]),a.fillRect(-c,-c,d,d)),a.globalAlpha=1,b["marker-line-color"]&&b["marker-line-width"]&&(b["marker-line-opacity"]&&(a.globalAlpha=b["marker-line-opacity"]),b["marker-line-width"]&&(a.lineWidth=b["marker-line-width"]),a.strokeStyle=b["marker-line-color"],a.globalAlpha>0&&a.strokeRect(-c,-c,d,d))}function f(a,b,c){b.complete&&(void 0===c["marker-fill-opacity"]&&void 0===c["marker-opacity"]||(a.globalAlpha=c["marker-fill-opacity"]||c["marker-opacity"]),a.drawImage(b,0,0,Math.min(b.width,i),Math.min(b.height,i)))}var g=2*Math.PI,h=.05,i=255;b.exports={renderPoint:d,renderSprite:f,renderRectangle:e,MAX_SPRITE_RADIUS:i}},{}],105:[function(a,b,c){b.exports={cartocss:a("./cartocss_render"),Point:a("./point"),Rectangle:a("./rectangle")}},{"./cartocss_render":104,"./point":106,"./rectangle":107}],106:[function(a,b,c){(function(c){function d(a){return l[a]||a}function e(a,b){if(!a)throw new Error("canvas can't be undefined");this.options=b,this._canvas=a,this._ctx=a.getContext("2d"),this._sprites=[],this._shader=null,this._icons={},this._iconsToLoad=0,this._filters=new j(this._canvas,{canvasClass:b.canvasClass}),this.setCartoCSS(this.options.cartocss||k),this.TILE_SIZE=256,this._style=null,this._gradients={},this._forcePoints=!1}var f=a("../"),g=a("./cartocss_render"),h=a("../profiler"),i=c.carto||a("carto"),j=a("./torque_filters"),k=(2*Math.PI,["#layer {","  marker-fill: #662506;","  marker-width: 4;","  [value > 1] { marker-fill: #FEE391; }","  [value > 2] { marker-fill: #FEC44F; }","  [value > 3] { marker-fill: #FE9929; }","  [value > 4] { marker-fill: #EC7014; }","  [value > 5] { marker-fill: #CC4C02; }","  [value > 6] { marker-fill: #993404; }","  [value > 7] { marker-fill: #662506; }","}"].join("\n")),l={src:"source-over","src-over":"source-over","dst-over":"destination-over","src-in":"source-in","dst-in":"destination-in","src-out":"source-out","dst-out":"destination-out","src-atop":"source-atop","dst-atop":"destination-atop",xor:"xor",darken:"darken",lighten:"lighten"};f.extend(e.prototype,f.Event,{clearCanvas:function(){var a=this._canvas,b=this._Map["-torque-clear-color"];if("rgba(255, 255, 255, 0)"!==b&&b){var c=this._ctx;c.setTransform(1,0,0,1,0,0);var e=this._Map["comp-op"];c.globalCompositeOperation=d(e),c.fillStyle=b,c.fillRect(0,0,a.width,a.height)}else this._canvas.width=this._canvas.width},setCanvas:function(a){this._canvas=a,this._ctx=a.getContext("2d")},setCartoCSS:function(a){this.setShader((new i.RendererJS).render(a))},setShader:function(a){this._sprites=[],this._shader=a,this._Map=this._shader.getDefault().getStyle({},{zoom:0});var b=this._shader.getImageURLs();this._preloadIcons(b)},clearSpriteCache:function(){this._sprites=[]},generateSprite:function(a,b,c){var d=h.metric("torque.renderer.point.generateSprite").start(),e=a.getStyle({value:b},c);null!==this._style&&this._style===e||(this._style=e);var i=e["marker-width"];if(!i)return null;if(0===e["marker-opacity"]&&!e["marker-line-opacity"])return null;var j=this._createCanvas(),k=j.getContext("2d"),l=e["marker-file"]||e["point-file"],m=l&&this._qualifyURL(l);if(m&&this._iconsToLoad<=0&&this._icons[m]){var n=this._icons[m],o=Math.min(2*e["marker-width"]||n.width,2*g.MAX_SPRITE_RADIUS),p=Math.min((e["marker-height"]||o)*(n.width/n.height),2*g.MAX_SPRITE_RADIUS);j.width=k.width=o,j.height=k.height=p,k.scale(o/n.width,p/n.height),g.renderSprite(k,n,e)}else{var q=(e["marker-line-width"]||0)+2*i,r=k.width=j.width=k.height=j.height=Math.ceil(q);k.translate(r/2,r/2);var s=e["marker-type"];s&&"rectangle"===s?g.renderRectangle(k,e):g.renderPoint(k,e)}if(d.end(!0),f.flags.sprites_to_images){var t=this._createImage();return t.src=j.toDataURL(),t}return j},renderTile:function(a,b,c){if(this._iconsToLoad>0)return this.on("allIconsLoaded",function(){this.renderTile.apply(this,[a,b,c])}),!1;"undefined"==typeof b.length&&(b=[b]);for(var d=h.metric("torque.renderer.point.renderLayers").start(),e=this._shader.getLayers(),f=0,g=e.length;g>f;++f){var i=e[f];if("Map"!==i.name())for(var j=this._sprites[f]||(this._sprites[f]={}),k=0;k<i.frames().length;++k)for(var l=i.frames()[k],m=j[l]||(j[l]=[]),n=0,o=b.length;o>n;n++)this._renderTile(a,b[n]-l,l,m,i)}return d.end(!0),c&&c(null)},_createCanvas:function(){return this.options.canvasClass?new this.options.canvasClass:document.createElement("canvas")},_createImage:function(){return this.options.imageClass?new this.options.imageClass:new Image},_setImageSrc:function(a,b,c){this.options.setImageSrc?this.options.setImageSrc(a,b,c):(a.onload=function(){c(null)},a.onerror=function(){c(new Error("Could not load image"))},a.src=b)},_qualifyURL:function(a){if("undefined"!=typeof this.options.qualifyURL)return this.options.qualifyURL(a);var b=document.createElement("a");return b.href=a,b.href},_renderTile:function(a,b,c,e,g,i){if(this._canvas){var j=h.metric("torque.renderer.point.renderTile").start(),k=this._ctx,l=d(g.eval("comp-op"))||this.options.blendmode;l&&(k.globalCompositeOperation=l),this.options.cumulative&&b>a.maxDate&&(b=a.maxDate);var m=this.options.resolution*(this.TILE_SIZE/this.options.resolution-1),n=a.timeCount[b],o=this.options.resolution/2;if(n)for(var p=a.timeIndex[b],q=0;n>q;++q){var r=a.renderDataPos[p+q],s=a.renderData[p+q];if(s){var t=e[s];if(void 0===t&&(t=e[s]=this.generateSprite(g,s,f.extend({zoom:a.z,"frame-offset":c},i))),t){var u=a.x[r]-(t.width>>1)+o,v=m-a.y[r]+o;k.drawImage(t,u,v-(t.height>>1))}}}j.end(!0)}},setBlendMode:function(a){this.options.blendmode=a},getActivePointsBBox:function(a,b){for(var c=[],d=new f.Mercator,e=this.options.resolution*(this.TILE_SIZE/this.options.resolution-1),g=a.timeCount[b],h=a.timeIndex[b],i=0;g>i;++i){var j=a.renderDataPos[h+i],k=a.renderData[h+i];if(k){var l=a.x[j],m=e-a.y[j];c.push(d.tilePixelBBox(a.coord.x,a.coord.y,a.coord.z,l,m))}}return c},getValues:function(a,b,c){c=c||[];for(var d=a.timeCount[b],e=a.timeIndex[b],f=0;d>f;++f){a.renderDataPos[e+f];c.push(a.renderData[e+f])}return c},getValueFor:function(a,b,c,d){for(var e=new f.Mercator,g=this.options.resolution,h=g>>1,i=this.options.resolution*(this.TILE_SIZE/this.options.resolution-1),j=a.timeCount[b],k=a.timeIndex[b],l=0;j>l;++l){var m=a.renderDataPos[k+l],n=a.renderData[k+l];if(n){var o=a.x[m],p=i-a.y[m],q=c+h-o,r=d+h-p;if(q>=0&&g>q&&r>=0&&g>r)return{value:n,bbox:e.tilePixelBBox(a.coord.x,a.coord.y,a.coord.z,o-h,p-h,g)}}}return null},_preloadIcons:function(a){var b=this;if(a.length>0&&!this._forcePoints){var c=Object.keys(a.reduce(function(a,c){var d=b._qualifyURL(c);return b._icons[d]||(a[d]=!0),a},{})),d=b._shader.getLayers().some(function(a){return"undefined"!=typeof a.shader["image-filters"]});this._iconsToLoad+=c.length,c.forEach(function(a){b._icons[a]=null;var c=b._createImage();d&&(c.crossOrigin="Anonymous"),b._setImageSrc(c,a,function(e){e?(b._forcePoints=!0,b.clearSpriteCache(),b._iconsToLoad=0,b.fire("allIconsLoaded"),d&&console.info("Only CORS-enabled, or same domain image-files can be used in combination with image-filters"),console.error("Couldn't get marker-file "+a)):(b._icons[a]=c,b._iconsToLoad--,b._iconsToLoad<=0&&(b.clearSpriteCache(),b.fire("allIconsLoaded")))})})}else this.fire("allIconsLoaded")},applyFilters:function(){function a(a){for(var b="",c=0;c<a.args.length;c++){var d=a.args[c].rgb;b+=d[0]+":"+d[1]+":"+d[2]}return b}function b(a){var b=a.toString(16);return 1==b.length?"0"+b:b}function c(a,c,d){return"#"+b(a)+b(c)+b(d)}if(this._style&&this._style["image-filters"]){var d=this._gradients[a(this._style["image-filters"])];if(!d){d={};for(var e=this._style["image-filters"].args,f=1/e.length,g=0;g<e.length;g++){var h=f*g+f,i=e[g].rgb,j=c(i[0],i[1],i[2]);d[h]=j}this._gradients[a(this._style["image-filters"])]=d}this._filters.gradient(d),this._filters.draw()}}}),b.exports=e}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../":91,"../profiler":98,"./cartocss_render":104,"./torque_filters":108,carto:111}],107:[function(a,b,c){(function(c){function d(a,b){this.options=b,e.tree.Reference.set(torque["torque-reference"]),this.setCanvas(a),this.setCartoCSS(this.options.cartocss||f)}var e=c.carto||a("carto"),f=["#layer {","  polygon-fill: #FFFF00;","  [value > 10] { polygon-fill: #FFFF00; }","  [value > 100] { polygon-fill: #FFCC00; }","  [value > 1000] { polygon-fill: #FE9929; }","  [value > 10000] { polygon-fill: #FF6600; }","  [value > 100000] { polygon-fill: #FF3300; }","}"].join("\n");2*Math.PI;d.prototype={setCartoCSS:function(a){if(this._cartoCssStyle=(new e.RendererJS).render(a),this._cartoCssStyle.getLayers().length>1)throw new Error("only one CartoCSS layer is supported");this._shader=this._cartoCssStyle.getLayers()[0].shader},setCanvas:function(a){a&&(this._canvas=a,this._ctx=a.getContext("2d"))},accumulate:function(a,b){var c,d,e,f,g,h,i,j,k=Profiler.metric("RectangleRender:accumulate").start(),l=this.options.resolution,m=256/l,n=new Float32Array(m*m);for("object"!=typeof b&&(b=[b]),g=0;g<b.length;++g)if(h=b[g],i=a.timeCount[h])for(j=a.timeIndex[h],f=0;i>f;++f)e=a.renderDataPos[j+f],c=a.x[e]/l,d=a.y[e]/l,n[c*m+d]+=a.renderData[j+f];return k.end(),n},renderTileAccum:function(a,b,c){var d,e,f,g,h=Profiler.metric("RectangleRender:renderTileAccum").start(),i=this.options.resolution,j=this._ctx,k=256/i|0,l=k*k;this._colors;this.options.blendmode&&(j.globalCompositeOperation=this.options.blendmode);for(var m=this._shader["polygon-opacity"]||function(){return 1},n=0;l>n;++n){var o=n,p=a[n];p&&(e=o/k|0,f=o%k,d=this._shader["polygon-fill"]({value:p},{zoom:0}),j.fillStyle=d,g=m({value:p},{zoom:0}),null===g&&(g=1),j.globalAlpha=g,j.fillRect(e*i,256-i-f*i,i,i))}h.end()},renderTile:function(a,b,c){if(this._canvas){var d=this.options.resolution,e=this._ctx,f=this._colors,g=a.timeCount[b];if(g)for(var h=(this._canvas.width,this._canvas.height,a.timeIndex[b]),i=0;i<activePixels;++i){var j=a.renderDataPos[h+i],k=a.renderData[h+i];if(k){var l=f[Math.min(k,f.length-1)],m=a.x[j],n=a.y[j];e.fillStyle=l,e.fillRect(m,n,d,d)}}return c&&c(null)}}},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{carto:111}],108:[function(a,b,c){"use strict";function d(a,b){return this instanceof d?(b=b||{},this._canvas=a="string"==typeof a?document.getElementById(a):a,this._ctx=a.getContext("2d"),this._width=a.width,this._height=a.height,this._max=1,this._data=[],void(this.canvasClass=b.canvasClass)):new d(a,b)}d.prototype={defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},gradient:function(a){var b=this._createCanvas(),c=b.getContext("2d"),d=c.createLinearGradient(0,0,0,256);b.width=1,b.height=256;for(var e in a)d.addColorStop(+e,a[e]);return c.fillStyle=d,c.fillRect(0,0,1,256),this._grad=c.getImageData(0,0,1,256).data,this},draw:function(){this._grad||this.gradient(this.defaultGradient);var a=this._ctx,b=a.getImageData(0,0,this._canvas.width,this._canvas.height);return this._colorize(b.data,this._grad),a.putImageData(b,0,0),this},_colorize:function(a,b){for(var c,d=3,e=a.length;e>d;d+=4)c=4*a[d],c&&(a[d-3]=b[c],a[d-2]=b[c+1],a[d-1]=b[c+2])},_createCanvas:function(){return this.canvasClass?new this.canvasClass:document.createElement("canvas")}},b.exports=d},{}],109:[function(a,b,c){(function(c){function d(a,b,c){function d(){e.removeChild(f),clearTimeout(i),delete window[h]}c=c||{},c.timeout=void 0===c.timeout?1e4:c.timeout;var e=document.getElementsByTagName("head")[0],f=document.createElement("script"),h=c.callbackName||"torque_"+Date.now();g.isFunction(h)&&(h=h()),window[h]=function(){d(),b.apply(window,arguments)};var i=setTimeout(function(){d(),b.call(window,null)},c.timeout);a=a.replace("callback=?","callback="+h),f.type="text/javascript",f.src=a,f.async=!0,setTimeout(function(){e.appendChild(f)},0)}function e(a,b,d){function e(){var a=g.status,c="arraybuffer"===d.responseType?g.response:g.responseText;b(!a&&c||a>=200&&300>a||304===a?g:null)}d=d||{method:"GET",data:null,responseType:"text"},h={url:a,callback:b};var f=XMLHttpRequest;!c.XDomainRequest||"withCredentials"in f||!/^(http(s)?:)?\/\//.test(a)||(f=XDomainRequest);var g=new f;return g.open(d.method,a,!0),"onload"in g?g.onload=g.onerror=e:g.onreadystatechange=function(){g.readyState>3&&e()},g.onprogress=function(){},g.responseType=d.responseType,d.data&&(g.setRequestHeader("Content-type","application/json"),g.setRequestHeader("Accept","*")),g.send(d.data),g}function f(a,b,c){return e(a,c,{data:b,method:"POST"})}var g=a("./core"),h=null;b.exports={get:e,post:f,jsonp:d,lastCall:function(){return h}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./core":85}],110:[function(a,b,c){arguments[4][2][0].apply(c,arguments)},{"./tree":116,dup:2}],111:[function(a,b,c){(function(b,d){function e(){if(b.browser)return a("../../package.json").version.split(".");if(parseInt(b.version.split(".")[1],10)>4)return a("../../package.json").version.split(".");var c=JSON.parse(h.readFileSync(i.join(d,"../../package.json")));return c.version.split(".")}function f(a,b){var c={bold:[1,22],inverse:[7,27],underline:[4,24],yellow:[33,39],green:[32,39],red:[31,39],grey:[90,39]};return"["+c[b][0]+"m"+a+"["+c[b][1]+"m"}var g=a("util"),h=a("fs"),i=a("path"),j={version:e(),Parser:a("./parser").Parser,Renderer:a("./renderer").Renderer,tree:a("./tree"),RendererJS:a("./renderer_js"),default_reference:a("./torque-reference"),writeError:function(a,b){var c="",d=a.extract,e=[];if(b=b||{},!b.silent){if(b.indent=b.indent||"",!("index"in a&&d))return g.error(b.indent+(a.stack||a.message));"string"==typeof d[0]&&e.push(f(a.line-1+" "+d[0],"grey")),""===d[1]&&"undefined"==typeof d[2]&&(d[1]="¶"),e.push(a.line+" "+d[1].slice(0,a.column)+f(f(d[1][a.column],"bold")+d[1].slice(a.column+1),"yellow")),"string"==typeof d[2]&&e.push(f(a.line+1+" "+d[2],"grey")),e=b.indent+e.join("\n"+b.indent)+"[0m\n",c=b.indent+c+f(a.message,"red"),a.filename&&(c+=f(" in ","red")+a.filename),g.error(c,e),a.callLine&&(g.error(f("from ","red")+(a.filename||"")),g.error(f(a.callLine,"grey")+" "+a.callExtract)),a.stack&&g.error(f(a.stack,"red"))}}};a("./tree/call"),a("./tree/color"),a("./tree/comment"),a("./tree/definition"),a("./tree/dimension"),a("./tree/element"),a("./tree/expression"),a("./tree/filterset"),a("./tree/filter"),a("./tree/field"),a("./tree/keyword"),a("./tree/layer"),a("./tree/literal"),a("./tree/operation"),a("./tree/quoted"),a("./tree/imagefilter"),a("./tree/reference"),a("./tree/rule"),a("./tree/ruleset"),a("./tree/selector"),a("./tree/style"),a("./tree/url"),a("./tree/value"),a("./tree/variable"),a("./tree/zoom"),a("./tree/invalid"),a("./tree/fontset"),a("./tree/frame_offset"),a("./functions");for(var k in j)c[k]=j[k]}).call(this,a("_process"),"/../cartodb.js/node_modules/torque.js/node_modules/carto/lib/carto")},{"../../package.json":147,"./functions":110,"./parser":112,"./renderer":113,"./renderer_js":114,"./torque-reference":115,"./tree":116,"./tree/call":117,"./tree/color":118,"./tree/comment":119,"./tree/definition":120,"./tree/dimension":121,"./tree/element":122,"./tree/expression":123,"./tree/field":124,"./tree/filter":125,"./tree/filterset":126,"./tree/fontset":127,"./tree/frame_offset":128,"./tree/imagefilter":129,"./tree/invalid":130,"./tree/keyword":131,"./tree/layer":132,"./tree/literal":133,"./tree/operation":134,"./tree/quoted":135,"./tree/reference":136,"./tree/rule":137,"./tree/ruleset":138,"./tree/selector":139,"./tree/style":140,"./tree/url":141,"./tree/value":142,"./tree/variable":143,"./tree/zoom":144,_process:327,fs:323,path:326,util:329}],112:[function(a,b,c){(function(b){var d=c,e=a("./tree"),f=b._||a("underscore");d.Parser=function(a){function b(){n=q[m],o=l,r=l}function c(){q[m]=n,l=o,r=l}function d(){l>r&&(q[m]=q[m].slice(l-r),r=l)}function g(a){var b,c,e,f;if(a instanceof Function)return a.call(s.parsers);if("string"==typeof a)b=k.charAt(l)===a?a:null,c=1,d();else{if(d(),b=a.exec(q[m]),!b)return null;c=b[0].length}if(b){var g=l+=c;for(f=l+q[m].length-c;f>l&&(e=k.charCodeAt(l),32===e||10===e||9===e);)l++;return q[m]=q[m].slice(c+(l-g)),r=l,0===q[m].length&&m<q.length-1&&m++,"string"==typeof b?b:1===b.length?b[0]:b}}function h(a){return"string"==typeof a?k.charAt(l)===a:!!a.test(q[m])}function i(a,b){return(a.slice(0,b).match(/\n/g)||"").length+1}function j(b){var c;f(b).defaults({index:p,filename:a.filename,message:"Parse error.",line:0,column:-1}),c=b.filename&&t.env.inputs&&t.env.inputs[b.filename]?t.env.inputs[b.filename]:k,b.line=i(c,b.index);for(var d=b.index;d>=0&&"\n"!==c.charAt(d);d--)b.column++;return new Error(f("<%=filename%>:<%=line%>:<%=column%> <%=message%>").template(b))}var k,l,m,n,o,p,q,r,s,t=this;return this.env=a=a||{},this.env.filename=this.env.filename||null,this.env.inputs=this.env.inputs||{},s={extractErrorLine:i,parse:function(b){var c,d=null;l=m=r=p=0,q=[],k=b.replace(/\r\n/g,"\n"),a.filename&&(t.env.inputs[a.filename]=k);if(q=function(a){for(var b,c,e,f,g=0,h=/(?:@\{[\w-]+\}|[^"'`\{\}\/\(\)\\])+/g,i=/\/\*(?:[^*]|\*+[^\/*])*\*+\/|\/\/.*/g,j=/"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'|`((?:[^`]|\\.)*)`/g,l=0,m=a[0],n=0;n<k.length;)if(h.lastIndex=n,(b=h.exec(k))&&b.index===n&&(n+=b[0].length,m.push(b[0])),e=k.charAt(n),i.lastIndex=j.lastIndex=n,(b=j.exec(k))&&b.index===n)n+=b[0].length,m.push(b[0]);else if(c||"/"!==e||(f=k.charAt(n+1),"/"!==f&&"*"!==f||!(b=i.exec(k))||b.index!==n)){switch(e){case"{":if(!c){l++,m.push(e);break}case"}":if(!c){l--,m.push(e),a[++g]=m=[];break}case"(":if(!c){c=!0,m.push(e);break}case")":if(c){c=!1,m.push(e);break}default:m.push(e)}n++}else n+=b[0].length,m.push(b[0]);return 0!==l&&(d={index:n-1,type:"Parse",message:l>0?"missing closing `}`":"missing opening `{`"}),a.map(function(a){return a.join("")})}([[]]),d)throw j(d);c=new e.Ruleset([],g(this.parsers.primary)),c.root=!0,c.toList=function(){return function(a){a.error=function(b){a.errors||(a.errors=new Error("")),a.errors.message?a.errors.message+="\n"+j(b).message:a.errors.message=j(b).message},a.frames=a.frames||[];var b=this.flatten([],[],a);return b.sort(f),b}}();var f=function(a,b){var c=a.specificity,d=b.specificity;return c[0]!=d[0]?d[0]-c[0]:c[1]!=d[1]?d[1]-c[1]:c[2]!=d[2]?d[2]-c[2]:d[3]-c[3]};return c},parsers:{primary:function(){for(var a,b=[];(a=g(this.rule)||g(this.ruleset)||g(this.comment))||g(/^[\s\n]+/)||(a=g(this.invalid));)a&&b.push(a);return b},invalid:function(){var a=g(/^[^;\n]*[;\n]/);return a?new e.Invalid(a,o):void 0},comment:function(){var a;if("/"===k.charAt(l))return"/"===k.charAt(l+1)?new e.Comment(g(/^\/\/.*/),!0):(a=g(/^\/\*(?:[^*]|\*+[^\/*])*\*+\/\n?/))?new e.Comment(a):void 0},entities:{quoted:function(){if('"'===k.charAt(l)||"'"===k.charAt(l)){var a=g(/^"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'/);return a?new e.Quoted(a[1]||a[2]):void 0}},field:function(){if(g("[")){var a=g(/(^[^\]]+)/);if(g("]"))return a?new e.Field(a[1]):void 0}},comparison:function(){var a=g(/^=~|=|!=|<=|>=|<|>/);return a?a:void 0},keyword:function(){var a=g(/^[A-Za-z-]+[A-Za-z-0-9_]*/);return a?new e.Keyword(a):void 0},call:function(){var a,b;if(a=/^([\w\-]+|%)\(/.exec(q[m])){if(a=a[1],"url"===a)return null;if(l+=a.length,g("("),b=g(this.entities.arguments),g(")"))return a?new e.Call(a,b,l):void 0}},arguments:function(){for(var a,b=[];(a=g(this.expression))&&(b.push(a),g(",")););return b},literal:function(){return g(this.entities.dimension)||g(this.entities.keywordcolor)||g(this.entities.hexcolor)||g(this.entities.quoted)},url:function(){var a;if("u"===k.charAt(l)&&g(/^url\(/))return a=g(this.entities.quoted)||g(this.entities.variable)||g(/^[\-\w%@$\/.&=:;#+?~]+/)||"",g(")")?new e.URL("undefined"!=typeof a.value||a instanceof e.Variable?a:new e.Quoted(a)):new e.Invalid(a,o,"Missing closing ) in URL.")},variable:function(){var b,c=l;return"@"===k.charAt(l)&&(b=g(/^@[\w-]+/))?new e.Variable(b,c,a.filename):void 0},hexcolor:function(){var a;return"#"===k.charAt(l)&&(a=g(/^#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})/))?new e.Color(a[1]):void 0},keywordcolor:function(){var a=q[m].match(/^[a-z]+/);return a&&a[0]in e.Reference.data.colors?new e.Color(e.Reference.data.colors[g(/^[a-z]+/)]):void 0},dimension:function(){var a=k.charCodeAt(l);if(!(a>57||45>a||47===a)){var b=g(/^(-?\d*\.?\d+(?:[eE][-+]?\d+)?)(\%|\w+)?/);return b?new e.Dimension(b[1],b[2],o):void 0}}},variable:function(){var a;return"@"===k.charAt(l)&&(a=g(/^(@[\w-]+)\s*:/))?a[1]:void 0},entity:function(){return g(this.entities.call)||g(this.entities.literal)||g(this.entities.field)||g(this.entities.variable)||g(this.entities.url)||g(this.entities.keyword)},end:function(){return g(";")||h("}")},element:function(){var a=g(/^(?:[.#][\w\-]+|\*|Map)/);return a?new e.Element(a):void 0},attachment:function(){var a=g(/^::([\w\-]+(?:\/[\w\-]+)*)/);return a?a[1]:void 0},selector:function(){var a,b,c,d,f,h=[],i=new e.Filterset,m=[],n=e.FrameOffset.none;for(segments=0,conditions=0;(c=g(this.element))||(f=g(this.zoom))||(fo=g(this.frame_offset))||(d=g(this.filter))||(a=g(this.attachment));){if(segments++,c)h.push(c);else if(f)m.push(f),conditions++;else if(fo)n=fo,conditions++;else if(d){var p=i.add(d);if(p)throw j({message:p,index:l-1});conditions++}else{if(b)throw j({message:"Encountered second attachment name.",index:l-1});b=a}var q=k.charAt(l);if("{"===q||"}"===q||";"===q||","===q)break}return segments?new e.Selector(i,m,n,h,b,conditions,o):void 0},filter:function(){b();var c,d,f;if(g("[")&&(c=g(/^[a-zA-Z0-9\-_]+/)||g(this.entities.quoted)||g(this.entities.variable)||g(this.entities.keyword)||g(this.entities.field))&&(c instanceof e.Quoted&&(c=new e.Field(c.toString())),(d=g(this.entities.comparison))&&(f=g(this.entities.quoted)||g(this.entities.variable)||g(this.entities.dimension)||g(this.entities.keyword)||g(this.entities.field)))){if(!g("]"))throw j({message:"Missing closing ] of filter.",index:o-1});return c.is||(c=new e.Field(c)),new e.Filter(c,d,f,o,a.filename)}},frame_offset:function(){b();var a,c;return g(/^\[\s*frame-offset/g)&&(a=g(this.entities.comparison))&&(c=g(/^\d+/))&&g("]")?e.FrameOffset(a,c,o):void 0},zoom:function(){b();var a,d;return g(/^\[\s*zoom/g)&&(a=g(this.entities.comparison))&&(d=g(this.entities.variable)||g(this.entities.dimension))&&g("]")?new e.Zoom(a,d,o):void c()},block:function(){var a;return g("{")&&(a=g(this.primary))&&g("}")?a:void 0},ruleset:function(){var a,d,f=[];for(b();a=g(this.selector);){for(f.push(a);g(this.comment););if(!g(","))break;for(;g(this.comment););}if(a)for(;g(this.comment););if(f.length>0&&(d=g(this.block))){if(1===f.length&&f[0].elements.length&&"Map"===f[0].elements[0].value){var h=new e.Ruleset(f,d);return h.isMap=!0,h}return new e.Ruleset(f,d)}c()},rule:function(){var d,f,h=k.charAt(l);if(b(),"."!==h&&"#"!==h&&(d=g(this.variable)||g(this.property))){if(f=g(this.value),f&&g(this.end))return new e.Rule(d,f,o,a.filename);p=l,c()}},font:function(){for(var a,b=[],c=[];a=g(this.entity);)c.push(a);if(b.push(new e.Expression(c)),g(","))for(;(a=g(this.expression))&&(b.push(a),g(",")););return new e.Value(b)},value:function(){for(var a,b=[];(a=g(this.expression))&&(b.push(a),g(",")););return b.length>1?new e.Value(b.map(function(a){return a.value[0]})):1===b.length?new e.Value(b):void 0},sub:function(){var a;return g("(")&&(a=g(this.expression))&&g(")")?a:void 0},multiplication:function(){var a,b,c,d;if(a=g(this.operand)){for(;(c=g("/")||g("*")||g("%"))&&(b=g(this.operand));)d=new e.Operation(c,[d||a,b],o);return d||a}},addition:function(){var a,b,c,d;if(a=g(this.multiplication)){for(;(c=g(/^[-+]\s+/)||" "!=k.charAt(l-1)&&(g("+")||g("-")))&&(b=g(this.multiplication));)d=new e.Operation(c,[d||a,b],o);return d||a}},operand:function(){return g(this.sub)||g(this.entity)},expression:function(){for(var a,b=[];a=g(this.addition)||g(this.entity);)b.push(a);return b.length>0?new e.Expression(b):void 0},property:function(){var a=g(/^(([a-z][-a-z_0-9]*\/)?\*?-?[-a-z_0-9]+)\s*:/);return a?a[1]:void 0}}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./tree":116,underscore:146}],113:[function(a,b,c){(function(c){function d(a,b,c,d){for(var e,f,g,h=b.filters,i=b.rules,j=0;j<a.length;j++)e=a[j].filters.cloneWith(h),e?(g=c[e],g?g.addRules(i):(f=a[j].clone(e),f.addRules(i)&&(c[e]=f,a.splice(j,0,f),j++))):null===e&&(a[j]=a[j].clone(),a[j].addRules(i));return a}function e(a,b){var c,e,f=+new Date,g={},h={},i=[];a.forEach(function(a){a.filters.ev(b)});for(var j=0;j<a.length;j++){e=a[j].attachment,c=[a[j]],g[e]||(g[e]=[],g[e].attachment=e,h[e]={},i.push(g[e]));for(var k=j+1;k<a.length;k++)a[k].attachment===e&&(c=d(c,a[k],h[e],b));for(var l=0;l<c.length;l++)h[e][c[l].filters]=c[l],g[e].push(c[l])}return b.benchmark&&console.warn("Inheritance time: "+(new Date-f)+"ms"),i}function f(a,b){return b.index-a.index}function g(a,b){for(var c=0;c<a.length;c++){var d=a[c];d.index=1/0;for(var e=0;e<d.length;e++)for(var g=d[e].rules,h=0;h<g.length;h++){var i=g[h];i.index<d.index&&(d.index=i.index)}}var j=a.slice();return j.sort(f),j}function h(a,b,c){var d={},e=j.tree.Reference.data.symbolizers.map;return i(a).each(function(a,b){b in e&&(d[b]=b+'="'+a+'"')}),b.filter(function(a){return"Map"===a.elements.join("")}).forEach(function(a){for(var b=0;b<a.rules.length;b++){var f=a.rules[b].name;f in e||c.error({message:"Rule "+f+" not allowed for Map.",index:a.rules[b].index}),d[f]=a.rules[b].ev(c).toXML(c)}}),d}var i=c._||a("underscore"),j=a("./index");j.Renderer=function(a,b){this.env=a||{},this.options=b||{},this.options.mapnik_version=this.options.mapnik_version||"3.0.0"},j.Renderer.prototype.renderMSS=function(a){var b=i(this.env).defaults({benchmark:!1,validation_data:!1,effects:[]});if(!j.tree.Reference.setVersion(this.options.mapnik_version))throw new Error("Could not set mapnik version to "+this.options.mapnik_version);var c=[],d=[];b.benchmark&&console.time("Parsing MSS");var f=j.Parser(b).parse(a);b.benchmark&&console.timeEnd("Parsing MSS"),b.benchmark&&console.time("Rule generation");var h=f.toList(b);b.benchmark&&console.timeEnd("Rule generation"),b.benchmark&&console.time("Rule inheritance");var k=e(h,b);b.benchmark&&console.timeEnd("Rule inheritance"),b.benchmark&&console.time("Style sort");var l=g(k,b);b.benchmark&&console.timeEnd("Style sort"),b.benchmark&&console.time("Total Style generation");for(var m,n,o=0;o<l.length;o++){m=l[o],n="style"+("__default__"!==m.attachment?"-"+m.attachment:""),d.push(n);var p='	Style "'+n+'" (#'+o+") toXML";b.benchmark&&console.time(p),c.push(j.tree.StyleXML(n,m.attachment,m,b)),b.benchmark&&console.timeEnd(p)}if(b.benchmark&&console.timeEnd("Total Style generation"),b.errors)throw b.errors;return c.join("\n")},j.Renderer.prototype.render=function(a){function b(a,b){return function(a){return a.appliesTo(f.name,b)}}var c=i(this.env).defaults({benchmark:!1,validation_data:!1,effects:[],ppi:90.714});if(!j.tree.Reference.setVersion(this.options.mapnik_version))throw new Error("Could not set mapnik version to "+this.options.mapnik_version);for(var d,f,k,l,m,n,o=[],p=i(a.Stylesheet).chain().map(function(a){if("string"==typeof a)throw new Error("Stylesheet object is expected not a string: '"+a+"'");c=i(c).extend({filename:a.id});var b=+new Date,d=j.Parser(c).parse(a.data);return c.benchmark&&console.warn("Parsing time: "+(new Date-b)+"ms"),d.toList(c)}).flatten().value(),q=0;q<a.Layer.length;q++){f=a.Layer[q],d=[],k={},c.benchmark&&console.warn("processing layer: "+f.id);for(var r=(f["class"]||"").split(/\s+/g),s=0;s<r.length;s++)k[r[s]]=!0;n=p.filter(b(f.name,k)),l=e(n,c),m=g(l,c);for(var t,u,v=0;v<m.length;v++){t=m[v],u=f.name+("__default__"!==t.attachment?"-"+t.attachment:"");var w=j.tree.StyleXML(u,t.attachment,t,c);w&&(o.push(w),d.push(u))}o.push(j.tree.LayerXML(f,d))}o.unshift(c.effects.map(function(a){return a.toXML(c)}).join("\n"));var x=h(a,p,c);if(c.errors)throw c.errors;var y=i(a).reduce(function(a,b,c){if(!b&&0!==b)return a;switch(c){case"srs":case"Layer":case"Stylesheet":break;case"bounds":case"center":case"minzoom":case"maxzoom":case"version":a.push('  <Parameter name="'+c+'">'+b+"</Parameter>");break;case"name":case"description":case"legend":case"attribution":case"template":a.push('  <Parameter name="'+c+'"><![CDATA['+b+"]]></Parameter>");break;case"format":a.push('  <Parameter name="'+c+'">'+b+"</Parameter>");break;case"interactivity":a.push('  <Parameter name="interactivity_layer">'+b.layer+"</Parameter>"),a.push('  <Parameter name="interactivity_fields">'+b.fields+"</Parameter>");break;default:"string"==typeof b?a.push('  <Parameter name="'+c+'"><![CDATA['+b+"]]></Parameter>"):"number"==typeof b?a.push('  <Parameter name="'+c+'">'+b+"</Parameter>"):"boolean"==typeof b&&a.push('  <Parameter name="'+c+'">'+b+"</Parameter>")}return a},[]);y.length&&o.unshift("<Parameters>\n"+y.join("\n")+"\n</Parameters>\n");var z=i(x).map(function(a){return" "+a}).join("");return o.unshift('<?xml version="1.0" encoding="utf-8"?>\n<!DOCTYPE Map[]>\n<Map'+z+">\n"),o.push("</Map>"),o.join("\n")},b.exports=j,b.exports.addRules=d,b.exports.inheritDefinitions=e,b.exports.sortStyles=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./index":111,underscore:146}],114:[function(require,module,exports){(function(global){!function(carto){function CartoCSS(a,b){this.options=b||{},this.imageURLs=[],a&&this.setStyle(a)}var tree=require("./tree"),_=global._||require("underscore");CartoCSS.Layer=function(a,b){this.options=b,this.shader=a},CartoCSS.Layer.prototype={fullName:function(){return this.shader.attachment},name:function(){return this.fullName().split("::")[0]},frames:function(){return this.shader.frames},attachment:function(){return this.fullName().split("::")[1]},eval:function(a){var b=this.shader[a];if(b&&b.style)return b.style({},{zoom:0,"frame-offset":0})},getStyle:function(a,b){var c={};for(var d in this.shader)"attachment"!==d&&"zoom"!==d&&"frames"!==d&&"symbolizers"!==d&&(c[d]=this.shader[d].style(a,b));return c},getSymbolizers:function(){return this.shader.symbolizers},isVariable:function(){for(var a in this.shader)if("attachment"!==a&&"zoom"!==a&&"frames"!==a&&"symbolizers"!==a&&!this.shader[a].constant)return!0;return!1},getShader:function(){return this.shader},filter:function(a,b,c){for(var d in this.shader){var e=this.shader[d](b,c);if(e)return!0}return!1},transformGeometry:function(a){return a},transformGeometries:function(a){return a}},CartoCSS.prototype={setStyle:function(a){var b=this.parse(a);if(!b)throw new Error(this.parse_env.errors);this.layers=b.map(function(a){return new CartoCSS.Layer(a)})},getLayers:function(){return this.layers},getDefault:function(){return this.findLayer({attachment:"__default__"})},findLayer:function(a){return _.find(this.layers,function(b){for(var c in a){var d=b[c];if("function"==typeof d&&(d=d.call(b)),a[c]!==d)return!1}return!0})},_createFn:function(a){var b=a.join("\n");return this.options.debug&&console.log(b),Function("data","ctx","var _value = null; "+b+"; return _value; ")},_compile:function(shader){"string"==typeof shader&&(shader=eval("(function() { return "+shader+"; })()")),this.shader_src=shader;for(var attr in shader){var c=mapper[attr];c&&(this.compiled[c]=eval("(function() { return shader[attr]; })();"))}},getImageURLs:function(){return this.imageURLs},parse:function(a){function b(a){return a.elements[0]+"::"+a.attachment}var c={frames:[],errors:[],error:function(a){this.errors.push(a)}};this.parse_env=c;var d=null;
try{d=new carto.Parser(c).parse(a)}catch(e){return void c.errors.push(e.message)}if(d){var f=d.toList(c);f.reverse();for(var g={},h=0;h<f.length;++h){for(var i=f[h],j=b(i),k=g[j]=g[j]||{symbolizers:[]},l=0;l<i.rules.length;l++)if("marker-file"===i.rules[l].name||"point-file"===i.rules[l].name){var m=i.rules[l].value.value[0].value[0].value.value;this.imageURLs.push(m)}k.frames=[],k.zoom=tree.Zoom.all;var n=i.toJS(c);this.options.debug&&console.log("props",n);for(var o in n){var p=k[o]=k[o]||{constant:!1,symbolizer:null,js:[],index:0};p.js.push(n[o].map(function(a){return a.js}).join("\n")),p.symbolizer=_.first(n[o].map(function(a){return a.symbolizer})),p.index=_.max(n[o].map(function(a){return a.index}).concat(p.index)),p.constant=!_.any(n[o].map(function(a){return!a.constant}))}}var q=[];this.options.debug&&console.log(g);for(var r={},h=0;h<f.length;++h){var i=f[h],s=b(i),k=g[s];if(!r[s]){this.options.debug&&console.log("**",s);for(var t in k)"zoom"!==t&&"frames"!==t&&"symbolizers"!==t&&(this.options.debug&&console.log("*",t),k[t].style=this._createFn(k[t].js),k.symbolizers.push(k[t].symbolizer),k.symbolizers=_.uniq(k.symbolizers));k.attachment=s,q.push(k),r[s]=!0}k.zoom|=i.zoom,k.frames.push(i.frame_offset)}for(h=0;h<q.length;++h)q[h].frames=_.uniq(q[h].frames);return q}return null}},carto.RendererJS=function(a){this.options=a||{},this.options.mapnik_version=this.options.mapnik_version||"latest"},carto.RendererJS.prototype.render=function(a,b){var c=require("./torque-reference");return tree.Reference.setData(c.version.latest),new CartoCSS(a,this.options)},"undefined"!=typeof module&&(module.exports=carto.RendererJS)}(require("../carto"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../carto":111,"./torque-reference":115,"./tree":116,underscore:146}],115:[function(a,b,c){arguments[4][7][0].apply(c,arguments)},{dup:7}],116:[function(a,b,c){arguments[4][8][0].apply(c,arguments)},{dup:8}],117:[function(a,b,c){(function(b){!function(c){var d=b._||a("underscore");c.Call=function(a,b,c){this.name=a,this.args=b,this.index=c},c.Call.prototype={is:"call",ev:function(a){for(var b=this.args.map(function(b){return b.ev(a)}),e=0;e<b.length;e++)if("undefined"===b[e].is)return{is:"undefined",value:"undefined"};if(this.name in c.functions){if(c.functions[this.name].length<=b.length){var f=c.functions[this.name].apply(c.functions,b);return null===f?(a.error({message:"incorrect arguments given to "+this.name+"()",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}):f}return a.error({message:"incorrect number of arguments for "+this.name+"(). "+c.functions[this.name].length+" expected.",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}}var g=c.Reference.mapnikFunctions[this.name];if(void 0===g){var h=d.pairs(c.Reference.mapnikFunctions),i=this.name,j=h.map(function(a){return[a[0],c.Reference.editDistance(i,a[0]),a[1]]}).sort(function(a,b){return a[1]-b[1]});return a.error({message:"unknown function "+this.name+"(), did you mean "+j[0][0]+"("+j[0][2]+")",index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"}}return g===b.length||Array.isArray(g)&&d.include(g,b.length)||-1===g?(this.args=b,this):(a.error({message:"function "+this.name+"() takes "+g+" arguments and was given "+b.length,index:this.index,type:"runtime",filename:this.filename}),{is:"undefined",value:"undefined"})},toString:function(a,b){return this.args.length?this.name+"("+this.args.join(",")+")":this.name}}}(a("../tree"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":116,underscore:146}],118:[function(a,b,c){arguments[4][10][0].apply(c,arguments)},{"../tree":116,dup:10}],119:[function(a,b,c){arguments[4][11][0].apply(c,arguments)},{"../tree":116,dup:11}],120:[function(a,b,c){(function(b){!function(c){function d(a){function b(a){return a[1].toUpperCase()}return a.charAt(0).toUpperCase()+a.slice(1).replace(/\-./,b)+"Symbolizer"}function e(a){return a.sort(function(a,b){return a[1]-b[1]}).map(function(a){return a[0]})}var f=a("assert"),g=b._||a("underscore");c.Definition=function(a,b){this.elements=a.elements,f.ok(a.filters instanceof c.Filterset),this.rules=b,this.ruleIndex={};for(var d=0;d<this.rules.length;d++)"zoom"in this.rules[d]&&(this.rules[d]=this.rules[d].clone()),this.rules[d].zoom=a.zoom,this.ruleIndex[this.rules[d].updateID()]=!0;this.filters=a.filters,this.zoom=a.zoom,this.frame_offset=a.frame_offset,this.attachment=a.attachment||"__default__",this.specificity=a.specificity()},c.Definition.prototype.toString=function(){for(var a=this.filters.toString(),b=0;b<this.rules.length;b++)a+="\n    "+this.rules[b];return a},c.Definition.prototype.clone=function(a){a&&f.ok(a instanceof c.Filterset);var b=Object.create(c.Definition.prototype);return b.rules=this.rules.slice(),b.ruleIndex=g.clone(this.ruleIndex),b.filters=a?a:this.filters.clone(),b.attachment=this.attachment,b},c.Definition.prototype.addRules=function(a){for(var b=0,c=0;c<a.length;c++)this.ruleIndex[a[c].id]||(this.rules.push(a[c]),this.ruleIndex[a[c].id]=!0,b++);return b},c.Definition.prototype.appliesTo=function(a,b){for(var c=0,d=this.elements.length;d>c;c++){var e=this.elements[c];if(!(e.wildcard||"class"===e.type&&b[e.clean]||"id"===e.type&&a===e.clean))return!1}return!0},c.Definition.prototype.symbolizersToXML=function(a,b,f){var g=f.toXML(a).join("")+this.filters.toXML(a),h=[],i=[];for(var j in b){i=[];for(var k in b[j])i.push(b[j][k].index);var l=Math.min.apply(Math,i);h.push([j,l])}h=e(h);for(var m=0,n=0;n<h.length;n++){var o=b[h[n]],p=h[n].split("/").pop();if("*"!==p){m++;var q=c.Reference.requiredProperties(p,o);if(q){var r=o[Object.keys(o).shift()];a.error({message:q,index:r.index,filename:r.filename})}var s,t=d(p),u=!0;g+="    <"+t+" ";for(var v in o){"map"===p&&a.error({message:"Map properties are not permitted in other rules",index:o[v].index,filename:o[v].filename});var w=c.Reference.selector(o[v].name);w&&w.serialization&&"content"===w.serialization?(u=!1,s=o[v].ev(a).toXML(a,!0)):w&&w.serialization&&"tag"===w.serialization?(u=!1,s=o[v].ev(a).toXML(a,!0)):g+=o[v].ev(a).toXML(a)+" "}u?g+="/>\n":"undefined"!=typeof s&&(g+=-1!=s.indexOf("<")?">"+s+"</"+t+">\n":"><![CDATA["+s+"]]></"+t+">\n")}}return m&&g?"  <Rule>\n"+g+"  </Rule>\n":""},c.Definition.prototype.collectSymbolizers=function(a,b){for(var c,d={},e=b;e<this.rules.length;e++){c=this.rules[e];var f=c.instance+"/"+c.symbolizer;!(a.current&c.zoom)||f in d&&c.name in d[f]||(a.current&=c.zoom,f in d||(d[f]={}),d[f][c.name]=c)}return Object.keys(d).length?(a.rule&=a.available&=~a.current,d):void 0},c.Definition.prototype.toXML=function(a,b){var d=this.filters.toString();d in b||(b[d]=c.Zoom.all);for(var e,f=c.Zoom.all,g="",h={available:c.Zoom.all},i=0;i<this.rules.length&&f;i++)if(h.rule=this.rules[i].zoom,b[d]&h.rule)for(;h.current=h.rule&f;)if(e=this.collectSymbolizers(h,i)){if(!(b[d]&h.current))continue;g+=this.symbolizersToXML(a,e,(new c.Zoom).setZoom(b[d]&h.current)),b[d]&=~h.current}return g},c.Definition.prototype.toJS=function(a){var b={},d="("+this.zoom+" & (1 << ctx.zoom))",e=this.frame_offset,f=this.filters.toJS(a),h=[d];return f&&h.push(f),e&&h.push('ctx["frame-offset"] === '+e),f=h.join(" && "),g.each(this.rules,function(d){if(!(d instanceof c.Rule))throw new Error("Ruleset not supported");b[d.name]=b[d.name]||[];var e={index:d.index,symbolizer:d.symbolizer};f?e.js="if("+f+"){"+d.value.toJS(a)+"}":e.js=d.value.toJS(a),e.constant="field"!==d.value.ev(a).is,e.filtered=!!f,b[d.name].push(e)}),b}}(a("../tree"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":116,assert:324,underscore:146}],121:[function(a,b,c){(function(b){!function(c){var d=b._||a("underscore");c.Dimension=function(a,b,c){this.value=parseFloat(a),this.unit=b||null,this.index=c},c.Dimension.prototype={is:"float",physical_units:["m","cm","in","mm","pt","pc"],screen_units:["px","%"],all_units:["m","cm","in","mm","pt","pc","px","%"],densities:{m:.0254,mm:25.4,cm:2.54,pt:72,pc:6},ev:function(a){if(this.unit&&!d.contains(this.all_units,this.unit))return a.error({message:"Invalid unit: '"+this.unit+"'",index:this.index}),{is:"undefined",value:"undefined"};if(this.unit&&d.contains(this.physical_units,this.unit)){if(!a.ppi)return a.error({message:"ppi is not set, so metric units can't be used",index:this.index}),{is:"undefined",value:"undefined"};this.value=this.value/this.densities[this.unit]*a.ppi,this.unit="px"}return this},round:function(){return this.value=Math.round(this.value),this},toColor:function(){return new c.Color([this.value,this.value,this.value])},round:function(){return this.value=Math.round(this.value),this},toString:function(){return this.value.toString()},operate:function(a,b,d){return"%"===this.unit&&"%"!==d.unit?(a.error({message:"If two operands differ, the first must not be %",index:this.index}),{is:"undefined",value:"undefined"}):"%"!==this.unit&&"%"===d.unit?"*"===b||"/"===b||"%"===b?(a.error({message:"Percent values can only be added or subtracted from other values",index:this.index}),{is:"undefined",value:"undefined"}):new c.Dimension(c.operate(b,this.value,this.value*d.value*.01),this.unit):new c.Dimension(c.operate(b,this.value,d.value),this.unit||d.unit)}}}(a("../tree"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":116,underscore:146}],122:[function(a,b,c){arguments[4][14][0].apply(c,arguments)},{"../tree":116,dup:14}],123:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{"../tree":116,dup:15}],124:[function(a,b,c){arguments[4][16][0].apply(c,arguments)},{"../tree":116,dup:16}],125:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{"../tree":116,dup:17}],126:[function(a,b,c){(function(b){var c=a("../tree"),d=b._||a("underscore");c.Filterset=function(){this.filters={}},c.Filterset.prototype.toXML=function(a){var b=[];for(var c in this.filters)b.push("("+this.filters[c].toXML(a).trim()+")");return b.length?"    <Filter>"+b.join(" and ")+"</Filter>\n":""},c.Filterset.prototype.toString=function(){var a=[];for(var b in this.filters)a.push(this.filters[b].id);return a.sort().join("	")},c.Filterset.prototype.ev=function(a){for(var b in this.filters)this.filters[b].ev(a);return this},c.Filterset.prototype.clone=function(){var a=new c.Filterset;for(var b in this.filters)a.filters[b]=this.filters[b];return a},c.Filterset.prototype.cloneWith=function(a){var b=[];for(var d in a.filters){var e=this.addable(a.filters[d]);if(e===!1)return!1;e===!0&&b.push(a.filters[d])}if(!b.length)return null;var f=new c.Filterset;for(d in this.filters)f.filters[d]=this.filters[d];for(;d=b.shift();)f.add(d);return f},c.Filterset.prototype.toJS=function(a){var b={"=":"==="};return d.map(this.filters,function(a){var c=a.op;c in b&&(c=b[c]);var d=a.val;void 0!==a._val&&(d=a._val.toString(!0));var e="data";return e+"."+a.key.value+" "+c+" "+("string"===d.is?"'"+d.toString().replace(/'/g,"\\'")+"'":d)}).join(" && ")},c.Filterset.prototype.addable=function(a){var b=a.key.toString(),c=a.val.toString();switch(c.match(/^[0-9]+(\.[0-9]*)?$/)&&(c=parseFloat(c)),a.op){case"=":return void 0!==this.filters[b+"="]?this.filters[b+"="].val.toString()!=c?!1:null:void 0!==this.filters[b+"!="+c]?!1:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?!1:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?!1:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>c?!1:!(void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<c);case"=~":return!0;case"!=":return void 0!==this.filters[b+"="]?this.filters[b+"="].val==c?!1:null:void 0!==this.filters[b+"!="+c]?null:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?null:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?null:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>c?null:void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<c?null:!0;case">":return b+"="in this.filters?this.filters[b+"="].val<=c?!1:null:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?!1:void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<=c?!1:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?null:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>c?null:!0;case">=":return void 0!==this.filters[b+"="]?this.filters[b+"="].val<c?!1:null:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?!1:void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<c?!1:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?null:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>=c?null:!0;case"<":return void 0!==this.filters[b+"="]?this.filters[b+"="].val>=c?!1:null:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?!1:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>=c?!1:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?null:void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<c?null:!0;case"<=":return void 0!==this.filters[b+"="]?this.filters[b+"="].val>c?!1:null:void 0!==this.filters[b+">"]&&this.filters[b+">"].val>=c?!1:void 0!==this.filters[b+">="]&&this.filters[b+">="].val>c?!1:void 0!==this.filters[b+"<"]&&this.filters[b+"<"].val<=c?null:void 0!==this.filters[b+"<="]&&this.filters[b+"<="].val<=c?null:!0}},c.Filterset.prototype.conflict=function(a){var b=a.key.toString(),c=a.val.toString();return isNaN(parseFloat(c))||(c=parseFloat(c)),"="===a.op&&void 0!==this.filters[b+"="]&&c!=this.filters[b+"="].val.toString()||"!="===a.op&&void 0!==this.filters[b+"="]&&c==this.filters[b+"="].val.toString()||"="===a.op&&void 0!==this.filters[b+"!="]&&c==this.filters[b+"!="].val.toString()?a.toString()+" added to "+this.toString()+" produces an invalid filter":!1},c.Filterset.prototype.add=function(a,b){var c,d=a.key.toString(),e=a.op,f=this.conflict(a);if(f)return f;if("="===e){for(var g in this.filters)this.filters[g].key==d&&delete this.filters[g];this.filters[d+"="]=a}else if("!="===e)this.filters[d+"!="+a.val]=a;else if("=~"===e)this.filters[d+"=~"+a.val]=a;else if(">"===e){for(var h in this.filters)this.filters[h].key==d&&this.filters[h].val<=a.val&&delete this.filters[h];this.filters[d+">"]=a}else if(">="===e){for(var i in this.filters)c=+this.filters[i].val.toString(),this.filters[i].key==d&&c<a.val&&delete this.filters[i];void 0!==this.filters[d+"!="+a.val]?(delete this.filters[d+"!="+a.val],a.op=">",this.filters[d+">"]=a):this.filters[d+">="]=a}else if("<"===e){for(var j in this.filters)c=+this.filters[j].val.toString(),this.filters[j].key==d&&c>=a.val&&delete this.filters[j];this.filters[d+"<"]=a}else if("<="===e){for(var k in this.filters)c=+this.filters[k].val.toString(),this.filters[k].key==d&&c>a.val&&delete this.filters[k];void 0!==this.filters[d+"!="+a.val]?(delete this.filters[d+"!="+a.val],a.op="<",this.filters[d+"<"]=a):this.filters[d+"<="]=a}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":116,underscore:146}],127:[function(a,b,c){arguments[4][19][0].apply(c,arguments)},{"../tree":116,dup:19}],128:[function(a,b,c){arguments[4][20][0].apply(c,arguments)},{"../tree":116,dup:20}],129:[function(a,b,c){arguments[4][21][0].apply(c,arguments)},{"../tree":116,dup:21}],130:[function(a,b,c){arguments[4][22][0].apply(c,arguments)},{"../tree":116,dup:22}],131:[function(a,b,c){arguments[4][23][0].apply(c,arguments)},{"../tree":116,dup:23}],132:[function(a,b,c){arguments[4][24][0].apply(c,arguments)},{"../tree":116,dup:24}],133:[function(a,b,c){arguments[4][25][0].apply(c,arguments)},{"../tree":116,dup:25}],134:[function(a,b,c){arguments[4][26][0].apply(c,arguments)},{"../tree":116,dup:26}],135:[function(a,b,c){arguments[4][27][0].apply(c,arguments)},{"../tree":116,dup:27}],136:[function(a,b,c){(function(b){!function(c){function d(a){var b={};for(var c in a.symbolizers)for(var d in a.symbolizers[c])a.symbolizers[c][d].hasOwnProperty("css")&&(b[a.symbolizers[c][d].css]=[a.symbolizers[c][d],c,d]);return b}function e(a){var b={};for(var c in a.symbolizers)for(var d in a.symbolizers[c])if("functions"===a.symbolizers[c][d].type)for(var e=0;e<a.symbolizers[c][d].functions.length;e++){var f=a.symbolizers[c][d].functions[e];b[f[0]]=f[1]}return b}function f(a){var b={};for(var c in a.symbolizers){b[c]=[];for(var d in a.symbolizers[c])a.symbolizers[c][d].required&&b[c].push(a.symbolizers[c][d].css)}return b}function g(a,b){if("string"===a.value[0].is)return!0;for(var c in a.value)for(var d in a.value[c].value){if("call"!==a.value[c].value[d].is)return!1;var e=i.find(j.selector(b).functions,function(b){return b[0]==a.value[c].value[d].name});if(!(e&&-1==e[1]||e&&e[1]===a.value[c].value[d].args.length))return!1}return!0}function h(a,b){return"object"==typeof j.selector(b).type?-1!==j.selector(b).type.indexOf(a.value[0].value):"string"===j.selector(b).type}var i=b._||a("underscore"),j={};j.setData=function(a){j.data=a,j.selector_cache=d(a),j.mapnikFunctions=e(a),j.mapnikFunctions.matrix=[6],j.mapnikFunctions.translate=[1,2],j.mapnikFunctions.scale=[1,2],j.mapnikFunctions.rotate=[1,3],j.mapnikFunctions.skewX=[1],j.mapnikFunctions.skewY=[1],j.required_cache=f(a)},j.setVersion=function(b){var c=a("mapnik-reference");return c.version.hasOwnProperty(b)?(j.setData(c.version[b]),!0):!1},j.selectorData=function(a,b){return j.selector_cache[a]?j.selector_cache[a][b]:void 0},j.validSelector=function(a){return!!j.selector_cache[a]},j.selectorName=function(a){return j.selectorData(a,2)},j.selector=function(a){return j.selectorData(a,0)},j.symbolizer=function(a){return j.selectorData(a,1)},j.requiredProperties=function(a,b){var c=j.required_cache[a];for(var d in c)if(!(c[d]in b))return"Property "+c[d]+" required for defining "+a+" styles."},j._validateValue={font:function(a,b){return a.validation_data&&a.validation_data.fonts?-1!=a.validation_data.fonts.indexOf(b):!0}},j.isFont=function(a){return"font"==j.selector(a).validate},j.editDistance=function(a,b){if(0===a.length)return b.length;if(0===b.length)return a.length;for(var c=[],d=0;d<=b.length;d++)c[d]=[d];for(var e=0;e<=a.length;e++)c[0][e]=e;for(d=1;d<=b.length;d++)for(e=1;e<=a.length;e++)b.charAt(d-1)==a.charAt(e-1)?c[d][e]=c[d-1][e-1]:c[d][e]=Math.min(c[d-1][e-1]+1,Math.min(c[d][e-1]+1,c[d-1][e]+1));return c[b.length][a.length]},j.validValue=function(a,b,c){var d;if(j.selector(b)){if("keyword"==c.value[0].is)return h(c,b);if("undefined"==c.value[0].is)return!0;if("numbers"==j.selector(b).type){for(d in c.value)if("float"!==c.value[d].is)return!1;return!0}if("tags"==j.selector(b).type){if(!c.value)return!1;if(!c.value[0].value)return"tag"===c.value[0].is;for(d=0;d<c.value[0].value.length;d++)if("tag"!==c.value[0].value[d].is)return!1;return!0}if("functions"==j.selector(b).type)return g(c,b);if("unsigned"===j.selector(b).type)return"float"===c.value[0].is?(c.value[0].round(),!0):!1;if(j.selector(b).expression)return!0;if(j.selector(b).validate){var e=!1;for(d=0;d<c.value.length;d++)if(j.selector(b).type==c.value[d].is&&j._validateValue[j.selector(b).validate](a,c.value[d].value))return!0;return e}return j.selector(b).type==c.value[0].is}return!1},c.Reference=j}(a("../tree"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":116,"mapnik-reference":145,underscore:146}],137:[function(a,b,c){arguments[4][29][0].apply(c,arguments)},{"../tree":116,dup:29}],138:[function(a,b,c){arguments[4][30][0].apply(c,arguments)},{"../tree":116,dup:30}],139:[function(a,b,c){arguments[4][31][0].apply(c,arguments)},{"../tree":116,dup:31}],140:[function(a,b,c){(function(b){!function(c){var d=b._||a("underscore");c.StyleXML=function(a,b,c,e){for(var f={},g=[],h=[],i=[],j=[],k=[],l=0;l<c.length;l++)for(var m=0;m<c[l].rules.length;m++)"image-filters"===c[l].rules[m].name&&g.push(c[l].rules[m]),"image-filters-inflate"===c[l].rules[m].name&&h.push(c[l].rules[m]),"direct-image-filters"===c[l].rules[m].name&&i.push(c[l].rules[m]),"comp-op"===c[l].rules[m].name&&j.push(c[l].rules[m]),"opacity"===c[l].rules[m].name&&k.push(c[l].rules[m]);var n=c.map(function(a){return a.toXML(e,f)}),o="";g.length&&(o+=' image-filters="'+d.chain(g).uniq(function(a){return a.id}).map(function(a){return a.ev(e).toXML(e,!0,",","image-filter")}).value().join(",")+'"'),h.length&&(o+=' image-filters-inflate="'+h[0].value.ev(e).toString()+'"'),i.length&&(o+=' direct-image-filters="'+d.chain(i).uniq(function(a){return a.id}).map(function(a){return a.ev(e).toXML(e,!0,",","direct-image-filter")}).value().join(",")+'"'),j.length&&"src-over"!=j[0].value.ev(e).value&&(o+=' comp-op="'+j[0].value.ev(e).toString()+'"'),k.length&&1!=k[0].value.ev(e).value&&(o+=' opacity="'+k[0].value.ev(e).toString()+'"');var p=n.join("");return o||p?'<Style name="'+a+'" filter-mode="first"'+o+">\n"+p+"</Style>":""}}(a("../tree"))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../tree":116,underscore:146}],141:[function(a,b,c){arguments[4][33][0].apply(c,arguments)},{"../tree":116,dup:33}],142:[function(a,b,c){arguments[4][34][0].apply(c,arguments)},{"../tree":116,dup:34}],143:[function(a,b,c){arguments[4][35][0].apply(c,arguments)},{"../tree":116,dup:35}],144:[function(a,b,c){arguments[4][36][0].apply(c,arguments)},{"../tree":116,dup:36}],145:[function(a,b,c){(function(c){var d=(a("fs"),a("path")),e=a("fs").existsSync||a("path").existsSync;b.exports.version={};var f=["2.0.0","2.0.1","2.0.2","2.1.0","2.1.1","2.2.0","2.3.0","3.0.0"];f.map(function(f){b.exports.version[f]=a(d.join(c,f,"reference.json"));var g=d.join(c,f,"datasources.json");e(g)&&(b.exports.version[f].datasources=a(g).datasources)})}).call(this,"/../cartodb.js/node_modules/torque.js/node_modules/carto/node_modules/mapnik-reference")},{fs:323,path:326}],146:[function(a,b,c){b.exports=a(148)},{dup:148}],147:[function(a,b,c){b.exports={name:"carto",version:"0.15.1-cdb1",description:"CartoCSS Stylesheet Compiler",url:"https://github.com/cartodb/carto",repository:{type:"git",url:"git+ssh://git@github.com/cartodb/carto.git"},author:{name:"CartoDB",url:"http://cartodb.com/"},keywords:["maps","css","stylesheets"],contributors:[{name:"Tom MacWright",email:"macwright@gmail.com"},{name:"Konstantin Käfer"},{name:"Alexis Sellier",email:"self@cloudhead.net"},{name:"Raul Ochoa",email:"rochoa@cartodb.com"},{name:"Javi Santana",email:"jsantana@cartodb.com"}],licenses:[{type:"Apache"}],bin:{carto:"./bin/carto"},man:["./man/carto.1"],main:"./lib/carto/index",engines:{node:">=0.4.x"},dependencies:{underscore:"~1.6.0","mapnik-reference":"~6.0.2",optimist:"~0.6.0"},devDependencies:{mocha:"1.12.x",jshint:"0.2.x",sax:"0.1.x",istanbul:"~0.2.14",coveralls:"~2.10.1",browserify:"~7.0.0","uglify-js":"1.3.3"},scripts:{pretest:"npm install",test:"mocha -R spec",coverage:"istanbul cover ./node_modules/.bin/_mocha && coveralls < ./coverage/lcov.info"},readme:"# CartoCSS\n\n[![Build Status](https://secure.travis-ci.org/mapbox/carto.png)](http://travis-ci.org/mapbox/carto)\n\nIs as stylesheet renderer for javascript, It's an evolution of the Mapnik renderer from Mapbox.\nPlease, see original [Mapbox repo](http://github.com/mapbox/carto) for more information and credits\n\n## Quick Start\n\n```javascript\n// shader is a CartoCSS object\n\nvar cartocss = [\n    '#layer {',\n    ' marker-width: [property]',\n    ' marker-fill: red',\n    '}'\n].join('')\nvar shader = new carto.RendererJS().render(cartocss);\nvar layers = shader.getLayers()\nfor (var i = 0; i < layers.length; ++i) {\n    var layer = layers[i];\n    console.log(\"layer name: \", layer.fullName())\n    console.log(\"- frames: \", layer.frames())\n    console.log(\"- attachment: \", layer.attachment())\n\n    var layerShader = layer.getStyle({ property: 1 }, { zoom: 10 })\n    console.log(layerShader['marker-width']) // 1\n    console.log(layerShader['marker-fill']) // #FF0000\n}\n\n```\n\n# API\n\n## RendererJS\n\n### render(cartocss)\n\n## CartoCSS\n\ncompiled cartocss object\n\n### getLayers\n\nreturn the layers, an array of ``CartoCSS.Layer`` object\n\n### getDefault\n\nreturn the default layer (``CartoCSS.Layer``), usually the Map layer\n\n\n### findLayer(where)\n\nfind a layer using where object.\n\n```\nshader.findLayer({ name: 'test' })\n```\n\n## CartoCSS.Layer\n\n### getStyle(props, context)\n\nreturn the evaluated style:\n    - props: object containing properties needed to render the style. If the cartocss style uses\n      some variables they should be passed in this object\n    - context: rendering context variables like ``zoom`` or animation ``frame``\n\n\n\n\n\n\n\n\n\n\n## Reference Documentation\n\n* [mapbox.com/carto](http://mapbox.com/carto/)\n\n\n",readmeFilename:"README.md",bugs:{url:"https://github.com/cartodb/carto/issues"},homepage:"https://github.com/cartodb/carto#readme",_id:"carto@0.15.1-cdb1",_shasum:"b84c5270f0de5c2a296ca6fd0695353d51fb9ec9",_resolved:"https://github.com/CartoDB/carto/archive/master.tar.gz",_from:"https://github.com/CartoDB/carto/archive/master.tar.gz"}},{}],148:[function(a,b,c){(function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=v(d,f,4);var g=!C(c)&&u.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function d(a){return function(b,c,d){c=w(c,d);for(var e=B(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function e(a,b,c){return function(d,e,f){var g=0,h=B(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(m.call(d,g,h),u.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&h>f;f+=a)if(d[f]===e)return f;return-1}}function f(a,b){var c=H.length,d=a.constructor,e=u.isFunction(d)&&d.prototype||j,f="constructor";for(u.has(a,f)&&!u.contains(b,f)&&b.push(f);c--;)f=H[c],f in a&&a[f]!==e[f]&&!u.contains(b,f)&&b.push(f)}var g=this,h=g._,i=Array.prototype,j=Object.prototype,k=Function.prototype,l=i.push,m=i.slice,n=j.toString,o=j.hasOwnProperty,p=Array.isArray,q=Object.keys,r=k.bind,s=Object.create,t=function(){},u=function(a){return a instanceof u?a:this instanceof u?void(this._wrapped=a):new u(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=u),c._=u):g._=u,u.VERSION="1.8.3";var v=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},w=function(a,b,c){return null==a?u.identity:u.isFunction(a)?v(a,b,c):u.isObject(a)?u.matcher(a):u.property(a)};u.iteratee=function(a,b){return w(a,b,1/0)};var x=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},y=function(a){if(!u.isObject(a))return{};if(s)return s(a);t.prototype=a;var b=new t;return t.prototype=null,b},z=function(a){return function(b){return null==b?void 0:b[a]}},A=Math.pow(2,53)-1,B=z("length"),C=function(a){var b=B(a);return"number"==typeof b&&b>=0&&A>=b};u.each=u.forEach=function(a,b,c){b=v(b,c);var d,e;if(C(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=u.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},u.map=u.collect=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},u.reduce=u.foldl=u.inject=a(1),u.reduceRight=u.foldr=a(-1),u.find=u.detect=function(a,b,c){var d;return d=C(a)?u.findIndex(a,b,c):u.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},u.filter=u.select=function(a,b,c){var d=[];return b=w(b,c),u.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},u.reject=function(a,b,c){return u.filter(a,u.negate(w(b)),c)},u.every=u.all=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},u.some=u.any=function(a,b,c){b=w(b,c);for(var d=!C(a)&&u.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},u.contains=u.includes=u.include=function(a,b,c,d){return C(a)||(a=u.values(a)),("number"!=typeof c||d)&&(c=0),u.indexOf(a,b,c)>=0},u.invoke=function(a,b){var c=m.call(arguments,2),d=u.isFunction(b);return u.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},u.pluck=function(a,b){return u.map(a,u.property(b))},u.where=function(a,b){return u.filter(a,u.matcher(b))},u.findWhere=function(a,b){return u.find(a,u.matcher(b))},u.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=C(a)?a:u.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=w(b,c),u.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},u.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=C(a)?a:u.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=w(b,c),u.each(a,function(a,c,d){e=b(a,c,d),(g>e||e===1/0&&f===1/0)&&(f=a,g=e)});return f},u.shuffle=function(a){for(var b,c=C(a)?a:u.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=u.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},u.sample=function(a,b,c){return null==b||c?(C(a)||(a=u.values(a)),a[u.random(a.length-1)]):u.shuffle(a).slice(0,Math.max(0,b))},u.sortBy=function(a,b,c){return b=w(b,c),u.pluck(u.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var D=function(a){return function(b,c,d){var e={};return c=w(c,d),u.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};u.groupBy=D(function(a,b,c){u.has(a,c)?a[c].push(b):a[c]=[b]}),u.indexBy=D(function(a,b,c){a[c]=b}),u.countBy=D(function(a,b,c){u.has(a,c)?a[c]++:a[c]=1}),u.toArray=function(a){return a?u.isArray(a)?m.call(a):C(a)?u.map(a,u.identity):u.values(a):[]},u.size=function(a){return null==a?0:C(a)?a.length:u.keys(a).length},u.partition=function(a,b,c){b=w(b,c);var d=[],e=[];return u.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},u.first=u.head=u.take=function(a,b,c){return null!=a?null==b||c?a[0]:u.initial(a,a.length-b):void 0},u.initial=function(a,b,c){return m.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},u.last=function(a,b,c){return null!=a?null==b||c?a[a.length-1]:u.rest(a,Math.max(0,a.length-b)):void 0},u.rest=u.tail=u.drop=function(a,b,c){return m.call(a,null==b||c?1:b)},u.compact=function(a){return u.filter(a,u.identity)};var E=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=B(a);h>g;g++){var i=a[g];if(C(i)&&(u.isArray(i)||u.isArguments(i))){b||(i=E(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};u.flatten=function(a,b){return E(a,b,!1)},u.without=function(a){return u.difference(a,m.call(arguments,1))},u.uniq=u.unique=function(a,b,c,d){u.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=w(c,d));for(var e=[],f=[],g=0,h=B(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?u.contains(f,j)||(f.push(j),e.push(i)):u.contains(e,i)||e.push(i)}return e},u.union=function(){return u.uniq(E(arguments,!0,!0))},u.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=B(a);e>d;d++){var f=a[d];if(!u.contains(b,f)){for(var g=1;c>g&&u.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},u.difference=function(a){var b=E(arguments,!0,!0,1);return u.filter(a,function(a){return!u.contains(b,a)})},u.zip=function(){return u.unzip(arguments)},u.unzip=function(a){for(var b=a&&u.max(a,B).length||0,c=Array(b),d=0;b>d;d++)c[d]=u.pluck(a,d);return c},u.object=function(a,b){for(var c={},d=0,e=B(a);e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c;
},u.findIndex=d(1),u.findLastIndex=d(-1),u.sortedIndex=function(a,b,c,d){c=w(c,d,1);for(var e=c(b),f=0,g=B(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},u.indexOf=e(1,u.findIndex,u.sortedIndex),u.lastIndexOf=e(-1,u.findLastIndex),u.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var F=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=y(a.prototype),g=a.apply(f,e);return u.isObject(g)?g:f};u.bind=function(a,b){if(r&&a.bind===r)return r.apply(a,m.call(arguments,1));if(!u.isFunction(a))throw new TypeError("Bind must be called on a function");var c=m.call(arguments,2),d=function(){return F(a,d,b,this,c.concat(m.call(arguments)))};return d},u.partial=function(a){var b=m.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===u?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return F(a,c,this,this,f)};return c},u.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=u.bind(a[c],a);return a},u.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return u.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},u.delay=function(a,b){var c=m.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},u.defer=u.partial(u.delay,u,1),u.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:u.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=u.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},u.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=u.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=u.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},u.wrap=function(a,b){return u.partial(b,a)},u.negate=function(a){return function(){return!a.apply(this,arguments)}},u.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},u.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},u.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},u.once=u.partial(u.before,2);var G=!{toString:null}.propertyIsEnumerable("toString"),H=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];u.keys=function(a){if(!u.isObject(a))return[];if(q)return q(a);var b=[];for(var c in a)u.has(a,c)&&b.push(c);return G&&f(a,b),b},u.allKeys=function(a){if(!u.isObject(a))return[];var b=[];for(var c in a)b.push(c);return G&&f(a,b),b},u.values=function(a){for(var b=u.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},u.mapObject=function(a,b,c){b=w(b,c);for(var d,e=u.keys(a),f=e.length,g={},h=0;f>h;h++)d=e[h],g[d]=b(a[d],d,a);return g},u.pairs=function(a){for(var b=u.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},u.invert=function(a){for(var b={},c=u.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},u.functions=u.methods=function(a){var b=[];for(var c in a)u.isFunction(a[c])&&b.push(c);return b.sort()},u.extend=x(u.allKeys),u.extendOwn=u.assign=x(u.keys),u.findKey=function(a,b,c){b=w(b,c);for(var d,e=u.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},u.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;u.isFunction(b)?(e=u.allKeys(g),d=v(b,c)):(e=E(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;i>h;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},u.omit=function(a,b,c){if(u.isFunction(b))b=u.negate(b);else{var d=u.map(E(arguments,!1,!1,1),String);b=function(a,b){return!u.contains(d,b)}}return u.pick(a,b,c)},u.defaults=x(u.allKeys,!0),u.create=function(a,b){var c=y(a);return b&&u.extendOwn(c,b),c},u.clone=function(a){return u.isObject(a)?u.isArray(a)?a.slice():u.extend({},a):a},u.tap=function(a,b){return b(a),a},u.isMatch=function(a,b){var c=u.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var I=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof u&&(a=a._wrapped),b instanceof u&&(b=b._wrapped);var e=n.call(a);if(e!==n.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(u.isFunction(g)&&g instanceof g&&u.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!I(a[i],b[i],c,d))return!1}else{var j,k=u.keys(a);if(i=k.length,u.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!u.has(b,j)||!I(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};u.isEqual=function(a,b){return I(a,b)},u.isEmpty=function(a){return null==a?!0:C(a)&&(u.isArray(a)||u.isString(a)||u.isArguments(a))?0===a.length:0===u.keys(a).length},u.isElement=function(a){return!(!a||1!==a.nodeType)},u.isArray=p||function(a){return"[object Array]"===n.call(a)},u.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},u.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){u["is"+a]=function(b){return n.call(b)==="[object "+a+"]"}}),u.isArguments(arguments)||(u.isArguments=function(a){return u.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(u.isFunction=function(a){return"function"==typeof a||!1}),u.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},u.isNaN=function(a){return u.isNumber(a)&&a!==+a},u.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===n.call(a)},u.isNull=function(a){return null===a},u.isUndefined=function(a){return void 0===a},u.has=function(a,b){return null!=a&&o.call(a,b)},u.noConflict=function(){return g._=h,this},u.identity=function(a){return a},u.constant=function(a){return function(){return a}},u.noop=function(){},u.property=z,u.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},u.matcher=u.matches=function(a){return a=u.extendOwn({},a),function(b){return u.isMatch(b,a)}},u.times=function(a,b,c){var d=Array(Math.max(0,a));b=v(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},u.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},u.now=Date.now||function(){return(new Date).getTime()};var J={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},K=u.invert(J),L=function(a){var b=function(b){return a[b]},c="(?:"+u.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};u.escape=L(J),u.unescape=L(K),u.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),u.isFunction(d)?d.call(a):d};var M=0;u.uniqueId=function(a){var b=++M+"";return a?a+b:b},u.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var N=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\u2028|\u2029/g,Q=function(a){return"\\"+O[a]};u.template=function(a,b,c){!b&&c&&(b=c),b=u.defaults({},b,u.templateSettings);var d=RegExp([(b.escape||N).source,(b.interpolate||N).source,(b.evaluate||N).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(P,Q),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,u)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},u.chain=function(a){var b=u(a);return b._chain=!0,b};var R=function(a,b){return a._chain?u(b).chain():b};u.mixin=function(a){u.each(u.functions(a),function(b){var c=u[b]=a[b];u.prototype[b]=function(){var a=[this._wrapped];return l.apply(a,arguments),R(this,c.apply(u,a))}})},u.mixin(u),u.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=i[a];u.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],R(this,c)}}),u.each(["concat","join","slice"],function(a){var b=i[a];u.prototype[a]=function(){return R(this,b.apply(this._wrapped,arguments))}}),u.prototype.value=function(){return this._wrapped},u.prototype.valueOf=u.prototype.toJSON=u.prototype.value,u.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return u})}).call(this)},{}],149:[function(a,b,c){b.exports={name:"cartodb.js",version:"4.0.0-alpha.1",description:"CartoDB javascript library",repository:{type:"git",url:"git://github.com/CartoDB/cartodb.js.git"},author:{name:"CartoDB",url:"http://cartodb.com/",email:"wadus@cartodb.com"},contributors:["Javier Álvarez <jmedina@cartodb.com>","Javier Álvarez <xabel@vizzuality.com>","Javier Arce <javierarce@cartodb.com>","Javier Santana <jsantana@cartodb.com>","Raul Ochoa <rochoa@cartodb.com>","Carlos Matallín <matallo@cartodb.com>","Jaime Chapinal <jaime.chapinal@cartodb.com>","Nicklas Gummesson <nicklas@cartodb.com>","Francisco Dans <francisco@cartodb.com>","Emilio García <emilio@cartodb.com>"],licenses:[{type:"BSD"}],dependencies:{backbone:"1.2.3","browserify-shim":"3.8.10",jquery:"2.1.4",jstify:"0.12.0",leaflet:"0.7.3",mustache:"1.1.0","perfect-scrollbar":"0.6.7","torque.js":"2.15.1",underscore:"1.8.3",cartoassets:"CartoDB/CartoAssets#master",d3:"3.5.8","d3.cartodb":"CartoDB/d3.cartodb#gh-pages"},devDependencies:{browserify:"11.2.0","findup-sync":"0.1.3",grunt:"0.4.5","grunt-aws":"^0.4.0","grunt-browserify":"4.0.1","grunt-contrib-clean":"~0.5.0","grunt-contrib-concat":"~0.3.0","grunt-contrib-connect":"~0.11.2","grunt-contrib-copy":"~0.7.0","grunt-contrib-cssmin":"~0.7.0","grunt-contrib-imagemin":"~1.0.0","grunt-contrib-jasmine":"0.9.2","grunt-contrib-jshint":"~0.8.0","grunt-contrib-uglify":"0.10.0","grunt-contrib-watch":"git://github.com/gruntjs/grunt-contrib-watch.git#b884948805940c663b1cbb91a3c28ba8afdebf78","grunt-exorcise":"2.1.0","grunt-fastly":"~0.1.3","grunt-gitinfo":"~0.1.7","grunt-prompt":"~1.3.0","grunt-replace":"0.6.2","grunt-sass":"~1.1.0-beta",gulp:"3.8.10","gulp-iconfont":"1.0.0","gulp-iconfont-css":"0.0.9","gulp-install":"0.2.0","gulp-sketch":"0.0.7","jshint-stylish":"~0.1.3","load-grunt-tasks":"~0.6.0",semistandard:"7.0.4",semver:"~4.1.0","source-map-support":"0.3.2","time-grunt":"~0.3.1",watchify:"3.4.0"},browserify:{transform:["browserify-shim","jstify"]},browser:{cdb:"./src/cdb.js","cdb.config":"./src/cdb.config.js","cdb.core.util":"./src/core/util.js","cdb.core.Profiler":"./src/core/profiler.js","cdb.log":"./src/cdb.log.js","cdb.errors":"./src/cdb.errors.js","cdb.templates":"./src/cdb.templates.js",geojson:"./vendor/GeoJSON.js","html-css-sanitizer":"./vendor/html-css-sanitizer-bundle.js","clip-path":"./vendor/clip-path.js",lzma:"./vendor/lzma.js",mousewheel:"./vendor/mousewheel.js",mwheelIntent:"./vendor/mwheelIntent.js","spin.js":"./vendor/spin.js","wax.cartodb.js":"./vendor/wax.cartodb.js"},"browserify-shim":{geojson:"GeoJSON","html-css-sanitizer":"html",lzma:"LZMA","clip-path":{depends:["underscore:_","jquery:jQuery"]},mousewheel:{depends:["jquery:jQuery"]},mwheelIntent:{depends:["jquery:jQuery"]},"spin.js":"Spinner","wax.cartodb.js":"wax"},files:["dist","node_modules/cdb","src","themes","vendor"],main:"src/index.js",semistandard:{globals:["cartodb","cdb","jasmine","describe","xdescribe","beforeEach","afterEach","spyOn","it","xit","expect"],ignore:["/*.js","/dist","/doc","/examples","/grunt","/styleguide","/themes","/vendor"]}}},{}],150:[function(a,b,c){function d(a){var b=a.host||"cartodb.com",c=a.protocol||"https";return c+"://"+a.user+"."+b+"/api/v1/viz/"+a.table+"/viz.json"}function e(a,b){var c=null;return void 0!==a.layers||void 0!==(a.kind||a.type)?void f.defer(function(){b(a)}):(void 0!==a.table&&void 0!==a.user?c=d(a):a.indexOf&&(c=a),void(c?i.get(c,b):f.defer(function(){b(null)})))}var f=a("underscore"),g=a("leaflet"),h=a("cdb"),i=a("../core/loader"),j=a("../geo/map"),k=a("../vis/vis"),l=a("../vis/vis/layers"),m=a("./promise");b.exports=function(a,b,c,d){if(void 0===a)throw new TypeError("map should be provided");if(void 0===b)throw new TypeError("layer should be provided");var i,n;c=c||{};var o=arguments,p=o[o.length-1];f.isFunction(p)&&(d=p);var q=new m;return q.addTo=function(a,b){return q.on("done",function(){n.addLayerToMap(i,a,b)}),q},e(b,function(b){function e(){i=r.createLayer(m);var a=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);c.mobile_layout&&a||c.force_mobile;if(!i)return q.trigger("error","layer not supported"),q;if(c.infowindow&&r.addInfowindow(i),c.tooltip&&r.addTooltip(i),c.legends){var b=l.create(m.type||m.kind,r,m);r._addLegends(r._createLayerLegendView(b.attributes,i))}d&&d(i),q.trigger("done",i)}var m;if(!b)return void q.trigger("error");if(b.layers){b.layers.length<2&&q.trigger("error","visualization file does not contain layer info");var o=c.layerIndex;if(void 0!==o){if(b.layers.length<=o)return void q.trigger("error","layerIndex out of bounds");m=b.layers[o]}else{var p=["namedmap","layergroup","torque"];m=f.find(b.layers,function(a){return-1!==p.indexOf(a.type)})}}else m=b;if(!m)return void q.trigger("error");if(c&&!f.isFunction(c)&&(m.options=m.options||{},f.extend(m.options,c)),c=f.defaults(c,{infowindow:!0,https:!1,legends:!0,time_slider:!0,tooltip:!0}),"undefined"!=typeof a.overlayMapTypes)n=h.geo.GoogleMapsMapView;else{if(!(a instanceof g.Map))return q.trigger("error","cartodb.js can't guess the map type"),q;n=h.geo.LeafletMapView}var r=a.viz;if(!r){var s=new n({map_object:a,map:new j});a.viz=r=new k({mapView:s}),r.https=c.https}r.checkModules([m])?e():r.loadModules([m],function(){e()})}),q}},{"../core/loader":161,"../geo/map":227,"../vis/vis":299,"../vis/vis/layers":301,"./promise":152,cdb:157,leaflet:58,underscore:148}],151:[function(a,b,c){var d=a("underscore"),e=a("../vis/vis"),f=function(a,b,c,f){if(!a)throw new TypeError("a DOM element should be provided");var g=arguments,h=g[g.length-1];d.isFunction(h)&&(f=h),a="string"==typeof a?document.getElementById(a):a;var i=new e({el:a});return b&&(i.load(b,c),f&&i.done(f)),i};b.exports=f},{"../vis/vis":299,underscore:148}],152:[function(a,b,c){function d(){}var e=a("underscore"),f=a("backbone");e.extend(d.prototype,f.Events,{done:function(a){return this.bind("done",a)},error:function(a){return this.bind("error",a)}}),b.exports=d},{backbone:1,underscore:148}],153:[function(a,b,c){function d(a){if(window.cdb===this||window===this)return new d(a);if(!a.user)throw new Error("user should be provided");var b=new String(window.location.protocol);if(b=b.slice(0,b.length-1),"file"==b&&(b="https"),this.options=f.defaults(a,{version:"v2",protocol:b,jsonp:!g.support.cors}),!this.options.sql_api_template){var c=this.options,e=null;if(c&&c.completeDomain)e=c.completeDomain;else{var h=c.host||"cartodb.com",i=c.protocol||"https";e=i+"://{user}."+h}this.options.sql_api_template=e}}function e(a){return JSON.parse(a.replace(/^{/,"[").replace(/}$/,"]"))}var f=a("underscore"),g=a("jquery"),h=a("mustache"),i=a("./promise");d.prototype._host=function(){var a=this.options;return a.sql_api_template.replace("{user}",a.user)+"/api/"+a.version+"/sql"},d.prototype.execute=function(a,b,c,d){var e=1024,j=new i;if(!a)throw new TypeError("sql should not be null");var k=arguments,l=k[k.length-1];f.isFunction(l)&&(d=l),c=f.defaults(c||{},this.options);var m={type:"get",dataType:"json",crossDomain:!0};void 0!==c.cache&&(m.cache=c.cache),c.jsonp&&(delete m.crossDomain,c.jsonpCallback&&(m.jsonpCallback=c.jsonpCallback),m.dataType="jsonp");var n="156543.03515625",o="ST_MakeEnvelope(-20037508.5,-20037508.5,20037508.5,20037508.5,3857)";a=a.replace("!bbox!",o).replace("!pixel_width!",n).replace("!pixel_height!",n);var p=h.render(a,b),q=p.length<e,r=["format","dp","api_key"];if(c.extra_params&&(r=r.concat(c.extra_params)),m.url=this._host(),q){var s="q="+encodeURIComponent(p);for(var t in r){var u=r[t],v=c[u];v&&(s+="&"+u+"="+v)}m.url+="?"+s}else{var w={q:p};for(var t in r){var u=r[t],v=c[u];v&&(w[u]=v)}m.data=w,m.type="post"}var x=c.success,y=c.error;return x&&delete c.success,y&&delete y.success,m.error=function(a){var b=a.responseText||a.response,c=b&&JSON.parse(b);j.trigger("error",c&&c.error,a),y&&y(a)},m.success=function(a,b,c){void 0==b&&(b=a.status,c=a,a=JSON.parse(a.response)),setTimeout(function(){j.trigger("done",a,b,c),x&&x(a,b,c),d&&d(a)},0)},delete c.jsonp,g.ajax(f.extend(m,c)),j},d.prototype.getBounds=function(a,b,c,d){var e=new i,g=arguments,j=g[g.length-1];f.isFunction(j)&&(d=j);var k="SELECT ST_XMin(ST_Extent(the_geom)) as minx,       ST_YMin(ST_Extent(the_geom)) as miny,       ST_XMax(ST_Extent(the_geom)) as maxx,       ST_YMax(ST_Extent(the_geom)) as maxy from ({{{ sql }}}) as subq";return a=h.render(a,b),this.execute(k,{sql:a},c).done(function(a){if(a.rows&&a.rows.length>0&&null!=a.rows[0].maxx){var b=a.rows[0],c=-85.0511,f=85.0511,g=-179,h=179,i=function(a,b,c){return b>a?b:a>c?c:a},j=i(b.maxx,g,h),k=i(b.minx,g,h),l=i(b.maxy,c,f),m=i(b.miny,c,f),n=[[l,j],[m,k]];e.trigger("done",n),d&&d(n)}}).error(function(a){e.trigger("error",a)}),e},d.prototype.table=function(a){function b(){b.fetch.apply(b,arguments)}var c,d,e,g,h=a,i=[],j=this;return b.fetch=function(a){a=a||{};var c=arguments,d=c[c.length-1];f.isFunction(d)&&(callback=d,1===c.length&&(a={})),j.execute(b.sql(),a,callback)},b.sql=function(){var a="select";return a+=i.length?" "+i.join(",")+" ":" * ",a+="from "+h,c&&(a+=" where "+c),d&&(a+=" limit "+d),e&&(a+=" order by "+e),g&&(a+=" "+g),a},b.filter=function(a){return c=a,b},b.order_by=function(a){return e=a,b},b.asc=function(){return g="asc",b},b.desc=function(){return g="desc",b},b.columns=function(a){return i=a,b},b.limit=function(a){return d=a,b},b},d.prototype.describeString=function(a,b,c){var d=["WITH t as (","        SELECT count(*) as total,","               count(DISTINCT {{column}}) as ndist","        FROM ({{sql}}) _wrap","      ), a as (","        SELECT ","          count(*) cnt, ","          {{column}}","        FROM ","          ({{sql}}) _wrap ","        GROUP BY ","          {{column}} ","        ORDER BY ","          cnt DESC","        ), b As (","         SELECT","          row_number() OVER (ORDER BY cnt DESC) rn,","          cnt","         FROM a","        ), c As (","        SELECT ","          sum(cnt) OVER (ORDER BY rn ASC) / t.total cumperc,","          rn,","          cnt ","         FROM b, t","         LIMIT 10","         ),","stats as (","select count(distinct({{column}})) as uniq, ","       count(*) as cnt, ","       sum(case when COALESCE(NULLIF({{column}},'')) is null then 1 else 0 end)::numeric as null_count, ","       sum(case when COALESCE(NULLIF({{column}},'')) is null then 1 else 0 end)::numeric / count(*)::numeric as null_ratio, ","       (SELECT max(cumperc) weight FROM c) As skew ","from ({{sql}}) __wrap","),","hist as (","select array_agg(row(d, c)) array_agg from (select distinct({{column}}) d, count(*) as c from ({{sql}}) __wrap, stats group by 1 limit 100) _a",")","select * from stats, hist"],g=h.render(d.join("\n"),{column:b,sql:a}),i=function(a){var b=a.replace(/^"(.+(?="$))?"$/,"$1");return b.replace(/""/g,'"')};this.execute(g,function(a){var b=a.rows[0],d=0,g=[];try{var h=e(b.array_agg),g=f(h).map(function(a){var b=a.match(/\((.*),(\d+)/),c=i(b[1]);return[c,+b[2]]});d=b.skew*(1-b.null_ratio)*(1-b.uniq/b.cnt)*(b.uniq>1?1:0)}catch(j){}c({type:"string",hist:g,distinct:b.uniq,count:b.cnt,null_count:b.null_count,null_ratio:b.null_ratio,skew:b.skew,weight:d})})},d.prototype.describeDate=function(a,b,c){var d=["with minimum as (","SELECT min({{column}}) as start_time FROM ({{sql}}) _wrap), ","maximum as (SELECT max({{column}}) as end_time FROM ({{sql}}) _wrap), ","null_ratio as (SELECT sum(case when {{column}} is null then 1 else 0 end)::numeric / count(*)::numeric as null_ratio FROM ({{sql}}) _wrap), ","moments as (SELECT count(DISTINCT {{column}}) as moments FROM ({{sql}}) _wrap)","SELECT * FROM minimum, maximum, moments, null_ratio"],e=h.render(d.join("\n"),{column:b,sql:a});this.execute(e,function(a){var b=a.rows[0],d=new Date(b.end_time),e=new Date(b.start_time),f=(b.moments,Math.min(b.moments,1024));c({type:"date",start_time:e,end_time:d,range:d-e,steps:f,null_ratio:b.null_ratio})})},d.prototype.describeBoolean=function(a,b,c){var d=["with stats as (","select count(distinct({{column}})) as uniq,","count(*) as cnt","from ({{sql}}) _wrap ","),","null_ratio as (","SELECT sum(case when {{column}} is null then 1 else 0 end)::numeric / count(*)::numeric as null_ratio FROM ({{sql}}) _wrap), ","true_ratio as (","SELECT sum(case when {{column}} is true then 1 else 0 end)::numeric / count(*)::numeric as true_ratio FROM ({{sql}}) _wrap) ","SELECT * FROM true_ratio, null_ratio, stats"],e=h.render(d.join("\n"),{column:b,sql:a});this.execute(e,function(a){var b=a.rows[0];c({type:"boolean",null_ratio:b.null_ratio,true_ratio:b.true_ratio,distinct:b.uniq,count:b.cnt})})},d.prototype.describeGeom=function(a,b,c){function d(a){return{st_multipolygon:"polygon",st_polygon:"polygon",st_multilinestring:"line",st_linestring:"line",st_multipoint:"point",st_point:"point"}[a.toLowerCase()]}var e=["with stats as (","select st_asgeojson(st_extent({{column}})) as bbox","from ({{sql}}) _wrap","),","geotype as (","select st_geometrytype({{column}}) as geometry_type from ({{sql}}) _w where {{column}} is not null limit 1","),","clusters as (","with clus as (","SELECT distinct(ST_snaptogrid(the_geom, 10)) as cluster, count(*) as clustercount FROM ({{sql}}) _wrap group by 1 order by 2 desc limit 3),","total as (","SELECT count(*) FROM ({{sql}}) _wrap)","SELECT sum(clus.clustercount)/sum(total.count) AS clusterrate FROM clus, total","),","density as (","SELECT count(*) / st_area(st_extent(the_geom)) as density FROM ({{sql}}) _wrap",")","select * from stats, geotype, clusters, density"],f=h.render(e.join("\n"),{column:b,sql:a});this.execute(f,function(a){var b=a.rows[0],e=JSON.parse(b.bbox).coordinates[0];c({type:"geom",bbox:[[e[0][0],e[0][1]],[e[2][0],e[2][1]]],geometry_type:b.geometry_type,simplified_geometry_type:d(b.geometry_type),cluster_rate:b.clusterrate,density:b.density})})},d.prototype.columns=function(a,b,c){var d=arguments,e=d[d.length-1];f.isFunction(e)&&(c=e);var g="select * from ("+a+") __wrap limit 0",h=["cartodb_id","latitude","longitude","created_at","updated_at","lat","lon","the_geom_webmercator"];this.execute(g,function(a){var b={};for(var d in a.fields)-1===h.indexOf(d)&&(b[d]=a.fields[d].type);c(b)})},d.prototype.describeFloat=function(a,b,c){var d=["with stats as (","select min({{column}}) as min,","max({{column}}) as max,","avg({{column}}) as avg,","count(DISTINCT {{column}}) as cnt,","count(distinct({{column}})) as uniq,","count(*) as cnt,","sum(case when {{column}} is null then 1 else 0 end)::numeric / count(*)::numeric as null_ratio,","stddev_pop({{column}}) / count({{column}}) as stddev,","CASE WHEN abs(avg({{column}})) > 1e-7 THEN stddev({{column}}) / abs(avg({{column}})) ELSE 1e12 END as stddevmean,",'CDB_DistType(array_agg("{{column}}"::numeric)) as dist_type ',"from ({{sql}}) _wrap ","),","params as (select min(a) as min, (max(a) - min(a)) / 7 as diff from ( select {{column}} as a from ({{sql}}) _table_sql where {{column}} is not null ) as foo ),","histogram as (","select array_agg(row(bucket, range, freq)) as hist from (","select CASE WHEN uniq > 1 then width_bucket({{column}}, min-0.01*abs(min), max+0.01*abs(max), 100) ELSE 1 END as bucket,","numrange(min({{column}})::numeric, max({{column}})::numeric) as range,","count(*) as freq","from ({{sql}}) _w, stats","group by 1","order by 1",") __wrap","),","hist as (","select array_agg(row(d, c)) cat_hist from (select distinct({{column}}) d, count(*) as c from ({{sql}}) __wrap, stats group by 1 limit 100) _a","),","buckets as (","select CDB_QuantileBins(array_agg(distinct({{column}}::numeric)), 7) as quantiles, ","       (select array_agg(x::numeric) FROM (SELECT (min + n * diff)::numeric as x FROM generate_series(1,7) n, params) p) as equalint,","       CDB_JenksBins(array_agg(distinct({{column}}::numeric)), 7) as jenks, ","       CDB_HeadsTailsBins(array_agg(distinct({{column}}::numeric)), 7) as headtails ","from ({{sql}}) _table_sql where {{column}} is not null",")","select * from histogram, stats, buckets, hist"],g=h.render(d.join("\n"),{column:b,sql:a});this.execute(g,function(a){var b=a.rows[0],d=e(b.hist),g=e(b.cat_hist);c({type:"number",cat_hist:f(g).map(function(a){var b=a.match(/\((.*),(\d+)/);return[+b[1],+b[2]]}),hist:f(d).map(function(a){if(!(a.indexOf("empty")>-1)){var b=a.split('"');return{index:b[0].replace(/\D/g,""),range:b[1].split(",").map(function(a){return a.replace(/\D/g,"")}),freq:b[2].replace(/\D/g,"")}}}),stddev:b.stddev,null_ratio:b.null_ratio,count:b.cnt,distinct:b.uniq,avg:b.avg,max:b.max,min:b.min,stddevmean:b.stddevmean,weight:(b.uniq>1?1:0)*(1-b.null_ratio)*(b.stddev<-1?1:b.stddev<1?.5:b.stddev<3?.25:.1),quantiles:b.quantiles,equalint:b.equalint,jenks:b.jenks,headtails:b.headtails,dist_type:b.dist_type})})},d.prototype.describe=function(a,b,c){var d=this,e=arguments,g=e[e.length-1];if(f.isFunction(g))var h=g;var i=function(a){a.column=b,h(a)},j="select * from ("+a+") __wrap limit 0";this.execute(j,function(e){var f=c&&c.type?c.type:e.fields[b].type;return f?void("string"===f?d.describeString(a,b,i):"number"===f?d.describeFloat(a,b,i):"geometry"===f?d.describeGeom(a,b,i):"date"===f?d.describeDate(a,b,i):"boolean"===f?d.describeBoolean(a,b,i):i(new Error("column type is not supported"))):void i(new Error("column does not exist"))})},b.exports=d},{"./promise":152,jquery:57,mustache:59,underscore:148}],154:[function(a,b,c){var d=!!window.L,e=a("underscore"),f=a("leaflet");a("mousewheel"),a("mwheelIntent");var g=a("cdb");window&&(window.cartodb=window.cdb=g),g.Backbone=a("backbone"),g.Mustache=a("mustache"),g.$=a("jquery"),g._=e,g.L=f,d&&f.noConflict(),e.extend(g.geo,a("./geo/leaflet")),g.SQL=a("./api/sql"),g.config=a("cdb.config"),g.log=a("cdb.log"),g.errors=a("cdb.errors"),g.templates=a("cdb.templates"),g.createVis=a("./api/create-vis"),g.createLayer=a("./api/create-layer"),g.LZMA=a("lzma"),g.core.Profiler=a("cdb.core.Profiler"),g.core.util=a("cdb.core.util"),g.core.Loader=g.vis.Loader=a("./core/loader"),g.core.sanitize=a("./core/sanitize"),g.core.Template=a("./core/template"),g.core.TemplateList=a("./core/template-list"),g.core.Model=a("./core/model"),g.core.View=a("./core/view"),g.ui.common.Dialog=a("./ui/common/dialog"),g.ui.common.Dropdown=a("./ui/common/dropdown"),g.ui.common.FullScreen=a("./ui/common/fullscreen/fullscreen-view"),g.ui.common.Notification=a("./ui/common/notification"),g.ui.common.Row=a("./ui/common/table/row"),g.ui.common.TableData=a("./ui/common/table/table-data"),g.ui.common.TableProperties=a("./ui/common/table/table-properties"),g.ui.common.RowView=a("./ui/common/table/row-view"),g.ui.common.Table=a("./ui/common/table"),g.geo.geocoder.NOKIA=a("./geo/geocoder/nokia-geocoder"),g.geo.geocoder.YAHOO=a("./geo/geocoder/yahoo-geocoder"),g.geo.Geometry=a("./geo/geometry"),g.geo.TileLayer=a("./geo/map/tile-layer"),g.geo.GMapsBaseLayer=a("./geo/map/gmaps-base-layer"),g.geo.WMSLayer=a("./geo/map/wms-layer"),g.geo.PlainLayer=a("./geo/map/plain-layer"),g.geo.TorqueLayer=a("./geo/map/torque-layer"),g.geo.CartoDBLayer=a("./geo/map/cartodb-layer"),g.geo.Layers=a("./geo/map/layers"),g.geo.Map=a("./geo/map"),g.geo.MapView=a("./geo/map-view"),e.extend(g.geo,a("./geo/gmaps")),g.Promise=a("./api/promise"),g.geo.ui.Text=a("./geo/ui/text"),g.geo.ui.Annotation=a("./geo/ui/annotation"),g.geo.ui.Image=a("./geo/ui/image"),g.geo.ui.Zoom=a("./geo/ui/zoom/zoom-view"),e.extend(g.geo.ui,a("./geo/ui/legend-exports")),g.geo.ui.Legend=a("./geo/ui/legend"),e.extend(g.geo.ui.Legend,a("./geo/ui/legend/legend-view-exports")),g.geo.ui.InfowindowModel=a("./geo/ui/infowindow-model"),g.geo.ui.Infowindow=a("./geo/ui/infowindow"),g.geo.ui.Header=a("./geo/ui/header"),g.geo.ui.Search=a("./geo/ui/search/search"),g.geo.ui.LayerSelector=a("./geo/ui/layer-selector"),g.geo.ui.LayerView=a("./geo/ui/layer-view"),g.geo.ui.TilesLoader=a("./geo/ui/tiles-loader"),g.geo.ui.InfoBox=a("./geo/ui/infobox"),g.geo.ui.Tooltip=a("./geo/ui/tooltip"),g.vis.INFOWINDOW_TEMPLATE=a("./vis/vis/infowindow-template"),g.vis.Overlay=a("./vis/vis/overlay"),g.vis.Overlays=a("./vis/vis/overlays"),g.vis.Layers=a("./vis/vis/layers"),g.vis.Vis=a("./vis/vis"),a("./vis/overlays"),a("./vis/layers"),b.exports=g},{"./api/create-layer":150,"./api/create-vis":151,"./api/promise":152,"./api/sql":153,"./core/loader":161,"./core/model":165,"./core/sanitize":167,"./core/template":169,"./core/template-list":168,"./core/view":171,"./geo/geocoder/nokia-geocoder":194,"./geo/geocoder/yahoo-geocoder":195,"./geo/geometry":197,"./geo/gmaps":198,"./geo/leaflet":212,"./geo/map":227,"./geo/map-view":226,"./geo/map/cartodb-layer":228,"./geo/map/gmaps-base-layer":229,"./geo/map/layers":231,"./geo/map/plain-layer":232,"./geo/map/tile-layer":233,"./geo/map/torque-layer":234,"./geo/map/wms-layer":235,"./geo/ui/annotation":237,"./geo/ui/header":240,"./geo/ui/image":241,"./geo/ui/infobox":242,"./geo/ui/infowindow":244,"./geo/ui/infowindow-model":243,"./geo/ui/layer-selector":245,"./geo/ui/layer-view":246,"./geo/ui/legend":252,"./geo/ui/legend-exports":247,"./geo/ui/legend/legend-view-exports":271,"./geo/ui/search/search":275,"./geo/ui/text":278,"./geo/ui/tiles-loader":279,"./geo/ui/tooltip":280,"./geo/ui/zoom/zoom-view":282,"./ui/common/dialog":284,"./ui/common/dropdown":285,"./ui/common/fullscreen/fullscreen-view":287,"./ui/common/notification":288,"./ui/common/table":289,"./ui/common/table/row":291,"./ui/common/table/row-view":290,"./ui/common/table/table-data":292,"./ui/common/table/table-properties":293,"./vis/layers":296,"./vis/overlays":297,"./vis/vis":299,"./vis/vis/infowindow-template":300,"./vis/vis/layers":301,"./vis/vis/overlay":302,"./vis/vis/overlays":303,backbone:1,cdb:157,"cdb.config":155,"cdb.core.Profiler":166,"cdb.core.util":170,"cdb.errors":156,"cdb.log":158,"cdb.templates":159,jquery:57,leaflet:58,lzma:318,mousewheel:319,mustache:59,mwheelIntent:320,underscore:148}],155:[function(a,b,c){var d=a("./core/config"),e=new d;e.set({cartodb_attributions:'CartoDB <a href="http://cartodb.com/attributions" target="_blank">attribution</a>',cartodb_logo_link:"http://www.cartodb.com"}),b.exports=e},{"./core/config":160}],156:[function(a,b,c){var d=a("./core/log/error-list");b.exports=new d},{"./core/log/error-list":163}],157:[function(a,b,c){var d={};d.VERSION=a("../package.json").version,d.DEBUG=!1,d.CARTOCSS_DEFAULT_VERSION="2.1.1",d.CARTOCSS_VERSIONS={"2.0.0":"","2.1.0":""},d.config={},d.core={},d.decorators={},d.image={},d.geo={},d.geo.common={},d.geo.geocoder={},d.geo.ui={},d.ui={},d.ui.common={},d.vis={},b.exports=d},{"../package.json":149}],158:[function(a,b,c){var d=a("./core/log");b.exports=new d({tag:"cdb"})},{"./core/log":162}],159:[function(a,b,c){var d=a("./core/template-list");b.exports=new d},{"./core/template-list":168
}],160:[function(a,b,c){var d=a("backbone"),e=d.Model.extend({VERSION:4,initialize:function(){},REPORT_ERROR_URL:"/api/v0/error",ERROR_TRACK_ENABLED:!1});b.exports=e},{backbone:1}],161:[function(a,b,c){var d=a("cdb"),e={queue:[],current:void 0,_script:null,head:null,loadScript:function(a){var b=document.createElement("script");return b.type="text/javascript",b.src=a,b.async=!0,e.head||(e.head=document.getElementsByTagName("head")[0]),setTimeout(function(){e.head.appendChild(b)},0),b},get:function(a,b){e._script?e.queue.push([a,b]):(e.current=b,e._script=e.loadScript(a+(~a.indexOf("?")?"&":"?")+"callback=vizjson"))},getPath:function(a){var b=document.getElementsByTagName("script"),c=/\/?cartodb[\-\._]?([\w\-\._]*)\.js\??/;for(i=0,len=b.length;i<len;i++){var d=b[i].src,e=d.match(c);if(e){var f=d.split("/");return delete f[f.length-1],f.join("/")+a}}return null},loadModule:function(a){var b="cartodb.mod."+a+(d.DEBUG?".uncompressed.js":".js"),c=this.getPath(b);if(!c)throw new Error("can't find cartodb.js file (no src path found for '"+b+"')");e.loadScript(c)}};window.vizjson=function(a){e.current&&e.current(a),e.head.removeChild(e._script),e._script=null;var b=e.queue.shift();b&&e.get(b[0],b[1])},b.exports=e},{cdb:157}],162:[function(a,b,c){var d,e=a("backbone"),f=a("cdb"),g=a("cdb.errors"),h=a("cdb.config"),i=function(){};if(i.prototype.error=function(){},i.prototype.log=function(){},"undefined"!=typeof console){d=console;try{d.log.apply(d,["cartodb.js "+f.VERSION])}catch(j){d=new i}}else d=new i;var k=e.Model.extend({error:function(){d.error.apply(d,arguments),h.ERROR_TRACK_ENABLED&&g.create({msg:Array.prototype.slice.call(arguments).join("")})},log:function(){d.log.apply(d,arguments)},info:function(){d.log.apply(d,arguments)},debug:function(){f.DEBUG&&d.log.apply(d,arguments)}});b.exports=k},{backbone:1,cdb:157,"cdb.config":155,"cdb.errors":156}],163:[function(a,b,c){var d=a("backbone"),e=a("./error"),f=d.Collection.extend({model:e,enableTrack:function(){var a=this,b=window.onerror;window.onerror=function(c,d,e){a.create({msg:c,url:d,line:e}),b&&b.apply(window,arguments)}}});b.exports=f},{"./error":164,backbone:1}],164:[function(a,b,c){var d=a("backbone"),e=a("jquery"),f=a("cdb.config"),g=d.Model.extend({url:function(){return f.REPORT_ERROR_URL},initialize:function(){this.set({browser:JSON.stringify(e.browser)})}});b.exports=g},{backbone:1,"cdb.config":155,jquery:57}],165:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("backbone"),g=f.Model.extend({initialize:function(a){return e.bindAll(this,"fetch","save","retrigger"),f.Model.prototype.initialize.call(this,a)},fetch:function(a){var b=this;this.trigger("loadModelStarted"),d.when(f.Model.prototype.fetch.call(this,a)).done(function(a){b.trigger("loadModelCompleted",a)}).fail(function(a){b.trigger("loadModelFailed",a)})},setIdAttribute:function(a){this.idAttribute=a},retrigger:function(a,b,c){c||(c=a);var d=this;b.bind&&b.bind(a,function(){d.trigger(c)},d)},save:function(a,b){var c=this;b&&b.silent||this.trigger("saving");var e=f.Model.prototype.save.apply(this,arguments);return d.when(e).done(function(){b&&b.silent||c.trigger("saved")}).fail(function(){b&&b.silent||c.trigger("errorSaving")}),e}});b.exports=g},{backbone:1,jquery:57,underscore:148}],166:[function(a,b,c){function d(){}function e(a){this.t0=null,this.name=a,this.count=0}var f=1024;d.metrics={},d._backend=null,d.get=function(a){return d.metrics[a]||{max:0,min:Number.MAX_VALUE,avg:0,total:0,count:0,last:0,history:"undefined"!=typeof Float32Array?new Float32Array(f):[]}},d.backend=function(a){d._backend=a},d.new_value=function(a,b,c,e){c=c||"i";var g=d.metrics[a]=d.get(a);if(g.max=Math.max(g.max,b),g.min=Math.min(g.min,b),g.total+=b,++g.count,g.avg=g.total/g.count,g.history[g.count%f]=b,e){var h=(new Date).getTime();h-g.last>1e3&&(d._backend&&d._backend([c,a,g.avg]),g.last=h)}else d._backend&&d._backend([c,a,b])},d.print_stats=function(){for(k in d.metrics){var a=d.metrics[k];console.log(" === "+k+" === "),console.log(" max: "+a.max),console.log(" min: "+a.min),console.log(" avg: "+a.avg),console.log(" count: "+a.count),console.log(" total: "+a.total)}},e.prototype={start:function(){return this.t0=+new Date,this},_elapsed:function(){return+new Date-this.t0},end:function(a){null!==this.t0&&(d.new_value(this.name,this._elapsed(),"t",a),this.t0=null)},inc:function(a){a=void 0===a?1:a,d.new_value(this.name,a,"i")},dec:function(a){a=void 0===a?1:a,d.new_value(this.name,a,"d")},mark:function(){if(++this.count,null===this.t0)return void this.start();var a=this._elapsed();a>1&&(d.new_value(this.name,this.count),this.count=0,this.start())}},d.metric=function(a){return new e(a)},b.exports=d},{}],167:[function(a,b,c){var d=a("html-css-sanitizer");d.html=function(a,b){return a?void 0===b?d.sanitize(a,function(a){return a}):"function"==typeof b?b(a):a:void 0},b.exports=d},{"html-css-sanitizer":317}],168:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("cdb.log"),g=a("./template"),h=e.Collection.extend({model:g,getTemplate:function(a){this.namespace&&(a=this.namespace+a);var b=this.find(function(b){return b.get("name")===a});return b?d.bind(b.render,b):(f.error(a+" not found"),null)}});b.exports=h},{"./template":169,backbone:1,"cdb.log":158,underscore:148}],169:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("mustache"),g=a("cdb.log"),h=e.Model.extend({initialize:function(){this.bind("change",this._invalidate),this._invalidate()},url:function(){return this.get("template_url")},parse:function(a){return{template:a}},_invalidate:function(){this.compiled=null,this.get("template_url")&&this.fetch()},compile:function(){var a=this.get("type")||"underscore",b=h.compilers[a];return b?b(this.get("template")):(g.error("can't get rendered for "+a),null)},render:function(a){var b=this.compiled=this.compiled||this.get("compiled")||this.compile(),c=b(a);return c},asFunction:function(){return d.bind(this.render,this)}},{compilers:{underscore:d.template,mustache:"undefined"==typeof f?null:function(a){return f.parse(a),function(b,c){return f.render(a,b,c)}}},compile:function(a,b){var c=new h({template:a,type:b||"underscore"});return d.bind(c.render,c)}});b.exports=h},{backbone:1,"cdb.log":158,mustache:59,underscore:148}],170:[function(a,b,c){var d={};d.isCORSSupported=function(){return"withCredentials"in new XMLHttpRequest},d.array2hex=function(a){for(var b=[],c=0;c<a.length;++c)b.push(String.fromCharCode(a[c]+128));return d.btoa(b.join(""))},d.btoa=function(a){return"function"==typeof window.btoa?d.encodeBase64Native(a):d.encodeBase64(a)},d.encodeBase64Native=function(a){return btoa(a)},d.encodeBase64=function(a){var b,c,d,e,f,g,h,i,j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",k=0,l=0,m="",n=[];if(!a)return a;do b=a.charCodeAt(k++),c=a.charCodeAt(k++),d=a.charCodeAt(k++),i=b<<16|c<<8|d,e=i>>18&63,f=i>>12&63,g=i>>6&63,h=63&i,n[l++]=j.charAt(e)+j.charAt(f)+j.charAt(g)+j.charAt(h);while(k<a.length);m=n.join("");var o=a.length%3;return(o?m.slice(0,o-3):m)+"===".slice(o||3)},d.uniqueCallbackName=function(a){return d._callback_c=d._callback_c||0,++d._callback_c,d.crc32(a)+"_"+d._callback_c},d.crc32=function(a){for(var b=d._crcTable||(d._crcTable=d._makeCRCTable()),c=-1,e=0,f=a.length;f>e;++e)c=c>>>8^b[255&(c^a.charCodeAt(e))];return(-1^c)>>>0},d._makeCRCTable=function(){for(var a,b=[],c=0;256>c;++c){a=c;for(var d=0;8>d;++d)a=1&a?3988292384^a>>>1:a>>>1;b[c]=a}return b},d._inferBrowser=function(a){function b(){var b=a.indexOf("MSIE "),c=a.indexOf("Trident/");return b>-1||c>-1}function c(){return document.compatMode?window.XMLHttpRequest?document.querySelector?document.addEventListener?window.atob?document.all?10:11:9:8:7:6:5}var d={};return a=a||"undefined"!=typeof window&&window.navigator.userAgent||"",b()?d.ie={version:c()}:a.indexOf("Edge/")>-1?d.edge=a:a.indexOf("Chrome")>-1?d.chrome=a:a.indexOf("Firefox")>-1?d.firefox=a:a.indexOf("Opera")>-1?d.opera=a:a.indexOf("Safari")>-1&&(d.safari=a),d},d.browser=d._inferBrowser(),d.isMobileDevice=function(){return/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},b.exports=d},{}],171:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("cdb.core.Profiler"),g=a("cdb.templates"),h=e.View.extend({classLabel:"cdb.core.View",constructor:function(a){this.options=d.defaults(a,this.options),this._models=[],this._subviews={},e.View.call(this,a),h.viewCount++,h.views[this.cid]=this,this._created_at=new Date,f.new_value("total_views",h.viewCount)},add_related_model:function(a){if(!a)throw"added non valid model";this._models.push(a)},addView:function(a){this._subviews[a.cid]=a,a._parent=this},removeView:function(a){delete this._subviews[a.cid]},clearSubViews:function(){d(this._subviews).each(function(a){a.clean()}),this._subviews={}},clean:function(){var a=this;return this.trigger("clean"),this.clearSubViews(),this._parent&&(this._parent.removeView(this),this._parent=null),this.remove(),this.unbind(),this.model&&this.model.unbind&&this.model.unbind(null,null,this),d(this._models).each(function(b){b.unbind(null,null,a)}),this._models=[],h.viewCount--,delete h.views[this.cid],this},getTemplate:function(a){return this.options.template?d.template(this.options.template):g.getTemplate(a)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},retrigger:function(a,b,c){c||(c=a);var d=this;b.bind&&b.bind(a,function(){d.trigger(c)},d),this.add_related_model(b)},killEvent:function(a){a&&a.preventDefault&&a.preventDefault(),a&&a.stopPropagation&&a.stopPropagation()},cleanTooltips:function(){this.$(".tipsy").remove()}},{viewCount:0,views:{},extendEvents:function(a){return function(){return d.extend(a,this.constructor.__super__.events)}},runChecker:function(){d.each(h.views,function(a){d.each(a,function(b,c){"_parent"!==c&&a.hasOwnProperty(c)&&b instanceof h&&void 0===a._subviews[b.cid]&&(console.log("========="),console.log("untracked view: "),console.log(b.el),console.log("parent"),console.log(a.el),console.log(" "))})})}});b.exports=h},{backbone:1,"cdb.core.Profiler":166,"cdb.templates":159,underscore:148}],172:[function(a,b,c){var d=a("underscore"),e=a("./dataview-model-base"),f=a("./category-dataview/search-model"),g=a("./category-dataview/category-model-range"),h=a("./category-dataview/categories-collection");b.exports=e.extend({defaults:d.extend({type:"category",filterEnabled:!1,allCategoryNames:[]},e.prototype.defaults),url:function(){var a=["bbox="+this._getBoundingBoxFilterParam(),"own_filter="+(this.get("filterEnabled")?1:0)];return this.get("url")+"?"+a.join("&")},initialize:function(a,b){e.prototype.initialize.call(this,a,b),this._rangeModel=new g,this._data=new h,this._searchModel=new f,this.on("change:column change:aggregation change:aggregation_column",this._reloadMapAndForceFetch,this),this.bind("change:url",function(){this._searchModel.set({url:this.get("url")})},this),this.once("change:url",function(){this._rangeModel.setUrl(this.get("url"))},this),this._rangeModel.bind("change:totalCount change:categoriesCount",function(){this.set({totalCount:this._rangeModel.get("totalCount"),categoriesCount:this._rangeModel.get("categoriesCount")})},this),this._bindSearchModelEvents()},_onMapBoundsChanged:function(){e.prototype._onMapBoundsChanged.apply(this,arguments),this._searchModel.fetchIfSearchIsApplied()},_bindSearchModelEvents:function(){this._searchModel.bind("loading",function(){this.trigger("loading",this)},this),this._searchModel.bind("loaded",function(){this.trigger("loaded",this)},this),this._searchModel.bind("error",function(a){(!a||a&&"abort"!==a.statusText)&&this.trigger("error",this)},this),this._searchModel.bind("change:data",this._onSearchDataChange,this)},_onSearchDataChange:function(){this.getSearchResult().each(function(a){var b=this.filter.isAccepted(a.get("name"));a.set("selected",b)},this),this.trigger("change:searchData",this)},_shouldFetchOnBoundingBoxChange:function(){return e.prototype._shouldFetchOnBoundingBoxChange.call(this)&&!this.isSearchApplied()},enableFilter:function(){this.set("filterEnabled",!0)},disableFilter:function(){this.set("filterEnabled",!1)},getSearchQuery:function(){return this._searchModel.getSearchQuery()},setSearchQuery:function(a){this._searchModel.set("q",a)},isSearchValid:function(){return this._searchModel.isValid()},getSearchResult:function(){return this._searchModel.getData()},getSearchCount:function(){return this._searchModel.getCount()},applySearch:function(){this._searchModel.fetch()},isSearchApplied:function(){return this._searchModel.isSearchApplied()},cleanSearch:function(){this._searchModel.resetData()},setupSearch:function(){this.isSearchApplied()||this._searchModel.setData(this._data.toJSON())},getData:function(){return this._data},getSize:function(){return this._data.size()},getCount:function(){return this.get("categoriesCount")},isOtherAvailable:function(){return this._data.isOtherAvailable()},numberOfAcceptedCategories:function(){var a=this.filter.acceptedCategories,b=this.numberOfRejectedCategories(),c=this.getData(),d=c.size(),e=c.reduce(function(b,c){var d=a.where({name:c.get("name")}).length>0;return b+(d?1:0)},0);return b?d-b:e},numberOfRejectedCategories:function(){var a=this.filter.rejectedCategories,b=this.getData();return b.reduce(function(b,c){var d=a.where({name:c.get("name")}).length>0;return b+(d?1:0)},0)},refresh:function(){this.isSearchApplied()?this._searchModel.fetch():this.fetch()},parse:function(a){var b=[],c={},e=a.categories,f=[],g=[];return d.each(e,function(a){var d=String(a.category);f.push(d);var e=this.filter.isRejected(d);c[d]=!0,b.push({selected:!e,name:d,agg:a.agg,value:a.value})},this),this.get("filterEnabled")&&this.filter.acceptedCategories.each(function(a){var d=a.get("name");g.push(d),c[d]||b.push({selected:!0,name:d,agg:!1,value:0})},this),this._data.reset(b),{allCategoryNames:d.chain(f).union(g).unique().value(),data:b,nulls:a.nulls,min:a.min,max:a.max,count:a.count}},toJSON:function(){return{type:"aggregation",options:{column:this.get("column"),aggregation:this.get("aggregation"),aggregationColumn:this.get("aggregation_column")}}}},{ATTRS_NAMES:e.ATTRS_NAMES.concat(["column","aggregation","aggregation_column"])})},{"./category-dataview/categories-collection":173,"./category-dataview/category-model-range":175,"./category-dataview/search-model":176,"./dataview-model-base":177,underscore:148}],173:[function(a,b,c){var d=a("backbone"),e=a("./category-item-model");b.exports=d.Collection.extend({model:e,comparator:function(a,b){return"Other"===a.get("name")?1:"Other"===b.get("name")?-1:a.get("value")===b.get("value")?a.get("selected")<b.get("selected")?1:-1:a.get("value")<b.get("value")?1:-1},isOtherAvailable:function(){return this.where({agg:!0,name:"Other"}).length>0}})},{"./category-item-model":174,backbone:1}],174:[function(a,b,c){var d=a("../../core/model");b.exports=d.extend({defaults:{name:"",agg:!1,value:0}})},{"../../core/model":165}],175:[function(a,b,c){var d=a("underscore"),e=a("../../core/model");b.exports=e.extend({defaults:{url:"",totalCount:0,categoriesCount:0},url:function(){return this.get("url")},initialize:function(){this.bind("change:url",function(){this.fetch()},this)},setUrl:function(a){this.set("url",a)},parse:function(a){return{categoriesCount:a.categoriesCount,totalCount:d.reduce(d.pluck(a.categories,"value"),function(a,b){return a+b},0)}}})},{"../../core/model":165,underscore:148}],176:[function(a,b,c){var d=a("underscore"),e=a("../../core/model"),f=a("../../util/backbone-abort-sync"),g=a("./categories-collection");b.exports=e.extend({defaults:{q:"",data:[],url:""},url:function(){return this.get("url")+"/search?q="+encodeURIComponent(this.get("q"))},initialize:function(a,b){this._data=new g,this.sync=f.bind(this)},fetchIfSearchIsApplied:function(){this.isSearchApplied()&&this.fetch()},setData:function(a){var b=this._parseData(a);this._data.reset(b),this.set("data",b)},getData:function(){return this._data},getSize:function(){return this._data.size()},getCount:function(){return this.getSize()},isValid:function(){var a=this.get("q");return!!a},resetData:function(){this.setData([]),this.set("q","")},getSearchQuery:function(){return this.get("q")},isSearchApplied:function(){return this.isValid()&&this.getSize()>0},_parseData:function(a){var b=[];return d.each(a,function(a){a.agg||b.push({selected:!1,name:(a.category||a.name).toString(),agg:a.agg,value:a.value})},this),b},parse:function(a){var b=this._parseData(a.categories);return this._data.reset(b),{data:b}},fetch:function(a){if(a=a||{},this.trigger("loading",this),a.success)var b=a&&a.success;return e.prototype.fetch.call(this,d.extend(a,{success:function(){b&&b(arguments),this.trigger("loaded",this)}.bind(this),error:function(a,b){(!b||b&&"abort"!==b.statusText)&&this.trigger("error",a,b)}.bind(this)}))}})},{"../../core/model":165,"../../util/backbone-abort-sync":294,"./categories-collection":173,underscore:148}],177:[function(a,b,c){var d=a("underscore"),e=a("../core/model"),f=a("../util/backbone-abort-sync"),g=a("../windshaft/filters/bounding-box"),h=500;b.exports=e.extend({defaults:{url:"",data:[],sync_on_data_change:!0,sync_on_bbox_change:!0,enabled:!0},url:function(){var a=["bbox="+this._getBoundingBoxFilterParam()];return this.get("url")+"?"+a.join("&")},_getBoundingBoxFilterParam:function(){var a=new g(this._map.getViewBounds());return a.toString()},initialize:function(a,b){if(a=a||{},b=b||{},!b.map)throw new Error("map is required");if(!b.windshaftMap)throw new Error("windshaftMap is required");a.id||this.set("id",this.defaults.type+"-"+this.cid),this.layer=b.layer,this._map=b.map,this._windshaftMap=b.windshaftMap,this.sync=f.bind(this),this.filter=b.filter,this.filter&&this.filter.set("dataviewId",this.id);var c=this.layer.getDataProvider();c&&(this._dataProvider=c.createDataProviderForDataview(this)),this._initBinds()},_initBinds:function(){this.listenTo(this._windshaftMap,"instanceCreated",this._onNewWindshaftMapInstance),this.listenTo(this.layer,"change:visible",this._onLayerVisibilityChanged),this._dataProvider?(this.listenToOnce(this._dataProvider,"dataChanged",this._onChangeBinds,this),this.listenTo(this._dataProvider,"dataChanged",this._onDataProviderChanged)):this.listenToOnce(this,"change:url",function(){this.fetch({success:this._onChangeBinds.bind(this)})}),this.filter&&this.listenTo(this.filter,"change",this._onFilterChanged)},_onDataProviderChanged:function(){this.set(this.parse(this._dataProvider.getData()))},_onFilterChanged:function(a){this._dataProvider?this._dataProvider.applyFilter(a):this._reloadMap()},_reloadMap:function(a){a=a||{},this._map.reload(d.extend(a,{sourceLayerId:this.layer.get("id")}))},_reloadMapAndForceFetch:function(){this._reloadMap({forceFetch:!0})},_onNewWindshaftMapInstance:function(a,b,c){var d=a.getDataviewURL({dataviewId:this.get("id"),protocol:"https:"===window.location.protocol?"https":"http"});if(d){var e=b&&b!==this.layer.get("id");this.set("url",d,{silent:e,forceFetch:c}),this.get("sync_on_data_change")&&(this._newDataAvailable=!0)}},_onLayerVisibilityChanged:function(a,b){this.set({enabled:b})},_onChangeBinds:function(){this.listenTo(this._map,"change:center change:zoom",d.debounce(this._onMapBoundsChanged.bind(this),h)),this.on("change:url",function(a,b,c){(c&&c.forceFetch||this._shouldFetchOnURLChange())&&this.fetch()},this),this.on("change:enabled",function(a,b){b&&this._newDataAvailable&&(this.fetch(),this._newDataAvailable=!1)},this)},_onMapBoundsChanged:function(){this._shouldFetchOnBoundingBoxChange()&&this.fetch(),this.get("sync_on_bbox_change")&&(this._newDataAvailable=!0)},_shouldFetchOnURLChange:function(){return this.get("sync_on_data_change")&&this.get("enabled")},_shouldFetchOnBoundingBoxChange:function(){return this.get("enabled")&&this.get("sync_on_bbox_change")},refresh:function(){this.fetch()},update:function(a){a=d.pick(a,this.constructor.ATTRS_NAMES),this.set(a)},getData:function(){return this.get("data")},getPreviousData:function(){return this.previous("data")},fetch:function(a){if(a=a||{},!this._dataProvider){if(this.trigger("loading",this),a.success)var b=a&&a.success;return e.prototype.fetch.call(this,d.extend(a,{success:function(){b&&b(arguments),this.trigger("loaded",this)}.bind(this),error:function(a,b){(!b||b&&"abort"!==b.statusText)&&this.trigger("error",a,b)}.bind(this)}))}this.set(this.parse(this._dataProvider.getData()))},toJSON:function(){throw new Error("toJSON should be defined for each dataview")},remove:function(){this.filter&&this.filter.remove(),this.trigger("destroy",this),this.stopListening()}},{ATTRS_NAMES:["id","sync_on_data_change","sync_on_bbox_change","enabled"]})},{"../core/model":165,"../util/backbone-abort-sync":294,"../windshaft/filters/bounding-box":308,underscore:148}],178:[function(a,b,c){var d=a("backbone");b.exports=d.Collection.extend({initialize:function(){this.bind("change:histogram_sizes",function(a,b){b&&this.each(function(b){b!==a&&b.get("histogram_sizes")&&b.set("histogram_sizes",!1)})},this)}})},{backbone:1}],179:[function(a,b,c){function d(a,b){e.each(b,function(b){if(void 0===a[b])throw new Error(b+" is required")})}var e=a("underscore"),f=a("../core/model"),g=a("../windshaft/filters/category"),h=a("../windshaft/filters/range"),i=a("./category-dataview-model"),j=a("./formula-dataview-model"),k=a("./histogram-dataview-model"),l=a("./list-dataview-model");b.exports=f.extend({initialize:function(a,b){if(!b.map)throw new Error("map is required");if(!b.windshaftMap)throw new Error("windshaftMap is required");if(!b.dataviewsCollection)throw new Error("dataviewsCollection is required");if(!b.layersCollection)throw new Error("layersCollection is required");this._map=b.map,this._windshaftMap=b.windshaftMap,this._dataviewsCollection=b.dataviewsCollection,this._layersCollection=b.layersCollection},createCategoryModel:function(a,b){d(b,["column"]);var c=new g({layer:a});return b=e.pick(b,i.ATTRS_NAMES),b.aggregation=b.aggregation||"count",b.aggregation_column=b.aggregation_column||b.column,this._newModel(new i(b,{map:this._map,windshaftMap:this._windshaftMap,filter:c,layer:a}))},createFormulaModel:function(a,b){return d(b,["column","operation"]),b=e.pick(b,j.ATTRS_NAMES),this._newModel(new j(b,{map:this._map,windshaftMap:this._windshaftMap,layer:a}))},createHistogramModel:function(a,b){d(b,["column"]);var c=new h({layer:a});return b=e.pick(b,k.ATTRS_NAMES),this._newModel(new k(b,{map:this._map,windshaftMap:this._windshaftMap,filter:c,layer:a}))},createListModel:function(a,b){return d(b,["columns"]),b=e.pick(b,l.ATTRS_NAMES),this._newModel(new l(b,{map:this._map,windshaftMap:this._windshaftMap,layer:a}))},_newModel:function(a){return this._dataviewsCollection.add(a),a}})},{"../core/model":165,"../windshaft/filters/category":309,"../windshaft/filters/range":311,"./category-dataview-model":172,"./formula-dataview-model":180,"./histogram-dataview-model":181,"./list-dataview-model":183,underscore:148}],180:[function(a,b,c){var d=a("underscore"),e=a("./dataview-model-base");b.exports=e.extend({defaults:d.extend({type:"formula",data:""},e.prototype.defaults),initialize:function(){e.prototype.initialize.apply(this,arguments),this.on("change:column change:operation",this._reloadMapAndForceFetch,this)},parse:function(a){return{data:a.result,nulls:a.nulls}},toJSON:function(){return{type:"formula",options:{column:this.get("column"),operation:this.get("operation")}}}},{ATTRS_NAMES:e.ATTRS_NAMES.concat(["column","operation"])})},{"./dataview-model-base":177,underscore:148}],181:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./dataview-model-base"),g=a("./histogram-dataview/histogram-data-model");b.exports=f.extend({defaults:d.extend({type:"histogram",bins:10},f.prototype.defaults),url:function(){var a=["bbox="+this._getBoundingBoxFilterParam()];this.get("column_type")&&a.push("column_type="+this.get("column_type")),d.isNumber(this.get("own_filter"))?a.push("own_filter="+this.get("own_filter")):(d.isNumber(this.get("start"))&&a.push("start="+this.get("start")),d.isNumber(this.get("end"))&&a.push("end="+this.get("end")),d.isNumber(this.get("bins"))&&a.push("bins="+this.get("bins")));var b=this.get("url");return a.length>0&&(b+="?"+a.join("&")),b},initialize:function(a,b){f.prototype.initialize.apply(this,arguments),this._data=new e.Collection(this.get("data")),this._unfilteredData=new g({bins:this.get("bins")}),this._unfilteredData.bind("change:data",function(a,b){this.set({start:a.get("start"),end:a.get("end"),bins:a.get("bins")},{silent:!0}),this._onChangeBinds()},this),this.once("change:url",function(){this._unfilteredData.setUrl(this.get("url"))},this),this.listenTo(this.layer,"change:meta",this._onChangeLayerMeta),this.on("change:column",this._reloadMapAndForceFetch,this),this.on("change:bins change:start change:end",this._fetchAndResetFilter,this)},_initBinds:function(){f.prototype._initBinds.apply(this),this.stopListening(this,"change:url",null)},enableFilter:function(){this.set("own_filter",1)},disableFilter:function(){this.unset("own_filter")},getData:function(){return this._data.toJSON()},getUnfilteredDataModel:function(){return this._unfilteredData},getSize:function(){return this._data.size()},parse:function(a){var b=a.bins_count,c=a.bin_width,e=a.bins_start,f=new Array(b);d.each(a.bins,function(a){f[a.bin]=a});for(var g=0;b>g;g++)f[g]=d.extend({bin:g,start:e+g*c,end:e+(g+1)*c,freq:0},f[g]);var h=f[b-1];return h&&h.end<h.max&&(h.end=h.max),this._data.reset(f),{data:f,nulls:a.nulls}},toJSON:function(a){return{type:"histogram",options:{column:this.get("column"),bins:this.get("bins")}}},_onChangeLayerMeta:function(){this.filter.set("column_type",this.layer.get("meta").column_type)},_onChangeBinds:function(){f.prototype._onChangeBinds.call(this),this.bind("change:histogram_sizes",function(a,b,c){b&&this.trigger("histogram_sizes",this)},this)},_fetchAndResetFilter:function(){this.fetch(),this.disableFilter(),this.filter.unsetRange()}},{ATTRS_NAMES:f.ATTRS_NAMES.concat(["column","column_type","bins"])})},{"./dataview-model-base":177,"./histogram-dataview/histogram-data-model":182,backbone:1,underscore:148}],182:[function(a,b,c){var d=a("underscore"),e=a("../../core/model");b.exports=e.extend({defaults:{url:"",data:[]},url:function(){return this.get("url")+"?bins="+this.get("bins")},initialize:function(){this.bind("change:url change:bins",function(){this.fetch()},this)},setUrl:function(a){if(!a)throw new Error("url not specified");this.set("url",a)},setBins:function(a){if(!a)throw new Error("bins not specified");this.set("bins",a)},getData:function(){return this.get("data")},parse:function(a){var b=a.bins_count,c=a.bin_width,e=a.bins_start,f=new Array(b);d.each(a.bins,function(a){f[a.bin]=a});for(var g=0;b>g;g++)f[g]=d.extend({bin:g,start:e+g*c,end:e+(g+1)*c,freq:0},f[g]);return{data:f,start:f[0].start,end:f[f.length-1].end,bins:b}}})},{"../../core/model":165,underscore:148}],183:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./dataview-model-base");b.exports=f.extend({defaults:d.extend({type:"list",columns:[]},f.prototype.defaults),initialize:function(a,b){f.prototype.initialize.call(this,a,b),this._data=new e.Collection(this.get("data")),this.on("change:columns",this._reloadMapAndForceFetch,this)},getData:function(){return this._data},getSize:function(){return this._data.size()},parse:function(a){var b=a.rows;return this._data.reset(b),{data:b}},toJSON:function(){return{type:"list",options:{columns:this.get("columns")}}}},{ATTRS_NAMES:f.ATTRS_NAMES.concat(["columns"])})},{"./dataview-model-base":177,backbone:1,underscore:148}],184:[function(a,b,c){function d(){this.visible=!0,this.interactionEnabled=[]}a("underscore");d.prototype={show:function(){this.setOpacity(void 0===this.options.previous_opacity?.99:this.options.previous_opacity),delete this.options.previous_opacity,this._interactionDisabled=!1,this.visible=!0},hide:function(){void 0==this.options.previous_opacity&&(this.options.previous_opacity=this.options.opacity),this.setOpacity(0),this._interactionDisabled=!0,this.visible=!1},toggle:function(){return this.isVisible()?this.hide():this.show(),this.isVisible()},isVisible:function(){return this.visible},setInteraction:function(a,b){void 0==b&&(b=a,a=0);var c;if(this.interactionEnabled[a]=b,b){if(this.model.get("urls")){var d=+a,e=this.model.getTileJSONFromTiles(d);c=this.interaction[a],c&&c.remove();var f=this;this.interaction[a]=this.interactionClass().map(this.options.map).tilejson(e).on("on",function(b){f._interactionDisabled||(b.layer=+a,f._manageOnEvents(f.options.map,b))}).on("off",function(b){f._interactionDisabled||(b=b||{},b.layer=+a,f._manageOffEvents(f.options.map,b))})}}else c=this.interaction[a],c&&(c.remove(),this.interaction[a]=null);return this},error:function(a){},tilesOk:function(){},_reloadInteraction:function(){this._clearInteraction(),this.model.layers.each(function(a,b){a.hasInteraction()&&this.setInteraction(b,!0)}.bind(this))},_clearInteraction:function(){for(var a in this.interactionEnabled)this.interactionEnabled.hasOwnProperty(a)&&this.interactionEnabled[a]&&this.setInteraction(a,!1)}},b.exports=d},{underscore:148}],185:[function(a,b,c){var d=a("./cartodb-layer-group-base"),e=d.extend({defaults:{type:"layergroup"},_getIndexOfVisibleLayer:function(a){var b={},c=0;this.layers.each(function(a,d){a.isVisible()&&(b[d]=c,c++)});var d=b[a];return void 0===d&&(d=-1),d}});b.exports=e},{"./cartodb-layer-group-base":186}],186:[function(a,b,c){var d=a("jquery"),e=a("backbone"),f=a("cdb.core.util"),g=e.Model.extend({defaults:{visible:!0},initialize:function(a,b){if(b=b||{},!b.windshaftMap)throw new Error("windshaftMap option is required");this.layers=new e.Collection(b.layers||[]),this._windshaftMap=b.windshaftMap,this._windshaftMap.bind("instanceCreated",function(a){this.set({baseURL:a.getBaseURL(),urls:a.getTiles("mapnik")})},this)},isEqual:function(){return!1},getTileJSONFromTiles:function(a){var b=this.get("urls");if(!b)throw new Error("tileJSON for the layer cannot be calculated until urls are set");return{tilejson:"2.0.0",scheme:"xyz",grids:b.grids[this._getIndexOfVisibleLayer(a)],tiles:b.tiles,formatter:function(a,b){return b}}},_getIndexOfVisibleLayer:function(a){throw new Error("_getIndexOfVisibleLayer must be implemented")},fetchAttributes:function(a,b,c){if(!this.get("baseURL"))throw new Error("Attributes cannot be fetched until baseURL is set");var e=this._getIndexOfVisibleLayer(a);if(e>=0){var g=[this.get("baseURL"),e,"attributes",b].join("/");d.ajax({dataType:"jsonp",url:g,jsonpCallback:"_cdbi_layer_attributes_"+f.uniqueCallbackName(this.toJSON()),cache:!0,success:function(a){c(a)},error:function(a){c(null)}})}else c(null)}});b.exports=g},{backbone:1,"cdb.core.util":170,jquery:57}],187:[function(a,b,c){var d=a("./cartodb-layer-group-base"),e=d.extend({defaults:{type:"namedmap"},_getIndexOfVisibleLayer:function(a){return++a}});b.exports=e},{"./cartodb-layer-group-base":186}],188:[function(a,b,c){var d=a("underscore"),e=a("./geojson-data-provider-base"),f=function(a,b){e.apply(this,arguments)};d.extend(f.prototype,e.prototype),f.prototype.getData=function(){var a,b=this._dataview.attributes,c=b.column,e=b.filterEnabled,f=5,g=this._vectorLayerView.getFilter(this._layerIndex);a=e?g.getValues():g.getValues(!1,c);var h={categories:[],categoriesCount:0,count:0,max:0,min:0,nulls:0,type:"aggregation"};if(!a.length)return h;var i=d.groupBy(a,function(a){return a.properties[c]}),j=d.map(Object.keys(i),function(a){return{key:a,value:i[a].length}}),k=d.sortBy(j,function(a){return a.value}).reverse();h.count=a.length,h.categoriesCount=k.length,h.max=k[0].value,h.min=k[k.length-1].value,h.nulls=g.getValues(!1,c).reduce(function(a,b){return a+(null===b.properties[c]?1:0)},0),d.each(k.slice(0,f),function(a){h.categories.push({category:a.key,value:a.value,agg:!1})});var l=k.slice(f);if(!e&&l.length>0){var m={category:"Other",value:l.reduce(function(a,b){return a+b.value},0),agg:!0};h.categories.push(m)}return h},f.prototype.applyFilter=function(a){var b,c,d=this._dataview.get("column");
a.isEmpty()?(b="accept",c={column:d,values:"all"}):a.get("rejectAll")?(b="reject",c={column:d,values:"all"}):a.acceptedCategories.size()?(b="accept",c={column:d,values:a.getAcceptedCategoryNames()}):a.rejectedCategories.size()&&(b="reject",c={column:d,values:a.getRejectedCategoryNames()}),this._vectorLayerView.applyFilter(this._layerIndex,b,c)},b.exports=f},{"./geojson-data-provider-base":190,underscore:148}],189:[function(a,b,c){var d=a("underscore"),e=a("./geojson-data-provider-base"),f=function(a,b){e.apply(this,arguments)};d.extend(f.prototype,e.prototype),f.prototype.getData=function(){var a,b=this._vectorLayerView.getFilter(this._layerIndex),c=this._dataview.attributes,d=b.getValues(),e=c.operation,f=c.column,g=d.reduce(function(a,b){return a+(null===b.properties[f]?1:0)},0);if("count"===e)a=d.length;else if("avg"===e)a=d.reduce(function(a,b){return a+b.properties[f]},0)/d.length;else if("sum"===e)a=d.reduce(function(a,b){return a+b.properties[f]},0);else if("min"===e)a=d.reduce(function(a,b){return Math.min(a,b.properties[f])},1/0);else{if("max"!==e)throw new Error("Coudn't generate data for formula dataview and '"+e+"' operation.");a=d.reduce(function(a,b){return Math.max(a,b.properties[f])},0)}var h={operation:e,result:a,nulls:g,type:"formula"};return h},b.exports=f},{"./geojson-data-provider-base":190,underscore:148}],190:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=function(a){this._dataview=a.dataview,this._vectorLayerView=a.vectorLayerView,this._layerIndex=a.layerIndex,this._vectorLayerView._on("featuresChanged",function(){this.trigger("dataChanged",this.getData())}.bind(this))};f.prototype.getData=function(){throw new Error("Subclasses of GeoJSONDataProviderBase must implement .getData")},f.prototype.applyFilter=function(){},d.extend(f.prototype,e.Events),b.exports=f},{backbone:1,underscore:148}],191:[function(a,b,c){var d=a("./histogram-geojson-data-provider"),e=a("./category-geojson-data-provider"),f=a("./formula-geojson-data-provider"),g=a("./list-geojson-data-provider"),h=function(a,b){this._vectorLayerView=a,this._layerIndex=b};h.prototype._dataProviderMap={histogram:d,category:e,formula:f,list:g},h.prototype.createDataProviderForDataview=function(a){var b={dataview:a,vectorLayerView:this._vectorLayerView,layerIndex:this._layerIndex},c=this._dataProviderMap[a.get("type")];if(c)return new c(b);throw new Error("Couldn't create data provider for dataview of type "+a.get("type"))},b.exports=h},{"./category-geojson-data-provider":188,"./formula-geojson-data-provider":189,"./histogram-geojson-data-provider":192,"./list-geojson-data-provider":193}],192:[function(a,b,c){var d=a("d3"),e=a("underscore"),f=a("./geojson-data-provider-base"),g=function(a,b){f.apply(this,arguments)};e.extend(g.prototype,f.prototype),g.prototype.getData=function(){var a,b,c,e,f,g=this._dataview.attributes,h=this._vectorLayerView.getFilter(this._layerIndex),i=g.column,j=g.bins||g.data.length;1===g.own_filter?(a=h.getMax(i),b=h.getMin(i),f=h.getValues(),c=d.layout.histogram().range([b,a])(f.map(function(a){return a.properties[g.column]})),e=(a-b)/c.length):(a=g.end||h.getMax(i),b="number"==typeof g.start?g.start:h.getMin(i),e=(a-b)/g.bins,f=h.getValues(!1,i),c=d.layout.histogram().range([b,a]).bins(j)(f.map(function(a){return a.properties[g.column]}))),c=c.map(function(a,b){return{bin:b,max:d.max(a),min:d.min(a),avg:d.mean(a),freq:a.length}});var k=f.reduce(function(a,b){return a+(null===b.properties[i]?1:0)},0),l=c.reduce(function(a,b){return a+b.avg},0)/c.reduce(function(a,b){return a+b.freq},0),m={bin_width:e,bins_count:c.length,bins_start:b,nulls:k,avg:l,bins:c,type:"histogram"};return m},g.prototype.applyFilter=function(a){var b,c=this._dataview.get("column");b=a.isEmpty()?{column:c,min:0,max:1/0}:{column:c,min:a.get("min"),max:a.get("max")},this._vectorLayerView.applyFilter(this._layerIndex,"range",b)},b.exports=g},{"./geojson-data-provider-base":190,d3:56,underscore:148}],193:[function(a,b,c){var d=a("underscore"),e=a("./geojson-data-provider-base"),f=function(a,b){e.apply(this,arguments)};d.extend(f.prototype,e.prototype),f.prototype.getData=function(a){},f.prototype.applyFilter=function(a){},b.exports=f},{"./geojson-data-provider-base":190,underscore:148}],194:[function(a,b,c){var d=a("jquery"),e={keys:{app_id:"KuYppsdXZznpffJsKT24",app_code:"A7tBPacePg9Mj_zghvKt9Q"},geocode:function(a,b){a=a.toLowerCase().replace(/é/g,"e").replace(/á/g,"a").replace(/í/g,"i").replace(/ó/g,"o").replace(/ú/g,"u");var c="";-1===location.protocol.indexOf("http")&&(c="http:"),d.getJSON(c+"//places.nlp.nokia.com/places/v1/discover/search/?q="+encodeURIComponent(a)+"&app_id="+this.keys.app_id+"&app_code="+this.keys.app_code+"&Accept-Language=en-US&at=0,0&callback=?",function(a){var c=[];if(a&&a.results&&a.results.items&&a.results.items.length>0){var d=a.results.items;for(var e in d){var f,g=d[e];f={lat:g.position[0],lon:g.position[1]},g.bbox&&(f.boundingbox={north:g.bbox[3],south:g.bbox[1],east:g.bbox[2],west:g.bbox[0]}),g.category&&(f.type=g.category.id),g.title&&(f.title=g.title),c.push(f)}}b&&b.call(this,c)})}};b.exports=e},{jquery:57}],195:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f={keys:{app_id:"nLQPTdTV34FB9L3yK2dCXydWXRv3ZKzyu_BdCSrmCBAM1HgGErsCyCbBbVP2Yg--"},geocode:function(a,b){a=a.toLowerCase().replace(/é/g,"e").replace(/á/g,"a").replace(/í/g,"i").replace(/ó/g,"o").replace(/ú/g,"u").replace(/ /g,"+");var c="";-1===location.protocol.indexOf("http")&&(c="http:"),e.getJSON(c+"//query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('SELECT * FROM json WHERE url="http://where.yahooapis.com/geocode?q='+a+"&appid="+this.keys.app_id+'&flags=JX"')+"&format=json&callback=?",function(a){var c=[];if(a&&a.query&&a.query.results&&a.query.results.json&&a.query.results.json.ResultSet&&"0"!=a.query.results.json.ResultSet.Found){var e;e=d.isArray(a.query.results.json.ResultSet.Results)?a.query.results.json.ResultSet.Results:[a.query.results.json.ResultSet.Results];for(var f in e){var g,h=e[f];g={lat:h.latitude,lon:h.longitude},h.boundingbox&&(g.boundingbox=h.boundingbox),c.push(g)}}b(c)})}};b.exports=f},{jquery:57,underscore:148}],196:[function(a,b,c){function d(){}var e=a("underscore"),f=a("backbone");e.extend(d.prototype,f.Events,{edit:function(){throw new Error("to be implemented")}}),b.exports=d},{backbone:1,underscore:148}],197:[function(a,b,c){var d=a("../core/model"),e=d.extend({isPoint:function(){var a=this.get("geojson").type;return!(!a||"point"!==a.toLowerCase())}});b.exports=e},{"../core/model":165}],198:[function(a,b,c){var d={};"undefined"!=typeof window.google&&"undefined"!=typeof window.google.maps&&(d={gmaps:{PointView:a("./gmaps/gmaps-point-view"),PathView:a("./gmaps/gmaps-path-view")},GoogleMapsMapView:a("./gmaps/gmaps-map-view"),GMapsTiledLayerView:a("./gmaps/gmaps-tiled-layer-view"),GMapsLayerView:a("./gmaps/gmaps-layer-view"),GMapsPlainLayerView:a("./gmaps/gmaps-plain-layer-view"),GMapsBaseLayerView:a("./gmaps/gmaps-base-layer-view"),GMapsCartoDBLayerGroupView:a("./gmaps/gmaps-cartodb-layer-group-view")}),b.exports=d},{"./gmaps/gmaps-base-layer-view":200,"./gmaps/gmaps-cartodb-layer-group-view":201,"./gmaps/gmaps-layer-view":204,"./gmaps/gmaps-map-view":205,"./gmaps/gmaps-path-view":206,"./gmaps/gmaps-plain-layer-view":207,"./gmaps/gmaps-point-view":208,"./gmaps/gmaps-tiled-layer-view":209}],199:[function(a,b,c){var d=a("cdb.config"),e={opacity:.99,attribution:d.get("cartodb_attributions"),debug:!1,visible:!0,added:!1,tiler_domain:"cartodb.com",tiler_port:"80",tiler_protocol:"http",sql_api_domain:"cartodb.com",sql_api_port:"80",sql_api_protocol:"http",extra_params:{},cdn_url:null,subdomains:null};b.exports=e},{"cdb.config":155}],200:[function(a,b,c){var d=a("underscore"),e=a("./gmaps-default-map-style"),f=a("./gmaps-layer-view"),g=function(a,b){f.call(this,a,null,b)};d.extend(g.prototype,f.prototype,{_update:function(){var a=this.model,b={roadmap:google.maps.MapTypeId.ROADMAP,gray_roadmap:google.maps.MapTypeId.ROADMAP,dark_roadmap:google.maps.MapTypeId.ROADMAP,hybrid:google.maps.MapTypeId.HYBRID,satellite:google.maps.MapTypeId.SATELLITE,terrain:google.maps.MapTypeId.TERRAIN};this.gmapsMap.setOptions({mapTypeId:b[a.get("base_type")]}),this.gmapsMap.setOptions({styles:a.get("style")||e})},remove:function(){}}),b.exports=g},{"./gmaps-default-map-style":202,"./gmaps-layer-view":204,underscore:148}],201:[function(a,b,c){function d(a,b){var c=Math.round(100*b);c>=99?a.style.filter=l:a.style.filter="alpha(opacity="+b+");"}var e=a("underscore"),f=a("./gmaps-layer-view"),g=a("wax.cartodb.js"),h=a("./cartodb-default-options"),i=a("./projector"),j=a("../cartodb-layer-common"),k=a("cdb.core.Profiler"),l="progid:DXImageTransform.Microsoft.gradient(startColorstr=#00FFFFFF,endColorstr=#00FFFFFF)",m=function(a,b){var c=this,d=[];e.bindAll(this,"featureOut","featureOver","featureClick");var k=e.clone(a.attributes);k.map=b;var l,m=k.featureOver,n=k.featureOut,o=k.featureClick,p=-1;k.featureOver=function(a,b,e,f,g){d[g]||c.trigger("layerenter",a,b,e,f,g),d[g]=1,m&&m.apply(this,arguments),c.featureOver&&c.featureOver.apply(this,arguments),a.timeStamp===l&&clearTimeout(p),p=setTimeout(function(){c.trigger("mouseover",a,b,e,f,g),c.trigger("layermouseover",a,b,e,f,g)},0),l=a.timeStamp},k.featureOut=function(a,b){d[b]&&c.trigger("layermouseout",b),d[b]=0,e.any(d)||c.trigger("mouseout"),n&&n.apply(this,arguments),c.featureOut&&c.featureOut.apply(this,arguments)},k.featureClick=e.debounce(function(){o&&o.apply(this,arguments),c.featureClick&&c.featureClick.apply(k,arguments)},10),this.options=e.defaults(k,h),this.tiles=0,this.tilejson=null,this.interaction=[],a.bind("change:urls",function(){this.update()},this),g.g.connector.call(this,k),e.extend(this.options,k),f.call(this,a,this,b),this.projector=new i(k.map),j.call(this)};m.prototype=new g.g.connector,m.prototype.interactionClass=g.g.interaction,e.extend(m.prototype,m.prototype,j.prototype,m.prototype,f.prototype,{reload:function(){this.model.invalidate()},remove:function(){f.prototype.remove.call(this),this.clear()},featureOver:function(a,b,c,d,e){this.trigger("featureOver",a,[b.lat(),b.lng()],c,d,e)},featureOut:function(a,b){this.trigger("featureOut",a,b)},featureClick:function(a,b,c,d,e){this.trigger("featureClick",a,[b.lat(),b.lng()],c,d,e)},error:function(a){this.model&&(this.model.trigger("error",a?a.errors:"unknown error"),this.model.trigger("tileError",a?a.errors:"unknown error"))},ok:function(a){this.model.trigger("tileOk")},tilesOk:function(a){this.model.trigger("tileOk")},loading:function(){this.trigger("loading")},finishLoading:function(){this.trigger("load")},setOpacity:function(a){if(isNaN(a)||a>1||0>a)throw new Error(a+" is not a valid value, should be in [0, 1] range");this.opacity=this.options.opacity=a;for(var b in this.cache){var c=this.cache[b];c.style.opacity=a,d(c,a)}},getTile:function(a,b,c){var e="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",f=this,h="ActiveXObject"in window,i=h&&!document.addEventListener;if(this.options.added=!0,null===this.tilejson){var j=b+"/"+a.x+"/"+a.y,l=this.cache[j]=new Image(256,256);return l.src=e,l.setAttribute("gTileKey",j),l.style.opacity=this.options.opacity,l}var m=g.g.connector.prototype.getTile.call(this,a,b,c);i&&d(m,this.options.opacity),m.style.opacity=this.options.opacity,0===this.tiles&&this.loading&&this.loading(),this.tiles++;var n=k.metric("cartodb-js.tile.png.load.time").start(),o=function(){n.end(),f.tiles--,0===f.tiles&&f.finishLoading&&f.finishLoading()};return m.onload=o,m.onerror=function(){k.metric("cartodb-js.tile.png.error").inc(),o()},m},onAdd:function(){},clear:function(){this._clearInteraction(),self.finishLoading&&self.finishLoading()},update:function(a){this.loading&&this.loading();var b=this.model.get("urls");b?(this.tilejson=b,this.options.tiles=b.tiles,this.tiles=0,this.cache={},this._reloadInteraction(),this.refreshView(),this.ok&&this.ok(),a&&a()):(this.error&&this.error("URLs have not been fetched yet"),a&&a())},refreshView:function(){var a=this,b=this.options.map;b.overlayMapTypes.forEach(function(c,d){return c==a?void b.overlayMapTypes.setAt(d,a):void 0})},_checkLayer:function(){if(!this.options.added)throw new Error("the layer is not still added to the map")},_findPos:function(a,b){var c,d,e=0,f=0,g=a.getDiv();if(b.e.changedTouches&&b.e.changedTouches.length>0?(c=b.e.changedTouches[0].clientX+window.scrollX,d=b.e.changedTouches[0].clientY+window.scrollY):(c=b.e.clientX,d=b.e.clientY),g.offsetParent&&g.offsetTop>0){do e+=g.offsetLeft,f+=g.offsetTop;while(g=g.offsetParent);var h=this._newPoint(c-e,d-f)}else var i=g.getBoundingClientRect(),j=window.scrollX||window.pageXOffset,k=window.scrollY||window.pageYOffset,h=this._newPoint((b.e.clientX?b.e.clientX:c)-i.left-g.clientLeft-j,(b.e.clientY?b.e.clientY:d)-i.top-g.clientTop-k);return h},_newPoint:function(a,b){return new google.maps.Point(a,b)},_manageOffEvents:function(a,b){return this.options.featureOut?this.options.featureOut&&this.options.featureOut(b.e,b.layer):void 0},_manageOnEvents:function(a,b){var c=this._findPos(a,b),d=this.projector.pixelToLatLng(c),e=b.e.type.toLowerCase();switch(e){case"mousemove":if(this.options.featureOver)return this.options.featureOver(b.e,d,c,b.data,b.layer);break;case"click":case"touchend":case"touchmove":case"mspointerup":case"pointerup":case"pointermove":this.options.featureClick&&this.options.featureClick(b.e,d,c,b.data,b.layer)}}}),b.exports=m},{"../cartodb-layer-common":184,"./cartodb-default-options":199,"./gmaps-layer-view":204,"./projector":211,"cdb.core.Profiler":166,underscore:148,"wax.cartodb.js":321}],202:[function(a,b,c){var d=[{stylers:[{saturation:-65},{gamma:1.52}]},{featureType:"administrative",stylers:[{saturation:-95},{gamma:2.26}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.locality",stylers:[{visibility:"off"}]},{featureType:"road",stylers:[{visibility:"simplified"},{saturation:-99},{gamma:2.22}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",stylers:[{visibility:"off"}]},{featureType:"road.local",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",stylers:[{saturation:-55}]}];b.exports=d},{}],203:[function(a,b,c){var d=a("cdb.log"),e=function(){},f={};if("undefined"!=typeof google&&"undefined"!=typeof google.maps){var g=a("./gmaps-base-layer-view"),h=a("./gmaps-tiled-layer-view"),i=a("../leaflet/leaflet-wms-layer-view"),j=a("./gmaps-plain-layer-view"),k=a("./gmaps-cartodb-layer-group-view"),l=a("./gmaps-torque-layer-view");f={tiled:h,wms:i,plain:j,gmapsbase:g,layergroup:k,namedmap:k,torque:l}}e.prototype._constructors=f,e.prototype.createLayerView=function(a,b){var c=a.get("type").toLowerCase(),e=this._constructors[c];if(e)try{return new e(a,b)}catch(f){throw d.error("Error creating an instance of layer view for '"+c+"' layer -> "+f.message),f}else d.error("Error creating an instance of layer view for '"+c+"' layer. Type is not supported")},b.exports=e},{"../leaflet/leaflet-wms-layer-view":224,"./gmaps-base-layer-view":200,"./gmaps-cartodb-layer-group-view":201,"./gmaps-plain-layer-view":207,"./gmaps-tiled-layer-view":209,"./gmaps-torque-layer-view":210,"cdb.log":158}],204:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=function(a,b,c){this.gmapsLayer=b,this.map=this.gmapsMap=c,this.model=a,this.model.bind("change",this._update,this),this.type=a.get("type")||a.get("kind"),this.type=this.type.toLowerCase()};d.extend(f.prototype,e.Events),d.extend(f.prototype,{_searchLayerIndex:function(){var a=this,b=-1;return this.gmapsMap.overlayMapTypes.forEach(function(c,d){c==a&&(b=d)}),b},remove:function(){if(!this.isBase){var a=this._searchLayerIndex();a>=0?this.gmapsMap.overlayMapTypes.removeAt(a):this.gmapsLayer.setMap&&this.gmapsLayer.setMap(null),this.model.unbind(null,null,this),this.unbind()}},refreshView:function(){if(this.isBase){var a="_baseLayer";this.gmapsMap.setMapTypeId(null),this.gmapsMap.mapTypes.set(a,this.gmapsLayer),this.gmapsMap.setMapTypeId(a)}else{var b=this._searchLayerIndex();b>=0&&this.gmapsMap.overlayMapTypes.setAt(b,this)}},reload:function(){this.refreshView()},_update:function(){this.refreshView()}}),b.exports=f},{backbone:1,underscore:148}],205:[function(a,b,c){var d=a("underscore"),e=a("cdb.log"),f=a("../map-view"),g=a("./projector"),h=a("./gmaps-point-view"),i=a("./gmaps-path-view"),j=f.extend({initialize:function(){d.bindAll(this,"_ready"),this._isReady=!1;var a=this;f.prototype.initialize.call(this);var b=this.map.getViewBounds();b&&this.showBounds(b);var c=this.map.get("center");if(this.isMapAlreadyCreated()){this._gmapsMap=this.options.map_object,this.setElement(this._gmapsMap.getDiv());var e=a._gmapsMap.getCenter();a._setModelProperty({center:[e.lat(),e.lng()]}),a._setModelProperty({zoom:a._gmapsMap.getZoom()}),a.map.unset("view_bounds_sw",{silent:!0}),a.map.unset("view_bounds_ne",{silent:!0})}else this._gmapsMap=new google.maps.Map(this.el,{center:new google.maps.LatLng(c[0],c[1]),zoom:this.map.get("zoom"),minZoom:this.map.get("minZoom"),maxZoom:this.map.get("maxZoom"),disableDefaultUI:!0,scrollwheel:this.map.get("scrollwheel"),draggable:this.map.get("drag"),disableDoubleClickZoom:!this.map.get("drag"),mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,backgroundColor:"white",tilt:0}),this.map.bind("change:maxZoom",function(){a._gmapsMap.setOptions({maxZoom:a.map.get("maxZoom")})},this),this.map.bind("change:minZoom",function(){a._gmapsMap.setOptions({minZoom:a.map.get("minZoom")})},this);google.maps.event.addListener(this._gmapsMap,"center_changed",function(){var b=a._gmapsMap.getCenter();a._setModelProperty({center:[b.lat(),b.lng()]})}),google.maps.event.addListener(this._gmapsMap,"zoom_changed",function(){a._setModelProperty({zoom:a._gmapsMap.getZoom()})}),google.maps.event.addListener(this._gmapsMap,"click",function(b){a.trigger("click",b,[b.latLng.lat(),b.latLng.lng()])}),google.maps.event.addListener(this._gmapsMap,"dragend",function(b){var c=a._gmapsMap.getCenter();a.trigger("dragend",b,[c.lat(),c.lng()])}),google.maps.event.addListener(this._gmapsMap,"dblclick",function(b){a.trigger("dblclick",b)}),this.map.geometries.bind("add",this._addGeometry,this),this.map.geometries.bind("remove",this._removeGeometry,this),this._bindModel(),this._addLayers(),this.setAttribution(),this.projector=new g(this._gmapsMap),this.projector.draw=this._ready},_ready:function(){this.projector.draw=function(){},this.trigger("ready"),this._isReady=!0},_setKeyboard:function(a,b){this._gmapsMap.setOptions({keyboardShortcuts:b})},_setScrollWheel:function(a,b){this._gmapsMap.setOptions({scrollwheel:b})},_setZoom:function(a,b){b=b||0,this._gmapsMap.setZoom(b)},_setCenter:function(a,b){var c=new google.maps.LatLng(b[0],b[1]);this._gmapsMap.setCenter(c)},_getNativeMap:function(){return this._gmapsMap},_addLayerToMap:function(a,b,c){if(a){var f=1===d.keys(this._layerViews).length||c&&0===c.index||0===b.get("order");if(f){var g=a.model;"GMapsBase"!==g.get("type")&&(a.isBase=!0)}else{var h=b.get("order");a.getTile?(a.gmapsLayer||e.error("gmaps layer can't be null"),this._gmapsMap.overlayMapTypes.setAt(h,a.gmapsLayer)):a.gmapsLayer.setMap(this._gmapsMap)}void 0!==c&&c.silent||this.trigger("newLayerView",a,b,this)}else e.error("layer type not supported");return a},pixelToLatLon:function(a){var b=this.projector.pixelToLatLng(new google.maps.Point(a[0],a[1]));return{lat:b.lat(),lng:b.lng()}},latLonToPixel:function(a){return this.projector.latLngToPixel(new google.maps.LatLng(a[0],a[1]))},getSize:function(){return{x:this.$el.width(),y:this.$el.height()}},panBy:function(a){var b=this.map.get("center"),c=this.latLonToPixel(b);a.x+=c.x,a.y+=c.y;var d=this.projector.pixelToLatLng(a);this.map.setCenter([d.lat(),d.lng()])},getBounds:function(){if(this._isReady){var a=this._gmapsMap.getBounds(),b=a.getSouthWest(),c=a.getNorthEast();return[[b.lat(),b.lng()],[c.lat(),c.lng()]]}return[[0,0],[0,0]]},setAttribution:function(){},setCursor:function(a){this._gmapsMap.setOptions({draggableCursor:a})},_addGeomToMap:function(a){var b=j.createGeometry(a);if(b.geom.length)for(var c=0;c<b.geom.length;++c)b.geom[c].setMap(this._gmapsMap);else b.geom.setMap(this._gmapsMap);return b},_removeGeomFromMap:function(a){if(a.geom.length)for(var b=0;b<a.geom.length;++b)a.geom[b].setMap(null);else a.geom.setMap(null)},getNativeMap:function(){return this._gmapsMap},invalidateSize:function(){google.maps.event.trigger(this._gmapsMap,"resize")}},{addLayerToMap:function(a,b,c){c=c||0,a||e.error("gmaps layer can't be null"),a.getTile?b.overlayMapTypes.setAt(c,a):a.setMap(b)},createGeometry:function(a){return a.isPoint()?new h(a):new i(a)}});b.exports=j},{"../map-view":226,"./gmaps-path-view":206,"./gmaps-point-view":208,"./projector":211,"cdb.log":158,underscore:148}],206:[function(a,b,c){function d(a){function b(a){google.maps.event.addListener(a,"insert_at",c._updateModel)}var c=this;this._eventHandlers={},this.model=a,this.points=[];var d=e.clone(a.get("style"))||{};this.geom=new f(a.get("geojson"),d),e.bindAll(this,"_updateModel");var c=this;if(this.geom.getPaths){var g=this.geom.getPaths();if(g&&g[0])for(var h=0;h<g.length;++h)b(g[h]);else b(g),google.maps.event.addListener(this.geom,"mouseup",this._updateModel)}else if(this.geom.length)for(var h=0;h<this.geom.length;++h)b(this.geom[h].getPath()),google.maps.event.addListener(this.geom[h],"mouseup",this._updateModel);else b(this.geom.getPath()),google.maps.event.addListener(this.geom,"mouseup",this._updateModel)}var e=a("underscore"),f=a("geojson"),g=a("../geometry-view");d.prototype=new g,d.getGeoJSON=function(a,b){function c(a){return[a.lng(),a.lat()]}function e(a){for(var b=[],d=0;d<a.length;++d)b.push(c(a.getAt(d)));return b}if(a.length&&1!=a.length){for(var f=[],g=0;g<a.length;++g)f.push(d.getGeoJSON(a[g],b).coordinates[0]);return{type:b,coordinates:f}}var h,i=a.length?a[0]:a;if("Point"==b)h=c(i.getPosition());else if("MultiPoint"==b)h=[c(i.getPosition())];else if("Polygon"==b)h=[e(i.getPath())],h[0].push(c(i.getPath().getAt(0)));else if("MultiPolygon"==b){h=[];for(var j=0;j<i.getPaths().length;++j){var f=e(i.getPaths().getAt(j));f.push(c(i.getPaths().getAt(j).getAt(0))),h.push(f)}h=[h]}else"LineString"==b?h=e(i.getPath()):"MultiLineString"==b&&(h=[e(i.getPath())]);return{type:b,coordinates:h}},d.prototype._updateModel=function(a){var b=this;setTimeout(function(){b.model.set("geojson",d.getGeoJSON(b.geom,b.model.get("geojson").type))},100)},d.prototype.edit=function(a){for(var b=this.geom.length?this.geom:[this.geom],c=0;c<b.length;++c)b[c].setEditable(a);a||this.model.set("geojson",d.getGeoJSON(this.geom,this.model.get("geojson").type))},b.exports=d},{"../geometry-view":196,geojson:315,underscore:148}],207:[function(a,b,c){var d=a("underscore"),e=a("./gmaps-layer-view"),f=function(a,b){this.color=a.get("color"),e.call(this,a,this,b)};d.extend(f.prototype,e.prototype,{_update:function(){this.color=this.model.get("color"),this.refreshView()},getTile:function(a,b,c){var d=document.createElement("div");return d.style.width=this.tileSize.x,d.style.height=this.tileSize.y,d["background-color"]=this.color,d},tileSize:new google.maps.Size(256,256),maxZoom:100,minZoom:0,name:"plain layer",alt:"plain layer"}),b.exports=f},{"./gmaps-layer-view":204,underscore:148}],208:[function(a,b,c){function d(a){var b=this,c=["click","dblclick","mousedown","mouseover","mouseout","dragstart","drag","dragend"];this._eventHandlers={},this.model=a,this.points=[];var d=(e.clone(a.get("style"))||{},this.model.get("iconAnchor")),h={url:this.model.get("iconUrl")||g.get("assets_url")+"/images/layout/default_marker.png",anchor:{x:d&&d[0]||10,y:d&&d[1]||10}};this.geom=new f(a.get("geojson"),{icon:h,raiseOnDrag:!1,crossOnDrag:!1});var i;for(i=0;i<c.length;++i){var j=c[i];google.maps.event.addListener(this.geom,j,b._eventHandler(j))}this.bind("dragend",function(b,c){a.set({geojson:{type:"Point",coordinates:[c[1],c[0]]}})})}var e=a("underscore"),f=a("geojson"),g=a("cdb.config"),h=a("../geometry-view");d.prototype=new h,d.prototype._eventHandler=function(a){var b=this,c=this._eventHandlers[a];return c||(c=function(c){var d=c.latLng,e=[d.lat(),d.lng()];b.trigger(a,c,e)},this._eventHandlers[a]=c),c},d.prototype.edit=function(a){this.geom.setDraggable(a)},b.exports=d},{"../geometry-view":196,"cdb.config":155,geojson:315,underscore:148}],209:[function(a,b,c){var d=a("underscore"),e=a("./gmaps-layer-view"),f=function(a,b){e.call(this,a,this,b),this.tileSize=new google.maps.Size(256,256),this.opacity=1,this.isPng=!0,this.maxZoom=22,this.minZoom=0,this.name="cartodb tiled layer",google.maps.ImageMapType.call(this,this)};d.extend(f.prototype,e.prototype,google.maps.ImageMapType.prototype,{getTileUrl:function(a,b){var c=a.y,d=1<<b;if(0>c||c>=d)return null;var e=a.x;(0>e||e>=d)&&(e=(e%d+d)%d),this.model.get("tms")&&(c=d-c-1);var f=this.model.get("urlTemplate");return f.replace("{x}",e).replace("{y}",c).replace("{z}",b)}}),b.exports=f},{"./gmaps-layer-view":204,underscore:148}],210:[function(a,b,c){a("torque.js");var d=a("underscore"),e=a("torque.js"),f=a("backbone"),g=a("./gmaps-layer-view"),h=a("../torque-layer-view-base"),i=function(a,b){g.call(this,a,this,b),e.GMapsTorqueLayer.call(this,this._initialAttrs(a)),this._init(a)};d.extend(i.prototype,g.prototype,e.GMapsTorqueLayer.prototype,h,{_update:function(){var a=this.model.changedAttributes();a!==!1&&("visible"in a&&(this.model.get("visible")?this.show():this.hide()),"urls"in a&&(this.provider.templateUrl=this.model.get("urls").tiles[0],d.extend(this.provider.options,this.model.get("meta")),this.model.set(this.model.get("meta")),setTimeout(function(){this.provider._setReady(!0),this._reloadTiles()}.bind(this),0)))},refreshView:function(){},onAdd:function(){e.GMapsTorqueLayer.prototype.onAdd.apply(this)},onTilesLoaded:function(){f.Events.trigger.call(this,"load")},onTilesLoading:function(){f.Events.trigger.call(this,"loading")}}),b.exports=i},{"../torque-layer-view-base":236,"./gmaps-layer-view":204,backbone:1,"torque.js":91,underscore:148}],211:[function(a,b,c){var d=function(a){this.setMap(a)};d.prototype=new google.maps.OverlayView,d.prototype.draw=function(){},d.prototype.latLngToPixel=function(a){var b=this.getProjection();return b?b.fromLatLngToContainerPixel(a):[0,0]},d.prototype.pixelToLatLng=function(a){var b=this.getProjection();return b?b.fromContainerPixelToLatLng(a):[0,0]},b.exports=d},{}],212:[function(a,b,c){b.exports={LeafletLayerView:a("./leaflet/leaflet-layer-view"),LeafletPlainLayerView:a("./leaflet/leaflet-plain-layer-view"),LeafletTiledLayerView:a("./leaflet/leaflet-tiled-layer-view"),LeafletGmapsTiledLayerView:a("./leaflet/leaflet-gmaps-tiled-layer-view"),LeafletWMSLayerView:a("./leaflet/leaflet-wms-layer-view"),LeafletCartoDBLayerGroupView:a("./leaflet/leaflet-cartodb-layer-group-view"),leaflet:{PointView:a("./leaflet/leaflet-point-view"),PathView:a("./leaflet/leaflet-path-view")},LeafletMapView:a("./leaflet/leaflet-map-view")}},{"./leaflet/leaflet-cartodb-layer-group-view":213,"./leaflet/leaflet-gmaps-tiled-layer-view":215,"./leaflet/leaflet-layer-view":217,"./leaflet/leaflet-map-view":218,"./leaflet/leaflet-path-view":219,"./leaflet/leaflet-plain-layer-view":220,"./leaflet/leaflet-point-view":221,"./leaflet/leaflet-tiled-layer-view":222,"./leaflet/leaflet-wms-layer-view":224}],213:[function(a,b,c){var d=a("wax.cartodb.js"),e=a("leaflet"),f=a("cdb.config"),g=a("cdb.core.Profiler"),h=a("./leaflet-layer-view"),i=a("../cartodb-layer-common"),j=a("underscore"),k=a("backbone"),l=e.TileLayer.extend({includes:[k.Events,h.prototype,i.prototype],interactionClass:d.leaf.interaction,options:{opacity:.99,attribution:f.get("cartodb_attributions"),debug:!1,visible:!0,added:!1,tiler_domain:"cartodb.com",tiler_port:"80",tiler_protocol:"http",sql_api_domain:"cartodb.com",sql_api_port:"80",sql_api_protocol:"http",maxZoom:30,extra_params:{},cdn_url:null,subdomains:null},initialize:function(a,b){var c=this,d=[];this.interaction=[];var f=j.clone(a.attributes);f.map=b;var g,k=f.featureOver,l=f.featureOut,m=f.featureClick,n=-1;f.featureOver=function(a,b,e,f,h){d[h]||c.trigger("layerenter",a,b,e,f,h),d[h]=1,k&&k.apply(this,arguments),c.featureOver&&c.featureOver.apply(c,arguments),a.timeStamp===g&&clearTimeout(n),n=setTimeout(function(){c.trigger("mouseover",a,b,e,f,h),c.trigger("layermouseover",a,b,e,f,h)},0),g=a.timeStamp},f.featureOut=function(a,b){d[b]&&c.trigger("layermouseout",b),d[b]=0,j.any(d)||c.trigger("mouseout"),l&&l.apply(this,arguments),c.featureOut&&c.featureOut.apply(c,arguments)},f.featureClick=j.debounce(function(){m&&m.apply(c,arguments),c.featureClick&&c.featureClick.apply(c,arguments)},10),e.Util.setOptions(this,f),this.fire=this.trigger,a.bind("change:urls",this._onTileJSONChange,this),this.addProfiling(),i.call(this),e.TileLayer.prototype.initialize.call(this),h.call(this,a,this,b)},featureOver:function(a,b,c,d,e){this.trigger("featureOver",a,[b.lat,b.lng],c,d,e)},featureOut:function(a,b){this.trigger("featureOut",a,b)},featureClick:function(a,b,c,d,e){this.trigger("featureClick",a,[b.lat,b.lng],c,d,e)},error:function(a){this.trigger("error",a?a.errors||a:"unknown error"),this.model.trigger("error",a?a.errors:"unknown error")},ok:function(a){this.model.trigger("tileOk")},addProfiling:function(){this.bind("tileloadstart",function(a){var b=this.tileStats||(this.tileStats={});b[a.tile.src]=g.metric("cartodb-js.tile.png.load.time").start()});var a=function(a){var b=this.tileStats&&this.tileStats[a.tile.src];b&&b.end()};this.bind("tileload",a),this.bind("tileerror",function(b){g.metric("cartodb-js.tile.png.error").inc(),a(b)})},getTileUrl:function(a){var b="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";this._adjustTilePoint(a);var c=[b];this.tilejson&&(c=this.tilejson.tiles);var d=(a.x+a.y)%c.length;return e.Util.template(c[d],e.Util.extend({z:this._getZoomForUrl(),x:a.x,y:a.y},this.options))},setOpacity:function(a){if(isNaN(a)||a>1||0>a)throw new Error(a+" is not a valid value");this.options.opacity=Math.min(a,.99),this.options.visible&&(e.TileLayer.prototype.setOpacity.call(this,this.options.opacity),this.fire("updated"))},onAdd:function(a){return this.options.map=a,this.options.added=!0,e.TileLayer.prototype.onAdd.call(this,a)},onRemove:function(a){this.options.added&&(this.options.added=!1,e.TileLayer.prototype.onRemove.call(this,a))},_onTileJSONChange:function(){var a=this.model.get("urls");a?(this.tilejson=a,this.setUrl(this.tilejson.tiles[0]),this._reloadInteraction(),this.ok&&this.ok()):this.error&&this.error("URLs have not been fetched yet")},_manageOnEvents:function(a,b){var c=this._findPos(a,b);if(!c||isNaN(c.x)||isNaN(c.y))return!1;var d=a.layerPointToLatLng(c),e=b.e.type.toLowerCase(),f=a.layerPointToContainerPoint(c);switch(e){case"mousemove":if(this.options.featureOver)return this.options.featureOver(b.e,d,f,b.data,b.layer);break;case"click":case"touchend":case"touchmove":case"mspointerup":case"pointerup":case"pointermove":this.options.featureClick&&this.options.featureClick(b.e,d,f,b.data,b.layer)}},_manageOffEvents:function(a,b){return this.options.featureOut?this.options.featureOut&&this.options.featureOut(b.e,b.layer):void 0},_findPos:function(a,b){var c,d,e=0,f=0,g=a.getContainer();if(b.e.changedTouches&&b.e.changedTouches.length>0?(c=b.e.changedTouches[0].clientX+window.scrollX,d=b.e.changedTouches[0].clientY+window.scrollY):(c=b.e.clientX,d=b.e.clientY),g.offsetParent&&g.offsetTop>0){do e+=g.offsetLeft,f+=g.offsetTop;while(g=g.offsetParent);var h=this._newPoint(c-e,d-f)}else var i=g.getBoundingClientRect(),j=window.scrollX||window.pageXOffset,k=window.scrollY||window.pageYOffset,h=this._newPoint((b.e.clientX?b.e.clientX:c)-i.left-g.clientLeft-j,(b.e.clientY?b.e.clientY:d)-i.top-g.clientTop-k);return a.containerPointToLayerPoint(h)},_newPoint:function(a,b){return new e.Point(a,b);
},_modelUpdated:function(){}});b.exports=l},{"../cartodb-layer-common":184,"./leaflet-layer-view":217,backbone:1,"cdb.config":155,"cdb.core.Profiler":166,leaflet:58,underscore:148,"wax.cartodb.js":321}],214:[function(a,b,c){a("d3.cartodb");var d=window.L.CartoDBd3Layer,e=a("./leaflet-layer-view"),f=a("../data-providers/geojson/geojson-data-provider-factory"),g=d.extend({includes:[e.prototype],_on:d.prototype.on,initialize:function(a,b){e.call(this,a,this,b),d.prototype.initialize.call(this),a.bind("change:urls",this._onTileJSONChanged,this),a.layers.bind("change:cartocss",function(a,b){var c=a.get("order")-1;this.setCartoCSS(c,b)},this),a.layers.bind("change:meta",function(b,c){var d=a.layers.indexOf(b);this.options.styles[d]=c.cartocss},this),a.layers.each(function(b){this._onLayerAdded(b,a.layers)},this),a.layers.bind("add",this._onLayerAdded,this),this._on("featureClick",function(a,b,c,d,e){this.trigger("featureClick",a,b,c,d,e)}.bind(this)),this._on("featureOver",function(a,b,c,d,e){this.trigger("featureOver",a,b,c,d,e),this.trigger("mouseover",a,b,c,d)}.bind(this)),this._on("featureOut",function(a,b,c,d,e){this.trigger("mouseout")}.bind(this))},_onLayerAdded:function(a,b){var c=b.indexOf(a);a.setDataProvider(new f(this,c))},_onTileJSONChanged:function(){var a=this.model.get("urls");this.setUrl(a.tiles[0])},onAdd:function(a){d.prototype.onAdd.call(this,a),this.trigger("added",this),this.added=!0},_modelUpdated:function(){}});b.exports=g},{"../data-providers/geojson/geojson-data-provider-factory":191,"./leaflet-layer-view":217,"d3.cartodb":46}],215:[function(a,b,c){var d=a("underscore"),e=a("leaflet"),f=a("./leaflet-layer-view"),g=function(a){return{url:"http://{s}.basemaps.cartocdn.com/"+a+"_all/{z}/{x}/{y}.png",subdomains:"abcd",minZoom:0,maxZoom:18,attribution:'Map designs by <a href="http://stamen.com/">Stamen</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, Provided by <a href="http://cartodb.com">CartoDB</a>'}},h=function(a){return{url:"https://{s}.maps.nlp.nokia.com/maptile/2.1/maptile/newest/"+a+".day/{z}/{x}/{y}/256/png8?lg=eng&token=A7tBPacePg9Mj_zghvKt9Q&app_id=KuYppsdXZznpffJsKT24",subdomains:"1234",minZoom:0,maxZoom:21,attribution:'©2012 Nokia <a href="http://here.net/services/terms" target="_blank">Terms of use</a>'}},i={roadmap:h("normal"),gray_roadmap:g("light"),dark_roadmap:g("dark"),hybrid:h("hybrid"),terrain:h("terrain"),satellite:h("satellite")},j=e.TileLayer.extend({initialize:function(a,b){var c=i[a.get("base_type")];e.TileLayer.prototype.initialize.call(this,c.url,{tms:!1,attribution:c.attribution,minZoom:c.minZoom,maxZoom:c.maxZoom,subdomains:c.subdomains,errorTileUrl:"",opacity:1}),f.call(this,a,this,b)}});d.extend(j.prototype,f.prototype,{_modelUpdated:function(){}}),b.exports=j},{"./leaflet-layer-view":217,leaflet:58,underscore:148}],216:[function(a,b,c){var d=a("cdb.log"),e=a("./leaflet-tiled-layer-view"),f=a("./leaflet-wms-layer-view"),g=a("./leaflet-plain-layer-view"),h=a("./leaflet-gmaps-tiled-layer-view"),i=a("./leaflet-cartodb-layer-group-view"),j=a("./leaflet-torque-layer"),k=a("./leaflet-cartodb-vector-layer-group-view"),l=function(a,b,c){if(c.vector){var d=new k(a,b);return d}return new i(a,b)},m=function(a){a=a||{},this._vector=a.vector};m.prototype._constructors={tiled:e,wms:f,plain:g,gmapsbase:h,layergroup:l,namedmap:l,torque:j},m.prototype.createLayerView=function(a,b){var c=a.get("type").toLowerCase(),e=this._constructors[c];if(e)try{return new e(a,b,{vector:this._vector})}catch(f){throw d.error("Error creating an instance of layer view for '"+c+"' layer -> "+f.message),f}else d.error("Error creating an instance of layer view for '"+c+"' layer. Type is not supported")},b.exports=m},{"./leaflet-cartodb-layer-group-view":213,"./leaflet-cartodb-vector-layer-group-view":214,"./leaflet-gmaps-tiled-layer-view":215,"./leaflet-plain-layer-view":220,"./leaflet-tiled-layer-view":222,"./leaflet-torque-layer":223,"./leaflet-wms-layer-view":224,"cdb.log":158}],217:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=function(a,b,c){this.leafletLayer=b,this.leafletMap=c,this.model=a,this.setModel(a),this.type=a.get("type")||a.get("kind"),this.type=this.type.toLowerCase()};d.extend(f.prototype,e.Events),d.extend(f.prototype,{setModel:function(a){this.model&&this.model.unbind("change",this._modelUpdated,this),this.model=a,this.model.bind("change",this._modelUpdated,this)},remove:function(){this.leafletMap.removeLayer(this.leafletLayer),this.trigger("remove",this),this.model.unbind(null,null,this),this.unbind()},reload:function(){this.leafletLayer.redraw()}}),b.exports=f},{backbone:1,underscore:148}],218:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("leaflet"),g=a("../map-view"),h=a("../../core/view"),i=a("../../core/sanitize"),j=a("./leaflet-point-view"),k=a("./leaflet-path-view"),l=g.extend({initialize:function(){e.bindAll(this,"_addLayer","_removeLayer","_setZoom","_setCenter","_setView"),g.prototype.initialize.call(this);var a=this,b=this.map.get("center"),c={zoomControl:!1,center:new f.LatLng(b[0],b[1]),zoom:this.map.get("zoom"),minZoom:this.map.get("minZoom"),maxZoom:this.map.get("maxZoom"),attributionControl:!1};if(this.isMapAlreadyCreated()){this._leafletMap=this.options.map_object,this.setElement(this._leafletMap.getContainer());var d=a._leafletMap.getCenter();this._setModelProperty({center:[d.lat,d.lng]}),this._setModelProperty({zoom:a._leafletMap.getZoom()}),this.map.unset("view_bounds_sw",{silent:!0}),this.map.unset("view_bounds_ne",{silent:!0})}else this._leafletMap=new f.Map(this.el,c),0==this.map.get("scrollwheel")&&this._leafletMap.scrollWheelZoom.disable(),0==this.map.get("keyboard")&&this._leafletMap.keyboard.disable(),0==this.map.get("drag")&&(this._leafletMap.dragging.disable(),this._leafletMap.doubleClickZoom.disable());this.map.bind("set_view",this._setView,this),this.map.geometries.bind("add",this._addGeometry,this),this.map.geometries.bind("remove",this._removeGeometry,this),this._bindModel(),this._addLayers(),this.setAttribution(),this._leafletMap.on("layeradd",function(b){this.trigger("layeradd",b,a)},this),this._leafletMap.on("zoomstart",function(){a.trigger("zoomstart")}),this._leafletMap.on("click",function(b){a.trigger("click",b.originalEvent,[b.latlng.lat,b.latlng.lng])}),this._leafletMap.on("dblclick",function(b){a.trigger("dblclick",b.originalEvent)}),this._leafletMap.on("zoomend",function(){a._setModelProperty({zoom:a._leafletMap.getZoom()}),a.trigger("zoomend")},this),this._leafletMap.on("move",function(){var b=a._leafletMap.getCenter();a._setModelProperty({center:[b.lat,b.lng]})}),this._leafletMap.on("dragend",function(){var b=a._leafletMap.getCenter();this.trigger("dragend",[b.lat,b.lng])},this),this._leafletMap.on("drag",function(){var b=a._leafletMap.getCenter();a._setModelProperty({center:[b.lat,b.lng]}),a.trigger("drag")},this),this.map.bind("change:maxZoom",function(){f.Util.setOptions(a._leafletMap,{maxZoom:a.map.get("maxZoom")})},this),this.map.bind("change:minZoom",function(){f.Util.setOptions(a._leafletMap,{minZoom:a.map.get("minZoom")})},this),this.trigger("ready");var h=this.map.getViewBounds();h&&this.showBounds(h)},_addLayers:function(a,b){function c(a){var b=e.find(g,function(b){var c=b.model;return c.isEqual(a)});return b}function d(a){return f.map.layers.find(function(b){return b.isEqual(a)})}var f=this,g=this._layerViews;this._layerViews={};for(var h in g){var i=g[h];d(i.model)||i.remove()}this.map.layers.each(function(d){var e=c(d);e?(e.setModel(d),f._layerViews[d.cid]=e,f.trigger("newLayerView",e,d,f)):f._addLayer(d,a,{silent:b&&b.silent||!1,index:b&&b.index})})},clean:function(){f.DomEvent.off(window,"resize",this._leafletMap._onResize,this._leafletMap);for(var a in this._layerViews){var b=this._layerViews[a];b.remove(),delete this._layerViews[a]}h.prototype.clean.call(this)},_setKeyboard:function(a,b){b?this._leafletMap.keyboard.enable():this._leafletMap.keyboard.disable()},_setScrollWheel:function(a,b){b?this._leafletMap.scrollWheelZoom.enable():this._leafletMap.scrollWheelZoom.disable()},_setZoom:function(a,b){this._setView()},_setCenter:function(a,b){this._setView()},_setView:function(){this._leafletMap.setView(this.map.get("center"),this.map.get("zoom")||0)},_addGeomToMap:function(a){var b=l.createGeometry(a);return b.geom.addTo(this._leafletMap),b},_removeGeomFromMap:function(a){this._leafletMap.removeLayer(a.geom)},_getNativeMap:function(){return this._leafletMap},_addLayerToMap:function(a,b,c){return l.addLayerToMap(a,this._leafletMap),this._reorderLayerViews(),c.silent||this.trigger("newLayerView",a),a},_reorderLayerViews:function(){this.map.layers.each(function(a){var b=this.getLayerViewByLayerCid(a.cid);b&&b.setZIndex(a.get("order"))},this)},pixelToLatLon:function(a){var b=this._leafletMap.containerPointToLatLng([a[0],a[1]]);return b},latLonToPixel:function(a){var b=this._leafletMap.latLngToLayerPoint(new f.LatLng(a[0],a[1]));return this._leafletMap.layerPointToContainerPoint(b)},getBounds:function(){var a=this._leafletMap.getBounds(),b=a.getSouthWest(),c=a.getNorthEast();return[[b.lat,b.lng],[c.lat,c.lng]]},setAttribution:function(a){var b=this._leafletMap.attributionControl;if(this.isMapAlreadyCreated()&&b){if(a){var c=a.previous("attribution");e.each(c,function(a){b.removeAttribution(i.html(a))})}var d=this.map.get("attribution");e.each(d,function(a){b.addAttribution(i.html(a))})}},getSize:function(){return this._leafletMap.getSize()},panBy:function(a){this._leafletMap.panBy(new f.Point(a.x,a.y))},setCursor:function(a){d(this._leafletMap.getContainer()).css("cursor",a)},getNativeMap:function(){return this._leafletMap},invalidateSize:function(){this._leafletMap.invalidateSize({pan:!1}),this._leafletMap.setView(this.map.get("center"),this.map.get("zoom")||0,{animate:!1})}},{addLayerToMap:function(a,b,c){b.addLayer(a.leafletLayer),void 0!==c&&a.setZIndex&&a.setZIndex(c)},createGeometry:function(a){return a.isPoint()?new j(a):new k(a)}});f.Icon.Default.imagePath=function(){var a,b,c,d,e=document.getElementsByTagName("script"),f=/\/?cartodb[\-\._]?([\w\-\._]*)\.js\??/;for(a=0,b=e.length;b>a;a++)if(c=e[a].src,d=c.match(f)){var g=c.split("/");return delete g[g.length-1],g.join("/")+"themes/css/images"}}(),b.exports=l},{"../../core/sanitize":167,"../../core/view":171,"../map-view":226,"./leaflet-path-view":219,"./leaflet-point-view":221,jquery:57,leaflet:58,underscore:148}],219:[function(a,b,c){function d(a){this._eventHandlers={},this.model=a,this.points=[],this.geom=f.GeoJSON.geometryToLayer(a.get("geojson")),this.geom.setStyle(a.get("style"))}var e=a("underscore"),f=a("leaflet"),g=a("../geometry-view");d.prototype=new g,d.prototype._leafletLayers=function(){return this.geom.getLayers?this.geom.getLayers():[this.geom]},d.prototype.enableEdit=function(){var a=this,b=this._leafletLayers();e.each(b,function(b){b.setStyle(a.model.get("style")),b.on("edit",function(){a.model.set("geojson",a.geom.toGeoJSON().geometry)},a)})},d.prototype.disableEdit=function(){var a=this,b=this._leafletLayers();e.each(b,function(b){b.off("edit",null,a)})},d.prototype.edit=function(a){var b=this,c=a?"enable":"disable",d=this._leafletLayers();e.each(d,function(d){d.editing[c](),a?b.enableEdit():b.disableEdit()})},b.exports=d},{"../geometry-view":196,leaflet:58,underscore:148}],220:[function(a,b,c){var d=a("underscore"),e=a("leaflet"),f=a("./leaflet-layer-view"),g=e.Class.extend({includes:e.Mixin.Events,initialize:function(a,b){f.call(this,a,this,b)},onAdd:function(){this.redraw()},onRemove:function(){var a=this.leafletMap.getContainer();a.style.background="none"},_modelUpdated:function(){this.redraw()},redraw:function(){var a=this.leafletMap.getContainer();if(a.style.backgroundColor=this.model.get("color")||"#FFF",this.model.get("image")){var b="transparent url("+this.model.get("image")+") repeat center center";a.style.background=b}},setZIndex:function(){}});d.extend(g.prototype,f.prototype),b.exports=g},{"./leaflet-layer-view":217,leaflet:58,underscore:148}],221:[function(a,b,c){function d(a){var b=this,c=["click","dblclick","mousedown","mouseover","mouseout","dragstart","drag","dragend"];this._eventHandlers={},this.model=a,this.points=[];var d={iconUrl:this.model.get("iconUrl")||f.get("assets_url")+"/images/layout/default_marker.png",iconAnchor:this.model.get("iconAnchor")||[11,11]};this.geom=e.GeoJSON.geometryToLayer(a.get("geojson"),function(a,f){var g,h=e.marker(f,{icon:e.icon(d)});for(g=0;g<c.length;++g){var i=c[g];h.on(i,b._eventHandler(i))}return h}),this.bind("dragend",function(b,c){a.set({geojson:{type:"Point",coordinates:[c[1],c[0]]}})})}var e=a("leaflet"),f=a("cdb.config"),g=a("../geometry-view");d.prototype=new g,d.prototype.edit=function(){this.geom.dragging.enable()},d.prototype._eventHandler=function(a){var b=this,c=this._eventHandlers[a];return c||(c=function(c){var d=c.target.getLatLng(),e=[d.lat,d.lng];b.trigger(a,c.originalEvent,e)},this._eventHandlers[a]=c),c},b.exports=d},{"../geometry-view":196,"cdb.config":155,leaflet:58}],222:[function(a,b,c){var d=a("underscore"),e=a("leaflet"),f=a("./leaflet-layer-view"),g=e.TileLayer.extend({initialize:function(a,b){e.TileLayer.prototype.initialize.call(this,a.get("urlTemplate"),{tms:a.get("tms"),attribution:a.get("attribution"),minZoom:a.get("minZoom"),maxZoom:a.get("maxZoom"),subdomains:a.get("subdomains")||"abc",errorTileUrl:a.get("errorTileUrl"),opacity:a.get("opacity")}),f.call(this,a,this,b)},onAdd:function(a){e.TileLayer.prototype.onAdd.call(this,a);var b=this.getContainer();b.style.pointerEvents="none"}});d.extend(g.prototype,f.prototype,{_modelUpdated:function(){d.defaults(this.leafletLayer.options,d.clone(this.model.attributes)),this.leafletLayer.options.subdomains=this.model.get("subdomains")||"abc",this.leafletLayer.options.attribution=this.model.get("attribution"),this.leafletLayer.options.maxZoom=this.model.get("maxZoom"),this.leafletLayer.options.minZoom=this.model.get("minZoom"),this.leafletLayer.setUrl(this.model.get("urlTemplate"))}}),b.exports=g},{"./leaflet-layer-view":217,leaflet:58,underscore:148}],223:[function(a,b,c){a("torque.js");var d=a("underscore"),e=a("cdb.core.util"),f=a("./leaflet-layer-view"),g=a("../torque-layer-view-base"),h=L.TorqueLayer.extend({initialize:function(a,b){var c=this._getQuery(a),g=this._initialAttrs(a);d.extend(g,{dynamic_cdn:a.get("dynamic_cdn"),instanciateCallback:function(){var b=a.get("cartocss")||a.get("tile_style");return"_cdbct_"+e.uniqueCallbackName(b+c)}}),L.TorqueLayer.prototype.initialize.call(this,g),f.call(this,a,this,b),this.fire=this.trigger,this._init(a)},_modelUpdated:function(a){var b=this.model.changedAttributes();b!==!1&&("visible"in b&&(this.model.get("visible")?this.show():this.hide()),"urls"in b&&(this.provider.templateUrl=this.model.get("urls").tiles[0],d.extend(this.provider.options,this.model.get("meta")),this.model.set(this.model.get("meta")),setTimeout(function(){this.provider._setReady(!0),this._reloadTiles()}.bind(this),0)))}});d.extend(h.prototype,f.prototype),d.extend(h.prototype,g),b.exports=h},{"../torque-layer-view-base":236,"./leaflet-layer-view":217,"cdb.core.util":170,"torque.js":91,underscore:148}],224:[function(a,b,c){var d=a("underscore"),e=a("leaflet"),f=a("./leaflet-layer-view.js"),g=e.TileLayer.WMS.extend({initialize:function(a,b){e.TileLayer.WMS.prototype.initialize.call(this,a.get("urlTemplate"),{attribution:a.get("attribution"),layers:a.get("layers"),format:a.get("format"),transparent:a.get("transparent"),minZoom:a.get("minZomm"),maxZoom:a.get("maxZoom"),subdomains:a.get("subdomains")||"abc",errorTileUrl:a.get("errorTileUrl"),opacity:a.get("opacity")}),f.call(this,a,this,b)}});d.extend(g.prototype,f.prototype,{_modelUpdated:function(){d.defaults(this.leafletLayer.options,d.clone(this.model.attributes)),this.leafletLayer.setUrl(this.model.get("urlTemplate"))}}),b.exports=g},{"./leaflet-layer-view.js":217,leaflet:58,underscore:148}],225:[function(a,b,c){var d=a("cdb"),e=a("./leaflet/leaflet-layer-view-factory"),f=a("./gmaps/gmaps-layer-view-factory"),g=function(){};g.prototype.createMapView=function(a,b,c){var g,h;if("leaflet"===a)g=d.geo.LeafletMapView,h=e;else{if("googlemaps"!==a)throw new Error(a+" provider is not supported");if("undefined"==typeof google||"undefined"==typeof google.maps)throw new Error("Google maps library should be included");g=d.geo.GoogleMapsMapView,h=f}return new g({el:c,map:b,layerViewFactory:new h({vector:b.get("vector")})})},b.exports=g},{"./gmaps/gmaps-layer-view-factory":203,"./leaflet/leaflet-layer-view-factory":216,cdb:157}],226:[function(a,b,c){var d=a("underscore"),e=a("cdb.log"),f=a("../core/view"),g=a("./cartodb-layer-group-named-map"),h=a("./cartodb-layer-group-anonymous-map"),i=f.extend({initialize:function(){if(void 0===this.options.map)throw new Error("you should specify a map model");if(void 0===this.options.layerViewFactory)throw new Error("you should specify a layerViewFactory");this.map=this.options.map,this.add_related_model(this.map),this._layerViewFactory=this.options.layerViewFactory,this.autoSaveBounds=!1,this._layerViews={},this.geometries={},this.map.layers.bind("reset",this._addLayers,this),this.map.layers.bind("add",this._addLayer,this),this.map.layers.bind("remove",this._removeLayer,this),this.add_related_model(this.map.layers),this.bind("clean",this._removeLayers,this)},render:function(){return this},addInfowindow:function(a){this.addOverlay(a)},addOverlay:function(a){a&&(this.$el.append(a.render().el),this.addView(a))},isMapAlreadyCreated:function(){return this.options.map_object},_setModelProperty:function(a){if(this._unbindModel(),this.map.set(a),void 0!==a.center||void 0!==a.zoom){var b=this.getBounds();this.map.set({view_bounds_sw:b[0],view_bounds_ne:b[1]}),this.autoSaveBounds&&this._saveLocation()}this._bindModel()},_bindModel:function(){this._unbindModel(),this.map.bind("change:view_bounds_sw",this._changeBounds,this),this.map.bind("change:view_bounds_ne",this._changeBounds,this),this.map.bind("change:zoom",this._setZoom,this),this.map.bind("change:scrollwheel",this._setScrollWheel,this),this.map.bind("change:keyboard",this._setKeyboard,this),this.map.bind("change:center",this._setCenter,this),this.map.bind("change:attribution",this.setAttribution,this)},_unbindModel:function(){this.map.unbind("change:view_bounds_sw",null,this),this.map.unbind("change:view_bounds_ne",null,this),this.map.unbind("change:zoom",null,this),this.map.unbind("change:scrollwheel",null,this),this.map.unbind("change:keyboard",null,this),this.map.unbind("change:center",null,this),this.map.unbind("change:attribution",null,this)},_changeBounds:function(){var a=this.map.getViewBounds();a&&this.showBounds(a)},showBounds:function(a){this.map.fitBounds(a,this.getSize())},_addLayers:function(a,b){var c=this;this._removeLayers(),this.map.layers.each(function(d){c._addLayer(d,a,{silent:b&&b.silent||!1,index:b&&b.index})})},_addLayer:function(a,b,c){var d;d="CartoDB"===a.get("type")?this._addGroupedLayer(a):this._addIndividualLayer(a),d&&this._addLayerToMap(d,a,{silent:c.silent,index:c.index})},_addGroupedLayer:function(a){var b;return this._cartoDBLayerGroup?(this._cartoDBLayerGroup.layers.add(a),this._layerViews[a.cid]=this.getLayerViewByLayerCid(this._cartoDBLayerGroup.layers.at(0).cid)):(this._cartoDBLayerGroup=this._newCartoDBLayerGroup(a),b=this.createLayer(this._cartoDBLayerGroup),this._layerViews[a.cid]=b),b},_newCartoDBLayerGroup:function(a){var b=h,c=this.map.getWindshaftMap();return c.isNamedMap()&&(b=g),new b({},{windshaftMap:c,layers:[a]})},_addIndividualLayer:function(a){var b=this.createLayer(a);return b&&(this._layerViews[a.cid]=b),b},createLayer:function(a){return this._layerViewFactory.createLayerView(a,this.getNativeMap())},_removeLayers:function(){for(var a in this._layerViews){var b=this._layerViews[a];b.remove(),delete this._layerViews[a]}},_removeLayer:function(a){var b=this._layerViews[a.cid];"CartoDB"===a.get("type")?(this._cartoDBLayerGroup.layers.remove(a),0===this._cartoDBLayerGroup.layers.size()&&(delete this._cartoDBLayerGroup,b.remove())):b.remove(),delete this._layerViews[a.cid]},getLayerViewByLayerCid:function(a){var b=this._layerViews[a];return b||e.debug("layer with cid "+a+" can't be get"),b},setAttribution:function(){throw new Error("Subclasses of src/geo/map-view.js must implement .setAttribution")},getNativeMap:function(){throw new Error("Subclasses of src/geo/map-view.js must implement .getNativeMap")},_addLayerToMap:function(){throw new Error("Subclasses of src/geo/map-view.js must implement ._addLayerToMap")},_setZoom:function(a,b){throw new Error("Subclasses of src/geo/map-view.js must implement ._setZoom")},_setCenter:function(a,b){throw new Error("Subclasses of src/geo/map-view.js must implement ._setCenter")},_addGeomToMap:function(a){throw new Error("Subclasses of src/geo/map-view.js must implement ._addGeomToMap")},_removeGeomFromMap:function(a){throw new Error("Subclasses of src/geo/map-view.js must implement ._removeGeomFromMap")},setAutoSaveBounds:function(){this.autoSaveBounds=!0},_saveLocation:d.debounce(function(){this.map.save(null,{silent:!0})},1e3),_addGeometry:function(a){var b=this._addGeomToMap(a);this.geometries[a.cid]=b},_removeGeometry:function(a){var b=this.geometries[a.cid];this._removeGeomFromMap(b),delete this.geometries[a.cid]}});b.exports=i},{"../core/view":171,"./cartodb-layer-group-anonymous-map":185,"./cartodb-layer-group-named-map":187,"cdb.log":158,underscore:148}],227:[function(a,b,c){var d=(a("jquery"),a("underscore")),e=a("leaflet"),f=a("backbone"),g=a("cdb.config"),h=a("cdb.log"),i=a("../core/model"),j=a("./map/layers"),k=a("../core/sanitize"),l=a("../vis/layers"),m=i.extend({defaults:{attribution:[g.get("cartodb_attributions")],center:[0,0],zoom:4,minZoom:0,maxZoom:20,scrollwheel:!0,drag:!0,keyboard:!0,provider:"leaflet",vector:!1},RELOAD_DEBOUNCE_TIME:10,initialize:function(a,b){b=b||{},this.layers=new j,this.geometries=new f.Collection,this._windshaftMap=b.windshaftMap,this._dataviewsCollection=b.dataviewsCollection,a=a||{},a.bounds?(this.set({view_bounds_sw:a.bounds[0],view_bounds_ne:a.bounds[1],original_view_bounds_sw:a.bounds[0],original_view_bounds_ne:a.bounds[1]}),this.unset("bounds")):this.set({center:a.center||this.defaults.center,original_center:a.center||this.defaults.center,zoom:a.zoom||this.defaults.zoom})},createCartoDBLayer:function(a,b){return this._checkProperties(a,["sql","cartocss"]),this._addNewLayerModel("cartodb",a,b)},createTorqueLayer:function(a,b){return this._checkProperties(a,["sql","cartocss"]),this._addNewLayerModel("torque",a,b)},createTileLayer:function(a,b){return this._checkProperties(a,["urlTemplate"]),this._addNewLayerModel("tiled",a,b)},createWMSLayer:function(a,b){return this._checkProperties(a,["urlTemplate"]),this._addNewLayerModel("wms",a,b)},createGMapsBaseLayer:function(a,b){return this._checkProperties(a,["base_type"]),this._addNewLayerModel("gmapsbase",a,b)},createPlainLayer:function(a,b){return this._checkProperties(a,["color"]),this._addNewLayerModel("plain",a,b)},createBackgroundLayer:function(a,b){return this._checkProperties(a,["image"]),this._addNewLayerModel("plain",a,b)},_checkProperties:function(a,b){var c=d.select(b,function(b){return void 0===a[b]});if(c.length)throw new Error("The following attributes are missing: "+c.join(","))},_addNewLayerModel:function(a,b,c){c=c||{};var d=c.silent,e=l.create(a,b,{map:this});return this.listenTo(e,"destroy",this._removeLayerModelFromCollection),this.layers.add(e,{silent:d}),e},_removeLayerModelFromCollection:function(a){return this.layers.remove(a)},_initBinds:function(){this.layers.bind("reset",function(){this.layers.size()>=1&&this._adjustZoomtoLayer(this.layers.models[0])},this),this.layers.bind("reset",this._onLayersResetted,this),this.layers.bind("add",this._onLayerAdded,this),this.layers.bind("remove",this._onLayerRemoved,this),this.layers.bind("change:attribution",this._updateAttributions,this),this._dataviewsCollection&&this.listenTo(this._dataviewsCollection,"add",d.debounce(this._onDataviewAdded.bind(this),10))},instantiateMap:function(){this._initBinds(),this.reload()},_onLayersResetted:function(){this.reload(),this._updateAttributions()},_onLayerAdded:function(a){this.reload({sourceLayerId:a.get("id")}),this._updateAttributions()},_onLayerRemoved:function(){this.reload(),this._updateAttributions()},_onDataviewAdded:function(a){this.reload()},reload:d.debounce(function(a){if(this._windshaftMap){var b={layers:this.layers.models,sourceLayerId:a&&a.sourceLayerId,forceFetch:a&&a.forceFetch};this._dataviewsCollection&&(b.dataviews=this._dataviewsCollection),this._windshaftMap.createInstance(b)}},this.RELOAD_DEBOUNCE_TIME),_updateAttributions:function(){var a=this.defaults.attribution[0],b=d.chain(this.layers.models).map(function(a){return k.html(a.get("attribution"))}).reject(function(b){return b===a}).compact().uniq().value();b.push(a),this.set("attribution",b)},getWindshaftMap:function(){return this._windshaftMap},setView:function(a,b){this.set({center:a,zoom:b},{silent:!0}),this.trigger("set_view")},setZoom:function(a){this.set({zoom:a})},enableKeyboard:function(){this.set({keyboard:!0})},disableKeyboard:function(){this.set({keyboard:!1})},enableScrollWheel:function(){this.set({scrollwheel:!0})},disableScrollWheel:function(){this.set({scrollwheel:!1})},getZoom:function(){return this.get("zoom")},setCenter:function(a){this.set({center:a})},setOptions:function(a){if("object"!=typeof a||a.length){if(this.options.debug)throw a+" options has to be an object"}else d.defaults(this.options,a)},getViewBounds:function(){return this.has("view_bounds_sw")&&this.has("view_bounds_ne")?[this.get("view_bounds_sw"),this.get("view_bounds_ne")]:null},getLayerAt:function(a){return this.layers.at(a)},getLayerViewByLayerCid:function(a){return this.layers.get(a)},_adjustZoomtoLayer:function(a){var b=parseInt(a.get("maxZoom"),10),c=parseInt(a.get("minZoom"),10);d.isNumber(b)&&!d.isNaN(b)&&(this.get("zoom")>b?this.set({zoom:b,maxZoom:b}):this.set("maxZoom",b)),d.isNumber(c)&&!d.isNaN(c)&&(this.get("zoom")<c?this.set({minZoom:c,zoom:c}):this.set("minZoom",c))},addLayer:function(a,b){return 0==this.layers.size()&&this._adjustZoomtoLayer(a),this.layers.add(a,b),this.trigger("layerAdded"),1===this.layers.length&&this.trigger("firstLayerAdded"),a.cid},removeLayer:function(a){this.layers.remove(a)},removeLayerByCid:function(a){var b=this.layers.get(a);b?this.removeLayer(b):h.error("There's no layer with cid = "+a+".")},removeLayerAt:function(a){var b=this.layers.at(a);b?this.removeLayer(b):h.error("There's no layer in that position.")},clearLayers:function(){for(;this.layers.length>0;)this.removeLayer(this.layers.at(0))},getBaseLayer:function(){return this.layers.at(0)},isBaseLayerAdded:function(a){var b=this.getBaseLayer();return b&&a.isEqual(b)},getLayerTemplate:function(){var a=this.getBaseLayer();return a&&a.get("options")?a.get("options").urlTemplate:void 0},addGeometry:function(a){this.geometries.add(a)},removeGeometry:function(a){this.geometries.remove(a)},reCenter:function(){var a=this.get("original_view_bounds_sw"),b=this.get("original_view_bounds_ne"),c=this.get("original_center");a&&b?this.setBounds([a,b]):this.setCenter(c)},setBounds:function(a){this.attributes.view_bounds_sw=[a[0][0],a[0][1]],this.attributes.view_bounds_ne=[a[1][0],a[1][1]],this.trigger("change:view_bounds_ne",this)},fitBounds:function(a,b){var c=this.getBoundsZoom(a,b);if(null!==c){var d=m.latlngToMercator(a[0],c),e=m.latlngToMercator(a[1],c),f=m.mercatorToLatLng({x:.5*(d[0]+e[0]),y:.5*(d[1]+e[1])},c);this.set({center:f,zoom:c})}},getBoundsZoom:function(a,b){if(0===b.x||0===b.y)return null;var c,d,e=[b.x,b.y],f=this.get("minZoom")||0,g=this.get("maxZoom")||24,h=a[1],i=a[0],j=[],k=!0;do f++,c=m.latlngToMercator(h,f),d=m.latlngToMercator(i,f),j[0]=Math.abs(c[0]-d[0]),j[1]=Math.abs(d[1]-c[1]),k=j[0]<=e[0]||j[1]<=e[1];while(k&&g>=f);return k?g:f-1}},{latlngToMercator:function(a,b){var c=new e.LatLng(a[0],a[1]),d=e.CRS.EPSG3857.latLngToPoint(c,b);return[d.x,d.y]},mercatorToLatLng:function(a,b){var c=e.CRS.EPSG3857.pointToLatLng(a,b);return[c.lat,c.lng]}});b.exports=m},{"../core/model":165,"../core/sanitize":167,"../vis/layers":296,"./map/layers":231,backbone:1,"cdb.config":155,"cdb.log":158,jquery:57,leaflet:58,underscore:148}],228:[function(a,b,c){var d=a("underscore"),e=a("cdb.config"),f=a("./layer-model-base"),g=f.extend({defaults:{attribution:e.get("cartodb_attributions"),type:"CartoDB",visible:!0},initialize:function(a,b){f.prototype.initialize.apply(this,arguments),b=b||{},this._map=b.map,this.bind("change:visible change:sql change:cartocss",this._onAttributeChanged,this)},_onAttributeChanged:function(){this._map.reload({sourceLayerId:this.get("id")})},hasInteraction:function(){return this.isVisible()&&(this.containInfowindow()||this.containTooltip())},isVisible:function(){return this.get("visible")},getTooltipFieldNames:function(){var a=[],b=this.getTooltipData();return b&&b.fields&&(a=d.pluck(b.fields,"name")),a},getTooltipData:function(){var a=this.get("tooltip");return a&&a.fields&&a.fields.length?a:null},containInfowindow:function(){return!!this.getTooltipData()},getInfowindowFieldNames:function(){var a=[],b=this.getInfowindowData();return b&&b.fields&&(a=d.pluck(b.fields,"name")),a},getInfowindowData:function(){var a=this.get("infowindow");return a&&a.fields&&a.fields.length?a:null},containTooltip:function(){return!!this.getInfowindowData()},getInteractiveColumnNames:function(){var a=d.union(this.getInfowindowFieldNames(),this.getTooltipFieldNames());return a.length&&a.unshift("cartodb_id"),d.uniq(a)},getName:function(){return this.get("options")&&this.get("options").layer_name||this.get("layer_name")},setDataProvider:function(a){this._dataProvider=a},getDataProvider:function(){return this._dataProvider}});b.exports=g},{"./layer-model-base":230,"cdb.config":155,underscore:148}],229:[function(a,b,c){var d=a("./layer-model-base"),e=d.extend({OPTIONS:["roadmap","satellite","terrain","custom"],defaults:{type:"GMapsBase",base_type:"gray_roadmap",style:null}});b.exports=e},{"./layer-model-base":230}],230:[function(a,b,c){var d=a("underscore"),e=a("cdb.log"),f=a("cdb"),g=a("../../core/model"),h=g.extend({defaults:{visible:!0,type:"Tiled"},initialize:function(){this.bind("change:type",function(){e.error("changing layer type is not allowed, remove it and add a new one instead")})},remove:function(){this.trigger("destroy",this)},update:function(a){this.set(a)},show:function(){this.set("visible",!0)},hide:function(){this.set("visible",!1)},toggle:function(){this.set("visible",!this.get("visible"))},isEqual:function(a){var b=this.toJSON(),c=a.toJSON(),e=["id","order"];d.each(e,function(a){delete b[a],delete c[a],b.options&&delete b.options[a],c.options&&delete c.options[a]});var g,h,i=b.type?b.type:b.options.type,j=c.type?c.type:c.options.type;if(i&&i===j){if("Tiled"===i){g=b.urlTemplate?b.urlTemplate:b.options.urlTemplate,h=c.urlTemplate?c.urlTemplate:c.options.urlTemplate;var k=b.name?b.name:b.options.name,l=c.name?c.name:c.options.name;return g===h&&k===l}if("WMS"===i){g=b.urlTemplate?b.urlTemplate:b.options.urlTemplate,h=c.urlTemplate?c.urlTemplate:c.options.urlTemplate;var m=b.layers?b.layers:b.options.layers,n=c.layers?c.layers:c.options.layers;return g===h&&m===n}if("torque"===i)return f.geo.TorqueLayer.prototype.isEqual.call(this,a);if("named_map"===i)return f.geo.CartoDBNamedMapLayer.prototype.isEqual.call(this,a);var o=b.base_type?b.base_type:b.options.base_type;return o?!!d.isEqual(b,c):!0}return!1}});b.exports=h},{"../../core/model":165,cdb:157,"cdb.log":158,underscore:148}],231:[function(a,b,c){var d=a("backbone"),e=a("./layer-model-base"),f="Tiled",g="CartoDB",h="torque",i=d.Collection.extend({model:e,initialize:function(){this.comparator=function(a){return parseInt(a.get("order"),10)},this.bind("add",this._assignIndexes),this.bind("remove",this._assignIndexes)},_assignIndexes:function(a,b,c){if(this.size()>0&&(this.at(0).set({order:0}),this.size()>1)){for(var d={},e=1;e<this.size();++e){
var i=this.at(e),j=i.get("type");d[j]=d[j]||[],d[j].push(i)}for(var k=0,l=[g,h,f],e=0;e<l.length;++e)for(var m=l[e],n=d[m]||[],o=0;o<n.length;++o){var i=n[o];i.set({order:++k})}}}});b.exports=i},{"./layer-model-base":230,backbone:1}],232:[function(a,b,c){var d=a("./layer-model-base"),e=d.extend({defaults:{type:"Plain",base_type:"plain",className:"plain",color:"#FFFFFF",image:""}});b.exports=e},{"./layer-model-base":230}],233:[function(a,b,c){var d=a("./layer-model-base"),e=d.extend({getTileLayer:function(){}});b.exports=e},{"./layer-model-base":230}],234:[function(a,b,c){var d=a("underscore"),e=a("./layer-model-base"),f=e.extend({defaults:{type:"torque",visible:!0,isRunning:!1,renderRange:{start:void 0,end:void 0},steps:0,step:0,time:void 0},initialize:function(a,b){e.prototype.initialize.apply(this,arguments),b=b||{},this._map=b.map},play:function(){this.set("isRunning",!0)},pause:function(){this.set("isRunning",!1)},setStep:function(a){this.set("step",a)},renderRange:function(a,b){this.set("renderRange",{start:a,end:b})},resetRenderRange:function(){this.set("renderRange",{})},isEqual:function(a){var b=["query","query_wrapper","cartocss"],c=this;return this.get("type")===a.get("type")&&d.every(b,function(b){return a.get(b)===c.get(b)})},isVisible:function(){return!0},getName:function(){return this.get("layer_name")||this.get("table_name")},getInfowindowData:function(){var a=this.get("infowindow");return a&&a.fields&&a.fields.length?a:null},getTooltipData:function(){return null},getInteractiveColumnNames:function(){return[]},getInfowindowFieldNames:function(){return[]},hasInteraction:function(){return this.getInteractiveColumnNames()>0},fetchAttributes:function(a,b,c){},setDataProvider:function(a){this._dataProvider=a},getDataProvider:function(){return this._dataProvider},timeToStep:function(a){var b=this.get("steps"),c=this.get("start"),d=this.get("end"),e=b*(1e3*a-c)/(d-c);return e}});b.exports=f},{"./layer-model-base":230,underscore:148}],235:[function(a,b,c){var d=a("./layer-model-base"),e=d.extend({defaults:{service:"WMS",request:"GetMap",version:"1.1.1",layers:"",styles:"",format:"image/jpeg",transparent:!1}});b.exports=e},{"./layer-model-base":230}],236:[function(a,b,c){var d=a("underscore");b.exports={_initialAttrs:function(a){var b=a.get("extra_params");return{table:a.get("table_name"),user:a.get("user_name"),column:a.get("property"),blendmode:a.get("torque-blend-mode"),resolution:1,countby:"count(cartodb_id)",sql_api_domain:a.get("sql_api_domain"),sql_api_protocol:a.get("sql_api_protocol"),sql_api_port:a.get("sql_api_port"),tiler_protocol:a.get("tiler_protocol"),tiler_domain:a.get("tiler_domain"),tiler_port:a.get("tiler_port"),maps_api_template:a.get("maps_api_template"),stat_tag:a.get("stat_tag"),animationDuration:a.get("torque-duration"),steps:a.get("torque-steps"),sql:this._getQuery(a),visible:a.get("visible"),extra_params:{api_key:b?b.map_key:""},attribution:a.get("attribution"),cartocss:a.get("cartocss")||a.get("tile_style"),named_map:a.get("named_map"),auth_token:a.get("auth_token"),no_cdn:a.get("no_cdn"),loop:!(a.get("loop")===!1)}},_init:function(a){a.get("visible")&&this.play(),this.on("tilesLoaded",function(){this.trigger("load")},this),this.on("tilesLoading",function(){this.trigger("loading")},this),this.on("change:time",function(a){this._setModelAttrs({step:a.step,time:a.time,renderRange:{start:a.start,end:a.end}})},this),this.on("change:steps",function(a){this._setModelAttrs({steps:a.steps})},this),this.on("play",function(){this._callModel("play")}),this.on("pause",function(){this._callModel("pause")}),a.set({isRunning:this.isRunning(),time:this.getTime(),step:this.getStep(),steps:a.get("torque-steps")||this.provider&&this.provider.getSteps()||this.options.steps||0}),this._onModel()},_setModelAttrs:function(a){this._unonModel(),this.model.set(a),this._onModel()},_callModel:function(a){this._unonModel();var b=Array.prototype.slice.call(arguments,1);this.model[a].apply(this.model,b),this._onModel()},_onModel:function(){this._unonModel(),this.listenTo(this.model,"change:isRunning",this._isRunningChanged),this.listenTo(this.model,"change:time",this._timeChanged),this.listenTo(this.model,"change:step",this._stepChanged),this.listenTo(this.model,"change:steps",this._stepsChanged),this.listenTo(this.model,"change:renderRange",this._renderRangeChanged)},_unonModel:function(){this.stopListening(this.model,"change:isRunning",this._isRunningChanged),this.stopListening(this.model,"change:time",this._timeChanged),this.stopListening(this.model,"change:step",this._stepChanged),this.stopListening(this.model,"change:steps",this._stepsChanged),this.stopListening(this.model,"change:renderRange",this._renderRangeChanged)},_isRunningChanged:function(a,b){b?this.play():this.pause()},_timeChanged:function(a,b){this.setStep(this.timeToStep(b))},_stepChanged:function(a,b){this.setStep(b)},_stepsChanged:function(a,b){this.setSteps(b)},_renderRangeChanged:function(a,b){d.isObject(b)&&d.isNumber(b.start)&&d.isNumber(b.end)?this.renderRange(b.start,b.end):this.resetRenderRange()},_getQuery:function(a){var b=a.get("query"),c=a.get("query_wrapper");return c&&(b=d.template(c)({sql:b||"select * from "+a.get("table_name")})),b}}},{underscore:148}],237:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../core/model"),g=a("../../core/template"),h=a("../../core/view"),i=a("../../core/sanitize"),j=h.extend({className:"cartodb-overlay overlay-annotation",defaults:{minZoom:0,maxZoom:40,style:{textAlign:"left",zIndex:5,color:"#ffffff",fontSize:"13",fontFamilyName:"Helvetica",boxColor:"#333333",boxOpacity:.7,boxPadding:10,lineWidth:50,lineColor:"#333333"}},template:g.compile('<div class="content">    <div class="text widget_text">{{{ text }}}</div>    <div class="stick"><div class="ball"></div></div>    </div>',"mustache"),events:{click:"stopPropagation"},stopPropagation:function(a){a.stopPropagation()},initialize:function(){this.template=this.options.template||this.template,this.mapView=this.options.mapView,this.mobileEnabled=/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),this._cleanStyleProperties(this.options.style),d.defaults(this.options.style,this.defaults.style),this._setupModels(),this._bindMap()},_setupModels:function(){this.model=new f({display:!0,hidden:!1,text:this.options.text,latlng:this.options.latlng,minZoom:this.options.minZoom||this.defaults.minZoom,maxZoom:this.options.maxZoom||this.defaults.maxZoom}),this.model.on("change:display",this._onChangeDisplay,this),this.model.on("change:text",this._onChangeText,this),this.model.on("change:latlng",this._place,this),this.model.on("change:minZoom",this._applyZoomLevelStyle,this),this.model.on("change:maxZoom",this._applyZoomLevelStyle,this),this.style=new f(this.options.style),this.style.on("change",this._applyStyle,this),this.add_related_model(this.style)},_bindMap:function(){this.mapView.map.bind("change",this._place,this),this.mapView.map.bind("change:zoom",this._applyZoomLevelStyle,this),this.mapView.bind("zoomstart",this.hide,this),this.mapView.bind("zoomend",this.show,this)},_unbindMap:function(){this.mapView.map.unbind("change",this._place,this),this.mapView.map.unbind("change:zoom",this._applyZoomLevelStyle,this),this.mapView.unbind("zoomstart",this.hide,this),this.mapView.unbind("zoomend",this.show,this)},_onChangeDisplay:function(){this.model.get("display")?this.show():this.hide()},_onChangeText:function(){this.$el.find(".text").html(this._sanitizedText())},_sanitizedText:function(){return i.html(this.model.get("text"),this.model.get("sanitizeText"))},_getStandardPropertyName:function(a){if(a){var b=a.split("-");return 1===b.length?a:b[0]+d.map(b.slice(1),function(a){return a.slice(0,1).toUpperCase()+a.slice(1)}).join("")}},_cleanStyleProperties:function(a){var b={};d.each(a,function(a,c){b[this._getStandardPropertyName(c)]=a},this),this.options.style=b},_belongsToCanvas:function(){var a="mobile"===this.options.device;return a===this.mobileEnabled},show:function(a){if(!this.model.get("hidden")&&this._belongsToCanvas()){this.$el.css({opacity:0,display:"inline-table"}),this.$el.stop().animate({opacity:1},{duration:150,complete:function(){a&&a()}})}},hide:function(a){this.$el.stop().fadeOut(150,function(){a&&a()})},_place:function(){var a=this.model.get("latlng"),b=this.style.get("lineWidth"),c=this.style.get("textAlign"),d=this.mapView.latLonToPixel(a);if(d){var e=d.y-this.$el.height()/2,f=d.x+b;"right"===c&&(f=d.x-this.$el.width()-b-this.$el.find(".ball").width()),this.$el.css({top:e,left:f})}},setMinZoom:function(a){this.model.set("minZoom",a)},setMaxZoom:function(a){this.model.set("maxZoom",a)},setPosition:function(a){this.model.set("latlng",a)},setText:function(a){this.model.set("text",a)},setStyle:function(a,b){var c=this._getStandardPropertyName(a);c&&this.style.set(c,b)},_applyStyle:function(){var a=this.style.get("color"),b=this.style.get("textAlign"),c=(this.style.get("boxColor"),this.style.get("boxOpacity"),this.style.get("boxPadding")),d=this.style.get("lineWidth"),e=(this.style.get("lineColor"),this.style.get("fontFamilyName"));this.$text=this.$el.find(".text"),this.$text.css({color:a,textAlign:b}),this.$el.find(".content").css("padding",c),this.$text.css("font-size",this.style.get("fontSize")+"px"),this.$el.css("z-index",this.style.get("zIndex")),this.$el.find(".stick").css({width:d,left:-d});var f="";"Droid Sans"==e?f="droid":"Vollkorn"==e?f="vollkorn":"Open Sans"==e?f="open_sans":"Roboto"==e?f="roboto":"Lato"==e?f="lato":"Graduate"==e?f="graduate":"Gravitas One"==e?f="gravitas_one":"Old Standard TT"==e&&(f="old_standard_tt"),this.$el.removeClass("droid").removeClass("vollkorn").removeClass("roboto").removeClass("open_sans").removeClass("lato").removeClass("graduate").removeClass("gravitas_one").removeClass("old_standard_tt"),this.$el.addClass(f),"right"===b?(this.$el.addClass("align-right"),this.$el.find(".stick").css({left:"auto",right:-d})):this.$el.removeClass("align-right"),this._place(),this._applyZoomLevelStyle()},_getRGBA:function(a,b){return"rgba("+parseInt(a.slice(-6,-4),16)+","+parseInt(a.slice(-4,-2),16)+","+parseInt(a.slice(-2),16)+","+b+" )"},_applyZoomLevelStyle:function(){var a=this.style.get("boxColor"),b=this.style.get("boxOpacity"),c=this.style.get("lineColor"),d=this.model.get("minZoom"),e=this.model.get("maxZoom"),f=this.mapView.map.get("zoom");if(f>=d&&e>=f){var g=this._getRGBA(c,1),h=this._getRGBA(a,b);this.$el.find(".text").animate({opacity:1},150),this.$el.css("background-color",h),this.$el.find(".stick").css("background-color",g),this.$el.find(".ball").css("background-color",g),this.model.set("hidden",!1),this.model.set("display",!0)}else this.model.set("hidden",!0),this.model.set("display",!1)},clean:function(){this._unbindMap(),h.prototype.clean.call(this)},_fixLinks:function(){this.$el.find("a").each(function(a,b){e(this).attr("target","_top")})},render:function(){var a=d.clone(this.model.attributes);a.text=this._sanitizedText(),this.$el.html(this.template(a)),this._fixLinks();var b=this;return setTimeout(function(){b._applyStyle(),b._applyZoomLevelStyle(),b.show()},500),this}});b.exports=j},{"../../core/model":165,"../../core/sanitize":167,"../../core/template":169,"../../core/view":171,jquery:57,underscore:148}],238:[function(require,module,exports){require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button type="button" class="CDB-Attribution-button js-button">?</button> <div class="CDB-Attribution-text js-text">'+(null==(__t=attributions)?"":__t)+"</div>";return __p}},{underscore:148}],239:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("../../../core/view"),g=a("../../../core/model"),h=a("./attribution-template.tpl"),i=a("../../../core/sanitize"),j=f.extend({className:"CDB-Attribution",events:{"click .js-button":"_toggleAttributions",dblclick:"killEvent"},initialize:function(){this.model=new g({visible:!1}),this.map=this.options.map,this.model.bind("change:visible",function(a,b){this[b?"_showAttributions":"_hideAttributions"]()},this),e.bindAll(this,"_onKeyDown","_toggleAttributions")},render:function(){this._disableBinds();var a=e.compact(this.map.get("attribution")).join(", "),b="leaflet"!==this.map.get("provider");return this.$el.html(h({attributions:i.html(a)})),this.$el.toggleClass("CDB-Attribution--gmaps",!!b),this},_initBinds:function(){d(document).bind("keydown",this._onKeyDown),d(document).bind("click",this._toggleAttributions),this.map.bind("change:attribution",this.render,this)},_disableBinds:function(){d(document).unbind("keydown",this._onKeyDown),d(document).unbind("click",this._toggleAttributions),this.map.unbind(null,null,this)},_onKeyDown:function(a){a&&27===a.keyCode&&this._toggleAttributions()},_showAttributions:function(){this.$el.addClass("is-active"),this._initBinds()},_hideAttributions:function(){this.$el.removeClass("is-active"),this._disableBinds()},_toggleAttributions:function(a){a&&a.stopPropagation&&this.killEvent(a),this.model.set("visible",!this.model.get("visible"))},clean:function(){this._disableBinds(),f.prototype.clean.call(this)}});b.exports=j},{"../../../core/model":165,"../../../core/sanitize":167,"../../../core/view":171,"./attribution-template.tpl":238,jquery:57,underscore:148}],240:[function(a,b,c){var d=a("underscore"),e=a("../../core/sanitize"),f=a("../../core/view"),g=f.extend({className:"cartodb-header",initialize:function(){var a=this.model.get("extra");this.model.set({title:a.title,description:a.description,show_title:a.show_title,show_description:a.show_description},{silent:!0})},show:function(){var a=this.model.get("title")&&this.model.get("show_title"),b=this.model.get("description")&&this.model.get("show_description");(a||b)&&(this.$el.show(),a&&this.$el.find(".content div.title").show(),b&&this.$el.find(".content div.description").show())},_setLinksTarget:function(a){if(!a)return a;var b=new RegExp(/<(a)([^>]+)>/g);return a.replace(b,'<$1 target="_blank"$2>')},render:function(){var a=d.clone(this.model.attributes);return a.title=e.html(a.title),a.description=this._setLinksTarget(e.html(a.description)),this.$el.html(this.options.template(a)),this.model.get("show_title")||this.model.get("show_description")?this.show():this.hide(),this}});b.exports=g},{"../../core/sanitize":167,"../../core/view":171,underscore:148}],241:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../core/sanitize"),g=a("./text");b.exports=g.extend({className:"cartodb-overlay image-overlay",events:{click:"stopPropagation"},default_options:{},stopPropagation:function(a){a.stopPropagation()},initialize:function(){d.defaults(this.options,this.default_options),this.template=this.options.template;var a=this;e(window).on("map_resized",function(){a._place()}),e(window).on("resize",function(){a._place()})},_applyStyle:function(){var a=this.model.get("style"),b=a["box-color"],c=a["box-opacity"],d=a["box-width"];this.$el.find(".text").css(a),this.$el.css("z-index",a["z-index"]);var e="rgba("+parseInt(b.slice(-6,-4),16)+","+parseInt(b.slice(-4,-2),16)+","+parseInt(b.slice(-2),16)+", "+c+" )";this.$el.css({backgroundColor:e}),this.$el.find("img").css({width:d})},render:function(){var a;a=this.model.get("extra").has_default_image?d.template('<img src="<%- url %>" />')({url:this.model.get("extra").public_default_image_url}):f.html(this.model.get("extra").rendered_text,this.model.get("sanitizeContent"));var b=d.chain(this.model.attributes).clone().extend({content:a}).value();this.$el.html(this.template(b));var c=this;return setTimeout(function(){c._applyStyle(),c._place(),c.show()},900),this}})},{"../../core/sanitize":167,"./text":278,jquery:57,underscore:148}],242:[function(a,b,c){var d=a("underscore"),e=a("../../core/view"),f=a("../../core/template"),g=e.extend({className:"cartodb-infobox",defaults:{pos_margin:20,position:"bottom|right",width:200},initialize:function(){d.defaults(this.options,this.defaults),this.options.layer&&this.enable(),this.setTemplate(this.options.template||this.defaultTemplate,"mustache")},setTemplate:function(a){this.template=f.compile(a,"mustache")},enable:function(){this.options.layer&&this.options.layer.on("featureOver",function(a,b,c,d){this.render(d).show()},this).on("featureOut",function(){this.hide()},this)},disable:function(){this.options.layer&&this.options.layer.off(null,null,this)},setPosition:function(a){var b={};-1!==a.indexOf("top")?b.top=this.options.pos_margin:-1!==a.indexOf("bottom")&&(b.bottom=this.options.pos_margin),-1!==a.indexOf("left")?b.left=this.options.pos_margin:-1!==a.indexOf("right")&&(b.right=this.options.pos_margin),this.$el.css(b)},render:function(a){return this.$el.html(this.template(a)),this.options.width&&this.$el.css("width",this.options.width),this.options.position&&this.setPosition(this.options.position),this}});b.exports=g},{"../../core/template":169,"../../core/view":171,underscore:148}],243:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("backbone"),g=f.Model.extend({SYSTEM_COLUMNS:["the_geom","the_geom_webmercator","created_at","updated_at","cartodb_id","cartodb_georef_status"],defaults:{template_name:"infowindow_light",latlng:[0,0],offset:[28,0],maxHeight:180,autoPan:!0,template:"",content:"",visibility:!1,alternative_names:{},fields:null},clearFields:function(){this.set({fields:[]})},saveFields:function(a){a=a||"old_fields",this.set(a,d.clone(this.get("fields")))},fieldCount:function(){var a=this.get("fields");return a?a.length:0},restoreFields:function(a,b){b=b||"old_fields";var c=this.get(b);a&&(c=c.filter(function(b){return d.contains(a,b.name)})),c&&c.length&&this._setFields(c),this.unset(b)},_cloneFields:function(){return d(this.get("fields")).map(function(a){return d.clone(a)})},_setFields:function(a){a.sort(function(a,b){return a.position-b.position}),this.set({fields:a})},sortFields:function(){this.get("fields").sort(function(a,b){return a.position-b.position})},_addField:function(a,b){var c=e.Deferred();if(!this.containsField(a)){var d=this.get("fields");d?(b=void 0===b?d.length:b,d.push({name:a,title:!0,position:b})):(b=void 0===b?0:b,this.set("fields",[{name:a,title:!0,position:b}],{silent:!0}))}return c.resolve(),c.promise()},addField:function(a,b){var c=this;return e.when(this._addField(a,b)).then(function(){c.sortFields(),c.trigger("change:fields"),c.trigger("add:fields")}),this},getFieldProperty:function(a,b){if(this.containsField(a)){var c=this.get("fields")||[],e=d.indexOf(d(c).pluck("name"),a);return c[e][b]}return null},setFieldProperty:function(a,b,c){if(this.containsField(a)){var e=this._cloneFields()||[],f=d.indexOf(d(e).pluck("name"),a);e[f][b]=c,this._setFields(e)}return this},getAlternativeName:function(a){return this.get("alternative_names")&&this.get("alternative_names")[a]},setAlternativeName:function(a,b){var c=this.get("alternative_names")||[];c[a]=b,this.set({alternative_names:c}),this.trigger("change:alternative_names")},getFieldPos:function(a){var b=this.getFieldProperty(a,"position");return void 0==b?Number.MAX_VALUE:b},containsAlternativeName:function(a){var b=this.get("alternative_names")||[];return b[a]},containsField:function(a){var b=this.get("fields")||[];return d.contains(d(b).pluck("name"),a)},removeField:function(a){if(this.containsField(a)){var b=this._cloneFields()||[],c=d.indexOf(d(b).pluck("name"),a);c>=0&&b.splice(c,1),this._setFields(b),this.trigger("remove:fields")}return this},updateContent:function(a){var b=this.get("fields");this.set("content",g.contentForFields(a,b))},closeInfowindow:function(){this.get("visibility")&&(this.set("visibility",!1),this.trigger("close"))}},{contentForFields:function(a,b,c){c=c||{};for(var d=[],e=0;e<b.length;++e){var f=b[e],g=a[f.name];(c.empty_fields||void 0!==g&&null!==g)&&d.push({title:f.title?f.name:null,value:a[f.name],index:e})}return 0===d.length&&d.push({title:null,value:"No data available",index:0,type:"empty"}),{fields:d,data:a}}});b.exports=g},{backbone:1,jquery:57,underscore:148}],244:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("perfect-scrollbar");a("clip-path");var g=a("cdb.templates"),h=a("../../core/sanitize"),i=a("../../core/template"),j=a("../../core/view"),k=a("../../core/util"),l=j.extend({options:{imageTransitionSpeed:300,hookMargin:24,hookHeight:16},className:"CDB-infowindow-wrapper",events:{"click .close":"_closeInfowindow","touchstart .close":"_closeInfowindow","MSPointerDown .close":"_closeInfowindow",dragstart:"_checkOrigin",mousedown:"_checkOrigin",touchstart:"_checkOrigin",MSPointerDown:"_checkOrigin",dblclick:"_stopPropagation",DOMMouseScroll:"_stopBubbling",MozMousePixelScroll:"_stopBubbling",mousewheel:"_stopBubbling",dbclick:"_stopPropagation",click:"_stopPropagation"},initialize:function(){this.mapView=this.options.mapView,this.options.template&&this.model.set("template",this.options.template),this.model.get("template")?this._compileTemplate():this._setTemplate(),this._initBinds(),this.$el.hide()},render:function(){if(this.template){var a=d.map(this.model.attributes.content.fields,function(a){return d.clone(a)}),b=this.model.get("content")?this.model.get("content").data:{};if(this.model.get("template_name")){var c=d.clone(this.model.attributes.template_name);a=this._fieldsToString(a,c)}var e={};d.each(this.model.get("content").fields,function(a){e[a.title]=a.value});var f=d.extend({content:{fields:a,data:b}},e);this.$el.html(h.html(this.template(f),this.model.get("sanitizeTemplate"))),this.model.get("width")&&this.$(".js-infowindow").css("width",this.model.get("width")+"px"),this.model.get("maxHeight")&&this.$(".js-content").css("max-height",this.model.get("maxHeight")+"px"),this._containsCover()&&this._loadCover(),this.isLoadingData()||(this.model.trigger("domready",this,this.$el),this.trigger("domready",this,this.$el)),this._setupClasses(),this._renderScroll()}return this},_initBinds:function(){d.bindAll(this,"_onKeyUp","_onLoadImage","_onLoadImageError"),this.model.bind("change:content change:alternative_names change:width change:maxHeight",this.render,this),this.model.bind("change:template_name",this._setTemplate,this),this.model.bind("change:latlng",this._update,this),this.model.bind("change:visibility",this.toggle,this),this.model.bind("change:template change:sanitizeTemplate",this._compileTemplate,this),this.mapView.map.bind("change",this._updatePosition,this),this.mapView.bind("zoomstart",function(){this.hide(!0)},this),this.mapView.bind("zoomend",function(){this.show(!0)},this),this.add_related_model(this.mapView.map),this.add_related_model(this.mapView)},_onKeyUp:function(a){a&&27===a.keyCode&&this._closeInfowindow()},_renderCoverLoader:function(){var a=e("<div>").addClass("CDB-Loader js-loader");this.$(".js-cover").length>0&&this.$(".js-cover").append(a)},_startCoverLoader:function(){this.$(".js-infowindow").addClass("is-loading"),this.$(".js-loader").addClass("is-visible")},_stopCoverLoader:function(){this.$(".js-infowindow").removeClass("is-loading"),this.$(".js-loader").removeClass("is-visible")},_setupClasses:function(){var a=this.$(".js-infowindow"),b=this.$(".js-header").length,c=this.$(".js-cover").length,d=this.$(".js-content").length,e=this.$(".CDB-infowindow-title").length;c&&a.addClass("has-header-image"),b&&a.addClass("has-header"),d&&a.addClass("has-fields"),e&&a.addClass("has-title")},_renderScroll:function(){0!==this.$(".js-content").length&&(this.$(".js-infowindow").addClass("has-scroll"),f.initialize(this.$(".js-content").get(0),{wheelSpeed:2,wheelPropagation:!0,minScrollbarLength:20}))},_getModelTemplate:function(){return this.model.get("template_name")},_setTemplate:function(){this.model.get("template_name")&&(this.template=g.getTemplate(this._getModelTemplate()),this.render())},_compileTemplate:function(){var a=this.model.get("template")?this.model.get("template"):g.getTemplate(this._getModelTemplate());"function"!=typeof a?this.template=new i({template:a,type:this.model.get("template_type")||"mustache"}).asFunction():this.template=a,this.render()},_checkOrigin:function(a){var b=e(a.target).closest(".jspVerticalBar").length>0&&"touchstart"!==a.type;b||a.stopPropagation()},_fieldsToString:function(a,b){var c=[];if(a&&a.length>0){var e=this;c=d.map(a,function(a,c){return e._sanitizeField(a,b,a.index||c)})}return c},_sanitizeField:function(a,b,c){null!==a.value&&void 0!==a.value||(a.value="");var d=this.model.getAlternativeName(a.title);a.title&&d?a.title=d:a.title&&(a.title=a.title.replace(/_/g," "));var e=a.value.toString();return!a.type&&0===c&&a.value.length>35&&b&&-1!==b.search("_header_")&&(e=a.value.substr(0,32)+"..."),!a.type&&1===c&&a.value.length>35&&b&&-1!==b.search("_header_with_image")&&(e=a.value.substr(0,32)+"..."),this._isValidURL(a.value)&&(e="<a href='"+a.value+"' target='_blank' class='CDB-infowindow-link'>"+e+"</a>"),0===c&&-1!==b.search("_header_with_image")&&(e=a.value),a.value=e,a},isLoadingData:function(){return this.model.get("loading")},_containsCover:function(){return!!this.$(".js-infowindow").attr("data-cover")},_containsTemplateCover:function(){return this.$(".js-cover img").length>0},_getCoverURL:function(){var a=this.model.get("content"),b=this.$(".js-cover img").attr("src");return b?b:a&&a.fields&&a.fields.length>0?(a.fields[0].value||"").toString():!1},_loadImageHook:function(a,b,c){var d=this.$(".js-hook");if(d){var f=e("<img />").attr("src",c);d.append(f),f.attr("data-clipPath","M0,0 L0,16 L24,0 L0,0 Z"),f.clipPath(a.width,a.height,-this.options.hookMargin,a.height-this.options.hookHeight),f.load(function(){d.parent().addClass("has-image"),f.css({marginTop:-b.height,width:b.width})})}},_loadCoverFromTemplate:function(a){this.$(".js-cover img").remove(),this._loadCoverFromUrl(a)},_loadCoverFromUrl:function(a){var b=this.$(".js-cover");this._startCoverLoader();var c=e("<img class='CDB-infowindow-media-item' />").attr("src",a);b.append(c),c.load(this._onLoadImage).error(this._onLoadImageError)},_onLoadImageError:function(){this._stopCoverLoader(),this._showInfowindowImageError()},_onLoadImage:function(){var a=this.$(".js-cover"),b=this.$(".CDB-infowindow-media-item"),c=b.attr("src"),d={width:b.width(),height:b.height()},e={width:a.width(),height:a.height()},f=this._calcImageStyle(d,e);b.css(f),a.css({height:d.height-this.options.hookHeight}),this._stopCoverLoader(),b.fadeIn(150),this._loadImageHook(d,e,c)},_calcImageStyle:function(a,b){var c={},d=a.height/a.width,e=b.height/b.width;return a.width>b.width&&a.height>b.height?e>d&&(c={height:b.height}):c={width:a.width},c},_loadCover:function(){this._renderCoverLoader(),this._startCoverLoader();var a=this._getCoverURL();return this._isValidURL(a)?(this._clearInfowindowImageError(),void(this._containsTemplateCover()?this._loadCoverFromTemplate(a):this._loadCoverFromUrl(a))):void this._showInfowindowImageError()},_clearInfowindowImageError:function(){this.$(".js-infowindow").removeClass("is-fail")},_showInfowindowImageError:function(){this.$(".js-infowindow").addClass("is-fail"),this.$(".js-cover").append('<p class="CDB-infowindow-fail">Non-valid picture URL</p>')},_isValidURL:function(a){if(a){var b=/^(http|ftp|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-|]*[\w@?^=%&amp;\/~+#-])?$/;return null!==String(a).match(b)}return!1},toggle:function(){this.model.get("visibility")?this.show():this.hide()},_stopBubbling:function(a){a.preventDefault(),a.stopPropagation()},_stopPropagation:function(a){a.stopPropagation()},setLoading:function(){return this.model.set({content:{fields:[{type:"loading",title:"loading",value:"…"}]}}),this},setError:function(){return this.model.set({content:{fields:[{title:null,alternative_name:null,value:"There has been an error...",index:null,type:"error"}],data:{}}}),this},setLatLng:function(a){return this.model.set("latlng",a),this},_closeInfowindow:function(a){a&&(a.preventDefault(),a.stopPropagation()),this.model.get("visibility")&&(this.model.set("visibility",!1),this.trigger("close"))},showInfowindow:function(){this.model.set("visibility",!0)},show:function(a){e(document).off("keyup",this._onKeyUp).on("keyup",this._onKeyUp),this.model.get("visibility")&&(this.$el.css({left:-5e3}),this._update(a))},isHidden:function(){return!this.model.get("visibility")},hide:function(a){e(document).off("keyup",this._onKeyUp),!a&&this.model.get("visibility")||this._animateOut()},_update:function(a){if(!this.isHidden()){var b=0;a||(b=this.adjustPan()),this._updatePosition(),this._animateIn(b)}},_animateIn:function(a){!k.ie||k.browser.ie&&k.browser.ie.version>8?(this.$el.css({marginBottom:"-10px",display:"block",visibility:"visible",opacity:0}),this.$el.delay(a).animate({opacity:1,marginBottom:0},300)):this.$el.show()},_animateOut:function(){if(!k.ie||k.browser.ie&&k.browser.ie.version>8){var a=this;this.$el.animate({marginBottom:"-10px",opacity:"0",display:"block"},180,function(){a.$el.css({visibility:"hidden"})})}else this.$el.hide()},_updatePosition:function(){if(!this.isHidden()){var a=this.model.get("offset"),b=this.mapView.latLonToPixel(this.model.get("latlng")),c=b.x-a[0],d=this.mapView.getSize(),e=-1*(b.y-a[1]-d.y);this.$el.css({bottom:e,left:c})}},adjustPan:function(){var a=this.model.get("offset");if(this.model.get("autoPan")&&!this.isHidden()){var b=this.$el.outerHeight(!0)+15,c=this.$el.width(),d=this.mapView.latLonToPixel(this.model.get("latlng")),e={x:0,y:0},f=this.mapView.getSize(),g=0;return d.x-a[0]<0&&(e.x=d.x-a[0]-10),d.x-a[0]+c>f.x&&(e.x=d.x+c-f.x-a[0]+10),d.y-b<0&&(e.y=d.y-b-10),d.y-b>f.y&&(e.y=d.y+b-f.y),(e.x||e.y)&&(this.mapView.panBy(e),g=300),g}}});b.exports=l},{"../../core/sanitize":167,"../../core/template":169,"../../core/util":170,"../../core/view":171,"cdb.templates":159,"clip-path":316,jquery:57,"perfect-scrollbar":60,underscore:148}],245:[function(a,b,c){var d=a("underscore"),e=a("cdb"),f=a("../../ui/common/dropdown"),g=a("../../core/view"),h=(a("../../core/model"),a("./layer-view")),i=g.extend({className:"cartodb-layer-selector-box",events:{click:"_openDropdown",dblclick:"killEvent",mousedown:"killEvent"},initialize:function(){this.map=this.options.mapView.map,this.mapView=this.options.mapView,this.mapView.bind("click zoomstart drag",function(){this.dropdown&&this.dropdown.hide()},this),this.add_related_model(this.mapView),this.layers=[]},render:function(){return this.$el.html(this.options.template(this.options)),this.dropdown=new f({className:"cartodb-dropdown border",template:this.options.dropdown_template,target:this.$el.find("a"),speedIn:300,speedOut:200,position:"position",tick:"right",vertical_position:"down",horizontal_position:"right",vertical_offset:7,horizontal_offset:13}),e.god&&e.god.bind("closeDialogs",this.dropdown.hide,this.dropdown),this.$el.append(this.dropdown.render().el),this._getLayers(),this._setCount(),this},_getLayers:function(){var a=this;this.layers=[];var b=this._getLayerModelsFromMap();d.each(b,function(b){var c=a._createLayerView(b);c.bind("switchChanged",a._setCount,a),a.layers.push(c),b.bind("change:visible",function(a){this.trigger("change:visible",a.get("visible"),a.get("order"),a)},a)})},_getLayerModelsFromMap:function(){return this.map.layers.filter(function(a){return"CartoDB"===a.get("type")||"torque"===a.get("type")})},_createLayerView:function(a){var b=new h({model:a});return this.$("ul").append(b.render().el),this.addView(b),b},_setCount:function(){for(var a=0,b=0,c=this.layers.length;c>b;++b){var d=this.layers[b];d.model.get("visible")&&a++}this.$(".count").text(a),this.trigger("switchChanged",this)},_openDropdown:function(){this.dropdown.open()}});b.exports=i},{"../../core/model":165,"../../core/view":171,"../../ui/common/dropdown":285,"./layer-view":246,cdb:157,underscore:148}],246:[function(a,b,c){var d=a("underscore"),e=a("cdb.templates"),f=a("../../core/view"),g=f.extend({tagName:"li",defaults:{template:'      <a class="layer" href="#/change-layer"><%- layerName %></a>      <a href="#switch" class="right <%- visible ? "enabled" : "disabled" %> switch"><span class="handle"></span></a>    '},events:{click:"_onSwitchClick"},initialize:function(){this.model.has("visible")||this.model.set("visible",!1),
this.model.bind("change:visible",this._onSwitchSelected,this),this.add_related_model(this.model),this._onSwitchSelected(),this.template=this.options.template?e.getTemplate(this.options.template):d.template(this.defaults.template)},render:function(){var a={layerName:this.model.getName(),visible:this.model.isVisible()};return this.$el.append(this.template(a)),this},_onSwitchSelected:function(){var a=this.model.get("visible");this.$el.find(".switch").removeClass(a?"disabled":"enabled").addClass(a?"enabled":"disabled"),this.trigger("switchChanged")},_onSwitchClick:function(a){this.killEvent(a),this.model.set("visible",!this.model.get("visible"))}});b.exports=g},{"../../core/view":171,"cdb.templates":159,underscore:148}],247:[function(a,b,c){b.exports={LegendItemModel:a("./legend-item-model"),LegendItem:a("./legend-item"),LegendItems:a("./legend-items"),LegendModel:a("./legend-model"),Legends:a("./legends"),BaseLegend:a("./legend/base-legend"),BubbleLegend:a("./legend/bubble-legend"),CategoryLegend:a("./legend/category-legend"),ChoroplethLegend:a("./legend/choropleth-legend"),ColorLegend:a("./legend/color-legend"),CustomLegend:a("./legend/custom-legend"),DebugLegend:a("./legend/debug-legend"),DensityLegend:a("./legend/density-legend"),IntensityLegend:a("./legend/intensity-legend"),NoneLegend:a("./legend/none-legend"),StackedLegend:a("./legend/stacked-legend")}},{"./legend-item":249,"./legend-item-model":248,"./legend-items":250,"./legend-model":251,"./legend/base-legend":253,"./legend/bubble-legend":254,"./legend/category-legend":255,"./legend/choropleth-legend":256,"./legend/color-legend":257,"./legend/custom-legend":258,"./legend/debug-legend":259,"./legend/density-legend":260,"./legend/intensity-legend":261,"./legend/none-legend":272,"./legend/stacked-legend":273,"./legends":274}],248:[function(a,b,c){var d=a("../../core/model"),e=d.extend({defaults:{name:"Untitled",visible:!0,value:""}});b.exports=e},{"../../core/model":165}],249:[function(a,b,c){var d=a("underscore"),e=a("cdb.templates"),f=a("../../core/view"),g=f.extend({tagName:"li",initialize:function(){d.bindAll(this,"render"),this.template=this.options.template?d.template(this.options.template):e.getTemplate("geo/legend")},render:function(){var a;this.model.attributes.name=""+this.model.attributes.name,a="image"==this.model.get("type")&&this.model.get("value")?"url( "+this.model.get("value")+")":this.model.get("value");var b=d.extend(this.model.toJSON(),{value:a});return this.$el.html(this.template(b)),this.$el}});b.exports=g},{"../../core/view":171,"cdb.templates":159,underscore:148}],250:[function(a,b,c){var d=a("backbone"),e=a("./legend-item-model"),f=d.Collection.extend({model:e});b.exports=f},{"./legend-item-model":248,backbone:1}],251:[function(a,b,c){var d=a("../../core/model"),e=a("./legend-items"),f=d.extend({defaults:{type:null,show_title:!1,title:"",template:"",visible:!0},initialize:function(){this.items=new e(this.get("items")),this.items.bind("add remove reset change",function(){this.set({items:this.items.toJSON()})},this),this.bind("change:items",this._onUpdateItems,this),this.bind("change:title change:show_title",this._onUpdateTitle,this),this.bind("change:template",this._onUpdateTemplate,this)},_onUpdateTemplate:function(){this.template=this.get("template")},_onUpdateTitle:function(){this.title=this.get("title"),this.show_title=this.get("show_title")},_onUpdateItems:function(){var a=this.get("items");this.items.reset(a)}});b.exports=f},{"../../core/model":165,"./legend-items":250}],252:[function(a,b,c){var d=a("underscore"),e=a("./legend-model"),f=a("./legend-exports"),g=a("../../core/view"),h=g.extend({className:"cartodb-legend",events:{dragstart:"_stopPropagation",mousedown:"_stopPropagation",touchstart:"_stopPropagation",MSPointerDown:"_stopPropagation",dblclick:"_stopPropagation",mousewheel:"_stopPropagation",DOMMouseScroll:"_stopPropagation",dbclick:"_stopPropagation",click:"_stopPropagation"},initialize:function(){d.bindAll(this,"render","show","hide"),d.defaults(this.options,this.default_options),this.map=this.options.map,this._setupModel(),this._setupItems(),this._updateLegendType()},_stopPropagation:function(a){a.stopPropagation()},_setupModel:function(){this.model||(this.model=new e({type:this.options.type||e.prototype.defaults.type,title:this.options.title||e.prototype.defaults.title,show_title:this.options.show_title||e.prototype.defaults.show_title,template:this.options.template||e.prototype.defaults.template})),this.add_related_model(this.model),this.model.bind("change",this._updateLegendType,this)},_updateLegendType:function(){var a=this.model.get("type");if(this.legend_name=this._capitalize(a)+"Legend","none"==a||null==a)this.legend_name=null,this.model.set({type:"none"},{silent:!0});else if(!f[this.legend_name])return this.legend_name=null,void this.model.set({type:this.model.previous("type")},{silent:!0});this._refresh()},_capitalize:function(a){return a&&d.isString(a)?a.charAt(0).toUpperCase()+a.slice(1):void 0},_refresh:function(){this.view&&this.view.clean();var a=this.model.get("type");this.model.get("title"),this.model.get("show_title"),this.model.get("template");a&&this.legend_name?(this.view=new f[this.legend_name]({model:this.model}),this.$el.removeClass(),this.$el.addClass(this.className+" "+this.model.get("type"))):(this.hide(),this.$el.removeClass(),this.$el.addClass(this.className+" none")),this.render()},_setupItems:function(){this.items=this.model.items,this.options.data&&this.items.reset(this.options.data),this.items.bind("add remove change:value change:name",this.render,this)},render:function(){return this.view&&(this.model.get("template")?(this.$el.html(this.view.render().$el.html()),this.$el.removeClass(this.model.get("type")),this.$el.addClass("wrapper")):this.$el.html(this.view.render().$el.html()),this.model.get("visible")===!1?this.hide():this.show()),this},show:function(a){var b=this.model.get("type");b&&"none"!=b&&this.$el.show()},hide:function(a){this.model.get("type")&&this.$el.hide()}});b.exports=h},{"../../core/view":171,"./legend-exports":247,"./legend-model":251,underscore:148}],253:[function(a,b,c){var d=a("jquery"),e=a("../../../core/view"),f=e.extend({_bindModel:function(){this.model.bind("change:template change:title change:show_title",this.render,this)},addTo:function(a){d(a).html(this.render().$el)},setTitle:function(a){this.model.set("title",a)},showTitle:function(){this.model.set("show_title",!0)},hideTitle:function(){this.model.set("show_title",!1)}});b.exports=f},{"../../../core/view":171,jquery:57}],254:[function(a,b,c){var d=a("underscore"),e=a("../../../core/sanitize.js"),f=a("./base-legend"),g=f.extend({className:"bubble-legend",template:d.template('<% if (title && show_title) { %>\n<div class="legend-title"><%- title %></div><% } %><ul><li>	<%- min %></li><li class="graph">		<div class="bubbles"></div></li><li>	<%- max %></li></ul>'),initialize:function(){this.items=this.model.items},_bindModel:function(){this.model.bind("change:template change:title change:show_title change:color change:min change:max",this.render,this)},setColor:function(a){this.model.set("color",a)},setMinValue:function(a){this.model.set("min",a)},setMaxValue:function(a){this.model.set("max",a)},_renderGraph:function(a){this.$el.find(".graph").css("background",a)},render:function(){if(this.model.get("template")){var a=d.template(e.html(this.model.get("template"),this.model.get("sanitizeTemplate")));this.$el.html(a(this.model.toJSON())),this.$el.removeClass("bubble-legend")}else{var b=this.model.get("color")||(this.items.length>=3?this.items.at(2).get("value"):"");if(this.items.length>=3){var c=this.model.get("min")||this.items.at(0).get("value"),f=this.model.get("max")||this.items.at(1).get("value"),g=d.extend(this.model.toJSON(),{min:c,max:f});this.$el.html(this.template(g))}this._renderGraph(b)}return this}});b.exports=g},{"../../../core/sanitize.js":167,"./base-legend":253,underscore:148}],255:[function(a,b,c){var d=a("underscore"),e=a("../../../core/sanitize"),f=a("./base-legend"),g=a("../legend-item"),h=f.extend({className:"category-legend",template:d.template('<% if (title && show_title) { %>\n<div class="legend-title"><%- title %></div><% } %><ul></ul>'),initialize:function(){this.items=this.model.items},_bindModel:function(){this.model.bind("change:title change:show_title change:template",this.render,this)},_renderItems:function(){this.items.each(this._renderItem,this)},_renderItem:function(a){view=new g({model:a,className:a.get("value")&&a.get("value").indexOf("http")>=0||a.get("type")&&"image"==a.get("type")?"bkg":"",template:'		<div class="bullet" style="background: <%= value %>"></div> <%- name || ((name === false) ? "false": "null") %>'}),this.$el.find("ul").append(view.render())},render:function(){if(this.model.get("template")){var a=d.template(e.html(this.model.get("template"),this.model.get("sanitizeTemplate")));this.$el.html(a(this.model.toJSON()))}else this.$el.html(this.template(this.model.toJSON())),this.items.length>0?this._renderItems():this.$el.html('<div class="warning">The category legend is empty</div>');return this}});b.exports=h},{"../../../core/sanitize":167,"../legend-item":249,"./base-legend":253,underscore:148}],256:[function(a,b,c){var d=a("underscore"),e=a("../../../core/sanitize"),f=a("./base-legend"),g=f.extend({className:"choropleth-legend",template:d.template('<% if (title && show_title) { %>\n<div class="legend-title"><%- title %></div><% } %><ul><li class="min">		<%- leftLabel %></li><li class="max">		<%- rightLabel %></li><li class="graph count_<%- buckets_count %>">	<div class="colors"><%= colors %>\n	</div></li></ul>'),initialize:function(){this.items=this.model.items},_generateColorList:function(){var a="";if(this.model.get("colors"))return d.map(this.model.get("colors"),function(a){return'\n	<div class="quartile" style="background-color:'+a+'"></div>'}).join("");for(var b=2;b<this.items.length;b++){var c=this.items.at(b).get("value");a+='\n	<div class="quartile" style="background-color:'+c+'"></div>'}return a},setLeftLabel:function(a){this.model.set("leftLabel",a)},setRightLabel:function(a){this.model.set("rightLabel",a)},setColors:function(a){this.model.set("colors",a)},render:function(){if(this.model.get("template")){var a=d.template(e.html(this.model.get("template"),this.model.get("sanitizeTemplate")));this.$el.html(a(this.model.toJSON()))}else if(this.items.length>=2){this.leftLabel=this.items.at(0),this.rightLabel=this.items.at(1);var b=this.model.get("leftLabel")||this.leftLabel.get("value"),c=this.model.get("rightLabel")||this.rightLabel.get("value"),f=this._generateColorList(),g=d.extend(this.model.toJSON(),{leftLabel:b,rightLabel:c,colors:f,buckets_count:f.length});this.$el.html(this.template(g))}return this}});b.exports=g},{"../../../core/sanitize":167,"./base-legend":253,underscore:148}],257:[function(a,b,c){var d=a("underscore"),e=a("./base-legend"),f=a("../legend-item"),g=e.extend({className:"color-legend",type:"color",template:d.template('<% if (title && show_title) { %>\n<div class="legend-title"><%- title %></div><% } %><ul></ul>'),initialize:function(){this.items=this.model.items},_renderItems:function(){this.items.each(this._renderItem,this)},_renderItem:function(a){view=new f({model:a,className:a.get("value")&&a.get("value").indexOf("http")>=0?"bkg":"",template:'		<div class="bullet" style="background: <%= value %>"></div> <%- name || ((name === false) ? "false": "null") %>'}),this.$el.find("ul").append(view.render())},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.items.length>0?this._renderItems():this.$el.html('<div class="warning">The color legend is empty</div>'),this}});b.exports=g},{"../legend-item":249,"./base-legend":253,underscore:148}],258:[function(a,b,c){var d=a("underscore"),e=a("../../../core/sanitize.js"),f=a("./base-legend"),g=a("../legend-items"),h=a("../legend-item"),i=f.extend({className:"custom-legend",type:"custom",template:d.template('<% if (title && show_title) { %>\n<div class="legend-title"><%- title %></div><% } %><ul></ul>'),initialize:function(){this.items=this.model.items},setData:function(a){this.items=new g(a),this.model.items=this.items,this.model.set("items",a)},_renderItems:function(){this.items.each(this._renderItem,this)},_renderItem:function(a){var b=this.options.itemTemplate||'		<div class="bullet" style="background:<%= value %>"></div>\n		<%- name || "null" %>';view=new h({model:a,className:a.get("value")&&a.get("value").indexOf("http")>=0?"bkg":"",template:b}),this.$el.find("ul").append(view.render())},render:function(){if(this.model.get("template")){var a=d.template(e.html(this.model.get("template"),this.model.get("sanitizeTemplate")));this.$el.html(a(this.model.toJSON()))}else this.$el.html(this.template(this.model.toJSON())),this.items.length>0?this._renderItems():this.$el.html('<div class="warning">The legend is empty</div>');return this}});b.exports=i},{"../../../core/sanitize.js":167,"../legend-item":249,"../legend-items":250,"./base-legend":253,underscore:148}],259:[function(a,b,c){var d=a("../../../core/view"),e=d.extend({});b.exports=e},{"../../../core/view":171}],260:[function(a,b,c){var d=a("underscore"),e=a("../../../core/sanitize"),f=a("./base-legend"),g=f.extend({className:"density-legend",template:d.template('<% if (title && show_title) { %>\n<div class="legend-title"><%- title %></div><% } %><ul><li class="min">	<%- leftLabel %></li><li class="max">	<%- rightLabel %></li><li class="graph count_<%- buckets_count %>">	<div class="colors"><%= colors %>\n	</div></li></ul>'),initialize:function(){this.items=this.model.items},setLeftLabel:function(a){this.model.set("leftLabel",a)},setRightLabel:function(a){this.model.set("rightLabel",a)},setColors:function(a){this.model.set("colors",a)},_generateColorList:function(){var a="";if(this.model.get("colors"))return d.map(this.model.get("colors"),function(a){return'\n		<div class="quartile" style="background-color:'+a+'"></div>'}).join("");for(var b=2;b<this.items.length;b++){var c=this.items.at(b).get("value");a+='\n		<div class="quartile" style="background-color:'+c+'"></div>'}return a},render:function(){if(this.model.get("template")){var a=d.template(e.html(this.model.get("template"),this.model.get("sanitizeTemplate")));this.$el.html(a(this.model.toJSON()))}else if(this.items.length>=2){this.leftLabel=this.items.at(0),this.rightLabel=this.items.at(1);var b=this.model.get("leftLabel")||this.leftLabel.get("value"),c=this.model.get("rightLabel")||this.rightLabel.get("value"),f=this._generateColorList(),g=d.extend(this.model.toJSON(),{leftLabel:b,rightLabel:c,colors:f,buckets_count:f.length});this.$el.html(this.template(g))}return this}});b.exports=g},{"../../../core/sanitize":167,"./base-legend":253,underscore:148}],261:[function(a,b,c){var d=a("underscore"),e=a("../../../core/sanitize"),f=a("./base-legend"),g=f.extend({className:"intensity-legend",template:d.template('<% if (title && show_title) { %>\n<div class="legend-title"><%- title %></div><% } %><ul><li class="min">	<%- leftLabel %></li><li class="max">	<%- rightLabel %></li><li class="graph"></li></ul>'),initialize:function(){this.items=this.model.items},_bindModel:function(){this.model.bind("change:template",this.render,this)},setColor:function(a){this.model.set("color",a)},setLeftLabel:function(a){this.model.set("leftLabel",a)},setRightLabel:function(a){this.model.set("rightLabel",a)},_hexToRGB:function(a){var b=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return b?{r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16)}:null},_rgbToHex:function(a,b,c){function d(a){var b=a.toString(16);return 1==b.length?"0"+b:b}return"#"+d(a)+d(b)+d(c)},_calculateMultiply:function(a,b){var c=this._hexToRGB(a);if(c){for(var d=c.r,e=c.g,f=c.b,g=0;b>=g;g++)d=Math.round(d*c.r/255),e=Math.round(e*c.g/255),f=Math.round(f*c.b/255);return this._rgbToHex(d,e,f)}return"#ffffff"},_renderGraph:function(a){var b="";b+="background: <%= color %>;",b+="background: -moz-linear-gradient(left, <%= color %> 0%, <%= right %> 100%);",b+="background: -webkit-gradient(linear, left top, right top, color-stop(0%,<%= color %>), color-stop(100%,<%= right %>));",b+="background: -webkit-linear-gradient(left, <%= color %> 0%,<%= right %> 100%);",b+="background: -o-linear-gradient(left, <%= color %> 0%,<%= right %> 100%);",b+="background: -ms-linear-gradient(left, <%= color %> 0%,<%= right %> 100%)",b+="background: linear-gradient(to right, <%= color %> 0%,<%= right %> 100%);",b+="filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='<%= color %>', endColorstr='<%= right %>',GradientType=1 );",b+="background-image: -ms-linear-gradient(left, <%= color %> 0%,<%= right %> 100%)";var c=d.template(b),e=this._calculateMultiply(a,4);this.$el.find(".graph").attr("style",c({color:a,right:e}))},render:function(){if(this.model.get("template")){var a=d.template(e.html(this.model.get("template"),this.model.get("sanitizeTemplate")));this.$el.html(a(this.model.toJSON()))}else if(this.items.length>=3){this.leftLabel=this.items.at(0),this.rightLabel=this.items.at(1);var b=this.model.get("color")||this.items.at(2).get("value"),c=this.model.get("leftLabel")||this.leftLabel.get("value"),f=this.model.get("rightLabel")||this.rightLabel.get("value"),g=d.extend(this.model.toJSON(),{color:b,leftLabel:c,rightLabel:f});this.$el.html(this.template(g)),this._renderGraph(b)}return this}});b.exports=g},{"../../../core/sanitize":167,"./base-legend":253,underscore:148}],262:[function(a,b,c){var d=a("../legend-model"),e=a("./bubble-legend"),f=e.extend({className:"cartodb-legend bubble",type:"bubble",initialize:function(){this.model=new d({type:this.type,title:this.options.title,min:this.options.min,max:this.options.max,color:this.options.color,show_title:!!this.options.title}),this.add_related_model(this.model),this._bindModel()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this._renderGraph(this.model.get("color")),this}});b.exports=f},{"../legend-model":251,"./bubble-legend":254}],263:[function(a,b,c){var d=a("./category-legend"),e=a("../legend-items"),f=a("../legend-model"),g=d.extend({className:"cartodb-legend category",type:"category",initialize:function(){this.items=new e(this.options.data),this.model=new f({type:this.type,title:this.options.title,show_title:!!this.options.title}),this._bindModel()},render:function(){return this.$el.html(this.template(this.model.toJSON())),this._renderItems(),this}});b.exports=g},{"../legend-items":250,"../legend-model":251,"./category-legend":255}],264:[function(a,b,c){var d=a("underscore"),e=a("./choropleth-legend"),f=a("../legend-model"),g=e.extend({type:"choropleth",className:"cartodb-legend choropleth",initialize:function(){this.items=this.options.items,this.model=new f({type:this.type,title:this.options.title,show_title:!!this.options.title,leftLabel:this.options.left||this.options.leftLabel,rightLabel:this.options.right||this.options.rightLabel,colors:this.options.colors,buckets_count:this.options.colors?this.options.colors.length:0}),this.add_related_model(this.model),this._bindModel()},_bindModel:function(){this.model.bind("change:template change:title change:show_title change:colors change:leftLabel change:rightLabel",this.render,this)},_generateColorList:function(){return d.map(this.model.get("colors"),function(a){return'		<div class="quartile" style="background-color:'+a+'"></div>'}).join("")},render:function(){var a=d.extend(this.model.toJSON(),{colors:this._generateColorList()});return this.$el.html(this.template(a)),this}});b.exports=g},{"../legend-model":251,"./choropleth-legend":256,underscore:148}],265:[function(a,b,c){var d=a("./legend-category"),e=d.extend({});b.exports=e},{"./legend-category":263}],266:[function(a,b,c){var d=a("./custom-legend"),e=a("../legend-items"),f=a("../legend-model"),g=d.extend({className:"cartodb-legend custom",type:"custom",initialize:function(){this.items=new e(this.options.data||this.options.items),this.model=new f({type:this.type,title:this.options.title,show_title:!!this.options.title,items:this.items.models}),this._bindModel()},_bindModel:function(){this.model.bind("change:items change:template change:title change:show_title",this.render,this)}});b.exports=g},{"../legend-items":250,"../legend-model":251,"./custom-legend":258}],267:[function(a,b,c){var d=a("underscore"),e=a("./density-legend"),f=a("../legend-model"),g=e.extend({type:"density",className:"cartodb-legend density",initialize:function(){this.items=this.options.items,this.model=new f({type:this.type,title:this.options.title,show_title:!!this.options.title,leftLabel:this.options.left||this.options.leftLabel,rightLabel:this.options.right||this.options.rightLabel,colors:this.options.colors,buckets_count:this.options.colors?this.options.colors.length:0,items:this.options.items}),this._bindModel()},_bindModel:function(){this.model.bind("change:colors change:template change:title change:show_title change:colors change:leftLabel change:rightLabel",this.render,this)},_generateColorList:function(){return d.map(this.model.get("colors"),function(a){return'<div class="quartile" style="background-color:'+a+'"></div>'}).join("")},render:function(){var a=d.extend(this.model.toJSON(),{colors:this._generateColorList()});return this.$el.html(this.template(a)),this}});b.exports=g},{"../legend-model":251,"./density-legend":260,underscore:148}],268:[function(a,b,c){var d=a("./intensity-legend"),e=a("../legend-model"),f=d.extend({className:"cartodb-legend intensity",type:"intensity",initialize:function(){this.items=this.options.items,this.model=new e({type:this.type,title:this.options.title,show_title:!!this.options.title,color:this.options.color,leftLabel:this.options.left||this.options.leftLabel,rightLabel:this.options.right||this.options.rightLabel}),this.add_related_model(this.model),this._bindModel()},_bindModel:function(){this.model.bind("change:title change:show_title change:color change:leftLabel change:rightLabel",this.render,this)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this._renderGraph(this.model.get("color")),this}});b.exports=f},{"../legend-model":251,"./intensity-legend":261}],269:[function(a,b,c){var d=a("../../../core/view"),e=d.extend({});b.exports=e},{"../../../core/view":171}],270:[function(a,b,c){var d=a("underscore"),e=a("cdb"),f=a("../legends"),g=a("../legend-model"),h=a("./stacked-legend"),i=h.extend({initialize:function(){if(this.options.legends){var a=d.map(this.options.legends,function(a){return a.model});this.legendItems=new f(a),this.legendItems.bind("add remove change",this.render,this)}else if(this.options.data){var a=d.map(this.options.data,function(a){return new g(a)});this.legendItems=new f(a),this.legendItems.bind("add remove change",this.render,this)}},_capitalize:function(a){return a&&d.isString(a)?a.charAt(0).toUpperCase()+a.slice(1):void 0},render:function(){return this.$el.empty(),this.legends=[],this.legendItems&&this.legendItems.length>0&&this.legendItems.each(this._renderLegend,this),this},_renderLegend:function(a){var b=a.get("type");b||(b="custom"),b=this._capitalize(b);var c=new e.geo.ui.Legend[b](a.attributes);this.legends.push(c),a.get("visible")!==!1&&this.$el.append(c.render().$el)},getLegendAt:function(a){return this.legends[a]},addLegend:function(a){var b=new g(a);this.legendItems.push(b)},removeLegendAt:function(a){var b=this.legendItems.at(a);this.legendItems.remove(b)}});b.exports=i},{"../legend-model":251,"../legends":274,"./stacked-legend":273,cdb:157,underscore:148}],271:[function(a,b,c){var d={};d.Bubble=a("./legend-bubble"),d.Category=a("./legend-category"),d.Choropleth=a("./legend-choropleth"),d.Color=a("./legend-color"),d.Custom=a("./legend-custom"),d.Density=a("./legend-density"),d.Intensity=a("./legend-intensity"),d.None=a("./legend-none"),d.Stacked=a("./legend-stacked"),b.exports=d},{"./legend-bubble":262,"./legend-category":263,"./legend-choropleth":264,"./legend-color":265,"./legend-custom":266,"./legend-density":267,"./legend-intensity":268,"./legend-none":269,"./legend-stacked":270}],272:[function(a,b,c){var d=a("./base-legend"),e=d.extend({});b.exports=e},{"./base-legend":253}],273:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../../core/view"),g=f.extend({events:{dragstart:"_stopPropagation",mousedown:"_stopPropagation",touchstart:"_stopPropagation",MSPointerDown:"_stopPropagation",dblclick:"_stopPropagation",mousewheel:"_stopPropagation",DOMMouseScroll:"_stopPropagation",dbclick:"_stopPropagation",click:"_stopPropagation"},className:"cartodb-legend-stack",initialize:function(){d.each(this.options.legends,this._setupBinding,this)},_stopPropagation:function(a){a.stopPropagation()},getLegendByIndex:function(a){if(!this._layerByIndex){this._layerByIndex={};for(var b=this.options.legends,c=0;c<b.length;++c){var d=b[c];this._layerByIndex[d.options.index]=d}}return this._layerByIndex[a]},_setupBinding:function(a){a.model.bind("change:type",this._checkVisibility,this),this.add_related_model(a.model)},render:function(){return this._renderItems(),this._checkVisibility(),this},_renderItems:function(){d.each(this.options.legends,function(a){this.$el.append(a.render().$el)},this)},_checkVisibility:function(){var a=d.some(this.options.legends,function(a){return a.model.get("type")&&("none"!=a.model.get("type")||a.model.get("template"))},this);a?this.show():this.hide(),d.each(this.options.legends,function(a){var b=a.model;"none"===b.get("type")||b.get("visible")===!1?a.hide():a.show()},this)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},addTo:function(a){e(a).html(this.render().$el)}});b.exports=g},{"../../../core/view":171,jquery:57,underscore:148}],274:[function(a,b,c){var d=a("backbone"),e=a("./legend-model");b.exports=d.Collection.extend({model:e})},{"./legend-model":251,backbone:1}],275:[function(a,b,c){var d=a("underscore"),e=a("../../../core/view"),f=a("../../../geo/geocoder/nokia-geocoder"),g=a("../../../geo/ui/infowindow-model"),h=a("../../../geo/ui/infowindow"),i=a("../../../geo/geometry"),j=a("./search_template.tpl"),k=a("./search_infowindow_template.tpl"),l=e.extend({className:"CDB-Search",_ZOOM_BY_CATEGORY:{building:18,"postal-area":15,"default":12},events:{"click .js-toggle":"_onToggleClick","submit .js-form":"_onSubmit",click:"_stopPropagation",dblclick:"_stopPropagation",mousedown:"_stopPropagation"},options:{searchPin:!0,infowindowWidth:186,infowindowOffset:[30,30],iconUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAfCAYAAADXwvzvAAACuklEQVR4Ae3PQ+AsNxzA8e8vo/Xus237vVN9qW3b7qW2bdu2caxt29bu/meSmaTpqW63Pfc7wemTZPh9K/Xv3zhzxIgVrho0aMsLGo2N9o+iuYDwV02E5NJpM7d5fMGC515dMP/7l6dNMc+OGJY9Uq99cVMc33I4LOJXCQBQuXPBglNnDRm0Xa1RAWewP3yL/vJLul99Q/pNm0/b+qsnbLHngXAVgAI4b9KkXWc1m9vV58ykst56lKdMptyokdTKRJUIV1MMTGTgbOTknWABgFo2SSbOjuN9wlgIBrSIJ0yiVG9QUgGxUigRRAlpCQYrBs+A/QClliuXV6ppPVibDPPqi5irL8G+/QY2S3FZhityrLNYBWkAI2G5WTA2nGTthKDTJfP/FH1sCb76nNBa7I8/knba6Eyj8wJjLbk4qlCdAFNClWXKiiL72kGRUkSRhwUuTUm7XTqZ3z3KnMM7QhAFUfiKMZ9OQci+ydFFH32BIsDh8hxjDF2T0y0KtHHUczCg34P3wgesfWhZozstW1R/cJpuohA8dI7cWrSfxqM4gwEOnoJnn4HXBVDHwHnriNr2W3G0I8FEkKufMbjcIw1DC+iCuRw2OBduEYAKDD8drlkGlk6BHwAtIEDioD/QBnsnnHAI7A9YAAAGenwEnPuAd8+DewHcS+CeB3szvL0b7ADE/FWzYf5BCxa9dMvqa7oLll7WbTlsxKkDYRi9dPqhRz743L0PuKtOPMXtutHmm/InKf5Y6Co15Upl8qSCqVajXiEeUTRb6GqNIojoGaLEDwEA6B0KIKL8lH8JBeS/3AgK73qAPfc/tCLiAACUCmyvsJHnphwEAYFStNs/NoHgn2ATWPmlF54b/9GHH/Khn88/+9SywJx/+q0SsKTZbB45d/6CO0aNHnutv3kbYDQg9JAAIRDwF/0EjlkjUi3fkAMAAAAASUVORK5CYII=",iconAnchor:[7,31]},initialize:function(){this.mapView=this.options.mapView,this.template=this.options.template||j},render:function(){return this.$el.html(this.template(this.options)),this},_stopPropagation:function(a){a&&a.stopPropagation()},_onSubmit:function(a){a.preventDefault();var b=this,c=this.$(".js-textInput").val();c&&(this._destroySearchPin(0),f.geocode(c,function(a){b._onResult(a)}))},_onResult:function(a){var b="",c=this.$(".js-textInput").val();if(a&&a.length>0){var d=a[0],e=this._isBBoxValid(d);if(e){var f=parseFloat(d.boundingbox.south),g=parseFloat(d.boundingbox.west),h=parseFloat(d.boundingbox.north),i=parseFloat(d.boundingbox.east),j=(g+i)/2,k=(f+h)/2;b=[k,j],this.model.setBounds([[f,g],[h,i]])}d.lat&&d.lon&&(b=[d.lat,d.lon]),e||(this.model.setCenter(b),this.model.setZoom(this._getZoomByCategory(d.type))),this.options.searchPin&&this._createSearchPin(b,c)}},_onToggleClick:function(){this.$(".CDB-Search-inner").toggleClass("is-active"),this.$(".js-textInput").focus()},_getZoomByCategory:function(a){return a&&this._ZOOM_BY_CATEGORY[a]?this._ZOOM_BY_CATEGORY[a]:this._ZOOM_BY_CATEGORY["default"]},_isBBoxValid:function(a){return!(!a.boundingbox||a.boundingbox.south===a.boundingbox.north||a.boundingbox.east===a.boundingbox.west)},_createSearchPin:function(a,b){this._destroySearchPin(),this._createPin(a,b),this._createInfowindow(a,b),this._bindEvents()},_destroySearchPin:function(a){this._unbindEvents(),this._destroyPin(),this._destroyInfowindow(a)},_createInfowindow:function(a,b){var c=new g({template:k,latlng:a,width:this.options.infowindowWidth,offset:this.options.infowindowOffset,content:{fields:[{title:"address",value:b}]}});this._searchInfowindow=new h({model:c,mapView:this.mapView}),this.mapView.$el.append(this._searchInfowindow.el),c.set("visibility",!0)},_destroyInfowindow:function(a){if(this._searchInfowindow){a=!d.isUndefined(a)&&d.isNumber(a)?a:500,this._searchInfowindow.hide(!0);var b=this;setTimeout(function(){b._searchInfowindow&&(b._searchInfowindow.clean(),delete b._searchInfowindow)},a)}},_createPin:function(a,b){this._searchPin=this.mapView._addGeomToMap(new i({geojson:{type:"Point",coordinates:[a[1],a[0]]},iconUrl:this.options.iconUrl,iconAnchor:this.options.iconAnchor}))},_toggleSearchInfowindow:function(){var a=this._searchInfowindow.model.get("visibility");this._searchInfowindow.model.set("visibility",!a)},_destroyPin:function(){this._searchPin&&(this.mapView._removeGeomFromMap(this._searchPin),delete this._searchPin)},_bindEvents:function(){this._searchPin&&this._searchPin.bind("click",this._toggleSearchInfowindow,this),this.mapView.bind("click",this._destroySearchPin,this)},_unbindEvents:function(){this._searchPin&&this._searchPin.unbind("click",this._toggleSearchInfowindow,this),this.mapView.unbind("click",this._destroySearchPin,this)},clean:function(){this._unbindEvents(),this._destroySearchPin(),e.prototype.clean.call(this)}});b.exports=l},{"../../../core/view":171,"../../../geo/geocoder/nokia-geocoder":194,"../../../geo/geometry":197,"../../../geo/ui/infowindow":244,"../../../geo/ui/infowindow-model":243,"./search_infowindow_template.tpl":276,"./search_template.tpl":277,underscore:148}],276:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-infowindow CDB-infowindow--light js-infowindow"> <div class="CDB-infowindow-container"> <div class="CDB-infowindow-inner"> <div class="CDB-infowindow-list"> <div class="CDB-infowindow-listItem"> <h4 class="CDB-infowindow-title">'+(null==(__t=address)?"":_.escape(__t))+'</h4> </div> </div> </div> <div class="CDB-hook"> <div class="CDB-hook-inner"> </div> </div> </div> </div>';return __p}},{underscore:148}],277:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Overlay"> <div class="CDB-Search-inner"> <form class="js-form"> <div class="CDB-Search-action"> <button type="button" class="CDB-Shape CDB-Search-actionButton js-toggle"> <span class="CDB-Shape-magnify is-small"></span> </button> </div> <input type="text" placeholder="Search Location" class="CDB-Search-text js-textInput" value=""> </form> </div> </div>';return __p}},{underscore:148}],278:[function(a,b,c){var d=a("underscore"),e=a("../../core/view"),f=a("../../core/sanitize"),g=a("jquery"),h=e.extend({className:"cartodb-overlay overlay-text",events:{click:"stopPropagation"
},default_options:{},stopPropagation:function(a){a.stopPropagation()},initialize:function(){d.defaults(this.options,this.default_options),this.template=this.options.template;var a=this;g(window).on("map_resized",function(){a._place()}),g(window).on("resize",function(){a._place()})},_applyStyle:function(){var a=this.model.get("style"),b=a["box-color"],c=a["box-opacity"],d=a["box-width"],e=a["font-family-name"];this.$text=this.$el.find(".text"),this.$text.css(a),this.$text.css("font-size",a["font-size"]+"px"),this.$el.css("z-index",a["z-index"]);var f="";"Droid Sans"==e?f="droid":"Vollkorn"==e?f="vollkorn":"Open Sans"==e?f="open_sans":"Roboto"==e?f="roboto":"Lato"==e?f="lato":"Graduate"==e?f="graduate":"Gravitas One"==e?f="gravitas_one":"Old Standard TT"==e&&(f="old_standard_tt");var g="rgba("+parseInt(b.slice(-6,-4),16)+","+parseInt(b.slice(-4,-2),16)+","+parseInt(b.slice(-2),16)+", "+c+" )";this.$el.removeClass("droid").removeClass("vollkorn").removeClass("roboto").removeClass("open_sans").removeClass("lato").removeClass("graduate").removeClass("gravitas_one").removeClass("old_standard_tt"),this.$el.addClass(f),this.$el.css({backgroundColor:g,maxWidth:d})},_place:function(a){var b=a||this.model.get("extra"),c=this.model.get("y"),d=this.model.get("x"),e=b.bottom-this.$el.height(),f=b.right-this.$el.width(),g=b.top_percentage,h=b.left_percentage,i="auto",j="auto",k=0,l=0,m=b.width,n=b.height,o=b.portrait_dominant_side,p=b.landscape_dominant_side;"bottom"===o&&250>=e?(c="auto",j=e):g>45&&55>g&&(c="50%",k=-n/2),"right"===p&&250>=f?(d="auto",i=f):h>45&&55>h&&(d="50%",l=-m/2),this.$el.css({marginLeft:l,marginTop:k,top:c,left:d,right:i,bottom:j})},show:function(a){this.$el.fadeIn(150,function(){a&&a()})},hide:function(a){this.$el.fadeOut(150,function(){a&&a()})},_fixLinks:function(){this.$el.find("a").each(function(a,b){g(this).attr("target","_top")})},render:function(){var a=f.html(this.model.get("extra").rendered_text,this.model.get("sanitizeText")),b=d.chain(this.model.attributes).clone().extend({text:a}).value();this.$el.html(this.template(b)),this._fixLinks();var c=this;return setTimeout(function(){c._applyStyle(),c._place(),c.show()},900),this}});b.exports=h},{"../../core/sanitize":167,"../../core/view":171,jquery:57,underscore:148}],279:[function(a,b,c){var d=(a("underscore"),a("../../core/view")),e=d.extend({className:"CDB-Loader",options:{animationSpeed:500},initialize:function(){this.isVisible=0},render:function(){return this},show:function(a){this.isVisible||(this.$el.addClass("is-visible"),this.isVisible++)},hide:function(a){this.isVisible--,this.isVisible>0||(this.isVisible=0,this.$el.removeClass("is-visible"))},visible:function(){return this.isVisible>0}});b.exports=e},{"../../core/view":171,underscore:148}],280:[function(a,b,c){var d=a("underscore"),e=a("./infobox"),f=a("../../core/sanitize"),g=a("./infowindow-model"),h=e.extend({defaultTemplate:"<p>{{text}}</p>",className:"CDB-Tooltip-wrapper",defaults:{vertical_offset:0,horizontal_offset:0,position:"top|center"},initialize:function(){if(!this.options.mapView)throw new Error("mapView should be present");this.options.template=this.options.template||this.defaultTemplate,e.prototype.initialize.call(this),this._filter=null,this.showing=!1,this.showhideTimeout=null},render:function(a){var b=f.html(this.template(a));return this.$el.html(b),this},setFilter:function(a){return this._filter=a,this},setFields:function(a){return this.options.fields=a,this},setAlternativeNames:function(a){this.options.alternative_names=a},enable:function(){this.options.layer&&(this.options.layer.unbind(null,null,this),this.options.layer.on("mouseover",function(a,b,c,e){if(this.options.fields&&this.options.fields.length>0){var f=["fields","content"];this.options.omit_columns&&(f=f.concat(this.options.omit_columns));var h=g.contentForFields(e,this.options.fields,{empty_fields:this.options.empty_fields});e.content=d.omit(e,f),e.fields=h.fields;var i=this.options.alternative_names;if(i)for(var j=0;j<e.fields.length;++j){var k=e.fields[j];k.title=i[k.title]||k.title}this.show(c,e),this.showing=!0}else this.showing&&(this.hide(),this.showing=!1)},this).on("mouseout",function(){this.showing&&(this.hide(),this.showing=!1)},this),this.add_related_model(this.options.layer))},disable:function(){this.options.layer&&this.options.layer.unbind(null,null,this),this.hide(),this.showing=!1},_visibility:function(){var a=this;clearTimeout(this.showhideTimeout),this.showhideTimeout=setTimeout(a._showing?function(){a.$el.fadeIn(100)}:function(){a.$el.fadeOut(200)},50)},hide:function(){this._showing&&(this._showing=!1,this._visibility())},show:function(a,b){return this._filter&&!this._filter(b)?this:(this.render(b),this.setPosition(a),this._showing||(this._showing=!0,this._visibility()),this)},setPosition:function(a){var b=this.options.position,c=this.$el.innerHeight(),d=this.$el.innerWidth(),e=this.options.mapView.getSize(),f=0,g=0,h="CDB-Tooltip-wrapper--";this._removePositionModifiers(),f=-1!==b.indexOf("top")?a.y-c:-1!==b.indexOf("middle")?a.y-c/2:a.y,0>f?(f=a.y,h+="top"):f+c>e.y?(f=a.y-c,h+="bottom"):h+="top",g=-1!==b.indexOf("left")?a.x-d:-1!==b.indexOf("center")?a.x-d/2:a.x,0>g?(g=a.x,h+="Left"):g+d>e.x?(g=a.x-d,h+="Right"):h+="Left",f+=this.options.vertical_offset,g+=this.options.horizontal_offset,this.$el.css({top:f,left:g}).addClass(h)},_removePositionModifiers:function(){var a=["topLeft","topRight","bottomRight","bottomLeft"],b=d.map(a,function(a){return this._modifierClassName(a)},this);this.$el.removeClass(b.join(" "))},_modifierClassName:function(a){return this.className+"--"+a}});b.exports=h},{"../../core/sanitize":167,"./infobox":242,"./infowindow-model":243,underscore:148}],281:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Overlay"> <button class="CDB-Zoom-action CDB-Zoom-action--out js-zoomOut"></button> <button class="CDB-Zoom-action CDB-Zoom-action--in js-zoomIn"></button> </div> <div class="CDB-Zoom-info js-zoomInfo">-</div>';return __p}},{underscore:148}],282:[function(a,b,c){var d=a("../../../core/view"),e=a("./zoom-template.tpl");b.exports=d.extend({className:"CDB-Zoom",events:{"click .js-zoomIn":"_onZoomIn","click .js-zoomOut":"_onZoomOut",dblclick:"killEvent"},options:{timeout:0,msg:""},initialize:function(){this.map=this.model,this.template=this.options.template||e,this.map.bind("change:zoom change:minZoom change:maxZoom",this._checkZoom,this)},render:function(){return this.$el.html(this.template(this.options)),this._checkZoom(),this},_checkZoom:function(){var a=this.map.get("zoom");this.$(".js-zoomIn")[a<this.map.get("maxZoom")?"removeClass":"addClass"]("is-disabled"),this.$(".js-zoomOut")[a>this.map.get("minZoom")?"removeClass":"addClass"]("is-disabled"),this.$(".js-zoomInfo").text(a)},_onZoomIn:function(a){this.killEvent(a),this.map.get("maxZoom")>this.map.getZoom()&&this.map.setZoom(this.map.getZoom()+1)},_onZoomOut:function(a){this.killEvent(a),this.map.get("minZoom")<this.map.getZoom()&&this.map.setZoom(this.map.getZoom()-1)}})},{"../../../core/view":171,"./zoom-template.tpl":281}],283:[function(a,b,c){var d=a("./cartodb.js");b.exports=d},{"./cartodb.js":154}],284:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("cdb.templates"),g=a("../../core/view");b.exports=g.extend({tagName:"div",className:"dialog",events:{"click .ok":"_ok","click .cancel":"_cancel","click .close":"_cancel"},default_options:{title:"title",description:"",ok_title:"Ok",cancel_title:"Cancel",width:300,height:200,clean_on_hide:!1,enter_to_confirm:!1,template_name:"old_common/views/dialog_base",ok_button_classes:"button green",cancel_button_classes:"",modal_type:"",modal_class:"",include_footer:!0,additionalButtons:[]},initialize:function(){d.defaults(this.options,this.default_options),d.bindAll(this,"render","_keydown"),e(document).bind("keydown",this._keydown),this.bind("clean",this._reClean),this.template_base=this.options.template_base?d.template(this.options.template_base):f.getTemplate(this.options.template_name)},render:function(){var a=this.$el;return a.html(this.template_base(this.options)),a.find(".modal").css({width:this.options.width}),this.render_content&&this.$(".content").append(this.render_content()),this.options.modal_class&&this.$el.addClass(this.options.modal_class),this},_keydown:function(a){27===a.keyCode?this._cancel():13===a.keyCode&&this.options.enter_to_confirm&&this._ok()},appendToBody:function(){return e("body").append(this.render().el),this},_ok:function(a){a&&a.preventDefault(),this.ok&&this.ok(this.result),this.hide()},_cancel:function(a){a&&(a.preventDefault(),a.stopPropagation()),this.cancel&&this.cancel(),this.hide()},hide:function(){this.$el.hide(),this.options.clean_on_hide&&this.clean()},open:function(){this.$el.show()},_reClean:function(){e(document).unbind("keydown",this._keydown)}})},{"../../core/view":171,"cdb.templates":159,jquery:57,underscore:148}],285:[function(a,b,c){var d=a("jquery"),e=(a("cdb"),a("underscore")),f=a("cdb.templates"),g=a("../../core/view"),h=g.extend({tagName:"div",className:"dropdown",events:{"click ul li a":"_fireClick"},default_options:{width:160,speedIn:150,speedOut:300,vertical_position:"down",horizontal_position:"right",tick:"right",vertical_offset:0,horizontal_offset:0},initialize:function(){e.bindAll(this,"open","hide","_handleClick","_keydown"),e.defaults(this.options,this.default_options),this.options.template_base?this.template_base=f.getTemplate(this.options.template_base):this.options.template&&(this.template_base=this.options.template),d(this.options.target).bind({click:this._handleClick}),d(document).bind("keydown",this._keydown),this.isOpen=!1},render:function(){var a=this.$el;return a.html(this.template_base(this.options)).css({width:this.options.width}),this},_handleClick:function(a){a&&(a.preventDefault(),a.stopPropagation()),this.isOpen?this.hide():this.open()},_keydown:function(a){27===a.keyCode&&this.hide()},hide:function(){this.isOpen=!1,this.$el.hide()},show:function(){this.$el.css({display:"block",opacity:1}),this.isOpen=!0},open:function(a,b){var c=b&&d(b)||this.options.target;this.options.target=c;var e=c[this.options.position||"offset"](),f=c.outerWidth(),g=c.outerHeight(),h=this.$el.outerWidth(),i=this.$el.outerHeight(),j=this;this.$el.css({top:e.top+parseInt("up"==j.options.vertical_position?-i-10-j.options.vertical_offset:g+10-j.options.vertical_offset),left:e.left+parseInt("left"==j.options.horizontal_position?j.options.horizontal_offset-15:f-h+15-j.options.horizontal_offset)}).addClass(("up"==this.options.vertical_position?"vertical_top":"vertical_bottom")+" "+("right"==this.options.horizontal_position?"horizontal_right":"horizontal_left")+" tick_"+this.options.tick),this.show(),this.isOpen=!0},clean:function(){d(this.options.target).unbind({click:this._handleClick}),d(document).unbind("keydown",this._keydown),g.prototype.clean.apply(this,arguments)},_fireClick:function(a){this.trigger("optionClicked",a,this.el)}});b.exports=h},{"../../core/view":171,cdb:157,"cdb.templates":159,jquery:57,underscore:148}],286:[function(require,module,exports){require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<a href="'+(null==(__t=mapUrl)?"":__t)+'" target="_blank"> <div class="CDB-Shape-Arrow is-up"></div> <div class="CDB-Shape-Arrow is-down"></div> </a>';return __p}},{underscore:148}],287:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("cdb.log"),g=a("../../../core/view"),h=a("./fullscreen-template.tpl"),i=g.extend({tagName:"div",className:"CDB-Fullscreen",events:{click:"_toggleFullScreen"},initialize:function(){e.bindAll(this,"render"),this.template=this.options.template||h,this._addWheelEvent()},render:function(){var a=e.extend(this.options,{mapUrl:window.location.href||""});return this.$el.html(this.template(a)),this._canFullScreenBeEnabled()||(this.undelegateEvents(),f.info("FullScreen API is deprecated on insecure origins. See https://goo.gl/rStTGz for more details.")),this},_addWheelEvent:function(){var a=this,b=this.options.mapView;d(document).on("webkitfullscreenchange mozfullscreenchange fullscreenchange",function(){document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||a.options.allowWheelOnFullscreen&&b.options.map.set("scrollwheel",!1),b.invalidateSize()})},_toggleFullScreen:function(a){a&&this.killEvent(a);var b=window.document,c=b.documentElement;this.options.doc&&(c=this.options.doc);var d=c.requestFullscreen||c.mozRequestFullScreen||c.webkitRequestFullScreen||c.msRequestFullscreen,e=b.exitFullscreen||b.mozCancelFullScreen||b.webkitExitFullscreen||b.msExitFullscreen,f=this.options.mapView;b.fullscreenElement||b.mozFullScreenElement||b.webkitFullscreenElement||b.msFullscreenElement?e.call(b):(c.webkitRequestFullScreen?d.call(c,void 0):d&&d.call(c),f&&this.options.allowWheelOnFullscreen&&f.map.set("scrollwheel",!0))},_canFullScreenBeEnabled:function(){if(this._isInIframe()){var a=document.referrer;if(0!==a.search("https:"))return!1}return!0},_isInIframe:function(){try{return window.self!==window.top}catch(a){return!0}}});b.exports=i},{"../../../core/view":171,"./fullscreen-template.tpl":286,"cdb.log":158,jquery:57,underscore:148}],288:[function(a,b,c){var d=a("underscore"),e=a("cdb.templates"),f=a("../../core/view"),g=f.extend({tagName:"div",className:"dialog",events:{"click .close":"hide"},default_options:{timeout:0,msg:"",hideMethod:"",duration:"normal"},initialize:function(){this.closeTimeout=-1,d.defaults(this.options,this.default_options),this.template=this.options.template?d.template(this.options.template):e.getTemplate("common/notification"),this.$el.hide()},render:function(){var a=this.$el;return a.html(this.template(this.options)),this.render_content&&this.$(".content").append(this.render_content()),this},hide:function(a){var b=this;a&&a.preventDefault(),clearTimeout(this.closeTimeout),""!=this.options.hideMethod&&this.$el.is(":visible")?this.$el[this.options.hideMethod](this.options.duration,"swing",function(){b.$el.html(""),b.trigger("notificationDeleted"),b.remove()}):(this.$el.hide(),b.$el.html(""),b.trigger("notificationDeleted"),b.remove())},open:function(a,b){this.render(),this.$el.show(a,b),this.options.timeout&&(this.closeTimeout=setTimeout(d.bind(this.hide,this),this.options.timeout))}});b.exports=g},{"../../core/view":171,"cdb.templates":159,underscore:148}],289:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("../../core/view"),g=a("./table/row-view"),h=f.extend({tagName:"table",rowView:g,events:{"click td":"_cellClick","dblclick td":"_cellDblClick"},default_options:{},initialize:function(){var a=this;d.defaults(this.options,this.default_options),this.dataModel=this.options.dataModel,this.rowViews=[],this.setDataSource(this.dataModel),this.model.bind("change",this.render,this),this.model.bind("change:dataSource",this.setDataSource,this),this.bind("clean",this.clear_rows,this),this.add_related_model(this.dataModel),this.add_related_model(this.model),this.model.bind("removing:row",function(){a.rowsBeingDeleted=a.rowsBeingDeleted?a.rowsBeingDeleted+1:1,a.rowDestroying()}),this.model.bind("remove:row",function(){a.rowsBeingDeleted>0&&(a.rowsBeingDeleted--,a.rowDestroyed(),0==a.dataModel.length&&a.emptyTable())})},headerView:function(a){return a[0]},setDataSource:function(a){this.dataModel&&this.dataModel.unbind(null,null,this),this.dataModel=a,this.dataModel.bind("reset",this._renderRows,this),this.dataModel.bind("error",this._renderRows,this),this.dataModel.bind("add",this.addRow,this)},_renderHeader:function(){var a=this,b=e("<thead>"),c=e("<tr>");return this.options.row_header?c.append(e("<th>").append(a.headerView(["","header"]))):c.append(e("<th>").append(a.headerView(["","header"]))),d(this.model.get("schema")).each(function(b){c.append(e("<th>").append(a.headerView(b)))}),b.append(c),b},clear_rows:function(){this.$("tfoot").remove(),this.$("tr.noRows").remove();for(var a=null;a=this.rowViews.pop();)a.unbind(null,null,this),a.clean();this.rowViews=[]},addRow:function(a,b,c){var e=this,f=new e.rowView({model:a,order:this.model.columnNames(),row_header:this.options.row_header});if(f.tableView=this,f.bind("clean",function(){var a=d.indexOf(e.rowViews,f);e.rowViews.splice(a,1);for(var b=a;b<e.rowViews.length;++b)e.rowViews[b].$el.attr("data-y",b)},this),f.bind("changeRow",this.rowChanged,this),f.bind("saved",this.rowSynched,this),f.bind("errorSaving",this.rowFailed,this),f.bind("saving",this.rowSaving,this),this.retrigger("saving",f),f.render(),c&&void 0!==c.index&&c.index!=e.rowViews.length){f.$el.insertBefore(e.rowViews[c.index].$el),e.rowViews.splice(c.index,0,f);for(var g=c.index;g<e.rowViews.length;++g)e.rowViews[g].$el.attr("data-y",g)}else f.$el.attr("data-y",e.rowViews.length),e.$el.append(f.el),e.rowViews.push(f);this.trigger("createRow")},rowChanged:function(){},rowSynched:function(){},rowFailed:function(){},rowSaving:function(){},rowDestroying:function(){},rowDestroyed:function(){},emptyTable:function(){},isEmptyTable:function(){return 0===this.dataModel.length&&this.dataModel.fetched},_renderRows:function(){if(this.clear_rows(),this.isEmptyTable())this._renderEmpty();else if(this.dataModel.fetched){var a=this;this.dataModel.each(function(b){a.addRow(b)})}else this._renderLoading()},_renderLoading:function(){},_renderEmpty:function(){},addEmptyTableInfo:function(){},render:function(){var a=this;return a.$el.html(a._renderHeader()),a._renderRows(),this},getCell:function(a,b){return this.options.row_header&&++b,this.rowViews[b].getCell(a)},_cellClick:function(a,b){b=b||"cellClick",a.preventDefault();var c=e(a.currentTarget||a.target),d=parseInt(c.attr("data-x"),10),f=parseInt(c.parent().attr("data-y"),10);this.trigger(b,a,c,d,f)},_cellDblClick:function(a){this._cellClick(a,"cellDblClick")}});b.exports=h},{"../../core/view":171,"./table/row-view":290,jquery:57,underscore:148}],290:[function(a,b,c){var d=a("underscore"),e=a("../../../core/view"),f=e.extend({tagName:"tr",initialize:function(){this.model.bind("change",this.render,this),this.model.bind("destroy",this.clean,this),this.model.bind("remove",this.clean,this),this.model.bind("change",this.triggerChange,this),this.model.bind("sync",this.triggerSync,this),this.model.bind("error",this.triggerError,this),this.add_related_model(this.model),this.order=this.options.order},triggerChange:function(){this.trigger("changeRow")},triggerSync:function(){this.trigger("syncRow")},triggerError:function(){this.trigger("errorRow")},valueView:function(a,b){return b},render:function(){var a,b=this,c=this.model,e="",f=0;a=this.options.row_header?'<td class="rowHeader" data-x="'+f+'">':'<td class="EmptyRowHeader" data-x="'+f+'">';var g=b.valueView("","");g.html&&(g=g[0].outerHTML),a+=g,a+="</td>",f++,e+=a;for(var h=this.order||d.keys(c.attributes),i="",j=c.attributes,k=0,l=h.length;l>k;++k){var m=h[k],n=j[m];if(void 0!==n){var a='<td id="cell_'+c.id+"_"+m+'" data-x="'+f+'">',g=b.valueView(m,n);g.html&&(g=g[0].outerHTML),a+=g,a+="</td>",f++,i+=a}}return e+=i,this.$el.html(e).attr("id","row_"+c.id),this},getCell:function(a){return this.options.row_header&&++a,this.$("td:eq("+a+")")},getTableView:function(){return this.tableView}});b.exports=f},{"../../../core/view":171,underscore:148}],291:[function(a,b,c){var d=a("../../../core/model"),e=d.extend({});b.exports=e},{"../../../core/model":165}],292:[function(a,b,c){var d=a("backbone"),e=a("./row"),f=d.Collection.extend({model:e,fetched:!1,initialize:function(){var a=this;this.bind("reset",function(){a.fetched=!0})},getCell:function(a,b){var c=this.at(a);return c?c.get(b):null},isEmpty:function(){return 0===this.length}});b.exports=f},{"./row":291,backbone:1}],293:[function(a,b,c){var d=a("underscore"),e=a("../../../core/model"),f=e.extend({columnNames:function(){return d.map(this.get("schema"),function(a){return a[0]})},columnName:function(a){return this.columnNames()[a]}});b.exports=f},{"../../../core/model":165,underscore:148}],294:[function(a,b,c){var d=a("backbone");b.exports=function(a,b,c){var e=arguments[1];return this._xhr&&this._xhr.abort(),this._xhr=d.sync.apply(this,arguments),this._xhr.always(function(){e._xhr=null}),this._xhr}},{backbone:1}],295:[function(a,b,c){var d=a("underscore"),e=a("./vis/overlay"),f=a("../geo/ui/infowindow-model"),g=function(a){this._vis=a};g.prototype.manage=function(a,b){this._mapView=a,this._map=b,this._map.layers.bind("reset",function(a){a.each(this._addInfowindowForLayer,this)},this),this._map.layers.bind("add",this._addInfowindowForLayer,this)},g.prototype._addInfowindowForLayer=function(a){if(a.getInfowindowData&&a.getInfowindowData()){var b=this._mapView.getLayerViewByLayerCid(a.cid);b.infowindowView||(this._addInfowindowOverlay(b,a),this._bindFeatureClickEvent(b)),b.bind("mouseover",function(){this._mapView.setCursor("pointer")},this),b.bind("mouseout",function(a,b){this._mapView.setCursor("auto")},this)}},g.prototype._addInfowindowOverlay=function(a,b){var c=a.infowindowView;c||(a.infowindowView=c=e.create("infowindow",this._vis,b.getInfowindowData()),this._mapView.addInfowindow(c))},g.prototype._bindFeatureClickEvent=function(a){var b=a.infowindowView;a.bind("featureClick",function(c,e,g,h,i){var j=a.model;if(j.layers&&(j=j.layers.at(i)),!j)throw new Error("featureClick event for layer "+i+" was captured but layerModel coudn't be retrieved");var k=j.getInfowindowData();if(k){var l=h.cartodb_id;a.model.fetchAttributes(i,l,function(a){var c=d.defaults({offset:k.offset,width:k.width,maxHeight:k.maxHeight},f.prototype.defaults);b.model.set({fields:k.fields,template:k.template,template_type:k.template_type,alternative_names:k.alternative_names,sanitizeTemplate:k.sanitizeTemplate,offset:c.offset,width:c.width,maxHeight:c.maxHeight}),a?(b.model.updateContent(a),b.adjustPan()):b.setError()}),b.setLatLng(e).setLoading().showInfowindow(),a.tooltipView&&a.tooltipView.setFilter(function(a){return a.cartodb_id!==l}).hide()}})},b.exports=g},{"../geo/ui/infowindow-model":243,"./vis/overlay":302,underscore:148}],296:[function(a,b,c){function d(a){for(var b in n)if(-1!==a.indexOf(b))return a.replace(b,n[b]);return a}function e(a){for(var b in n){var c=n[b];if(-1!==a.indexOf(c))return a.replace(c,b)}return a}function f(a,b){a.infowindow&&a.infowindow.fields&&(a.interactivity?-1===a.interactivity.indexOf("cartodb_id")&&(a.interactivity=a.interactivity+",cartodb_id"):a.interactivity="cartodb_id")}var g=a("./vis/layers"),h=a("../geo/map/tile-layer"),i=a("../geo/map/wms-layer"),j=a("../geo/map/gmaps-base-layer"),k=a("../geo/map/plain-layer"),l=a("../geo/map/cartodb-layer"),m=a("../geo/map/torque-layer"),n={"https://dnv9my2eseobd.cloudfront.net/":"http://a.tiles.mapbox.com/","https://maps.nlp.nokia.com/":"http://maps.nlp.nokia.com/","https://tile.stamen.com/":"http://tile.stamen.com/","https://{s}.maps.nlp.nokia.com/":"http://{s}.maps.nlp.nokia.com/","https://cartocdn_{s}.global.ssl.fastly.net/":"http://{s}.api.cartocdn.com/","https://cartodb-basemaps-{s}.global.ssl.fastly.net/":"http://{s}.basemaps.cartocdn.com/"};g.register("tilejson",function(a,b){var c=a.tiles[0];return b.https===!0?c=e(c):b.https===!1&&(c=d(c)),new h({urlTemplate:c},{map:b.map})}),g.register("tiled",function(a,b){var c=a.urlTemplate;return b.https===!0?c=e(c):b.https===!1&&(c=d(c)),a.urlTemplate=c,new h(a)}),g.register("wms",function(a,b){return new i(a)}),g.register("gmapsbase",function(a,b){return new j(a)}),g.register("plain",function(a,b){return new k(a)}),g.register("background",function(a,b){return new k(a)}),g.register("cartodb",function(a,b){return f(a,b),new l(a,{map:b.map})}),g.register("torque",function(a,b){return f(a,b),b.https&&a.sql_api_domain&&-1!==a.sql_api_domain.indexOf("cartodb.com")&&(a.sql_api_protocol="https",a.sql_api_port=443,a.tiler_protocol="https",a.tiler_port=443),new m(a,{map:b.map})}),b.exports=g},{"../geo/map/cartodb-layer":228,"../geo/map/gmaps-base-layer":229,"../geo/map/plain-layer":232,"../geo/map/tile-layer":233,"../geo/map/torque-layer":234,"../geo/map/wms-layer":235,"./vis/layers":301}],297:[function(a,b,c){var d=a("underscore"),e=a("./vis/overlay"),f=a("../core/model"),g=a("../core/template"),h=a("../geo/ui/annotation"),i=a("../geo/ui/header"),j=a("../geo/ui/infobox"),k=a("../geo/ui/infowindow"),l=a("../geo/ui/infowindow-model"),m=a("../geo/ui/layer-selector"),n=a("../geo/ui/search/search"),o=a("../geo/ui/text"),p=a("../geo/ui/tiles-loader"),q=a("../geo/ui/tooltip"),r=a("../geo/ui/zoom/zoom-view"),s=a("../ui/common/fullscreen/fullscreen-view"),t=a("../geo/ui/attribution/attribution-view");e.register("logo",function(a,b){}),e.register("attribution",function(a,b){var c=new t({map:a.map});return c.render()}),e.register("text",function(a,b){var c=a.options,d=g.compile(a.template||'    <div class="content">    <div class="text widget_text">{{{ text }}}</div>    </div>',a.templateType||"mustache"),e=new o({model:new f(c),template:d,className:"cartodb-overlay overlay-text "+c.device});return e.render()}),e.register("annotation",function(a,b){var c=a.options,d=g.compile(a.template||'    <div class="content">    <div class="text widget_text">{{{ text }}}</div>    <div class="stick"><div class="ball"></div></div>    </div>',a.templateType||"mustache"),c=a.options,e=new h({className:"cartodb-overlay overlay-annotation "+c.device,template:d,mapView:b.mapView,device:c.device,text:c.extra.rendered_text,minZoom:c.style["min-zoom"],maxZoom:c.style["max-zoom"],latlng:c.extra.latlng,style:c.style});return e.render()}),e.register("header",function(a,b){var c=a.options,d=g.compile(a.template||'    <div class="content">    <div class="title">{{{ title }}}</div>    <div class="description">{{{ description }}}</div>    </div>',a.templateType||"mustache"),e=new i({model:new f(c),template:d});return e.render()}),e.register("zoom",function(a,b){var c={model:a.map},d=new r(c);return d.render()}),e.register("loader",function(a){var b=new p;return b.render()}),e.register("_header",function(a,b){function c(a,b){return a.substr(0,b-1)+(a.length>b?"…":"")}location.href?a.share_url=encodeURIComponent(location.href):a.share_url=a.url;var d,e=g.compile(a.template||"      {{#title}}        <h1>          {{#url}}            <a href='#' onmousedown=\"window.open('{{url}}')\">{{title}}</a>          {{/url}}          {{^url}}            {{title}}          {{/url}}        </h1>      {{/title}}      {{#description}}<p>{{{description}}}</p>{{/description}}      {{#mobile_shareable}}        <div class='social'>          <a class='facebook' target='_blank'            href='http://www.facebook.com/sharer.php?u={{share_url}}&text=Map of {{title}}: {{description}}'>F</a>          <a class='twitter' href='https://twitter.com/share?url={{share_url}}&text={{twitter_title}}'           target='_blank'>T</a>        </div>      {{/mobile_shareable}}    ",a.templateType||"mustache"),f=a.map.get("title"),h=a.map.get("description"),j=f+": "+h;d=f&&h?c(f+": "+h,112)+" %23map ":f?c(f,112)+" %23map":h?c(h,112)+" %23map":"%23map";var k="false"!=a.shareable&&a.shareable?a.shareable:null,l=k;l=l&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);var m=new i({title:f,description:h,facebook_title:j,twitter_title:d,url:a.url,share_url:a.share_url,mobile_shareable:l,shareable:k&&!l,template:e});return m.render()}),e.register("infowindow",function(a,b){if(0==d.size(a.fields))return null;var c=new l({template:a.template,template_type:a.templateType,alternative_names:a.alternative_names,fields:a.fields,template_name:a.template_name,template_type:a.template_type}),e=new k({model:c,mapView:b.mapView,template:a.template});return e}),e.register("layer_selector",function(a,b){var c=a.options,d=g.compile(a.template||'      <a href="#/change-visibility" class="layers">Visible layers<div class="count"></div></a>      ',a.templateType||"underscore"),e=g.compile(a.template||'      <ul></ul><div class="tail"><span class="border"></span></div>      ',a.templateType||"underscore"),h=new m({model:new f(c),mapView:b.mapView,template:d,dropdown_template:e,layer_names:a.layer_names});return b.legends&&h.bind("change:visible",function(a,c,d){if("layergroup"===d.get("type")||"torque"===d.get("type")){var e=b.legends&&b.legends.getLegendByIndex(c);e&&e[a?"show":"hide"]()}}),h.render()}),e.register("fullscreen",function(a,b){var c=d.extend(a,{doc:b.$el.find("> div").get(0),allowWheelOnFullscreen:!1,mapView:b.mapView});a.template&&(c.template=g.compile(a.template,a.templateType||"mustache"));var e=new s(c);return e.render()}),e.register("share",function(a,b){}),e.register("search",function(a,b){var c=d.extend(a,{mapView:b.mapView,model:b.map});a.template&&(c.template=g.compile(a.template,a.templateType||"mustache"));var e=new n(c);return e.render()}),e.register("tooltip",function(a,b){if(!a.layer&&b.getLayers().length<=1)throw new Error("layer is null");return a.layer=a.layer||b.getLayers()[1],a.layer.setInteraction(!0),a.mapView=b.mapView,new q(a)}),e.register("infobox",function(a,b){var c,d=b.getLayers();if(a.layer||(d.length>1&&(c=d[1]),a.layer=c),!a.layer)throw new Error("layer is null");a.layer.setInteraction(!0);var e=new j(a);return e})},{"../core/model":165,"../core/template":169,"../geo/ui/annotation":237,"../geo/ui/attribution/attribution-view":239,"../geo/ui/header":240,"../geo/ui/infobox":242,"../geo/ui/infowindow":244,"../geo/ui/infowindow-model":243,"../geo/ui/layer-selector":245,"../geo/ui/search/search":275,"../geo/ui/text":278,"../geo/ui/tiles-loader":279,"../geo/ui/tooltip":280,"../geo/ui/zoom/zoom-view":282,"../ui/common/fullscreen/fullscreen-view":287,"./vis/overlay":302,underscore:148}],298:[function(a,b,c){var d=a("../geo/ui/tooltip"),e=function(a){this._vis=a};e.prototype.manage=function(a,b){this._mapView=a,this._map=b,this._map.layers.bind("reset",function(a){a.each(this._addTooltipForLayer,this)},this),this._map.layers.bind("add",this._addTooltipForLayer,this)},e.prototype._addTooltipForLayer=function(a){if(a.getTooltipData&&a.getTooltipData()){var b=this._mapView.getLayerViewByLayerCid(a.cid);b.tooltipView||(this._addTooltipOverlay(b,a),this._bindFeatureOverEvent(b))}},e.prototype._addTooltipOverlay=function(a,b){var c=a.tooltipView;if(!c){var e=b.getTooltipData();a.tooltipView=c=new d({mapView:this._mapView,layer:a,template:e.template,position:"bottom|right",vertical_offset:10,horizontal_offset:4,fields:e.fields,omit_columns:["cartodb_id"]}),this._mapView.addOverlay(c),a.bind("remove",function(){c.clean()})}},e.prototype._bindFeatureOverEvent=function(a){var b=a.tooltipView;a.bind("featureOver",function(c,d,e,f,g){var h=a.model;if(h.layers&&(h=h.layers.at(g)),!h)throw new Error("featureOver event for layer "+g+" was captured but layerModel coudn't be retrieved");var i=h.getTooltipData();i?(b.setTemplate(i.template),b.setFields(i.fields),b.setAlternativeNames(i.alternative_names),b.enable()):b.disable()})},b.exports=e},{"../geo/ui/tooltip":280}],299:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("jquery"),g=a("cdb.log"),h=a("cdb.core.util"),j=a("../core/loader"),k=a("../core/view"),l=a("../geo/ui/legend/stacked-legend"),m=a("../geo/map"),n=a("../geo/map-view-factory"),o=a("../geo/ui/legend-model"),p=a("../geo/ui/legend"),q=a("../geo/ui/infowindow-model"),r=a("../geo/ui/infowindow"),s=a("../core/template"),t=a("./vis/layers"),u=a("./vis/overlay"),v=a("./vis/infowindow-template"),w=a("../dataviews/dataviews-factory"),x=a("../dataviews/dataviews-collection"),y=a("./infowindow-manager"),z=a("./tooltip-manager"),A=a("../windshaft/config"),B=a("../windshaft/client"),C=a("../windshaft/layergroup-config"),D=a("../windshaft/namedmap-config"),E=a("../windshaft/windshaft-map"),F=a("./vizjson"),h=a("cdb.core.util"),G=k.extend({initialize:function(){d.bindAll(this,"loadingTiles","loadTiles","_onResize"),this.overlays=[],this.options.mapView&&(this.mapView=this.options.mapView,this.map=this.mapView.map)},_addLegends:function(a){
this.legends&&this.legends.remove(),this.legends=new l({legends:a}),this.mapView.addOverlay(this.legends)},addLegends:function(a){this._addLegends(this.createLegendView(a))},_setLayerOptions:function(a){var b=[],b=d.map(this.getLayers().slice(1),function(a){return a.getSubLayers?a.getSubLayers():a});for(b=d.flatten(b),i=0;i<Math.min(a.sublayer_options.length,b.length);++i){var c=a.sublayer_options[i],e=b[i],f=this.legends&&this.legends.getLegendByIndex(i);f&&f[c.visible?"show":"hide"](),e.model&&"torque"===e.model.get("type")&&c.visible===!1&&e.model.set("visible",!1)}},_addOverlays:function(a,b,c){for(a=a.toJSON(),a=d.sortBy(a,function(a){return null===a.order?Number.MAX_VALUE:a.order});0!==this.overlays.length;)this.overlays.pop().clean();this._createOverlays(a,b,c)},_createOverlays:function(a,b,c){d(a).each(function(a){var d=a.type;if(!("fullscreen"===d&&h.browser.ie&&h.browser.ie.version<=10)){if("image"===d||"text"===d||"annotation"===d){var e="mobile"==a.options.device;if(this.mobile!==e)return;if(!c[d]&&void 0!==c[d])return}if("header"===d)var g=this._addHeader(a,b);else var g=this.addOverlay(a);g&&d in c&&c[d]===!1&&g.hide();var i=a.options;if(("layer_selector"==d&&c[d]||"layer_selector"==d&&g.model.get("display")&&void 0==c[d])&&g.show(),("fullscreen"==d&&c[d]||"fullscreen"==d&&i.display&&void 0==c[d])&&g.show(),("search"==d&&c[d]||"search"==d&&i.display&&void 0==c[d])&&g.show(),"header"===d){var j=g.model;void 0!==c.title&&j.set("show_title",c.title),void 0!==c.description&&j.set("show_description",c.description),(j.get("show_title")||j.get("show_description"))&&f(".cartodb-map-wrapper").addClass("with_header"),g.render()}}},this)},_setupSublayers:function(a,b){b.sublayer_options=[],d.each(a.slice(1),function(a){"layergroup"===a.type?d.each(a.options.layer_definition.layers,function(a){b.sublayer_options.push({visible:void 0!==a.visible?a.visible:!0})}):"namedmap"===a.type?d.each(a.options.named_map.layers,function(a){b.sublayer_options.push({visible:void 0!==a.visible?a.visible:!0})}):"torque"===a.type&&b.sublayer_options.push({visible:void 0!==a.options.visible?a.options.visible:!0})})},load:function(a,b){if("string"==typeof a){var c=a;return void j.get(c,function(a){a?this.load(a,b):this.throwError("error fetching viz.json file")}.bind(this))}var g={tiles_loader:!0,loaderControl:!0,infowindow:!0,tooltip:!0,time_slider:!0};b=d.defaults(b||{},g);var i=new F(a);this._applyOptionsToVizJSON(i,b),this._dataviewsCollection=new x;var k,l,o=i.datasource;o.template_name?(k=[A.MAPS_API_BASE_URL,"named",o.template_name].join("/"),l=D):(k=A.MAPS_API_BASE_URL,l=C);var p=new B({endpoint:k,urlTemplate:o.maps_api_template,userName:o.user_name,forceCors:o.force_cors||!0}),q=new E(null,{client:p,configGenerator:l,statTag:o.stat_tag}),r=h.isMobileDevice()||i.hasZoomOverlay()||i.scrollwheel,s=i.center;"string"==typeof s&&(s=f.parseJSON(s));var t={title:i.title,description:i.description,maxZoom:i.maxZoom,minZoom:i.minZoom,legends:i.legends,bounds:i.bounds,center:s,zoom:i.zoom,scrollwheel:!!this.scrollwheel,drag:r,provider:i.map_provider,vector:i.vector};this.map=new m(t,{windshaftMap:q,dataviewsCollection:this._dataviewsCollection});var u=this.$el.outerHeight();0===u&&f(window).bind("resize",this._onResize);var v=f("<div>").css({position:"relative",width:"100%",height:"100%"});this.container=v;var G=f("<div>").addClass("cartodb-map-wrapper").css({position:"absolute",top:0,left:0,right:0,bottom:0,width:"100%"});v.append(G),this.$el.append(v);var H=new n;this.mapView=H.createMapView(this.map.get("provider"),this.map,G),(b.legends||void 0===b.legends&&this.map.get("legends")!==!1)&&this.map.layers.bind("reset",this.addLegends,this),this.mapView.bind("newLayerView",this._addLoading,this),this.https=window&&window.location.protocol&&"https:"===window.location.protocol||!!i.https||!!b.https;var I=this._newLayerModels(a,this.map),J=new y(this);J.manage(this.mapView,this.map);var K=new z(this);K.manage(this.mapView,this.map);var L=new e.Collection;return L.bind("reset",function(c){this._addOverlays(c,a,b)},this),L.reset(i.overlays),this.dataviews=new w(null,{dataviewsCollection:this._dataviewsCollection,layersCollection:this.map.layers,map:this.map,windshaftMap:q}),b.skipMapInstantiation||this.instantiateMap(),this.map.layers.reset(I),window.vis=this,this},_applyOptionsToVizJSON:function(a,b){a.scrollwheel=b.scrollwheel||a.scrollwheel,b.tiles_loader&&b.loaderControl||a.removeLoaderOverlay(),b.searchControl===!0?a.addSearchOverlay():b.searchControl===!1&&a.removeSearchOverlay(),(b.title&&a.title||b.description&&a.description)&&a.addHeaderOverlay(b.title,b.description,b.shareable),b.layer_selector&&a.addLayerSelectorOverlay(),void 0===b.zoomControl||b.zoomControl||a.removeZoomOverlay();var c=parseInt(b.zoom,10);isNaN(c)||a.setZoom(c);var d=parseFloat(b.center_lat),e=parseFloat(b.center_lon);isNaN(d)||isNaN(e)||a.setCenter([d,e]),void 0!==b.center&&a.setCenter(b.center);var f=parseFloat(b.sw_lat),g=parseFloat(b.sw_lon),h=parseFloat(b.ne_lat),i=parseFloat(b.ne_lon);isNaN(f)||isNaN(g)||isNaN(h)||isNaN(i)||a.setBounds([[f,g],[h,i]]),b.gmaps_base_type&&a.enforceGMapsBaseLayer(b.gmaps_base_type,b.gmaps_style)},instantiateMap:function(){var a=this;this._dataviewsCollection.on("add reset remove",d.debounce(this._invalidateSizeOnDataviewsChanges,10),this),this.map.instantiateMap(),d.defer(function(){a.trigger("done",a,a.map.layers)})},centerMapToOrigin:function(){this.mapView.invalidateSize(),this.map.reCenter()},_newLayerModels:function(a,b){var c=[],e={https:this.https,map:b};return d.each(a.layers,function(a){if("layergroup"===a.type||"namedmap"===a.type){var b;b="layergroup"===a.type?a.options.layer_definition.layers:a.options.named_map.layers,d.each(b,function(a){c.push(t.create("CartoDB",a,e))})}else c.push(t.create(a.type,a,e))}),c},_invalidateSizeOnDataviewsChanges:function(){this._dataviewsCollection.size()>0&&this.mapView.invalidateSize()},_addHeader:function(a,b){return this.addOverlay({type:"header",options:a.options})},_createLegendView:function(a,b){if(a.legend){a.legend.data=a.legend.items;var c=a.legend;if(c.items&&c.items.length||c.template){var e=d.extend(a.legend,{visible:a.visible}),f=new o(e),g=new p({model:f});return b.bind("change:visibility",function(a,b){g[b?"hide":"show"]()}),b.legend=f,g}}return null},createLegendView:function(a){for(var b=[],c=a.length-1;c>=0;--c){var e=a.at(c).cid,f=a.at(c).attributes;if(f.visible){var g=this.mapView.getLayerViewByLayerCid(e);if(g){var g=this.mapView.getLayerViewByLayerCid(e);b.push(this._createLayerLegendView(f,g))}}}return d.flatten(b)},_createLayerLegendView:function(a,b){var c=this,e=[];if(a.options&&a.options.layer_definition){var f=a.options.layer_definition.layers;d(f).each(function(a,d){e.push(c._createLegendView(a,b.getSubLayer(d)))})}else if(a.options&&a.options.named_map&&a.options.named_map.layers){var f=a.options.named_map.layers;d(f).each(function(a,d){e.push(c._createLegendView(a,b.getSubLayer(d)))})}else e.push(this._createLegendView(a,b));return d.compact(e).reverse()},addOverlay:function(a){a.map=this.map;var b=u.create(a.type,this,a);return b&&("loader"==a.type&&(this.loader=b),this.mapView.addOverlay(b),this.overlays.push(b),b.bind("clean",function(){for(var a in this.overlays){var c=this.overlays[a];if(b.cid===c.cid)return void this.overlays.splice(a,1)}},this)),b},createLayer:function(a){var b=t.create(a.type||a.kind,this,a);return this.mapView.createLayer(b)},_addLoading:function(a){if(a){var b=this,c=function(){b.loadingTiles()},d=function(){b.loadTiles()};a.bind("loading",c),a.bind("load",d)}},loadingTiles:function(){this.loader&&this.loader.show(),0===this.layersLoading&&this.trigger("loading"),this.layersLoading++},loadTiles:function(){this.loader&&this.loader.hide(),this.layersLoading--,this.layersLoading<=0&&(this.layersLoading=0,this.trigger("load"))},throwError:function(a,b){g.error(a);var c=this;d.defer(function(){c.trigger("error",a,b)})},error:function(a){return this.bind("error",a)},done:function(a){return this.bind("done",a)},getNativeMap:function(){return this.mapView.getNativeMap()},getLayers:function(){var a=this;return d.compact(this.map.layers.map(function(b){return a.mapView.getLayerViewByLayerCid(b.cid)}))},getOverlays:function(){return this.overlays},getOverlay:function(a){return d(this.overlays).find(function(b){return b.type==a})},getOverlaysByType:function(a){return d(this.overlays).filter(function(b){return b.type==a})},_onResize:function(){f(window).unbind("resize",this._onResize);var a=this;setTimeout(function(){a.centerMapToOrigin()},150)}},{addInfowindow:function(a,b,c,e){var f=d.defaults(e||{},{infowindowTemplate:v.light,templateType:"mustache",triggerEvent:"featureClick",templateName:"light",extraFields:[],cursorInteraction:!0});if(!a)throw new Error("map is not valid");if(!b)throw new Error("layer is not valid");if(!c&&void 0===c.length)throw new Error("fields should be a list of strings");var g=[];c=c.concat(f.extraFields);for(var h=0;h<c.length;++h)g.push({name:c,order:h});var i=new q({fields:g,template_name:f.templateName}),j=new r({model:i,mapView:a.viz.mapView,template:new s({template:f.infowindowTemplate,type:f.templateType}).asFunction()});return a.viz.mapView.addInfowindow(j),b.bind(f.triggerEvent,function(a,b,d,e,f){for(var g,h=[],i=0;i<c.length;++i){var k=c[i];(g=e[k])&&h.push({title:k,value:g,index:0})}j.model.set({content:{fields:h,data:e}}),j.setLatLng(b).showInfowindow(),j.adjustPan()},j),j.bind("clean",function(){b.unbind(f.triggerEvent,null,j)}),f.cursorInteraction&&G.addCursorInteraction(a,b),j},addCursorInteraction:function(a,b){var c=a.viz.mapView;b.bind("mouseover",function(){c.setCursor("pointer")}),b.bind("mouseout",function(a,b){c.setCursor("auto")})},removeCursorInteraction:function(a,b){var c=a.viz.mapView;b.unbind(null,null,c)}});b.exports=G},{"../core/loader":161,"../core/template":169,"../core/view":171,"../dataviews/dataviews-collection":178,"../dataviews/dataviews-factory":179,"../geo/map":227,"../geo/map-view-factory":225,"../geo/ui/infowindow":244,"../geo/ui/infowindow-model":243,"../geo/ui/legend":252,"../geo/ui/legend-model":251,"../geo/ui/legend/stacked-legend":273,"../windshaft/client":305,"../windshaft/config":306,"../windshaft/layergroup-config":312,"../windshaft/namedmap-config":313,"../windshaft/windshaft-map":314,"./infowindow-manager":295,"./tooltip-manager":298,"./vis/infowindow-template":300,"./vis/layers":301,"./vis/overlay":302,"./vizjson":304,backbone:1,"cdb.core.util":170,"cdb.log":158,jquery:57,underscore:148}],300:[function(a,b,c){var d={light:['<div class="cartodb-popup v2">','<a href="#close" class="cartodb-popup-close-button close">x</a>','<div class="cartodb-popup-content-wrapper">','<div class="cartodb-popup-content">',"{{#content.fields}}","{{#title}}<h4>{{title}}</h4>{{/title}}","{{#value}}",'<p {{#type}}class="{{ type }}"{{/type}}>{{{ value }}}</p>',"{{/value}}","{{^value}}",'<p class="empty">null</p>',"{{/value}}","{{/content.fields}}","</div>","</div>",'<div class="cartodb-popup-tip-container"></div>',"</div>"].join("")};b.exports=d},{}],301:[function(a,b,c){var d=a("underscore"),e=a("cdb.log"),f={_types:{},register:function(a,b){this._types[a]=b},create:function(a,b,c){if(!a)return e.error("creating a layer without type"),null;var f=this._types[a.toLowerCase()],g={};return g.type=a,d.extend(g,b,b.options),new f(g,c)}};b.exports=f},{"cdb.log":158,underscore:148}],302:[function(a,b,c){var d=a("cdb.log"),e={_types:{},register:function(a,b){e._types[a]=b},create:function(a,b,c){var f=e._types[a];if(!f)return void d.error("Overlay: "+a+" does not exist");c.options="string"==typeof c.options?JSON.parse(c.options):c.options,c.options=c.options||{};var g=f(c,b);return g?(g.type=a,g):!1}};b.exports=e},{"cdb.log":158}],303:[function(a,b,c){var d=a("backbone"),e=d.Collection.extend({comparator:function(){}});b.exports=e},{backbone:1}],304:[function(a,b,c){var d=a("underscore"),e=a("cdb.log"),f=["roadmap","gray_roadmap","dark_roadmap","hybrid","satellite","terrain"],g=function(a){d.each(Object.keys(a),function(b){this[b]=a[b]},this),this.overlays=this.overlays||[],this.layers=this.layers||[],this._addAttributionOverlay()};g.OVERLAY_TYPES={ZOOM:"zoom",ATTRIBUTION:"attribution",LOADER:"loader",SEARCH:"search",HEADER:"header",LAYER_SELECTOR:"layer_selector"},g.MAP_PROVIDER_TYPES={GMAPS:"googlemaps",LEAFLET:"leaflet"},g.prototype.hasZoomOverlay=function(){return this.hasOverlay(g.OVERLAY_TYPES.ZOOM)},g.prototype.hasOverlay=function(a){return d.isObject(this.getOverlayByType(a))},g.prototype.getOverlayByType=function(a){return d.find(this.overlays,function(b){return b.type===a})},g.prototype.addHeaderOverlay=function(a,b,c){this.hasOverlay(g.OVERLAY_TYPES.HEADER)||this.overlays.unshift({type:g.OVERLAY_TYPES.HEADER,order:1,shareable:c,url:this.url,options:{extra:{title:this.title,description:this.description,show_title:a,show_description:b}}})},g.prototype.addLayerSelectorOverlay=function(){this.hasOverlay(g.OVERLAY_TYPES.LAYER_SELECTOR)||this.overlays.push({type:g.OVERLAY_TYPES.LAYER_SELECTOR})},g.prototype.addSearchOverlay=function(){this.hasOverlay(g.OVERLAY_TYPES.SEARCH)||this.overlays.push({type:g.OVERLAY_TYPES.SEARCH,order:3})},g.prototype.removeOverlay=function(a){for(var b=0;b<this.overlays.length;++b)if(this.overlays[b].type===a)return void this.overlays.splice(b,1)},g.prototype.removeLoaderOverlay=function(){this.removeOverlay(g.OVERLAY_TYPES.LOADER)},g.prototype.removeZoomOverlay=function(){this.removeOverlay(g.OVERLAY_TYPES.ZOOM)},g.prototype.removeSearchOverlay=function(){this.removeOverlay(g.OVERLAY_TYPES.SEARCH)},g.prototype._addAttributionOverlay=function(){this.overlays.push({type:g.OVERLAY_TYPES.ATTRIBUTION})},g.prototype.enforceGMapsBaseLayer=function(a,b){var c=d.contains(f,a);this.map_provider===g.MAP_PROVIDER_TYPES.LEAFLET&&c?this.layers?(this.layers[0].options.type="GMapsBase",this.layers[0].options.base_type=a,this.layers[0].options.name=a,b&&(this.layers[0].options.style="string"==typeof b?JSON.parse(b):b),this.map_provider=g.MAP_PROVIDER_TYPES.GMAPS,this.layers[0].options.attribution=""):e.error("No base map loaded. Using Leaflet."):e.error('GMaps base_type "'+a+" is not supported. Using leaflet.")},g.prototype.setZoom=function(a){this.zoom=a,this.bounds=null},g.prototype.setCenter=function(a){this.center=a,this.bounds=null},g.prototype.setBounds=function(a){this.bounds=a},b.exports=g},{"cdb.log":158,underscore:148}],305:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("lzma"),g=a("../core/util"),h=function(a,b){var c=e.filter(b,function(b){return!a[b]});if(c.length)throw new Error("WindshaftClient could not be initialized. The following options are missing: "+c.join(", "))},i=function(a){h(a,["urlTemplate","userName","endpoint"]),this.urlTemplate=a.urlTemplate,this.userName=a.userName,this.endpoint=a.endpoint,this.statTag=a.statTag,this.forceCors=a.forceCors||!1,this.url=this.urlTemplate.replace("{user}",this.userName)};i.DEFAULT_COMPRESSION_LEVEL=3,i.MAX_GET_SIZE=2033,i.prototype.instantiateMap=function(a){var b=a.mapDefinition,c=a.statTag,d=a.filters||{},e=a.success,f=a.error,g=JSON.stringify(b),h={success:function(a){a.errors?f(a.errors[0]):e(a)},error:function(a){var b={errors:["Unknown error"]};try{b=JSON.parse(a.responseText)}catch(c){}f(b.errors[0])}},i=[["stat_tag",c].join("=")];Object.keys(d).length&&i.push(["filters",encodeURIComponent(JSON.stringify(d))].join("=")),this._usePOST(g,i)?this._post(g,i,h):this._get(g,i,h)},i.prototype._usePOST=function(a,b){return g.isCORSSupported()&&this.forceCors?!0:a.length>=this.constructor.MAX_GET_SIZE},i.prototype._post=function(a,b,c){d.ajax({crossOrigin:!0,method:"POST",dataType:"json",contentType:"application/json",url:this._getURL(b),data:a,success:c.success,error:c.error})},i.prototype._get=function(a,b,c){var e=this._getCompressor(a);e(a,this.constructor.DEFAULT_COMPRESSION_LEVEL,function(e){b.push(e),d.ajax({url:this._getURL(b),method:"GET",dataType:"jsonp",jsonpCallback:this._jsonpCallbackName(a),cache:!0,success:c.success,error:c.error})}.bind(this))},i.prototype._getCompressor=function(a){return a.length<this.constructor.MAX_GET_SIZE?function(a,b,c){c("config="+encodeURIComponent(a))}:function(a,b,c){a=JSON.stringify({config:a}),f.compress(a,b,function(a){c("lzma="+encodeURIComponent(g.array2hex(a)))})}},i.prototype._getURL=function(a){return[this.url,this.endpoint].join("/")+"?"+a.join("&")},i.prototype._jsonpCallbackName=function(a){return"_cdbc_"+g.uniqueCallbackName(a)},b.exports=i},{"../core/util":170,jquery:57,lzma:318,underscore:148}],306:[function(a,b,c){b.exports={MAPS_API_BASE_URL:"api/v1/map"}},{}],307:[function(a,b,c){var d=a("../../core/model");b.exports=d.extend({isEmpty:function(){throw new Error("Filters must implement the .isEmpty method")},toJSON:function(){throw new Error("Filters must implement the .toJSON method")},remove:function(){this.trigger("destroy",this),this.stopListening()}})},{"../../core/model":165}],308:[function(a,b,c){var d=a("../../core/model");b.exports=d.extend({initialize:function(a){this.setBounds(a)},setBounds:function(a){this.set({west:a[0][1],south:a[0][0],east:a[1][1],north:a[1][0]})},toString:function(){return[this.get("west"),this.get("south"),this.get("east"),this.get("north")].join(",")}})},{"../../core/model":165}],309:[function(a,b,c){var d=a("underscore"),e=a("backbone"),f=a("./base");b.exports=f.extend({defaults:{rejectAll:!1},initialize:function(){this.rejectedCategories=new e.Collection,this.acceptedCategories=new e.Collection,this._initBinds()},_initBinds:function(){this.listenTo(this.rejectedCategories,"add remove",function(){this.set("rejectAll",!1)}),this.listenTo(this.acceptedCategories,"add remove",function(){this.set("rejectAll",!1)})},isEmpty:function(){return 0===this.rejectedCategories.size()&&0===this.acceptedCategories.size()&&!this.get("rejectAll")},accept:function(a,b){a=d.isArray(a)?a:[a],d.each(a,function(a){var b={name:a},c=this.rejectedCategories.where(b),d=this.acceptedCategories.where(b);c.length>0?this.rejectedCategories.remove(c):d.length||this.acceptedCategories.add(b)},this),b!==!1&&this.applyFilter()},acceptAll:function(){this.set("rejectAll",!1),this.cleanFilter()},isAccepted:function(a){return this.acceptedCategories.where({name:a}).length>0},reject:function(a,b){a=d.isArray(a)?a:[a],d.each(a,function(a){var b={name:a},c=this.acceptedCategories.where(b),d=this.rejectedCategories.where(b);c.length>0?this.acceptedCategories.remove(c):d.length||this.rejectedCategories.add(b)},this),b!==!1&&this.applyFilter()},isRejected:function(a){var b=this.acceptedCategories.size();return this.rejectedCategories.where({name:a}).length>0?!0:b>0&&0===this.acceptedCategories.where({name:a}).length?!0:!!this.get("rejectAll")},rejectAll:function(){this.set("rejectAll",!0),this.cleanFilter()},cleanFilter:function(a){this.acceptedCategories.reset(),this.rejectedCategories.reset(),a!==!1&&this.applyFilter()},applyFilter:function(){this.trigger("change",this)},areAllRejected:function(){return this.get("rejectAll")},toJSON:function(){var a={},b=this.rejectedCategories.size(),c=this.acceptedCategories.size(),e={accept:d.pluck(this.acceptedCategories.toJSON(),"name")},f={reject:d.pluck(this.rejectedCategories.toJSON(),"name")};this.get("rejectAll")?a={accept:[]}:c>0?a=e:b>0&&0===c&&(a=f);var g={};return g[this.get("dataviewId")]=a,g},getAcceptedCategoryNames:function(){return this.acceptedCategories.map(function(a){return a.get("name")})},getRejectedCategoryNames:function(){return this.rejectedCategories.map(function(a){return a.get("name")})}})},{"./base":307,backbone:1,underscore:148}],310:[function(a,b,c){var d=a("underscore"),e=a("backbone");b.exports=e.Collection.extend({initialize:function(a,b){this.layers=b,e.Collection.prototype.initialize.apply(this,a)},toJSON:function(){var a={},b=this.getActiveFilters();if(b.length){a.layers=[];var c,e,f,g;for(c=0;c<this.layers.length;c++){var h=this.layers[c];if(h.isVisible()){if(f=this.getActiveFiltersForLayer(h),g={},f.length)for(e=0;e<f.length;e++)d.extend(g,f[e].toJSON());a.layers.push(g)}}}return a},getActiveFilters:function(){return this.filter(function(a){return!a.isEmpty()})},getActiveFiltersForLayer:function(a){return this.filter(function(b){return!b.isEmpty()&&b.get("layer")===a})}})},{backbone:1,underscore:148}],311:[function(a,b,c){var d=a("underscore"),e=a("./base");b.exports=e.extend({isEmpty:function(){return d.isUndefined(this.get("min"))&&d.isUndefined(this.get("max"))},setRange:function(a,b){this.set({min:a,max:b})},unsetRange:function(){this.setRange(void 0,void 0)},toJSON:function(){var a={};return a[this.get("dataviewId")]={min:this.get("min"),max:this.get("max"),column_type:this.get("column_type")},a}})},{"./base":307,underscore:148}],312:[function(a,b,c){var d=a("underscore"),e={},f="2.1.0";e.generate=function(a){var b=a.layers,c=a.dataviews,e={layers:[]};return d.each(b,function(a){if(a.isVisible()){var b={type:a.get("type").toLowerCase(),options:{sql:a.get("sql"),cartocss:a.get("cartocss"),cartocss_version:a.get("cartocss_version")||f,interactivity:a.getInteractiveColumnNames(),widgets:{}}};c&&(b.options.widgets=c.reduce(function(b,c){return a.get("id")===c.layer.get("id")&&(b[c.get("id")]=c.toJSON()),b},{})),a.getInfowindowFieldNames().length&&(b.options.attributes={id:"cartodb_id",columns:a.getInfowindowFieldNames()}),e.layers.push(b)}}),e},b.exports=e},{underscore:148}],313:[function(a,b,c){var d=a("underscore"),e={};e.generate=function(a){var b=a.layers,c={};return d.each(b,function(a,b){c["layer"+b]=a.isVisible()?1:0}),c},b.exports=e},{underscore:148}],314:[function(a,b,c){var d=a("backbone"),e=a("underscore"),f=a("./filters/collection"),g=a("./layergroup-config"),h=a("./namedmap-config"),i=a("./config"),j="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",k=d.Model.extend({initialize:function(a,b){this.client=b.client,this.statTag=b.statTag,this.configGenerator=b.configGenerator,this.pngParams=["map_key","api_key","cache_policy","updated_at"],this.gridParams=["map_key","api_key","cache_policy","updated_at"],this.set({urlTemplate:this.client.urlTemplate,userName:this.client.userName})},isNamedMap:function(){return this.configGenerator===h},isAnonymousMap:function(){return this.configGenerator===g},createInstance:function(a){a=a||{};var b=e.select(a.layers,function(a){return"CartoDB"===a.get("type")||"torque"===a.get("type")}),c=a.dataviews,d=a.sourceLayerId,g=a.forceFetch,h=this.configGenerator.generate({layers:b,dataviews:c}),i=[];c&&(i=c.chain().filter(function(a){return a.layer.isVisible()}).map(function(a){return a.filter}).compact().value());var j=new f(i,b);return this.client.instantiateMap({mapDefinition:h,statTag:this.statTag,filters:j.toJSON(),success:function(a){this.set(a),e.each(b,function(a,b){"torque"===a.get("type")?(a.set("meta",this.getLayerMeta(b)),a.set("urls",this.getTiles("torque"))):"CartoDB"===a.get("type")&&a.set("meta",this.getLayerMeta(b))},this),this.trigger("instanceCreated",this,d,g)}.bind(this),error:function(a){console.log("Error creating the map instance on Windshaft: "+a)}}),this},TILE_EXTENSIONS_BY_LAYER_TYPE:{mapnik:".png",torque:".json.torque"},getBaseURL:function(a){return[this._getHost(a),i.MAPS_API_BASE_URL,this.get("layergroupid")].join("/")},_getHost:function(a){var b=this.get("userName"),c=this._useHTTPS()?"https":"http";a=a?a+".":"";var d=this.get("urlTemplate").replace("{user}",b),e=this.get("cdn_url")&&this.get("cdn_url")[c];return e&&(d=[c,"://",a,e,"/",b].join("")),d},_useHTTPS:function(){return 0===this.get("urlTemplate").indexOf("https")},getDataviewURL:function(a){var b,c=a.dataviewId,d=a.protocol,f=this.get("metadata")&&this.get("metadata").layers;return e.each(f,function(a){var e=a.widgets;for(var f in e)if(c===f)return void(b=e[f].url[d])}),b},getTiles:function(a,b){var c=[],d=[],e=this._encodeParams(b,this.pngParams),f=this._encodeParams(b,this.gridParams),g=["0","1","2","3"];this._useHTTPS()&&(g=[""]),a=a||"mapnik";var h=this._getLayerIndexesByType(a);if(h.length)for(var i="/{z}/{x}/{y}",k=0;k<g.length;++k){var l=g[k],m=[this.getBaseURL(l),"/",h.join(","),"/{z}/{x}/{y}",this.TILE_EXTENSIONS_BY_LAYER_TYPE[a],e?"?"+e:""].join("");if(d.push(m),"mapnik"===a)for(var n=0;n<this.get("metadata").layers.length;++n){var o=this._getLayerIndexByType(n,"mapnik");if(o>=0){var p=[this.getBaseURL(l),"/",o,i,".grid.json",f?"?"+f:""].join("");c[n]=c[n]||[],c[n].push(p)}}}else d=[j];return this.urls={tiles:d,grids:c},this.urls},getLayerMeta:function(a){var b={},c=this._localLayerIndexToWindshaftLayerIndex(a),d=this.get("metadata")&&this.get("metadata").layers;return d&&d[c]&&(b=d[c].meta||{}),b},_localLayerIndexToWindshaftLayerIndex:function(a){var b=this.get("metadata")&&this.get("metadata").layers,c=b.length>0&&"http"===b[0].type;return c?++a:a},_encodeParams:function(a,b){if(!a)return"";var c=[];b=b||e.keys(a);for(var d in b){var f=b[d],g=a[f];if(g)if(e.isArray(g))for(var h=0,i=g.length;i>h;h++)c.push(f+"[]="+encodeURIComponent(g[h]));else{var j=encodeURIComponent(g);j=j.replace(/%7Bx%7D/g,"{x}").replace(/%7By%7D/g,"{y}").replace(/%7Bz%7D/g,"{z}"),c.push(f+"="+j)}}return c.join("&")},_getLayerIndexesByType:function(a){var b=this.get("metadata")&&this.get("metadata").layers;if(b){for(var c=[],d=0;d<b.length;d++){var e=b[d],f=!1;a&&a.length>0&&(f=-1!==a.indexOf(e.type)),f&&c.push(d)}return c}},_getLayerIndexByType:function(a,b){var c=this.get("metadata")&&this.get("metadata").layers;if(!c)return a;for(var d={},e=0,f=0;f<c.length;f++)c[f].type===b&&(d[e]=f,e++);return void 0===d[a]?-1:d[a]}});b.exports=k},{"./config":306,"./filters/collection":310,"./layergroup-config":312,"./namedmap-config":313,backbone:1,underscore:148}],315:[function(a,b,c){(function(a){(function(a,b,c,d,e){var f=function(a,b){var c,d=function(a,b,c){var g;switch(a.type){case"Point":b.position=new google.maps.LatLng(a.coordinates[1],a.coordinates[0]),g=new google.maps.Marker(b),c&&g.set("geojsonProperties",c);break;case"MultiPoint":g=[];for(var h=0;h<a.coordinates.length;h++)b.position=new google.maps.LatLng(a.coordinates[h][1],a.coordinates[h][0]),g.push(new google.maps.Marker(b));if(c)for(var i=0;i<g.length;i++)g[i].set("geojsonProperties",c);break;case"LineString":for(var j=[],h=0;h<a.coordinates.length;h++){var k=a.coordinates[h],l=new google.maps.LatLng(k[1],k[0]);j.push(l)}b.path=j,g=new google.maps.Polyline(b),c&&g.set("geojsonProperties",c);break;case"MultiLineString":g=[];for(var h=0;h<a.coordinates.length;h++){for(var j=[],m=0;m<a.coordinates[h].length;m++){var k=a.coordinates[h][m],l=new google.maps.LatLng(k[1],k[0]);j.push(l)}b.path=j,g.push(new google.maps.Polyline(b))}if(c)for(var i=0;i<g.length;i++)g[i].set("geojsonProperties",c);break;case"Polygon":for(var n,o,p=[],h=0;h<a.coordinates.length;h++){for(var j=[],m=0;m<a.coordinates[h].length;m++){var l=new google.maps.LatLng(a.coordinates[h][m][1],a.coordinates[h][m][0]);j.push(l)}h?1==h?(o=f(j),n==o?p.push(j.reverse()):p.push(j)):n==o?p.push(j.reverse()):p.push(j):(n=f(j),p.push(j))}b.paths=p,g=new google.maps.Polygon(b),c&&g.set("geojsonProperties",c);break;case"MultiPolygon":g=[];for(var h=0;h<a.coordinates.length;h++){for(var n,o,p=[],m=0;m<a.coordinates[h].length;m++){for(var j=[],i=0;i<a.coordinates[h][m].length-1;i++){var l=new google.maps.LatLng(a.coordinates[h][m][i][1],a.coordinates[h][m][i][0]);j.push(l)}m?1==m?(o=f(j),n==o?p.push(j.reverse()):p.push(j)):n==o?p.push(j.reverse()):p.push(j):(n=f(j),p.push(j))}b.paths=p,g.push(new google.maps.Polygon(b))}if(c)for(var i=0;i<g.length;i++)g[i].set("geojsonProperties",c);break;case"GeometryCollection":if(g=[],a.geometries)for(var h=0;h<a.geometries.length;h++)g.push(d(a.geometries[h],b,c||null));else g=e('Invalid GeoJSON object: GeometryCollection object missing "geometries" member.');break;default:g=e('Invalid GeoJSON object: Geometry object must be one of "Point", "LineString", "Polygon" or "MultiPolygon".')}return g},e=function(a){return{type:"Error",message:a}},f=function(a){for(var b,c=0,d=0;d<a.length-2;d++)c+=(a[d+1].lat()-a[d].lat())*(a[d+2].lng()-a[d].lng())-(a[d+2].lat()-a[d].lat())*(a[d+1].lng()-a[d].lng());return b=c>0},g=b||{};switch(a.type){case"FeatureCollection":if(a.features){c=[];for(var h=0;h<a.features.length;h++)c.push(d(a.features[h].geometry,g,a.features[h].properties))}else c=e('Invalid GeoJSON object: FeatureCollection object missing "features" member.');break;case"GeometryCollection":if(a.geometries){c=[];for(var h=0;h<a.geometries.length;h++)c.push(d(a.geometries[h],g))}else c=e('Invalid GeoJSON object: GeometryCollection object missing "geometries" member.');break;case"Feature":c=a.properties&&a.geometry?d(a.geometry,g,a.properties):e('Invalid GeoJSON object: Feature object missing "properties" or "geometry" member.');break;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":c=a.coordinates?c=d(a,g):e('Invalid GeoJSON object: Geometry object missing "coordinates" member.');break;default:c=e('Invalid GeoJSON object: GeoJSON object must be one of "Point", "LineString", "Polygon", "MultiPolygon", "Feature", "FeatureCollection" or "GeometryCollection".')}return c};e("undefined"!=typeof f?f:window.GeoJSON)}).call(a,void 0,void 0,void 0,void 0,function(a){b.exports=a})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],316:[function(a,b,c){(function(c){_=c._=a("underscore"),jQuery=c.jQuery=a("jquery");(function(a,b,c){!function(a){a.fn.clipPath=function(b,c,d,e){return this.filter("[data-clipPath]").each(function(f){var g=a(this).attr("data-clipPath"),h=a(this).attr("src"),i='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" class="CDB-infowindow-mask" width="<%- w %>" height="<%- h %>" viewBox="0 0 <%- w %> <%- h %>">';i+='<defs><clipPath id="maskID<%-id %>"><path d="<%-path %>"/></clipPath></defs>',i+='<image clip-path="url(#maskID<%-id %>)" x="<%- x %>" y="<%- y %>" width="<%-w %>" height="<%-h %>" xlink:href="<%-src %>" />',i+="</svg>";var j=a(_.template(i)({id:f,x:d,y:-e,w:b,h:c,src:h,path:g}));a(this).replaceWith(j)}),this}}(jQuery)}).call(c,b,void 0,void 0)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{jquery:57,underscore:148}],317:[function(a,b,c){(function(a){(function(a,b,c,d,e){var f=1,g=2,h=4,i=8,j=16,k=64,l=512,m=1024,n=function(){var a=[["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","transparent","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],["all-scroll","col-resize","crosshair","default","e-resize","hand","help","move","n-resize","ne-resize","no-drop","not-allowed","nw-resize","pointer","progress","row-resize","s-resize","se-resize","sw-resize","text","vertical-text","w-resize","wait"],["armenian","decimal","decimal-leading-zero","disc","georgian","lower-alpha","lower-greek","lower-latin","lower-roman","square","upper-alpha","upper-latin","upper-roman"],["100","200","300","400","500","600","700","800","900","bold","bolder","lighter"],["block-level","inline-level","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group"],["condensed","expanded","extra-condensed","extra-expanded","narrower","semi-condensed","semi-expanded","ultra-condensed","ultra-expanded","wider"],["inherit","inline","inline-block","inline-box","inline-flex","inline-grid","inline-list-item","inline-stack","inline-table","run-in"],["behind","center-left","center-right","far-left","far-right","left-side","leftwards","right-side","rightwards"],["large","larger","small","smaller","x-large","x-small","xx-large","xx-small"],["dashed","dotted","double","groove","outset","ridge","solid"],["ease","ease-in","ease-in-out","ease-out","linear","step-end","step-start"],["at","closest-corner","closest-side","ellipse","farthest-corner","farthest-side"],["baseline","middle","sub","super","text-bottom","text-top"],["caption","icon","menu","message-box","small-caption","status-bar"],["fast","faster","slow","slower","x-fast","x-slow"],["above","below","higher","level","lower"],["cursive","fantasy","monospace","sans-serif","serif"],["loud","silent","soft","x-loud","x-soft"],["no-repeat","repeat-x","repeat-y","round","space"],["blink","line-through","overline","underline"],["block","flex","grid","table"],["high","low","x-high","x-low"],["nowrap","pre","pre-line","pre-wrap"],["absolute","relative","static"],["alternate","alternate-reverse","reverse"],["border-box","content-box","padding-box"],["capitalize","lowercase","uppercase"],["child","female","male"],["=","opacity"],["backwards","forwards"],["bidi-override","embed"],["bottom","top"],["break-all","keep-all"],["clip","ellipsis"],["contain","cover"],["continuous","digits"],["end","start"],["flat","preserve-3d"],["hide","show"],["horizontal","vertical"],["inside","outside"],["italic","oblique"],["left","right"],["ltr","rtl"],["no-content","no-display"],["paused","running"],["suppress","unrestricted"],["thick","thin"],[","],["/"],["all"],["always"],["auto"],["avoid"],["both"],["break-word"],["center"],["circle"],["code"],["collapse"],["contents"],["fixed"],["hidden"],["infinite"],["inset"],["invert"],["justify"],["list-item"],["local"],["medium"],["mix"],["none"],["normal"],["once"],["repeat"],["scroll"],["separate"],["small-caps"],["spell-out"],["to"],["visible"]],b={
animation:{cssPropBits:517,cssLitGroup:[a[10],a[24],a[29],a[45],a[48],a[54],a[63],a[71],a[72]],cssFns:["cubic-bezier()","steps()"]},"animation-delay":{cssPropBits:5,cssLitGroup:[a[48]],cssFns:[]},"animation-direction":{cssPropBits:0,cssLitGroup:[a[24],a[48],a[72]],cssFns:[]},"animation-duration":"animation-delay","animation-fill-mode":{cssPropBits:0,cssLitGroup:[a[29],a[48],a[54],a[71]],cssFns:[]},"animation-iteration-count":{cssPropBits:5,cssLitGroup:[a[48],a[63]],cssFns:[]},"animation-name":{cssPropBits:512,cssLitGroup:[a[48],a[71]],cssFns:[]},"animation-play-state":{cssPropBits:0,cssLitGroup:[a[45],a[48]],cssFns:[]},"animation-timing-function":{cssPropBits:0,cssLitGroup:[a[10],a[48]],cssFns:["cubic-bezier()","steps()"]},appearance:{cssPropBits:0,cssLitGroup:[a[71]],cssFns:[]},azimuth:{cssPropBits:5,cssLitGroup:[a[7],a[42],a[56]],cssFns:[]},"backface-visibility":{cssPropBits:0,cssLitGroup:[a[59],a[62],a[80]],cssFns:[]},background:{cssPropBits:23,cssLitGroup:[a[0],a[18],a[25],a[31],a[34],a[42],a[48],a[49],a[52],a[56],a[61],a[68],a[71],a[74],a[75]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()","rgb()","rgba()"]},"background-attachment":{cssPropBits:0,cssLitGroup:[a[48],a[61],a[68],a[75]],cssFns:[]},"background-color":{cssPropBits:2,cssLitGroup:[a[0]],cssFns:["rgb()","rgba()"]},"background-image":{cssPropBits:16,cssLitGroup:[a[48],a[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"background-position":{cssPropBits:5,cssLitGroup:[a[31],a[42],a[48],a[56]],cssFns:[]},"background-repeat":{cssPropBits:0,cssLitGroup:[a[18],a[48],a[74]],cssFns:[]},"background-size":{cssPropBits:5,cssLitGroup:[a[34],a[48],a[52]],cssFns:[]},border:{cssPropBits:7,cssLitGroup:[a[0],a[9],a[47],a[62],a[64],a[69],a[71]],cssFns:["rgb()","rgba()"]},"border-bottom":"border","border-bottom-color":"background-color","border-bottom-left-radius":{cssPropBits:5,cssFns:[]},"border-bottom-right-radius":"border-bottom-left-radius","border-bottom-style":{cssPropBits:0,cssLitGroup:[a[9],a[62],a[64],a[71]],cssFns:[]},"border-bottom-width":{cssPropBits:5,cssLitGroup:[a[47],a[69]],cssFns:[]},"border-collapse":{cssPropBits:0,cssLitGroup:[a[59],a[76]],cssFns:[]},"border-color":"background-color","border-left":"border","border-left-color":"background-color","border-left-style":"border-bottom-style","border-left-width":"border-bottom-width","border-radius":{cssPropBits:5,cssLitGroup:[a[49]],cssFns:[]},"border-right":"border","border-right-color":"background-color","border-right-style":"border-bottom-style","border-right-width":"border-bottom-width","border-spacing":"border-bottom-left-radius","border-style":"border-bottom-style","border-top":"border","border-top-color":"background-color","border-top-left-radius":"border-bottom-left-radius","border-top-right-radius":"border-bottom-left-radius","border-top-style":"border-bottom-style","border-top-width":"border-bottom-width","border-width":"border-bottom-width",bottom:{cssPropBits:5,cssLitGroup:[a[52]],cssFns:[]},box:{cssPropBits:0,cssLitGroup:[a[60],a[71],a[72]],cssFns:[]},"box-shadow":{cssPropBits:7,cssLitGroup:[a[0],a[48],a[64],a[71]],cssFns:["rgb()","rgba()"]},"box-sizing":{cssPropBits:0,cssLitGroup:[a[25]],cssFns:[]},"caption-side":{cssPropBits:0,cssLitGroup:[a[31]],cssFns:[]},clear:{cssPropBits:0,cssLitGroup:[a[42],a[54],a[71]],cssFns:[]},clip:{cssPropBits:0,cssLitGroup:[a[52]],cssFns:["rect()"]},color:"background-color",content:{cssPropBits:8,cssLitGroup:[a[71],a[72]],cssFns:[]},cue:{cssPropBits:16,cssLitGroup:[a[71]],cssFns:[]},"cue-after":"cue","cue-before":"cue",cursor:{cssPropBits:16,cssLitGroup:[a[1],a[48],a[52]],cssFns:[]},direction:{cssPropBits:0,cssLitGroup:[a[43]],cssFns:[]},display:{cssPropBits:0,cssLitGroup:[a[4],a[6],a[20],a[52],a[67],a[71]],cssFns:[]},"display-extras":{cssPropBits:0,cssLitGroup:[a[67],a[71]],cssFns:[]},"display-inside":{cssPropBits:0,cssLitGroup:[a[20],a[52]],cssFns:[]},"display-outside":{cssPropBits:0,cssLitGroup:[a[4],a[71]],cssFns:[]},elevation:{cssPropBits:5,cssLitGroup:[a[15]],cssFns:[]},"empty-cells":{cssPropBits:0,cssLitGroup:[a[38]],cssFns:[]},filter:{cssPropBits:0,cssFns:["alpha()"]},"float":{cssPropBits:0,cssLitGroup:[a[42],a[71]],cssFns:[]},font:{cssPropBits:73,cssLitGroup:[a[3],a[8],a[13],a[16],a[41],a[48],a[49],a[69],a[72],a[77]],cssFns:[]},"font-family":{cssPropBits:72,cssLitGroup:[a[16],a[48]],cssFns:[]},"font-size":{cssPropBits:1,cssLitGroup:[a[8],a[69]],cssFns:[]},"font-stretch":{cssPropBits:0,cssLitGroup:[a[5],a[72]],cssFns:[]},"font-style":{cssPropBits:0,cssLitGroup:[a[41],a[72]],cssFns:[]},"font-variant":{cssPropBits:0,cssLitGroup:[a[72],a[77]],cssFns:[]},"font-weight":{cssPropBits:0,cssLitGroup:[a[3],a[72]],cssFns:[]},height:"bottom",left:"bottom","letter-spacing":{cssPropBits:5,cssLitGroup:[a[72]],cssFns:[]},"line-height":{cssPropBits:1,cssLitGroup:[a[72]],cssFns:[]},"list-style":{cssPropBits:16,cssLitGroup:[a[2],a[40],a[57],a[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"list-style-image":{cssPropBits:16,cssLitGroup:[a[71]],cssFns:["image()","linear-gradient()","radial-gradient()","repeating-linear-gradient()","repeating-radial-gradient()"]},"list-style-position":{cssPropBits:0,cssLitGroup:[a[40]],cssFns:[]},"list-style-type":{cssPropBits:0,cssLitGroup:[a[2],a[57],a[71]],cssFns:[]},margin:"bottom","margin-bottom":"bottom","margin-left":"bottom","margin-right":"bottom","margin-top":"bottom","max-height":{cssPropBits:1,cssLitGroup:[a[52],a[71]],cssFns:[]},"max-width":"max-height","min-height":{cssPropBits:1,cssLitGroup:[a[52]],cssFns:[]},"min-width":"min-height",opacity:{cssPropBits:1,cssFns:[]},outline:{cssPropBits:7,cssLitGroup:[a[0],a[9],a[47],a[62],a[64],a[65],a[69],a[71]],cssFns:["rgb()","rgba()"]},"outline-color":{cssPropBits:2,cssLitGroup:[a[0],a[65]],cssFns:["rgb()","rgba()"]},"outline-style":"border-bottom-style","outline-width":"border-bottom-width",overflow:{cssPropBits:0,cssLitGroup:[a[52],a[62],a[75],a[80]],cssFns:[]},"overflow-wrap":{cssPropBits:0,cssLitGroup:[a[55],a[72]],cssFns:[]},"overflow-x":{cssPropBits:0,cssLitGroup:[a[44],a[52],a[62],a[75],a[80]],cssFns:[]},"overflow-y":"overflow-x",padding:"opacity","padding-bottom":"opacity","padding-left":"opacity","padding-right":"opacity","padding-top":"opacity","page-break-after":{cssPropBits:0,cssLitGroup:[a[42],a[51],a[52],a[53]],cssFns:[]},"page-break-before":"page-break-after","page-break-inside":{cssPropBits:0,cssLitGroup:[a[52],a[53]],cssFns:[]},pause:"border-bottom-left-radius","pause-after":"border-bottom-left-radius","pause-before":"border-bottom-left-radius",perspective:{cssPropBits:5,cssLitGroup:[a[71]],cssFns:[]},"perspective-origin":{cssPropBits:5,cssLitGroup:[a[31],a[42],a[56]],cssFns:[]},pitch:{cssPropBits:5,cssLitGroup:[a[21],a[69]],cssFns:[]},"pitch-range":"border-bottom-left-radius","play-during":{cssPropBits:16,cssLitGroup:[a[52],a[70],a[71],a[74]],cssFns:[]},position:{cssPropBits:0,cssLitGroup:[a[23]],cssFns:[]},quotes:{cssPropBits:8,cssLitGroup:[a[71]],cssFns:[]},resize:{cssPropBits:0,cssLitGroup:[a[39],a[54],a[71]],cssFns:[]},richness:"border-bottom-left-radius",right:"bottom",speak:{cssPropBits:0,cssLitGroup:[a[71],a[72],a[78]],cssFns:[]},"speak-header":{cssPropBits:0,cssLitGroup:[a[51],a[73]],cssFns:[]},"speak-numeral":{cssPropBits:0,cssLitGroup:[a[35]],cssFns:[]},"speak-punctuation":{cssPropBits:0,cssLitGroup:[a[58],a[71]],cssFns:[]},"speech-rate":{cssPropBits:5,cssLitGroup:[a[14],a[69]],cssFns:[]},stress:"border-bottom-left-radius","table-layout":{cssPropBits:0,cssLitGroup:[a[52],a[61]],cssFns:[]},"text-align":{cssPropBits:0,cssLitGroup:[a[42],a[56],a[66]],cssFns:[]},"text-decoration":{cssPropBits:0,cssLitGroup:[a[19],a[71]],cssFns:[]},"text-indent":"border-bottom-left-radius","text-overflow":{cssPropBits:8,cssLitGroup:[a[33]],cssFns:[]},"text-shadow":"box-shadow","text-transform":{cssPropBits:0,cssLitGroup:[a[26],a[71]],cssFns:[]},"text-wrap":{cssPropBits:0,cssLitGroup:[a[46],a[71],a[72]],cssFns:[]},top:"bottom",transform:{cssPropBits:0,cssLitGroup:[a[71]],cssFns:["matrix()","perspective()","rotate()","rotate3d()","rotatex()","rotatey()","rotatez()","scale()","scale3d()","scalex()","scaley()","scalez()","skew()","skewx()","skewy()","translate()","translate3d()","translatex()","translatey()","translatez()"]},"transform-origin":"perspective-origin","transform-style":{cssPropBits:0,cssLitGroup:[a[37]],cssFns:[]},transition:{cssPropBits:1029,cssLitGroup:[a[10],a[48],a[50],a[71]],cssFns:["cubic-bezier()","steps()"]},"transition-delay":"animation-delay","transition-duration":"animation-delay","transition-property":{cssPropBits:1024,cssLitGroup:[a[48],a[50]],cssFns:[]},"transition-timing-function":"animation-timing-function","unicode-bidi":{cssPropBits:0,cssLitGroup:[a[30],a[72]],cssFns:[]},"vertical-align":{cssPropBits:5,cssLitGroup:[a[12],a[31]],cssFns:[]},visibility:"backface-visibility","voice-family":{cssPropBits:8,cssLitGroup:[a[27],a[48]],cssFns:[]},volume:{cssPropBits:1,cssLitGroup:[a[17],a[69]],cssFns:[]},"white-space":{cssPropBits:0,cssLitGroup:[a[22],a[72]],cssFns:[]},width:"min-height","word-break":{cssPropBits:0,cssLitGroup:[a[32],a[72]],cssFns:[]},"word-spacing":"letter-spacing","word-wrap":"overflow-wrap","z-index":"bottom",zoom:"line-height","cubic-bezier()":"animation-delay","steps()":{cssPropBits:5,cssLitGroup:[a[36],a[48]],cssFns:[]},"image()":{cssPropBits:18,cssLitGroup:[a[0],a[48]],cssFns:["rgb()","rgba()"]},"linear-gradient()":{cssPropBits:7,cssLitGroup:[a[0],a[31],a[42],a[48],a[79]],cssFns:["rgb()","rgba()"]},"radial-gradient()":{cssPropBits:7,cssLitGroup:[a[0],a[11],a[31],a[42],a[48],a[56],a[57]],cssFns:["rgb()","rgba()"]},"repeating-linear-gradient()":"linear-gradient()","repeating-radial-gradient()":"radial-gradient()","rgb()":{cssPropBits:1,cssLitGroup:[a[48]],cssFns:[]},"rgba()":"rgb()","rect()":{cssPropBits:5,cssLitGroup:[a[48],a[52]],cssFns:[]},"alpha()":{cssPropBits:1,cssLitGroup:[a[28]],cssFns:[]},"matrix()":"animation-delay","perspective()":"border-bottom-left-radius","rotate()":"border-bottom-left-radius","rotate3d()":"animation-delay","rotatex()":"border-bottom-left-radius","rotatey()":"border-bottom-left-radius","rotatez()":"border-bottom-left-radius","scale()":"animation-delay","scale3d()":"animation-delay","scalex()":"border-bottom-left-radius","scaley()":"border-bottom-left-radius","scalez()":"border-bottom-left-radius","skew()":"animation-delay","skewx()":"border-bottom-left-radius","skewy()":"border-bottom-left-radius","translate()":"animation-delay","translate3d()":"animation-delay","translatex()":"border-bottom-left-radius","translatey()":"border-bottom-left-radius","translatez()":"border-bottom-left-radius"};for(var c in b)"string"==typeof b[c]&&Object.hasOwnProperty.call(b,c)&&(b[c]=b[b[c]]);return b}();"undefined"!=typeof window&&(window.cssSchema=n);var o,p;!function(){function a(a){var b=parseInt(a.substring(1),16);return b>65535?(b-=65536,String.fromCharCode(55296+(b>>10),56320+(1023&b))):b==b?String.fromCharCode(b):a[1]<" "?"":a[1]}function b(a,b){return'"'+a.replace(/[\u0000-\u001f\\\"<>]/g,b)+'"'}function c(a){return e[a]||(e[a]="\\"+a.charCodeAt(0).toString(16)+" ")}function d(a){return f[a]||(f[a]=("">a?"%0":"%")+a.charCodeAt(0).toString(16))}var e={"\\":"\\\\"},f={"\\":"%5c"},g="[\\t\\n\\f ]",h=g+"*",i="[\\n\\f]",j="[\\ud800-\\udbff][\\udc00-\\udfff]",k="[\\u0080-\\ud7ff\\ue000-\\ufffd]|"+j,l="[0-9a-fA-F]{1,6}"+g+"?",m="(?:"+l+"|[\\u0020-\\u007e\\u0080-\\ud7ff\\ue000\\ufffd]|"+j+")",n="\\\\"+m,q="(?:[\\t\\x21\\x23-\\x26\\x28-\\x5b\\x5d-\\x7e]|"+k+"|"+n+")",r="[^'\"\\n\\f\\\\]|\\\\[\\s\\S]",s="\"(?:'|"+r+')*"|\'(?:"|'+r+")*'",t="[-+]?(?:[0-9]+(?:[.][0-9]+)?|[.][0-9]+)",u="(?:[a-zA-Z_]|"+k+"|"+n+")",v="(?:[a-zA-Z0-9_-]|"+k+"|"+n+")",w="-?"+u+v+"*",x="(?:@?-?"+u+"|#)"+v+"*",y=t+"(?:%|"+w+")?",z="url[(]"+h+"(?:"+s+"|"+q+"*)"+h+"[)]",A="U[+][0-9A-F?]{1,6}(?:-[0-9A-F]{1,6})?",B="<!--",C="-->",D=g+"+",E="/(?:[*][^*]*[*]+(?:[^/][^*]*[*]+)*/|/[^\\n\\f]*)",F="(?!url[(])"+w+"[(]",G="[~|^$*]=",H="[^\"'\\\\/]|/(?![/*])",I="\\uFEFF",J=new RegExp([I,A,z,F,x,s,y,B,C,D,E,G,H].join("|"),"gi"),K=new RegExp("\\\\(?:"+m+"|"+i+")","g"),L=new RegExp("^url\\("+h+"[\"']?|[\"']?"+h+"\\)$","gi");p=function(b){return b.replace(K,a)},o=function(a){a=("￿"+a).replace(/^\uffff/,""),a=a.replace(/\r\n?/g,"\n");for(var e=a.match(J)||[],f=0,g=" ",h=0,i=e.length;i>h;++h){var j=p(e[h]),k=j.length,l=j.charCodeAt(0);j=l=='"'.charCodeAt(0)||l=="'".charCodeAt(0)?b(j.substring(1,k-1),c):l=="/".charCodeAt(0)&&k>1||"\\"==j||j==C||j==B||"\ufeff"==j||l<=" ".charCodeAt(0)?" ":/url\(/i.test(j)?"url("+b(j.replace(L,""),d)+")":j,g==j&&" "==j||(e[f++]=g=j)}return e.length=f,e}}(),"undefined"!=typeof window&&(window.lexCss=o,window.decodeCss=p);var q=function(){function a(a){var b=(""+a).match(n);return b?new i(j(b[1]),j(b[2]),j(b[3]),j(b[4]),j(b[5]),j(b[6]),j(b[7])):null}function b(a,b,f,g,h,j,k){var l=new i(d(a,o),d(b,o),c(f),g>0?g.toString():null,d(h,p),null,c(k));return j&&("string"==typeof j?l.setRawQuery(j.replace(/[^?&=0-9A-Za-z_\-~.%]/g,e)):l.setAllParameters(j)),l}function c(a){return"string"==typeof a?encodeURIComponent(a):null}function d(a,b){return"string"==typeof a?encodeURI(a).replace(b,e):null}function e(a){var b=a.charCodeAt(0);return"%"+"0123456789ABCDEF".charAt(b>>4&15)+"0123456789ABCDEF".charAt(15&b)}function f(a){return a.replace(/(^|\/)\.(?:\/|$)/g,"$1").replace(/\/{2,}/g,"/")}function g(a){if(null===a)return null;for(var b,c=f(a),d=l;(b=c.replace(d,"$1"))!=c;c=b);return c}function h(a,b){var c=a.clone(),d=b.hasScheme();d?c.setRawScheme(b.getRawScheme()):d=b.hasCredentials(),d?c.setRawCredentials(b.getRawCredentials()):d=b.hasDomain(),d?c.setRawDomain(b.getRawDomain()):d=b.hasPort();var e=b.getRawPath(),f=g(e);if(d)c.setPort(b.getPort()),f=f&&f.replace(m,"");else if(d=!!e){if(47!==f.charCodeAt(0)){var h=g(c.getRawPath()||"").replace(m,""),i=h.lastIndexOf("/")+1;f=g((i?h.substring(0,i):"")+g(e)).replace(m,"")}}else f=f&&f.replace(m,""),f!==e&&c.setRawPath(f);return d?c.setRawPath(f):d=b.hasQuery(),d?c.setRawQuery(b.getRawQuery()):d=b.hasFragment(),d&&c.setRawFragment(b.getRawFragment()),c}function i(a,b,c,d,e,f,g){this.scheme_=a,this.credentials_=b,this.domain_=c,this.port_=d,this.path_=e,this.query_=f,this.fragment_=g,this.paramCache_=null}function j(a){return"string"==typeof a&&a.length>0?a:null}var k=new RegExp("(/|^)(?:[^./][^/]*|\\.{2,}(?:[^./][^/]*)|\\.{3,}[^/]*)/\\.\\.(?:/|$)"),l=new RegExp(k),m=/^(?:\.\.\/)*(?:\.\.$)?/;i.prototype.toString=function(){var a=[];return null!==this.scheme_&&a.push(this.scheme_,":"),null!==this.domain_&&(a.push("//"),null!==this.credentials_&&a.push(this.credentials_,"@"),a.push(this.domain_),null!==this.port_&&a.push(":",this.port_.toString())),null!==this.path_&&a.push(this.path_),null!==this.query_&&a.push("?",this.query_),null!==this.fragment_&&a.push("#",this.fragment_),a.join("")},i.prototype.clone=function(){return new i(this.scheme_,this.credentials_,this.domain_,this.port_,this.path_,this.query_,this.fragment_)},i.prototype.getScheme=function(){return this.scheme_&&decodeURIComponent(this.scheme_).toLowerCase()},i.prototype.getRawScheme=function(){return this.scheme_},i.prototype.setScheme=function(a){return this.scheme_=d(a,o),this},i.prototype.setRawScheme=function(a){return this.scheme_=a?a:null,this},i.prototype.hasScheme=function(){return null!==this.scheme_},i.prototype.getCredentials=function(){return this.credentials_&&decodeURIComponent(this.credentials_)},i.prototype.getRawCredentials=function(){return this.credentials_},i.prototype.setCredentials=function(a){return this.credentials_=d(a,o),this},i.prototype.setRawCredentials=function(a){return this.credentials_=a?a:null,this},i.prototype.hasCredentials=function(){return null!==this.credentials_},i.prototype.getDomain=function(){return this.domain_&&decodeURIComponent(this.domain_)},i.prototype.getRawDomain=function(){return this.domain_},i.prototype.setDomain=function(a){return this.setRawDomain(a&&encodeURIComponent(a))},i.prototype.setRawDomain=function(a){return this.domain_=a?a:null,this.setRawPath(this.path_)},i.prototype.hasDomain=function(){return null!==this.domain_},i.prototype.getPort=function(){return this.port_&&decodeURIComponent(this.port_)},i.prototype.setPort=function(a){if(a){if(a=Number(a),a!==(65535&a))throw new Error("Bad port number "+a);this.port_=""+a}else this.port_=null;return this},i.prototype.hasPort=function(){return null!==this.port_},i.prototype.getPath=function(){return this.path_&&decodeURIComponent(this.path_)},i.prototype.getRawPath=function(){return this.path_},i.prototype.setPath=function(a){return this.setRawPath(d(a,p))},i.prototype.setRawPath=function(a){return a?(a=String(a),this.path_=!this.domain_||/^\//.test(a)?a:"/"+a):this.path_=null,this},i.prototype.hasPath=function(){return null!==this.path_},i.prototype.getQuery=function(){return this.query_&&decodeURIComponent(this.query_).replace(/\+/g," ")},i.prototype.getRawQuery=function(){return this.query_},i.prototype.setQuery=function(a){return this.paramCache_=null,this.query_=c(a),this},i.prototype.setRawQuery=function(a){return this.paramCache_=null,this.query_=a?a:null,this},i.prototype.hasQuery=function(){return null!==this.query_},i.prototype.setAllParameters=function(a){if("object"==typeof a&&!(a instanceof Array)&&(a instanceof Object||"[object Array]"!==Object.prototype.toString.call(a))){var b=[],c=-1;for(var d in a){var e=a[d];"string"==typeof e&&(b[++c]=d,b[++c]=e)}a=b}this.paramCache_=null;for(var f=[],g="",h=0;h<a.length;){var d=a[h++],e=a[h++];f.push(g,encodeURIComponent(d.toString())),g="&",e&&f.push("=",encodeURIComponent(e.toString()))}return this.query_=f.join(""),this},i.prototype.checkParameterCache_=function(){if(!this.paramCache_){var a=this.query_;if(a){for(var b=a.split(/[&\?]/),c=[],d=-1,e=0;e<b.length;++e){var f=b[e].match(/^([^=]*)(?:=(.*))?$/);c[++d]=decodeURIComponent(f[1]).replace(/\+/g," "),c[++d]=decodeURIComponent(f[2]||"").replace(/\+/g," ")}this.paramCache_=c}else this.paramCache_=[]}},i.prototype.setParameterValues=function(a,b){"string"==typeof b&&(b=[b]),this.checkParameterCache_();for(var c=0,d=this.paramCache_,e=[],f=0;f<d.length;f+=2)a===d[f]?c<b.length&&e.push(a,b[c++]):e.push(d[f],d[f+1]);for(;c<b.length;)e.push(a,b[c++]);return this.setAllParameters(e),this},i.prototype.removeParameter=function(a){return this.setParameterValues(a,[])},i.prototype.getAllParameters=function(){return this.checkParameterCache_(),this.paramCache_.slice(0,this.paramCache_.length)},i.prototype.getParameterValues=function(a){this.checkParameterCache_();for(var b=[],c=0;c<this.paramCache_.length;c+=2)a===this.paramCache_[c]&&b.push(this.paramCache_[c+1]);return b},i.prototype.getParameterMap=function(a){this.checkParameterCache_();for(var b={},c=0;c<this.paramCache_.length;c+=2){var d=this.paramCache_[c++],e=this.paramCache_[c++];d in b?b[d].push(e):b[d]=[e]}return b},i.prototype.getParameterValue=function(a){this.checkParameterCache_();for(var b=0;b<this.paramCache_.length;b+=2)if(a===this.paramCache_[b])return this.paramCache_[b+1];return null},i.prototype.getFragment=function(){return this.fragment_&&decodeURIComponent(this.fragment_)},i.prototype.getRawFragment=function(){return this.fragment_},i.prototype.setFragment=function(a){return this.fragment_=a?encodeURIComponent(a):null,this},i.prototype.setRawFragment=function(a){return this.fragment_=a?a:null,this},i.prototype.hasFragment=function(){return null!==this.fragment_};var n=new RegExp("^(?:([^:/?#]+):)?(?://(?:([^/?#]*)@)?([^/?#:@]*)(?::([0-9]+))?)?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$"),o=/[#\/\?@]/g,p=/[\#\?]/g;return i.parse=a,i.create=b,i.resolve=h,i.collapse_dots=g,i.utils={mimeTypeOf:function(b){var c=a(b);return/\.html$/.test(c.getPath())?"text/html":"application/javascript"},resolve:function(b,c){return b?h(a(b),a(c)).toString():""+c}},i}();"undefined"!=typeof window&&(window.URI=q);var r=void 0,s=void 0,t=void 0,u=void 0,v=void 0;if(function(){function a(a){return"string"==typeof a?'url("'+a.replace(x,b)+'")':o}function b(a){return z[a]}function c(a,b){return a?q.utils.resolve(a,b):b}function d(a,b,c){if(!c)return null;var d=(""+a).match(A);return!d||d[1]&&!B.test(d[1])?null:c(a,b)}function e(a){return a.replace(/^-(?:apple|css|epub|khtml|moz|mso?|o|rim|wap|webkit|xv)-(?=[a-z])/,"")}var o='url("about:blank")',x=/[\n\f\r\"\'()*<>]/g,z={"\n":"%0a","\f":"%0c","\r":"%0d",'"':"%22","'":"%27","(":"%28",")":"%29","*":"%2a","<":"%3c",">":"%3e"},A=new RegExp("^(?:([^:/?# ]+):)?"),B=/^(?:https?|mailto)$/i;r=function(){function b(a){for(var b={},c=a.length;--c>=0;)for(var d=a[c],e=d.length;--e>=0;)b[d[e]]=q;return b}var q={};return function r(s,t,u,v,w){function x(a,b){for(var c=1,d=b+1,f=a.length;f>d&&c;){var g=a[d++];c+=")"===g?-1:/^[^"']*\($/.test(g)}if(!c)for(var h=a[b].toLowerCase(),i=e(h),j=a.splice(b,d-b,""),k=z.cssFns,l=0,m=k.length;m>l;++l)if(k[l].substring(0,i.length)==i)return j[0]=j[j.length-1]="",r(k[l],j,u,v),h+j.join(" ")+")";return""}var y=e(s),z=n[y];if(!z||"object"!=typeof z)return void(t.length=0);for(var A=z.cssPropBits,B=80&A,C=1536&A,D=NaN,E=0,F=0;E<t.length;++E){var G,H,I,J,K,L,M=t[E].toLowerCase(),N=M.charCodeAt(0);M=N===" ".charCodeAt(0)?"":N==='"'.charCodeAt(0)?B===j?u?a(d(c(v,p(t[E].substring(1,M.length-1))),y,u)):"":A&i&&!(B&B-1)?M:"":"inherit"===M?M:(K=z.cssLitGroup,L=K?z.cssLitMap||(z.cssLitMap=b(K)):q,L[e(M)]===q?M:N==="#".charCodeAt(0)&&/^#(?:[0-9a-f]{3}){1,2}$/.test(M)?A&g?M:"":"0".charCodeAt(0)<=N&&N<="9".charCodeAt(0)?A&f?M:"":(G=M.charCodeAt(1),H=M.charCodeAt(2),I="0".charCodeAt(0)<=G&&G<="9".charCodeAt(0),J="0".charCodeAt(0)<=H&&H<="9".charCodeAt(0),N==="+".charCodeAt(0)&&(I||G===".".charCodeAt(0)&&J)?A&f?(I?"":"0")+M.substring(1):"":N==="-".charCodeAt(0)&&(I||G===".".charCodeAt(0)&&J)?A&h?(I?"-":"-0")+M.substring(1):A&f?"0":"":N===".".charCodeAt(0)&&I?A&f?"0"+M:"":'url("'===M.substring(0,5)?u&&A&j?a(d(c(v,t[E].substring(5,M.length-2)),y,u)):"":"("===M.charAt(M.length-1)?x(t,E):C&&/^-?[a-z_][\w\-]*$/.test(M)&&!/__$/.test(M)?w&&C===l?t[E]+w:C===m&&n[M]&&"number"==typeof n[M].cssPropBits?M:"":/^\w+$/.test(M)&&B===k&&A&i?D+1===F?(t[D]=t[D].substring(0,t[D].length-1)+" "+M+'"',M=""):(D=F,'"'+M+'"'):"")),M&&(t[F++]=M)}1===F&&t[0]===o&&(F=0),t.length=F}}();var C=new RegExp("^(active|after|before|blank|checked|default|disabled|drop|empty|enabled|first|first-child|first-letter|first-line|first-of-type|fullscreen|focus|hover|in-range|indeterminate|invalid|last-child|last-of-type|left|link|only-child|only-of-type|optional|out-of-range|placeholder-shown|read-only|read-write|required|right|root|scope|user-error|valid|visited)$"),D={};D[">"]=D["+"]=D["~"]=D,s=function(a,b,c){function d(d,e){function f(c,d,e){var f,g,j,l,m,n=!0;if(f="",d>c)if(m=a[c],"*"===m)++c,f=m;else if(/^[a-zA-Z]/.test(m)){var o=i(m.toLowerCase(),[]);o&&("tagName"in o&&(m=o.tagName),++c,f=m)}for(g="",j="",l="";n&&d>c;++c)if(m=a[c],"#"===m.charAt(0))/^#_|__$|[^\w#:\-]/.test(m)?n=!1:g+=m+h;else if("."===m)++c<d&&/^[0-9A-Za-z:_\-]+$/.test(m=a[c])&&!/^_|__$/.test(m)?g+="."+m:n=!1;else if(d>c+1&&"["===a[c]){++c;var p=a[c++].toLowerCase(),q=y.ATTRIBS[f+"::"+p];q!==+q&&(q=y.ATTRIBS["*::"+p]);var r;b.virtualizeAttrName?(r=b.virtualizeAttrName(f,p),"string"!=typeof r&&(n=!1,r=p),n&&q!==+q&&(q=y.atype.NONE)):(r=p,q!==+q&&(n=!1));var s="",t="",u=!1;switch(/^[~^$*|]?=$/.test(a[c])&&(s=a[c++],t=a[c++],/^[0-9A-Za-z:_\-]+$/.test(t)?t='"'+t+'"':"]"===t&&(t='""',--c),/^"([^\"\\]|\\.)*"$/.test(t)||(n=!1),u="i"===a[c],u&&++c),"]"!==a[c]&&(++c,n=!1),q){case y.atype.CLASSES:case y.atype.LOCAL_NAME:case y.atype.NONE:break;case y.atype.GLOBAL_NAME:case y.atype.ID:case y.atype.IDREF:"="!==s&&"~="!==s&&"$="!==s||'""'==t||u?"|="===s||""===s||(n=!1):t='"'+t.substring(1,t.length-1)+h+'"';break;case y.atype.URI:case y.atype.URI_FRAGMENT:""!==s&&(n=!1);break;default:n=!1}n&&(j+="["+r.replace(/[^\w-]/g,"\\$&")+s+t+(u?" i]":"]"))}else{if(!(d>c&&":"===a[c]))break;if(m=a[++c],!C.test(m))break;l+=":"+m}if(c!==d&&(n=!1),n){var v=(f+g).replace(/[^ .*#\w-]/g,"\\$&")+j+l+e;v&&k.push(v)}return n}" "===a[d]&&++d,e-1!==d&&" "===a[e]&&--e;for(var k=[],l=d,m=!0,n=d;m&&e>n;++n){var o=a[n];D[o]!==D&&" "!==o||(f(l,n,o)?l=n+1:m=!1)}if(f(l,e,"")||(m=!1),m){if(k.length){var p=k.join("");null!==g&&(p="."+g+" "+p),j.push(p)}return!0}return!c||c(a.slice(d,e))}var e,f,g=b.containerClass,h=b.idSuffix,i=b.tagPolicy,j=[],k=0,l=0;for(e=0;e<a.length;++e)f=a[e],("("==f||"["==f?(++l,0):")"==f||"]"==f?(l&&--l,0):" "==a[e]&&(l||D[a[e-1]]===D||D[a[e+1]]===D))||(a[k++]=a[e]);a.length=k;var m=a.length,n=0;for(e=0;m>e;++e)if(","===a[e]){if(!d(n,e))return null;n=e+1}return d(n,m)?j:null},function(){var a="(?:all|aural|braille|embossed|handheld|print|projection|screen|speech|tty|tv)",b="(?:(?:min-|max-)?(?:(?:device-)?(?:aspect-ratio|height|width)|color(?:-index)?|monochrome|orientation|resolution)|grid|hover|luminosity|pointer|scan|script)",c="(?:p[cxt]|[cem]m|in|dpi|dppx|dpcm|%)",d="-?(?:[a-z]\\w+(?:-\\w+)*|\\d+(?: / \\d+|(?:\\.\\d+)?"+c+"?))",e="\\( "+b+" (?:: "+d+" )?\\)",f="(?:(?:(?:(?:only|not) )?"+a+"|"+e+")(?: and ?"+e+")*)",g=/^\w/,h=new RegExp("^"+f+"(?: , "+f+")*$","i");v=function(a){a=a.slice();for(var b=a.length,c=0,d=0;b>d;++d){var e=a[d];" "!=e&&(a[c++]=e)}a.length=c;var f=a.join(" ");return f=f.length?h.test(f)?g.test(f)?f:"not all , "+f:"not all":""}}(),function(){function a(a){var b,c=/^\s*["]([^"]*)["]\s*$/,d=/^\s*[']([^']*)[']\s*$/,e=/^\s*url\s*[(]["]([^"]*)["][)]\s*$/,f=/^\s*url\s*[(][']([^']*)['][)]\s*$/,g=/^\s*url\s*[(]([^)]*)[)]\s*$/;return(b=c.exec(a))?b[1]:(b=d.exec(a))?b[1]:(b=e.exec(a))?b[1]:(b=f.exec(a))?b[1]:(b=g.exec(a))?b[1]:null}function b(e,f,g,h,i,j,k){function l(){p=o.length&&null===o[o.length-1]}var m=void 0,n=k||[0],o=[],p=!1;return w(f,{startStylesheet:function(){m=[]},endStylesheet:function(){},startAtrule:function(f,k){if(p)f=null;else if("@media"===f)m.push("@media"," ",v(k));else if("@keyframes"===f||"@-webkit-keyframes"===f){var l=k[0];1!==k.length||/__$|[^\w\-]/.test(l)?f=null:(m.push(f," ",l+g.idSuffix),f="@keyframes")}else if("@import"===f&&k.length>0)if(f=null,"function"==typeof j){var q=v(k.slice(1));if("not all"!==q){++n[0];var r=[];m.push(r);var s=d(c(e,a(k[0])),function(a){var c=b(s,a.html,g,h,i,j,n);--n[0];var d=q?{toString:function(){return"@media "+q+" {"+c.result+"}"}}:c.result;r[0]=d,j(d,!!n[0])},i)}}else window.console&&window.console.log("@import "+k.join(" ")+" elided");p=!f,o.push(f)},endAtrule:function(){o.pop(),p||m.push(";"),l()},startBlock:function(){p||m.push("{")},endBlock:function(){p||(m.push("}"),p=!0)},startRuleset:function(a){if(!p){var b=void 0;if("@keyframes"===o[o.length-1])b=a.join(" ").match(/^ *(?:from|to|\d+(?:\.\d+)?%) *(?:, *(?:from|to|\d+(?:\.\d+)?%) *)*$/i),p=!b,b&&(b=b[0].replace(/ +/g,""));else{var c=s(a,g);c&&c.length?b=c.join(", "):p=!0}p||m.push(b,"{")}o.push(null)},endRuleset:function(){o.pop(),p||m.push("}"),l()},declaration:function(a,b){if(!p){var c=!1,d=b.length;d>=2&&"!"===b[d-2]&&"important"===b[d-1].toLowerCase()&&(c=!0,b.length-=2),r(a,b,h,e,g.idSuffix),b.length&&m.push(a,":",b.join(" "),c?" !important;":";")}}}),{result:{toString:function(){return m.join("")}},moreToCome:!!n[0]}}t=function(a,c,d,e){return b(a,c,d,e,void 0,void 0).result.toString()},u=function(a,c,d,e,f,g){return b(a,c,d,e,f,g)}}()}(),"undefined"!=typeof window&&(window.sanitizeCssProperty=r,window.sanitizeCssSelectorList=s,window.sanitizeStylesheet=t,window.sanitizeMediaQuery=v),"i"!=="I".toLowerCase())throw"I/i problem";var w,x;!function(){function a(a,c,e,f){if(e>c){var g=a[c];return"@"===g.charAt(0)?b(a,c,e,f,!0):d(a,c,e,f)}return c}function b(a,b,d,e,f){for(var g=b++;d>b&&"{"!==a[b]&&";"!==a[b];)++b;if(d>b&&(f||";"===a[b])){var h=g+1,i=b;d>h&&" "===a[h]&&++h,i>h&&" "===a[i-1]&&--i,e.startAtrule&&e.startAtrule(a[g].toLowerCase(),a.slice(h,i)),b="{"===a[b]?c(a,b,d,e):b+1,e.endAtrule&&e.endAtrule()}return b}function c(a,e,f,g){for(++e,g.startBlock&&g.startBlock();f>e;){var h=a[e].charAt(0);if("}"==h){++e;break}" "===h||";"===h?e+=1:e="@"===h?b(a,e,f,g,!1):"{"===h?c(a,e,f,g):d(a,e,f,g)}return g.endBlock&&g.endBlock(),e}function d(a,b,c,d){var f=b,h=e(a,b,c,!0);if(0>h)return h=~h,h===f?h+1:h;var i=a[h];if("{"!==i)return h===f?h+1:h;for(b=h+1,h>f&&" "===a[h-1]&&--h,d.startRuleset&&d.startRuleset(a.slice(f,h));c>b;){if(i=a[b],"}"===i){++b;break}" "===i?b+=1:b=g(a,b,c,d)}return d.endRuleset&&d.endRuleset(),b}function e(a,b,c,d){for(var e,f=[],g=-1;c>b;++b)if(e=a[b].charAt(0),"["===e||"("===e)f[++g]=e;else if("]"===e&&"["===f[g]||")"===e&&"("===f[g])--g;else if("{"===e||"}"===e||";"===e||"@"===e||":"===e&&!d)break;return g>=0&&(b=~(b+1)),b}function f(a,b,c){for(;c>b&&";"!==a[b]&&"}"!==a[b];)++b;return c>b&&";"===a[b]?b+1:b}function g(a,b,c,d){var g=a[b++];if(!h.test(g))return f(a,b,c);var i;if(c>b&&" "===a[b]&&++b,b==c||":"!==a[b])return f(a,b,c);++b,c>b&&" "===a[b]&&++b;var j=b,k=e(a,b,c,!1);if(0>k)k=~k;else{for(var l=[],m=0,n=j;k>n;++n)i=a[n]," "!==i&&(l[m++]=i);if(c>k){do{if(i=a[k],";"===i||"}"===i)break;m=0}while(++k<c);";"===i&&++k}m&&d.declaration&&d.declaration(g.toLowerCase(),l)}return k}w=function(b,c){var d=o(b);c.startStylesheet&&c.startStylesheet();for(var e=0,f=d.length;f>e;)e=" "===d[e]?e+1:a(d,e,f,c);c.endStylesheet&&c.endStylesheet()};var h=/^-?[a-z]/i;x=function(a,b){for(var c=o(a),d=0,e=c.length;e>d;)d=" "!==c[d]?g(c,d,e,b):d+1}}(),"undefined"!=typeof window&&(window.parseCssStylesheet=w,window.parseCssDeclarations=x);var y={};if(y.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,HTML:12,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10,MEDIA_QUERY:13},y.atype=y.atype,y.ATTRIBS={"*::class":9,"*::dir":0,"*::draggable":0,"*::hidden":0,"*::id":4,"*::inert":0,"*::itemprop":0,"*::itemref":6,"*::itemscope":0,"*::lang":0,"*::onblur":2,"*::onchange":2,"*::onclick":2,"*::ondblclick":2,"*::onerror":2,"*::onfocus":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::onreset":2,"*::onscroll":2,"*::onselect":2,"*::onsubmit":2,"*::ontouchcancel":2,"*::ontouchend":2,"*::ontouchenter":2,"*::ontouchleave":2,"*::ontouchmove":2,"*::ontouchstart":2,"*::onunload":2,"*::spellcheck":0,"*::style":3,"*::tabindex":0,"*::title":0,"*::translate":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::shape":0,"a::target":0,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::target":10,"audio::controls":0,"audio::loop":0,"audio::mediagroup":5,"audio::muted":0,"audio::preload":0,"audio::src":1,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"command::checked":0,"command::command":5,"command::disabled":0,"command::icon":1,"command::label":0,"command::radiogroup":0,"command::type":0,"data::value":0,"del::cite":1,"del::datetime":0,"details::open":0,"dir::compact":0,"div::align":0,"dl::compact":0,"fieldset::disabled":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::novalidate":0,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,
"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::inputmode":0,"input::ismap":0,"input::list":5,"input::max":0,"input::maxlength":0,"input::min":0,"input::multiple":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::pattern":0,"input::placeholder":0,"input::readonly":0,"input::required":0,"input::size":0,"input::src":1,"input::step":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"menu::label":0,"menu::type":0,"meter::high":0,"meter::low":0,"meter::max":0,"meter::min":0,"meter::optimum":0,"meter::value":0,"ol::compact":0,"ol::reversed":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"output::for":6,"output::name":8,"p::align":0,"pre::width":0,"progress::max":0,"progress::min":0,"progress::value":0,"q::cite":1,"select::autocomplete":0,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::required":0,"select::size":0,"source::type":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::autocomplete":0,"textarea::cols":0,"textarea::disabled":0,"textarea::inputmode":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::placeholder":0,"textarea::readonly":0,"textarea::required":0,"textarea::rows":0,"textarea::wrap":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"track::default":0,"track::kind":0,"track::label":0,"track::srclang":0,"ul::compact":0,"ul::type":0,"video::controls":0,"video::height":0,"video::loop":0,"video::mediagroup":5,"video::muted":0,"video::poster":1,"video::preload":0,"video::src":1,"video::width":0},y.ATTRIBS=y.ATTRIBS,y.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128,VIRTUALIZED:256},y.eflags=y.eflags,y.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:272,area:2,article:0,aside:0,audio:0,b:0,base:274,basefont:274,bdi:0,bdo:0,big:0,blockquote:0,body:305,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,command:2,data:0,datalist:0,dd:1,del:0,details:0,dfn:0,dialog:272,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,figcaption:0,figure:0,font:0,footer:0,form:0,frame:274,frameset:272,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:305,header:0,hgroup:0,hr:2,html:305,i:0,iframe:16,img:2,input:2,ins:0,isindex:274,kbd:0,keygen:274,label:0,legend:0,li:1,link:274,map:0,mark:0,menu:0,meta:274,meter:0,nav:0,nobr:0,noembed:276,noframes:276,noscript:276,object:272,ol:0,optgroup:0,option:1,output:0,p:1,param:274,pre:0,progress:0,q:0,s:0,samp:0,script:84,section:0,select:0,small:0,source:2,span:0,strike:0,strong:0,style:148,sub:0,summary:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,time:0,title:280,tr:1,track:2,tt:0,u:0,ul:0,"var":0,video:0,wbr:2},y.ELEMENTS=y.ELEMENTS,y.ELEMENT_DOM_INTERFACES={a:"HTMLAnchorElement",abbr:"HTMLElement",acronym:"HTMLElement",address:"HTMLElement",applet:"HTMLAppletElement",area:"HTMLAreaElement",article:"HTMLElement",aside:"HTMLElement",audio:"HTMLAudioElement",b:"HTMLElement",base:"HTMLBaseElement",basefont:"HTMLBaseFontElement",bdi:"HTMLElement",bdo:"HTMLElement",big:"HTMLElement",blockquote:"HTMLQuoteElement",body:"HTMLBodyElement",br:"HTMLBRElement",button:"HTMLButtonElement",canvas:"HTMLCanvasElement",caption:"HTMLTableCaptionElement",center:"HTMLElement",cite:"HTMLElement",code:"HTMLElement",col:"HTMLTableColElement",colgroup:"HTMLTableColElement",command:"HTMLCommandElement",data:"HTMLElement",datalist:"HTMLDataListElement",dd:"HTMLElement",del:"HTMLModElement",details:"HTMLDetailsElement",dfn:"HTMLElement",dialog:"HTMLDialogElement",dir:"HTMLDirectoryElement",div:"HTMLDivElement",dl:"HTMLDListElement",dt:"HTMLElement",em:"HTMLElement",fieldset:"HTMLFieldSetElement",figcaption:"HTMLElement",figure:"HTMLElement",font:"HTMLFontElement",footer:"HTMLElement",form:"HTMLFormElement",frame:"HTMLFrameElement",frameset:"HTMLFrameSetElement",h1:"HTMLHeadingElement",h2:"HTMLHeadingElement",h3:"HTMLHeadingElement",h4:"HTMLHeadingElement",h5:"HTMLHeadingElement",h6:"HTMLHeadingElement",head:"HTMLHeadElement",header:"HTMLElement",hgroup:"HTMLElement",hr:"HTMLHRElement",html:"HTMLHtmlElement",i:"HTMLElement",iframe:"HTMLIFrameElement",img:"HTMLImageElement",input:"HTMLInputElement",ins:"HTMLModElement",isindex:"HTMLUnknownElement",kbd:"HTMLElement",keygen:"HTMLKeygenElement",label:"HTMLLabelElement",legend:"HTMLLegendElement",li:"HTMLLIElement",link:"HTMLLinkElement",map:"HTMLMapElement",mark:"HTMLElement",menu:"HTMLMenuElement",meta:"HTMLMetaElement",meter:"HTMLMeterElement",nav:"HTMLElement",nobr:"HTMLElement",noembed:"HTMLElement",noframes:"HTMLElement",noscript:"HTMLElement",object:"HTMLObjectElement",ol:"HTMLOListElement",optgroup:"HTMLOptGroupElement",option:"HTMLOptionElement",output:"HTMLOutputElement",p:"HTMLParagraphElement",param:"HTMLParamElement",pre:"HTMLPreElement",progress:"HTMLProgressElement",q:"HTMLQuoteElement",s:"HTMLElement",samp:"HTMLElement",script:"HTMLScriptElement",section:"HTMLElement",select:"HTMLSelectElement",small:"HTMLElement",source:"HTMLSourceElement",span:"HTMLSpanElement",strike:"HTMLElement",strong:"HTMLElement",style:"HTMLStyleElement",sub:"HTMLElement",summary:"HTMLElement",sup:"HTMLElement",table:"HTMLTableElement",tbody:"HTMLTableSectionElement",td:"HTMLTableDataCellElement",textarea:"HTMLTextAreaElement",tfoot:"HTMLTableSectionElement",th:"HTMLTableHeaderCellElement",thead:"HTMLTableSectionElement",time:"HTMLTimeElement",title:"HTMLTitleElement",tr:"HTMLTableRowElement",track:"HTMLTrackElement",tt:"HTMLElement",u:"HTMLElement",ul:"HTMLUListElement","var":"HTMLElement",video:"HTMLVideoElement",wbr:"HTMLElement"},y.ELEMENT_DOM_INTERFACES=y.ELEMENT_DOM_INTERFACES,y.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},y.ueffects=y.ueffects,y.URIEFFECTS={"a::href":2,"area::href":2,"audio::src":1,"blockquote::cite":0,"command::icon":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0,"video::poster":1,"video::src":1},y.URIEFFECTS=y.URIEFFECTS,y.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},y.ltypes=y.ltypes,y.LOADERTYPES={"a::href":2,"area::href":2,"audio::src":2,"blockquote::cite":2,"command::icon":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2,"video::poster":1,"video::src":2},y.LOADERTYPES=y.LOADERTYPES,"undefined"!=typeof window&&(window.html4=y),"i"!=="I".toLowerCase())throw"I/i problem";var z=function(a){function b(a){if(F.hasOwnProperty(a))return F[a];var b=a.match(G);if(b)return String.fromCharCode(parseInt(b[1],10));if(b=a.match(H))return String.fromCharCode(parseInt(b[1],16));if(J&&I.test(a)){J.innerHTML="&"+a+";";var c=J.textContent;return F[a]=c,c}return"&"+a+";"}function c(a,c){return b(c)}function d(a){return a.replace(K,"")}function e(a){return a.replace(L,c)}function f(a){return(""+a).replace(N,"&amp;").replace(P,"&lt;").replace(Q,"&gt;").replace(R,"&#34;")}function g(a){return a.replace(O,"&amp;$1").replace(P,"&lt;").replace(Q,"&gt;")}function h(a){var b={cdata:a.cdata||a.cdata,comment:a.comment||a.comment,endDoc:a.endDoc||a.endDoc,endTag:a.endTag||a.endTag,pcdata:a.pcdata||a.pcdata,rcdata:a.rcdata||a.rcdata,startDoc:a.startDoc||a.startDoc,startTag:a.startTag||a.startTag};return function(a,c){return i(a,b,c)}}function i(a,b,c){var d=l(a),e={noMoreGT:!1,noMoreEndComments:!1};k(b,d,0,e,c)}function j(a,b,c,d,e){return function(){k(a,b,c,d,e)}}function k(b,c,d,e,f){try{b.startDoc&&0==d&&b.startDoc(f);for(var g,h,i,k=d,l=c.length;l>k;){var p=c[k++],q=c[k];switch(p){case"&":M.test(q)?(b.pcdata&&b.pcdata("&"+q,f,V,j(b,c,k,e,f)),k++):b.pcdata&&b.pcdata("&amp;",f,V,j(b,c,k,e,f));break;case"</":(g=/^([-\w:]+)[^\'\"]*/.exec(q))?g[0].length===q.length&&">"===c[k+1]?(k+=2,i=g[1].toLowerCase(),b.endTag&&b.endTag(i,f,V,j(b,c,k,e,f))):k=m(c,k,b,f,V,e):b.pcdata&&b.pcdata("&lt;/",f,V,j(b,c,k,e,f));break;case"<":if(g=/^([-\w:]+)\s*\/?/.exec(q))if(g[0].length===q.length&&">"===c[k+1]){k+=2,i=g[1].toLowerCase(),b.startTag&&b.startTag(i,[],f,V,j(b,c,k,e,f));var r=a.ELEMENTS[i];if(r&U){var s={name:i,next:k,eflags:r};k=o(c,s,b,f,V,e)}}else k=n(c,k,b,f,V,e);else b.pcdata&&b.pcdata("&lt;",f,V,j(b,c,k,e,f));break;case"<!--":if(!e.noMoreEndComments){for(h=k+1;l>h&&(">"!==c[h]||!/--$/.test(c[h-1]));h++);if(l>h){if(b.comment){var t=c.slice(k,h).join("");b.comment(t.substr(0,t.length-2),f,V,j(b,c,h+1,e,f))}k=h+1}else e.noMoreEndComments=!0}e.noMoreEndComments&&b.pcdata&&b.pcdata("&lt;!--",f,V,j(b,c,k,e,f));break;case"<!":if(/^\w/.test(q)){if(!e.noMoreGT){for(h=k+1;l>h&&">"!==c[h];h++);l>h?k=h+1:e.noMoreGT=!0}e.noMoreGT&&b.pcdata&&b.pcdata("&lt;!",f,V,j(b,c,k,e,f))}else b.pcdata&&b.pcdata("&lt;!",f,V,j(b,c,k,e,f));break;case"<?":if(!e.noMoreGT){for(h=k+1;l>h&&">"!==c[h];h++);l>h?k=h+1:e.noMoreGT=!0}e.noMoreGT&&b.pcdata&&b.pcdata("&lt;?",f,V,j(b,c,k,e,f));break;case">":b.pcdata&&b.pcdata("&gt;",f,V,j(b,c,k,e,f));break;case"":break;default:b.pcdata&&b.pcdata(p,f,V,j(b,c,k,e,f))}}b.endDoc&&b.endDoc(f)}catch(u){if(u!==V)throw u}}function l(a){var b=/(<\/|<\!--|<[!?]|[&<>])/g;if(a+="",T)return a.split(b);for(var c,d=[],e=0;null!==(c=b.exec(a));)d.push(a.substring(e,c.index)),d.push(c[0]),e=c.index+c[0].length;return d.push(a.substring(e)),d}function m(a,b,c,d,e,f){var g=p(a,b);return g?(c.endTag&&c.endTag(g.name,d,e,j(c,a,b,f,d)),g.next):a.length}function n(a,b,c,d,e,f){var g=p(a,b);return g?(c.startTag&&c.startTag(g.name,g.attrs,d,e,j(c,a,g.next,f,d)),g.eflags&U?o(a,g,c,d,e,f):g.next):a.length}function o(b,c,d,e,f,h){var i=b.length;W.hasOwnProperty(c.name)||(W[c.name]=new RegExp("^"+c.name+"(?:[\\s\\/]|$)","i"));for(var k=W[c.name],l=c.next,m=c.next+1;i>m&&("</"!==b[m-1]||!k.test(b[m]));m++);i>m&&(m-=1);var n=b.slice(l,m).join("");if(c.eflags&a.eflags.CDATA)d.cdata&&d.cdata(n,e,f,j(d,b,m,h,e));else{if(!(c.eflags&a.eflags.RCDATA))throw new Error("bug");d.rcdata&&d.rcdata(g(n),e,f,j(d,b,m,h,e))}return m}function p(b,c){var d=/^([-\w:]+)/.exec(b[c]),e={};e.name=d[1].toLowerCase(),e.eflags=a.ELEMENTS[e.name];for(var f=b[c].substr(d[0].length),g=c+1,h=b.length;h>g&&">"!==b[g];g++)f+=b[g];if(!(g>=h)){for(var i=[];""!==f;)if(d=S.exec(f)){if(d[4]&&!d[5]||d[6]&&!d[7]){for(var j=d[4]||d[6],k=!1,l=[f,b[g++]];h>g;g++){if(k){if(">"===b[g])break}else 0<=b[g].indexOf(j)&&(k=!0);l.push(b[g])}if(g>=h)break;f=l.join("");continue}var m=d[1].toLowerCase(),n=d[2]?r(d[3]):"";i.push(m,n),f=f.substr(d[0].length)}else f=f.replace(/^[\s\S][^a-z\s]*/,"");return e.attrs=i,e.next=g+1,e}}function r(a){var b=a.charCodeAt(0);return 34!==b&&39!==b||(a=a.substr(1,a.length-2)),e(d(a))}function s(b){var c,d,e=function(a,b){d||b.push(a)};return h({startDoc:function(a){c=[],d=!1},startTag:function(e,g,h){if(!d&&a.ELEMENTS.hasOwnProperty(e)){var i=a.ELEMENTS[e];if(!(i&a.eflags.FOLDABLE)){var j=b(e,g);if(!j)return void(d=!(i&a.eflags.EMPTY));if("object"!=typeof j)throw new Error("tagPolicy did not return object (old API?)");if(!("attribs"in j))throw new Error("tagPolicy gave no attribs");g=j.attribs;var k,l;if("tagName"in j?(l=j.tagName,k=a.ELEMENTS[l]):(l=e,k=i),i&a.eflags.OPTIONAL_ENDTAG){var m=c[c.length-1];!m||m.orig!==e||m.rep===l&&e===l||h.push("</",m.rep,">")}i&a.eflags.EMPTY||c.push({orig:e,rep:l}),h.push("<",l);for(var n=0,o=g.length;o>n;n+=2){var p=g[n],q=g[n+1];null!==q&&void 0!==q&&h.push(" ",p,'="',f(q),'"')}h.push(">"),i&a.eflags.EMPTY&&!(k&a.eflags.EMPTY)&&h.push("</",l,">")}}},endTag:function(b,e){if(d)return void(d=!1);if(a.ELEMENTS.hasOwnProperty(b)){var f=a.ELEMENTS[b];if(!(f&(a.eflags.EMPTY|a.eflags.FOLDABLE))){var g;if(f&a.eflags.OPTIONAL_ENDTAG)for(g=c.length;--g>=0;){var h=c[g].orig;if(h===b)break;if(!(a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG))return}else for(g=c.length;--g>=0&&c[g].orig!==b;);if(0>g)return;for(var i=c.length;--i>g;){var j=c[i].rep;a.ELEMENTS[j]&a.eflags.OPTIONAL_ENDTAG||e.push("</",j,">")}g<c.length&&(b=c[g].rep),c.length=g,e.push("</",b,">")}}},pcdata:e,rcdata:e,cdata:e,endDoc:function(a){for(;c.length;c.length--)a.push("</",c[c.length-1].rep,">")}})}function t(a,b,c,d,e){if(!e)return null;try{var f=q.parse(""+a);if(f&&(!f.hasScheme()||X.test(f.getScheme()))){var g=e(f,b,c,d);return g?g.toString():null}}catch(h){return null}return null}function u(a,b,c,d,e){if(c||a(b+" removed",{change:"removed",tagName:b}),d!==e){var f="changed";d&&!e?f="removed":!d&&e&&(f="added"),a(b+"."+c+" "+f,{change:f,tagName:b,attribName:c,oldValue:d,newValue:e})}}function v(a,b,c){var d;return d=b+"::"+c,a.hasOwnProperty(d)?a[d]:(d="*::"+c,a.hasOwnProperty(d)?a[d]:void 0)}function w(b,c){return v(a.LOADERTYPES,b,c)}function x(b,c){return v(a.URIEFFECTS,b,c)}function y(b,c,d,e,f){for(var g=0;g<c.length;g+=2){var h,i=c[g],j=c[g+1],k=j,l=null;if(h=b+"::"+i,(a.ATTRIBS.hasOwnProperty(h)||(h="*::"+i,a.ATTRIBS.hasOwnProperty(h)))&&(l=a.ATTRIBS[h]),null!==l)switch(l){case a.atype.NONE:break;case a.atype.SCRIPT:j=null,f&&u(f,b,i,k,j);break;case a.atype.STYLE:if("undefined"==typeof C){j=null,f&&u(f,b,i,k,j);break}var m=[];C(j,{declaration:function(b,c){var e=b.toLowerCase();D(e,c,d?function(b){return t(b,a.ueffects.SAME_DOCUMENT,a.ltypes.SANDBOXED,{TYPE:"CSS",CSS_PROP:e},d)}:null),c.length&&m.push(e+": "+c.join(" "))}}),j=m.length>0?m.join(" ; "):null,f&&u(f,b,i,k,j);break;case a.atype.ID:case a.atype.IDREF:case a.atype.IDREFS:case a.atype.GLOBAL_NAME:case a.atype.LOCAL_NAME:case a.atype.CLASSES:j=e?e(j):j,f&&u(f,b,i,k,j);break;case a.atype.URI:j=t(j,x(b,i),w(b,i),{TYPE:"MARKUP",XML_ATTR:i,XML_TAG:b},d),f&&u(f,b,i,k,j);break;case a.atype.URI_FRAGMENT:j&&"#"===j.charAt(0)?(j=j.substring(1),j=e?e(j):j,null!==j&&void 0!==j&&(j="#"+j)):j=null,f&&u(f,b,i,k,j);break;default:j=null,f&&u(f,b,i,k,j)}else j=/data-[\w-]+/.test(i)?e?e(j):j:null,f&&u(f,b,i,k,j);c[g+1]=j}return c}function z(b,c,d){return function(e,f){return a.ELEMENTS[e]&a.eflags.UNSAFE?void(d&&u(d,e,void 0,void 0,void 0)):{attribs:y(e,f,b,c,d)}}}function A(a,b){var c=[];return s(b)(a,c),c.join("")}function B(a,b,c,d){var e=z(b,c,d);return A(a,e)}var C,D,E;"undefined"!=typeof window&&(C=window.parseCssDeclarations,D=window.sanitizeCssProperty,E=window.cssSchema);var F={lt:"<",LT:"<",gt:">",GT:">",amp:"&",AMP:"&",quot:'"',apos:"'",nbsp:" "},G=/^#(\d+)$/,H=/^#x([0-9A-Fa-f]+)$/,I=/^[A-Za-z][A-za-z0-9]+$/,J="undefined"!=typeof window&&window.document?window.document.createElement("textarea"):null,K=/\0/g,L=/&(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/g,M=/^(#[0-9]+|#[xX][0-9A-Fa-f]+|\w+);/,N=/&/g,O=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,P=/[<]/g,Q=/>/g,R=/\"/g,S=new RegExp("^\\s*([-.:\\w]+)(?:\\s*(=)\\s*((\")[^\"]*(\"|$)|(')[^']*('|$)|(?=[a-z][-\\w]*\\s*=)|[^\"'\\s]*))?","i"),T=3==="a,b".split(/(,)/).length,U=a.eflags.CDATA|a.eflags.RCDATA,V={},W={},X=/^(?:https?|mailto)$/i,Y={};return Y.escapeAttrib=Y.escapeAttrib=f,Y.makeHtmlSanitizer=Y.makeHtmlSanitizer=s,Y.makeSaxParser=Y.makeSaxParser=h,Y.makeTagPolicy=Y.makeTagPolicy=z,Y.normalizeRCData=Y.normalizeRCData=g,Y.sanitize=Y.sanitize=B,Y.sanitizeAttribs=Y.sanitizeAttribs=y,Y.sanitizeWithPolicy=Y.sanitizeWithPolicy=A,Y.unescapeEntities=Y.unescapeEntities=e,Y}(y),A=z.sanitize;"undefined"!=typeof window&&(window.html=z,window.html_sanitize=A),e("undefined"!=typeof z?z:window.html)}).call(a,void 0,void 0,void 0,void 0,function(a){b.exports=a})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],318:[function(a,b,c){(function(a){(function(a,b,c,d,e){var f=function(){function a(a,b){postMessage({action:3,callback_num:b,result:a})}function b(){return Ye}function c(){}function d(){return Ze}function e(){}function f(){return $e}function g(){}function h(a,b){return a.detailMessage=b,a}function i(){return _e}function j(){}function k(a,b){return a}function l(){return af}function m(){}function n(a,b){a[a.explicitLength++]=b}function o(a,b){a[a.explicitLength++]=b}function p(a){var b,c;return c=a.join(""),a.length=a.explicitLength=0,b=c,a[a.explicitLength++]=b,b}function q(a,b){var c=new Array(b);if(a>0)for(var d=[null,0,!1,[0,0]][a],e=0;b>e;++e)c[e]=d;return c}function r(){return this.arrayClass$}function s(a,b,c,d,e){var f;return f=q(e,d),w(),y(f,Je,Ke),f.arrayClass$=a,f.typeId$=b,f.queryId$=c,f}function t(a,b,c,d){return w(),y(d,Je,Ke),d.arrayClass$=a,d.typeId$=b,d.queryId$=c,d}function u(a,b,c){if(null!=c){if(a.queryId$>0&&!A(c.typeId$,a.queryId$))throw new Ba;if(a.queryId$<0&&(c.typeMarker$==se||2==c.typeId$))throw new Ba}return a[b]=c}function v(){}function w(){w=se,Je=[],Ke=[],x(new v,Je,Ke)}function x(a,b,c){var d,e=0;for(var f in a)(d=a[f])&&(b[e]=f,c[e]=d,++e)}function y(a,b,c){w();for(var d=0,e=b.length;e>d;++d)a[b[d]]=c[d]}function z(a,b){return a&&!!Ue[a][b]}function A(a,b){return a&&Ue[a][b]}function B(a,b){if(null!=a&&!A(a.typeId$,b))throw new Ia;return a}function C(a,b){return null!=a&&z(a.typeId$,b)}function D(a){return~~Math.max(Math.min(a,2147483647),-2147483648)}function E(a){return null!=a&&z(a.typeId$,2)?a:k(new m,a)}function F(a,b){var c,d;return c=a[1]+b[1],d=a[0]+b[0],J(d,c)}function G(a,b,c){return 0==b?a:0==c?a:F(a,J(b*c,0))}function H(a,b){return Q(~~Math.max(Math.min(a[1]/4294967296,2147483647),-2147483648)&~~Math.max(Math.min(b[1]/4294967296,2147483647),-2147483648),P(a)&P(b))}function I(a,b){var c,d;return a[0]==b[0]&&a[1]==b[1]?0:(c=a[1]<0,d=b[1]<0,c&&!d?-1:!c&&d?1:Y(a,b)[1]<0?-1:1)}function J(a,b){var c,d;for(b%=0x10000000000000000,a%=0x10000000000000000,c=b%4294967296,d=4294967296*Math.floor(a/4294967296),b=b-c+d,a=a-d+c;0>a;)a+=4294967296,b-=4294967296;for(;a>4294967295;)a-=4294967296,b+=4294967296;for(b%=0x10000000000000000;b>0x7fffffff00000000;)b-=0x10000000000000000;for(;-0x8000000000000000>b;)b+=0x10000000000000000;return[a,b]}function K(a,b){var c,d,e,f,g,h;if(0==b[0]&&0==b[1])throw wa(new ya,"/ by zero");if(0==a[0]&&0==a[1])return ba(),Te;if(L(a,(ba(),Oe)))return L(b,Qe)||L(b,Pe)?Oe:(f=W(a,1),c=V(K(f,b),1),g=Y(a,R(b,c)),F(c,K(g,b)));if(L(b,Oe))return Te;if(a[1]<0)return b[1]<0?K(T(a),T(b)):T(K(T(a),b));if(b[1]<0)return T(K(a,T(b)));for(h=Te,g=a;I(g,b)>=0;)e=M(Math.floor(Z(g)/$(b))),0==e[0]&&0==e[1]&&(e=Qe),d=R(e,b),h=F(h,e),g=Y(g,d);return h}function L(a,b){return a[0]==b[0]&&a[1]==b[1]}function M(a){return isNaN(a)?(ba(),Te):-0x8000000000000000>a?(ba(),Oe):a>=0x8000000000000000?(ba(),Ne):a>0?J(Math.floor(a),0):J(Math.ceil(a),0)}function N(a){var b,c;return a>-129&&128>a?(b=a+128,c=(aa(),Le)[b],null==c&&(c=Le[b]=O(a)),c):O(a)}function O(a){return a>=0?[a,0]:[a+4294967296,-4294967296]}function P(a){return a[0]>=2147483648?~~Math.max(Math.min(a[0]-4294967296,2147483647),-2147483648):~~Math.max(Math.min(a[0],2147483647),-2147483648)}function Q(a,b){var c,d;return c=4294967296*a,d=b,0>b&&(d+=4294967296),[d,c]}function R(a,b){var c,d,e,f,g,h,i,j,k;return 0==a[0]&&0==a[1]?(ba(),Te):0==b[0]&&0==b[1]?(ba(),Te):L(a,(ba(),Oe))?S(b):L(b,Oe)?S(a):a[1]<0?b[1]<0?R(T(a),T(b)):T(R(T(a),b)):b[1]<0?T(R(a,T(b))):I(a,Se)<0&&I(b,Se)<0?J((a[1]+a[0])*(b[1]+b[0]),0):(e=a[1]%281474976710656,f=a[1]-e,c=a[0]%65536,d=a[0]-c,i=b[1]%281474976710656,j=b[1]-i,g=b[0]%65536,h=b[0]-g,k=Te,k=G(k,f,g),k=G(k,e,h),k=G(k,e,g),k=G(k,d,i),k=G(k,d,h),k=G(k,d,g),k=G(k,c,j),k=G(k,c,i),k=G(k,c,h),k=G(k,c,g))}function S(a){return 1==(1&P(a))?(ba(),Oe):(ba(),Te)}function T(a){var b,c;return L(a,(ba(),Oe))?Oe:(b=-a[1],c=-a[0],c>4294967295&&(c-=4294967296,b+=4294967296),0>c&&(c+=4294967296,b-=4294967296),[c,b])}function U(a){return 30>=a?1<<a:U(30)*U(a-30)}function V(a,b){var c,d,e,f;return b&=63,L(a,(ba(),Oe))?0==b?a:Te:a[1]<0?T(V(T(a),b)):(f=U(b),d=a[1]*f%0x10000000000000000,e=a[0]*f,c=e-e%4294967296,d+=c,e-=c,d>=0x8000000000000000&&(d-=0x10000000000000000),[e,d])}function W(a,b){var c,d,e;return b&=63,e=U(b),c=a[1]/e,d=Math.floor(a[0]/e),J(d,c)}function X(a,b){var c;return b&=63,c=W(a,b),a[1]<0&&(c=F(c,V((ba(),Re),63-b))),c}function Y(a,b){var c,d;return c=a[1]-b[1],d=a[0]-b[0],J(d,c)}function Z(a){var b,c,d;return c=D(Math.log(a[1])/(ba(),Me)),48>=c?a[1]+a[0]:(b=c-48,d=(1<<b)-1,a[1]+(a[0]-d))}function $(a){var b,c,d;return c=D(Math.log(a[1])/(ba(),Me)),48>=c?a[1]+a[0]:(b=c-48,d=(1<<b)-1,a[1]+(a[0]+d))}function _(a){var b,c,d,e,f,g;if(0==a[0]&&0==a[1])return"0";if(L(a,(ba(),Oe)))return"-9223372036854775808";if(a[1]<0)return"-"+_(T(a));for(c=a,e="";0!=c[0]||0!=c[1];){if(f=N(1e9),d=K(c,f),b=""+P(Y(c,R(d,f))),c=d,0!=c[0]||0!=c[1])for(g=9-b.length;g>0;--g)b="0"+b;e=b+e}return e}function aa(){aa=se,Le=s(cf,0,9,256,0)}function ba(){ba=se,Me=Math.log(2),Ne=Ie,Oe=ye,Pe=N(-1),Qe=N(1),Re=N(2),Se=Fe,Te=N(0)}function ca(){return df}function da(){}function ea(a,b){return fa(a,b,0,b.length),a}function fa(a,b,c,d){return a.buf=b,a.pos=c,a.count=c+d,a.count>b.length&&(a.count=b.length),a}function ga(a){return a.pos>=a.count?-1:255&a.buf[a.pos++]}function ha(a,b,c,d){return a.pos>=a.count?-1:(d=Ta(d,a.count-a.pos),ab(a.buf,a.pos,b,c,d),a.pos+=d,d)}function ia(){return ef}function ja(){}function ka(){return gf}function la(){}function ma(a){return a.buf=s(ff,0,-1,32,1),a}function na(a,b){var c;b<=a.buf.length||(b=Sa(b,2*a.buf.length),c=s(ff,0,-1,b,1),ab(a.buf,0,c,0,a.buf.length),a.buf=c)}function oa(a){var b;return b=s(ff,0,-1,a.count,1),ab(a.buf,0,b,0,a.count),b}function pa(a,b){na(a,a.count+1),a.buf[a.count++]=b<<24>>24}function qa(a,b,c,d){na(a,a.count+d),ab(b,c,a.buf,a.count,d),a.count+=d}function ra(){return hf}function sa(){}function ta(a,b){return a.detailMessage=b,a}function ua(){return jf}function va(){}function wa(a,b){return a.detailMessage=b,a}function xa(){return lf}function ya(){}function za(a,b){return a.detailMessage=b,a}function Aa(){return mf}function Ba(){}function Ca(a,b){var c;return c=new Ga,c.typeName=a+b,c}function Da(a,b){var c;return c=new Ga,c.typeName=a+b,c}function Ea(a,b){var c;return c=new Ga,c.typeName=a+b,c}function Fa(){return of}function Ga(){}function Ha(){return pf}function Ia(){}function Ja(){return kf}function Ka(){}function La(a,b){return a.detailMessage=b,a}function Ma(){return qf}function Na(){}function Oa(){return rf}function Pa(){}function Qa(){return sf}function Ra(){}function Sa(a,b){return a>b?a:b}function Ta(a,b){return b>a?a:b}function Ua(){return uf}function Va(){}function Wa(a,b){return null==b?!1:String(a)==b}function Xa(a,b,c,d,e){var f;for(f=b;c>f;++f)d[e++]=a.charCodeAt(f)}function Ya(){return vf}function Za(a){var b;return a.data=(b=[],b.explicitLength=0,b),a}function $a(){return wf}function _a(){}function ab(a,b,c,d,e){var f,g,h,i,j,k,l,m;if(null==a||null==c)throw new Va;if(l=(a.typeMarker$==se||2==a.typeId$?a.getClass$():bf).typeName,h=(c.typeMarker$==se||2==c.typeId$?c.getClass$():bf).typeName,91!=l.charCodeAt(0)||91!=h.charCodeAt(0))throw za(new Ba,"Must be array types");if(l.charCodeAt(1)!=h.charCodeAt(1))throw za(new Ba,"Array types must match");if(m=a.length,i=c.length,0>b||0>d||0>e||b+e>m||d+e>i)throw new Ra;if(76!=l.charCodeAt(1)&&91!=l.charCodeAt(1)||Wa(l,h))for(j=0;e>j;++j)c[d+j]=a[b+j];else if(k=B(a,3),f=B(c,3),(null==a?null:a)===(null==c?null:c)&&d>b)for(b+=e,g=d+e;g-- >d;)u(f,g,k[--b]);else for(g=d+e;g>d;)u(f,d++,k[b++])}function bb(a,b){if(!Vc(b,1<<a.dictionarySize))throw h(new j,"unexpected failure");if(!Yc(b,a.fb))throw h(new j,"unexpected failure");if(!Xc(b,a.matchFinder))throw h(new j,"unexpected failure");if(!Wc(b,a.lc,a.lp,a.pb))throw h(new j,"unexpected failure")}function cb(){return Xf}function db(){}function eb(a){var b;try{return $b(a.chunker)}catch(b){if(b=E(b),C(b,10))return!1;throw b}}function fb(a,b,c,d,e){var f,g;if(!e)throw La(new Na,"null mode");if(I(d,ze)<0)throw La(new Na,"invalid length "+_(d));for(a.length_0=d,f=Ic(new cd),bb(e,f),f._writeEndMark=!0,Zc(f,c),g=0;64>g;g+=8)pa(c,255&P(W(d,g)));a.chunker=(f._needReleaseMFStream=!1,f._inStream=b,f._finished=!1,Hc(f),f._rangeEncoder.Stream=c,Qc(f),Kc(f),Jc(f),f._lenEncoder._tableSize=f._numFastBytes+1-2,md(f._lenEncoder,1<<f._posStateBits),f._repMatchLenEncoder._tableSize=f._numFastBytes+1-2,md(f._repMatchLenEncoder,1<<f._posStateBits),void(f.nowPos64=Ae),Yb(new cc,f))}function gb(){return Yf}function hb(){}function ib(a,b,c){var d;a.output=ma(new sa);try{fb(a,ea(new ja,b),a.output,N(b.length),c)}catch(d){throw d=E(d),C(d,10)?h(new j,"impossible exception"):d}return a}function jb(){return Zf}function kb(){}function lb(a){var b,c;try{return $b(a.chunker)}catch(b){if(b=E(b),C(b,10))return c=b,a.exception=c,!1;throw b}}function mb(a,b,c){var d,e,f,g,h,i="";for(f=s(ff,0,-1,5,1),e=0;e<f.length;++e){if(g=ga(b),-1==g)throw ta(new va,"truncated input");f[e]=g<<24>>24}if(d=gc(new mc),!ic(d,f))throw ta(new va,"corrupted input");for(e=0;64>e;e+=8){if(g=ga(b),-1==g)throw ta(new va,"truncated input");g=g.toString(16),1==g.length&&(g="0"+g),i=g+""+i}"ffffffffffffffffff"==i.toLowerCase()||0==i?a.length_0=ze:(h=parseInt(i,16),h>4294967295?a.length_0=ze:a.length_0=M(h)),a.chunker=ec(d,b,c,a.length_0)}function nb(){return $f}function ob(){}function pb(a,b){return a.output=ma(new sa),mb(a,ea(new ja,b),a.output),a}function qb(){return _f}function rb(){}function sb(a,b,c,d){var e;a._keepSizeBefore=b,a._keepSizeAfter=c,e=b+c+d,null!=a._bufferBase&&a._blockSize==e||(a._bufferBase=null,a._blockSize=e,a._bufferBase=s(ff,0,-1,a._blockSize,1)),a._pointerToLastSafePosition=a._blockSize-c}function tb(a,b){return a._bufferBase[a._bufferOffset+a._pos+b]}function ub(a,b,c,d){var e,f;for(a._streamEndWasReached&&a._pos+b+d>a._streamPos&&(d=a._streamPos-(a._pos+b)),++c,f=a._bufferOffset+a._pos+b,e=0;d>e&&a._bufferBase[f+e]==a._bufferBase[f+e-c];++e);return e}function vb(a){return a._streamPos-a._pos}function wb(a){var b,c,d;for(d=a._bufferOffset+a._pos-a._keepSizeBefore,d>0&&--d,c=a._bufferOffset+a._streamPos-d,b=0;c>b;++b)a._bufferBase[b]=a._bufferBase[d+b];a._bufferOffset-=d}function xb(a){var b;++a._pos,a._pos>a._posLimit&&(b=a._bufferOffset+a._pos,b>a._pointerToLastSafePosition&&wb(a),yb(a))}function yb(a){var b,c,d;if(!a._streamEndWasReached)for(;;){if(d=-a._bufferOffset+a._blockSize-a._streamPos,0==d)return;if(b=ha(a._stream,a._bufferBase,a._bufferOffset+a._streamPos,d),-1==b)return a._posLimit=a._streamPos,c=a._bufferOffset+a._posLimit,c>a._pointerToLastSafePosition&&(a._posLimit=a._pointerToLastSafePosition-a._bufferOffset),void(a._streamEndWasReached=!0);a._streamPos+=b,a._streamPos>=a._pos+a._keepSizeAfter&&(a._posLimit=a._streamPos-a._keepSizeAfter)}}function zb(a,b){a._bufferOffset+=b,a._posLimit-=b,a._pos-=b,a._streamPos-=b}function Ab(){return xf}function Bb(){}function Cb(){Cb=se;var a,b,c;for(Ve=s(tf,0,-1,256,1),a=0;256>a;++a){for(c=a,b=0;8>b;++b)0!=(1&c)?c=c>>>1^-306674912:c>>>=1;Ve[a]=c}}function Db(a,b,c,d,e){var f,g,h;return b>1073741567?!1:(a._cutValue=16+(d>>1),h=~~((b+c+d+e)/2)+256,sb(a,b+c,d+e,h),a._matchMaxLen=d,f=b+1,a._cyclicBufferSize!=f&&(a._son=s(tf,0,-1,2*(a._cyclicBufferSize=f),1)),g=65536,a.HASH_ARRAY&&(g=b-1,g|=g>>1,g|=g>>2,g|=g>>4,g|=g>>8,g>>=1,g|=65535,g>16777216&&(g>>=1),a._hashMask=g,++g,g+=a.kFixHashSize),g!=a._hashSizeSum&&(a._hash=s(tf,0,-1,a._hashSizeSum=g,1)),!0)}function Eb(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(a._pos+a._matchMaxLen<=a._streamPos)p=a._matchMaxLen;else if(p=a._streamPos-a._pos,p<a.kMinMatchCheck)return Gb(a),0;for(s=0,q=a._pos>a._cyclicBufferSize?a._pos-a._cyclicBufferSize:0,d=a._bufferOffset+a._pos,r=1,j=0,k=0,a.HASH_ARRAY?(w=Ve[255&a._bufferBase[d]]^255&a._bufferBase[d+1],j=1023&w,w^=(255&a._bufferBase[d+2])<<8,k=65535&w,l=(w^Ve[255&a._bufferBase[d+3]]<<5)&a._hashMask):l=255&a._bufferBase[d]^(255&a._bufferBase[d+1])<<8,e=a._hash[a.kFixHashSize+l],a.HASH_ARRAY&&(f=a._hash[j],g=a._hash[1024+k],a._hash[j]=a._pos,a._hash[1024+k]=a._pos,f>q&&a._bufferBase[a._bufferOffset+f]==a._bufferBase[d]&&(b[s++]=r=2,b[s++]=a._pos-f-1),g>q&&a._bufferBase[a._bufferOffset+g]==a._bufferBase[d]&&(g==f&&(s-=2),b[s++]=r=3,b[s++]=a._pos-g-1,f=g),0!=s&&f==e&&(s-=2,r=1)),a._hash[a.kFixHashSize+l]=a._pos,u=(a._cyclicBufferPos<<1)+1,v=a._cyclicBufferPos<<1,n=o=a.kNumHashDirectBytes,0!=a.kNumHashDirectBytes&&e>q&&a._bufferBase[a._bufferOffset+e+a.kNumHashDirectBytes]!=a._bufferBase[d+a.kNumHashDirectBytes]&&(b[s++]=r=a.kNumHashDirectBytes,b[s++]=a._pos-e-1),c=a._cutValue;;){if(q>=e||0==c--){a._son[u]=a._son[v]=0;break}if(i=a._pos-e,h=(i<=a._cyclicBufferPos?a._cyclicBufferPos-i:a._cyclicBufferPos-i+a._cyclicBufferSize)<<1,t=a._bufferOffset+e,m=o>n?n:o,a._bufferBase[t+m]==a._bufferBase[d+m]){for(;++m!=p&&a._bufferBase[t+m]==a._bufferBase[d+m];);if(m>r&&(b[s++]=r=m,b[s++]=i-1,m==p)){a._son[v]=a._son[h],a._son[u]=a._son[h+1];break}}(255&a._bufferBase[t+m])<(255&a._bufferBase[d+m])?(a._son[v]=e,v=h+1,e=a._son[v],o=m):(a._son[u]=e,u=h,e=a._son[u],n=m)}return Gb(a),s}function Fb(a){var b;for(a._bufferOffset=0,a._pos=0,a._streamPos=0,a._streamEndWasReached=!1,yb(a),b=0;b<a._hashSizeSum;++b)a._hash[b]=0;a._cyclicBufferPos=0,zb(a,-1)}function Gb(a){var b;++a._cyclicBufferPos>=a._cyclicBufferSize&&(a._cyclicBufferPos=0),xb(a),1073741823==a._pos&&(b=a._pos-a._cyclicBufferSize,Hb(a._son,2*a._cyclicBufferSize,b),Hb(a._hash,a._hashSizeSum,b),zb(a,b))}function Hb(a,b,c){var d,e;for(d=0;b>d;++d)e=a[d],c>=e?e=0:e-=c,a[d]=e}function Ib(a,b){a.HASH_ARRAY=b>2,a.HASH_ARRAY?(a.kNumHashDirectBytes=0,a.kMinMatchCheck=4,a.kFixHashSize=66560):(a.kNumHashDirectBytes=2,a.kMinMatchCheck=3,a.kFixHashSize=0)}function Jb(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;do{if(a._pos+a._matchMaxLen<=a._streamPos)n=a._matchMaxLen;else if(n=a._streamPos-a._pos,n<a.kMinMatchCheck){Gb(a);continue}for(o=a._pos>a._cyclicBufferSize?a._pos-a._cyclicBufferSize:0,d=a._bufferOffset+a._pos,a.HASH_ARRAY?(s=Ve[255&a._bufferBase[d]]^255&a._bufferBase[d+1],h=1023&s,a._hash[h]=a._pos,s^=(255&a._bufferBase[d+2])<<8,i=65535&s,a._hash[1024+i]=a._pos,j=(s^Ve[255&a._bufferBase[d+3]]<<5)&a._hashMask):j=255&a._bufferBase[d]^(255&a._bufferBase[d+1])<<8,e=a._hash[a.kFixHashSize+j],a._hash[a.kFixHashSize+j]=a._pos,q=(a._cyclicBufferPos<<1)+1,r=a._cyclicBufferPos<<1,l=m=a.kNumHashDirectBytes,c=a._cutValue;;){if(o>=e||0==c--){a._son[q]=a._son[r]=0;break}if(g=a._pos-e,f=(g<=a._cyclicBufferPos?a._cyclicBufferPos-g:a._cyclicBufferPos-g+a._cyclicBufferSize)<<1,p=a._bufferOffset+e,k=m>l?l:m,a._bufferBase[p+k]==a._bufferBase[d+k]){for(;++k!=n&&a._bufferBase[p+k]==a._bufferBase[d+k];);if(k==n){a._son[r]=a._son[f],a._son[q]=a._son[f+1];break}}(255&a._bufferBase[p+k])<(255&a._bufferBase[d+k])?(a._son[r]=e,r=f+1,e=a._son[r],m=k):(a._son[q]=e,q=f,e=a._son[q],l=k)}Gb(a)}while(0!=--b)}function Kb(){return yf}function Lb(){}function Mb(a,b,c){var d;for(d=a._pos-b-1,0>d&&(d+=a._windowSize);0!=c;--c)d>=a._windowSize&&(d=0),a._buffer[a._pos++]=a._buffer[d++],a._pos>=a._windowSize&&Ob(a)}function Nb(a,b){null!=a._buffer&&a._windowSize==b||(a._buffer=s(ff,0,-1,b,1)),a._windowSize=b,a._pos=0,a._streamPos=0}function Ob(a){var b;b=a._pos-a._streamPos,0!=b&&(qa(a._stream,a._buffer,a._streamPos,b),a._pos>=a._windowSize&&(a._pos=0),
a._streamPos=a._pos)}function Pb(a,b){var c;return c=a._pos-b-1,0>c&&(c+=a._windowSize),a._buffer[c]}function Qb(a,b){b||(a._streamPos=0,a._pos=0)}function Rb(a,b){a._buffer[a._pos++]=b,a._pos>=a._windowSize&&Ob(a)}function Sb(a){Ob(a),a._stream=null}function Tb(a,b){Ob(a),a._stream=null,a._stream=b}function Ub(){return zf}function Vb(){}function Wb(a){return a-=2,4>a?a:3}function Xb(a){return 4>a?0:10>a?a-3:a-6}function Yb(a,b){return a.encoder=b,a.decoder=null,a.alive=!0,a}function Zb(a,b){return a.decoder=b,a.encoder=null,a.alive=!0,a}function $b(a){var b;if(!a.alive)throw new Pa;b=!0;try{return a.encoder?ac(a):_b(a),b=!1,a.alive}finally{b&&(a.alive=!1)}}function _b(a){var b;if(b=fc(a.decoder),-1==b)throw ta(new va,"corrupted input");a.inBytesProcessed=ze,a.outBytesProcessed=a.decoder.nowPos64,(1==b||I(a.decoder.outSize,Ae)>=0&&I(a.decoder.nowPos64,a.decoder.outSize)>=0)&&(dc(a.decoder),a.alive=!1)}function ac(a){Gc(a.encoder,a.encoder.processedInSize,a.encoder.processedOutSize,a.encoder.finished),a.inBytesProcessed=a.encoder.processedInSize[0],a.encoder.finished[0]&&(Uc(a.encoder),a.alive=!1)}function bc(){return Af}function cc(){}function dc(a){Ob(a.m_OutWindow),Sb(a.m_OutWindow),a.m_RangeDecoder.Stream=null}function ec(a,b,c,d){return a.m_RangeDecoder.Stream=b,Tb(a.m_OutWindow,c),hc(a),a.state=0,a.rep0=0,a.rep1=0,a.rep2=0,a.rep3=0,a.outSize=d,a.nowPos64=Ae,a.prevByte=0,Zb(new cc,a)}function fc(a){var b,c,d,e,f,g;if(g=P(a.nowPos64)&a.m_PosStateMask,0==Td(a.m_RangeDecoder,a.m_IsMatchDecoders,(a.state<<4)+g))b=uc(a.m_LiteralDecoder,P(a.nowPos64),a.prevByte),a.state<7?a.prevByte=yc(b,a.m_RangeDecoder):a.prevByte=zc(b,a.m_RangeDecoder,Pb(a.m_OutWindow,a.rep0)),Rb(a.m_OutWindow,a.prevByte),a.state=Xb(a.state),a.nowPos64=F(a.nowPos64,Be);else{if(1==Td(a.m_RangeDecoder,a.m_IsRepDecoders,a.state))d=0,0==Td(a.m_RangeDecoder,a.m_IsRepG0Decoders,a.state)?0==Td(a.m_RangeDecoder,a.m_IsRep0LongDecoders,(a.state<<4)+g)&&(a.state=a.state<7?9:11,d=1):(0==Td(a.m_RangeDecoder,a.m_IsRepG1Decoders,a.state)?c=a.rep1:(0==Td(a.m_RangeDecoder,a.m_IsRepG2Decoders,a.state)?c=a.rep2:(c=a.rep3,a.rep3=a.rep2),a.rep2=a.rep1),a.rep1=a.rep0,a.rep0=c),0==d&&(d=oc(a.m_RepLenDecoder,a.m_RangeDecoder,g)+2,a.state=a.state<7?8:11);else if(a.rep3=a.rep2,a.rep2=a.rep1,a.rep1=a.rep0,d=2+oc(a.m_LenDecoder,a.m_RangeDecoder,g),a.state=a.state<7?7:10,f=Fd(a.m_PosSlotDecoder[Wb(d)],a.m_RangeDecoder),f>=4){if(e=(f>>1)-1,a.rep0=(2|1&f)<<e,14>f)a.rep0+=Hd(a.m_PosDecoders,a.rep0-f-1,a.m_RangeDecoder,e);else if(a.rep0+=Ud(a.m_RangeDecoder,e-4)<<4,a.rep0+=Gd(a.m_PosAlignDecoder,a.m_RangeDecoder),a.rep0<0)return-1==a.rep0?1:-1}else a.rep0=f;if(I(N(a.rep0),a.nowPos64)>=0||a.rep0>=a.m_DictionarySizeCheck)return-1;Mb(a.m_OutWindow,a.rep0,d),a.nowPos64=F(a.nowPos64,N(d)),a.prevByte=Pb(a.m_OutWindow,0)}return 0}function gc(a){var b;for(a.m_OutWindow=new Vb,a.m_RangeDecoder=new Yd,a.m_IsMatchDecoders=s(Bf,0,-1,192,1),a.m_IsRepDecoders=s(Bf,0,-1,12,1),a.m_IsRepG0Decoders=s(Bf,0,-1,12,1),a.m_IsRepG1Decoders=s(Bf,0,-1,12,1),a.m_IsRepG2Decoders=s(Bf,0,-1,12,1),a.m_IsRep0LongDecoders=s(Bf,0,-1,192,1),a.m_PosSlotDecoder=s(Cf,0,7,4,0),a.m_PosDecoders=s(Bf,0,-1,114,1),a.m_PosAlignDecoder=Ed(new Jd,4),a.m_LenDecoder=pc(new sc),a.m_RepLenDecoder=pc(new sc),a.m_LiteralDecoder=new xc,b=0;4>b;++b)a.m_PosSlotDecoder[b]=Ed(new Jd,6);return a}function hc(a){var b;for(Qb(a.m_OutWindow,!1),Wd(a.m_IsMatchDecoders),Wd(a.m_IsRep0LongDecoders),Wd(a.m_IsRepDecoders),Wd(a.m_IsRepG0Decoders),Wd(a.m_IsRepG1Decoders),Wd(a.m_IsRepG2Decoders),Wd(a.m_PosDecoders),vc(a.m_LiteralDecoder),b=0;4>b;++b)Wd(a.m_PosSlotDecoder[b].Models);qc(a.m_LenDecoder),qc(a.m_RepLenDecoder),Wd(a.m_PosAlignDecoder.Models),Vd(a.m_RangeDecoder)}function ic(a,b){var c,d,e,f,g,h,i;if(b.length<5)return!1;for(i=255&b[0],e=i%9,h=~~(i/9),f=h%5,g=~~(h/5),c=0,d=0;4>d;++d)c+=(255&b[1+d])<<8*d;return kc(a,e,f,g)?jc(a,c):!1}function jc(a,b){return 0>b?!1:(a.m_DictionarySize!=b&&(a.m_DictionarySize=b,a.m_DictionarySizeCheck=Sa(a.m_DictionarySize,1),Nb(a.m_OutWindow,Sa(a.m_DictionarySizeCheck,4096))),!0)}function kc(a,b,c,d){var e;return b>8||c>4||d>4?!1:(tc(a.m_LiteralDecoder,c,b),e=1<<d,nc(a.m_LenDecoder,e),nc(a.m_RepLenDecoder,e),a.m_PosStateMask=e-1,!0)}function lc(){return Df}function mc(){}function nc(a,b){for(;a.m_NumPosStates<b;++a.m_NumPosStates)a.m_LowCoder[a.m_NumPosStates]=Ed(new Jd,3),a.m_MidCoder[a.m_NumPosStates]=Ed(new Jd,3)}function oc(a,b,c){var d;return 0==Td(b,a.m_Choice,0)?Fd(a.m_LowCoder[c],b):(d=8,d+=0==Td(b,a.m_Choice,1)?Fd(a.m_MidCoder[c],b):8+Fd(a.m_HighCoder,b))}function pc(a){return a.m_Choice=s(Bf,0,-1,2,1),a.m_LowCoder=s(Cf,0,7,16,0),a.m_MidCoder=s(Cf,0,7,16,0),a.m_HighCoder=Ed(new Jd,8),a}function qc(a){var b;for(Wd(a.m_Choice),b=0;b<a.m_NumPosStates;++b)Wd(a.m_LowCoder[b].Models),Wd(a.m_MidCoder[b].Models);Wd(a.m_HighCoder.Models)}function rc(){return Ef}function sc(){}function tc(a,b,c){var d,e;if(null==a.m_Coders||a.m_NumPrevBits!=c||a.m_NumPosBits!=b)for(a.m_NumPosBits=b,a.m_PosMask=(1<<b)-1,a.m_NumPrevBits=c,e=1<<a.m_NumPrevBits+a.m_NumPosBits,a.m_Coders=s(Ff,0,4,e,0),d=0;e>d;++d)a.m_Coders[d]=Ac(new Cc)}function uc(a,b,c){return a.m_Coders[((b&a.m_PosMask)<<a.m_NumPrevBits)+((255&c)>>>8-a.m_NumPrevBits)]}function vc(a){var b,c;for(c=1<<a.m_NumPrevBits+a.m_NumPosBits,b=0;c>b;++b)Wd(a.m_Coders[b].m_Decoders)}function wc(){return Gf}function xc(){}function yc(a,b){var c;c=1;do c=c<<1|Td(b,a.m_Decoders,c);while(256>c);return c<<24>>24}function zc(a,b,c){var d,e,f;f=1;do if(e=c>>7&1,c<<=1,d=Td(b,a.m_Decoders,(1+e<<8)+f),f=f<<1|d,e!=d){for(;256>f;)f=f<<1|Td(b,a.m_Decoders,f);break}while(256>f);return f<<24>>24}function Ac(a){return a.m_Decoders=s(Bf,0,-1,768,1),a}function Bc(){return Hf}function Cc(){}function Dc(){Dc=se;var a,b,c,d;for(We=s(ff,0,-1,2048,1),a=2,We[0]=0,We[1]=1,d=2;22>d;++d)for(c=1<<(d>>1)-1,b=0;c>b;++b,++a)We[a]=d<<24>>24}function Ec(a,b){var c,d,e,f;a._optimumEndIndex=b,e=a._optimum[b].PosPrev,d=a._optimum[b].BackPrev;do a._optimum[b].Prev1IsChar&&(Ad(a._optimum[e]),a._optimum[e].PosPrev=e-1,a._optimum[b].Prev2&&(a._optimum[e-1].Prev1IsChar=!1,a._optimum[e-1].PosPrev=a._optimum[b].PosPrev2,a._optimum[e-1].BackPrev=a._optimum[b].BackPrev2)),f=e,c=d,d=a._optimum[f].BackPrev,e=a._optimum[f].PosPrev,a._optimum[f].BackPrev=c,a._optimum[f].PosPrev=b,b=f;while(b>0);return a.backRes=a._optimum[0].BackPrev,a._optimumCurrentIndex=a._optimum[0].PosPrev,a._optimumCurrentIndex}function Fc(a){var b;for(a._state=0,a._previousByte=0,b=0;4>b;++b)a._repDistances[b]=0}function Gc(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;if(b[0]=Ae,c[0]=Ae,d[0]=!0,a._inStream&&(a._matchFinder._stream=a._inStream,Fb(a._matchFinder),a._needReleaseMFStream=!0,a._inStream=null),!a._finished){if(a._finished=!0,r=a.nowPos64,L(a.nowPos64,Ae)){if(0==vb(a._matchFinder))return void Lc(a,P(a.nowPos64));Sc(a),q=P(a.nowPos64)&a._posStateMask,$d(a._rangeEncoder,a._isMatch,(a._state<<4)+q,0),a._state=Xb(a._state),g=tb(a._matchFinder,-a._additionalOffset),ud(qd(a._literalEncoder,P(a.nowPos64),a._previousByte),a._rangeEncoder,g),a._previousByte=g,--a._additionalOffset,a.nowPos64=F(a.nowPos64,Be)}if(0==vb(a._matchFinder))return void Lc(a,P(a.nowPos64));for(;;){if(k=Mc(a,P(a.nowPos64)),n=a.backRes,q=P(a.nowPos64)&a._posStateMask,f=(a._state<<4)+q,1==k&&-1==n)$d(a._rangeEncoder,a._isMatch,f,0),g=tb(a._matchFinder,-a._additionalOffset),s=qd(a._literalEncoder,P(a.nowPos64),a._previousByte),a._state<7?ud(s,a._rangeEncoder,g):(m=tb(a._matchFinder,-a._repDistances[0]-1-a._additionalOffset),vd(s,a._rangeEncoder,m,g)),a._previousByte=g,a._state=Xb(a._state);else{if($d(a._rangeEncoder,a._isMatch,f,1),4>n){if($d(a._rangeEncoder,a._isRep,a._state,1),0==n?($d(a._rangeEncoder,a._isRepG0,a._state,0),1==k?$d(a._rangeEncoder,a._isRep0Long,f,0):$d(a._rangeEncoder,a._isRep0Long,f,1)):($d(a._rangeEncoder,a._isRepG0,a._state,1),1==n?$d(a._rangeEncoder,a._isRepG1,a._state,0):($d(a._rangeEncoder,a._isRepG1,a._state,1),$d(a._rangeEncoder,a._isRepG2,a._state,n-2))),1==k?a._state=a._state<7?9:11:(jd(a._repMatchLenEncoder,a._rangeEncoder,k-2,q),a._state=a._state<7?8:11),h=a._repDistances[n],0!=n){for(j=n;j>=1;--j)a._repDistances[j]=a._repDistances[j-1];a._repDistances[0]=h}}else{for($d(a._rangeEncoder,a._isRep,a._state,0),a._state=a._state<7?7:10,jd(a._lenEncoder,a._rangeEncoder,k-2,q),n-=4,p=_c(n),l=Wb(k),Ld(a._posSlotEncoder[l],a._rangeEncoder,p),p>=4&&(i=(p>>1)-1,e=(2|1&p)<<i,o=n-e,14>p?Pd(a._posEncoders,e-p-1,a._rangeEncoder,i,o):(_d(a._rangeEncoder,o>>4,i-4),Nd(a._posAlignEncoder,a._rangeEncoder,15&o),++a._alignPriceCount)),h=n,j=3;j>=1;--j)a._repDistances[j]=a._repDistances[j-1];a._repDistances[0]=h,++a._matchPriceCount}a._previousByte=tb(a._matchFinder,k-1-a._additionalOffset)}if(a._additionalOffset-=k,a.nowPos64=F(a.nowPos64,N(k)),0==a._additionalOffset){if(a._matchPriceCount>=128&&Kc(a),a._alignPriceCount>=16&&Jc(a),b[0]=a.nowPos64,c[0]=be(a._rangeEncoder),0==vb(a._matchFinder))return void Lc(a,P(a.nowPos64));if(I(Y(a.nowPos64,r),De)>=0)return a._finished=!1,void(d[0]=!1)}}}}function Hc(a){var b,c;a._matchFinder||(Cb(),b=new Lb,c=4,0==a._matchFinderType&&(c=2),Ib(b,c),a._matchFinder=b),pd(a._literalEncoder,a._numLiteralPosStateBits,a._numLiteralContextBits),a._dictionarySize==a._dictionarySizePrev&&a._numFastBytesPrev==a._numFastBytes||(Db(a._matchFinder,a._dictionarySize,4096,a._numFastBytes,274),a._dictionarySizePrev=a._dictionarySize,a._numFastBytesPrev=a._numFastBytes)}function Ic(a){var b;for(Dc(),a._repDistances=s(tf,0,-1,4,1),a._optimum=s(If,0,6,4096,0),a._rangeEncoder=(Zd(),new he),a._isMatch=s(Bf,0,-1,192,1),a._isRep=s(Bf,0,-1,12,1),a._isRepG0=s(Bf,0,-1,12,1),a._isRepG1=s(Bf,0,-1,12,1),a._isRepG2=s(Bf,0,-1,12,1),a._isRep0Long=s(Bf,0,-1,192,1),a._posSlotEncoder=s(Jf,0,8,4,0),a._posEncoders=s(Bf,0,-1,114,1),a._posAlignEncoder=Kd(new Sd,4),a._lenEncoder=kd(new od),a._repMatchLenEncoder=kd(new od),a._literalEncoder=new td,a._matchDistances=s(tf,0,-1,548,1),a._posSlotPrices=s(tf,0,-1,256,1),a._distancesPrices=s(tf,0,-1,512,1),a._alignPrices=s(tf,0,-1,16,1),a.reps=s(tf,0,-1,4,1),a.repLens=s(tf,0,-1,4,1),a.processedInSize=s(Kf,0,-1,1,3),a.processedOutSize=s(Kf,0,-1,1,3),a.finished=s(Lf,0,-1,1,2),a.properties=s(ff,0,-1,5,1),a.tempPrices=s(tf,0,-1,128,1),b=0;4096>b;++b)a._optimum[b]=new Dd;for(b=0;4>b;++b)a._posSlotEncoder[b]=Kd(new Sd,6);return a}function Jc(a){var b;for(b=0;16>b;++b)a._alignPrices[b]=Od(a._posAlignEncoder,b);a._alignPriceCount=0}function Kc(a){var b,c,d,e,f,g,h,i;for(e=4;128>e;++e)g=_c(e),d=(g>>1)-1,b=(2|1&g)<<d,a.tempPrices[e]=Qd(a._posEncoders,b-g-1,d,e-b);for(f=0;4>f;++f){for(c=a._posSlotEncoder[f],h=f<<6,g=0;g<a._distTableSize;++g)a._posSlotPrices[h+g]=Md(c,g);for(g=14;g<a._distTableSize;++g)a._posSlotPrices[h+g]+=(g>>1)-1-4<<6;for(i=128*f,e=0;4>e;++e)a._distancesPrices[i+e]=a._posSlotPrices[h+e];for(;128>e;++e)a._distancesPrices[i+e]=a._posSlotPrices[h+_c(e)]+a.tempPrices[e]}a._matchPriceCount=0}function Lc(a,b){Tc(a),$c(a,b&a._posStateMask),ae(a._rangeEncoder)}function Mc(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z;if(a._optimumEndIndex!=a._optimumCurrentIndex)return o=a._optimum[a._optimumCurrentIndex].PosPrev-a._optimumCurrentIndex,a.backRes=a._optimum[a._optimumCurrentIndex].BackPrev,a._optimumCurrentIndex=a._optimum[a._optimumCurrentIndex].PosPrev,o;if(a._optimumCurrentIndex=a._optimumEndIndex=0,a._longestMatchWasFound?(n=a._longestMatchLength,a._longestMatchWasFound=!1):n=Sc(a),C=a._numDistancePairs,A=vb(a._matchFinder)+1,2>A)return a.backRes=-1,1;for(A>273&&(A=273),P=0,k=0;4>k;++k)a.reps[k]=a._repDistances[k],a.repLens[k]=ub(a._matchFinder,-1,a.reps[k],273),a.repLens[k]>a.repLens[P]&&(P=k);if(a.repLens[P]>=a._numFastBytes)return a.backRes=P,o=a.repLens[P],Rc(a,o-1),o;if(n>=a._numFastBytes)return a.backRes=a._matchDistances[C-1]+4,Rc(a,n-1),n;if(i=tb(a._matchFinder,-1),s=tb(a._matchFinder,-a._repDistances[0]-1-1),2>n&&i!=s&&a.repLens[P]<2)return a.backRes=-1,1;if(a._optimum[0].State=a._state,J=b&a._posStateMask,a._optimum[1].Price=(Zd(),Xe[a._isMatch[(a._state<<4)+J]>>>2]+xd(qd(a._literalEncoder,b,a._previousByte),a._state>=7,s,i)),Ad(a._optimum[1]),t=Xe[2048-a._isMatch[(a._state<<4)+J]>>>2],O=t+Xe[2048-a._isRep[a._state]>>>2],s==i&&(Q=O+Pc(a,a._state,J),Q<a._optimum[1].Price&&(a._optimum[1].Price=Q,Bd(a._optimum[1]))),m=n>=a.repLens[P]?n:a.repLens[P],2>m)return a.backRes=a._optimum[1].BackPrev,1;a._optimum[1].PosPrev=0,a._optimum[0].Backs0=a.reps[0],a._optimum[0].Backs1=a.reps[1],a._optimum[0].Backs2=a.reps[2],a._optimum[0].Backs3=a.reps[3],l=m;do a._optimum[l--].Price=268435455;while(l>=2);for(k=0;4>k;++k)if(N=a.repLens[k],!(2>N)){L=O+Oc(a,k,a._state,J);do f=L+ld(a._repMatchLenEncoder,N-2,J),G=a._optimum[N],f<G.Price&&(G.Price=f,G.PosPrev=0,G.BackPrev=k,G.Prev1IsChar=!1);while(--N>=2)}if(z=t+Xe[a._isRep[a._state]>>>2],l=a.repLens[0]>=2?a.repLens[0]+1:2,n>=l){for(D=0;l>a._matchDistances[D];)D+=2;for(;j=a._matchDistances[D+1],f=z+Nc(a,j,l,J),G=a._optimum[l],f<G.Price&&(G.Price=f,G.PosPrev=0,G.BackPrev=j+4,G.Prev1IsChar=!1),l!=a._matchDistances[D]||(D+=2,D!=C);++l);}for(c=0;;){if(++c,c==m)return Ec(a,c);if(u=Sc(a),C=a._numDistancePairs,u>=a._numFastBytes)return a._longestMatchLength=u,a._longestMatchWasFound=!0,Ec(a,c);if(++b,I=a._optimum[c].PosPrev,a._optimum[c].Prev1IsChar?(--I,a._optimum[c].Prev2?(S=a._optimum[a._optimum[c].PosPrev2].State,S=a._optimum[c].BackPrev2<4?7>S?8:11:7>S?7:10):S=a._optimum[I].State,S=Xb(S)):S=a._optimum[I].State,I==c-1?S=0==a._optimum[c].BackPrev?7>S?9:11:Xb(S):(a._optimum[c].Prev1IsChar&&a._optimum[c].Prev2?(I=a._optimum[c].PosPrev2,H=a._optimum[c].BackPrev2,S=7>S?8:11):(H=a._optimum[c].BackPrev,S=4>H?7>S?8:11:7>S?7:10),F=a._optimum[I],4>H?0==H?(a.reps[0]=F.Backs0,a.reps[1]=F.Backs1,a.reps[2]=F.Backs2,a.reps[3]=F.Backs3):1==H?(a.reps[0]=F.Backs1,a.reps[1]=F.Backs0,a.reps[2]=F.Backs2,a.reps[3]=F.Backs3):2==H?(a.reps[0]=F.Backs2,a.reps[1]=F.Backs0,a.reps[2]=F.Backs1,a.reps[3]=F.Backs3):(a.reps[0]=F.Backs3,a.reps[1]=F.Backs0,a.reps[2]=F.Backs1,a.reps[3]=F.Backs2):(a.reps[0]=H-4,a.reps[1]=F.Backs0,a.reps[2]=F.Backs1,a.reps[3]=F.Backs2)),a._optimum[c].State=S,a._optimum[c].Backs0=a.reps[0],a._optimum[c].Backs1=a.reps[1],a._optimum[c].Backs2=a.reps[2],a._optimum[c].Backs3=a.reps[3],h=a._optimum[c].Price,i=tb(a._matchFinder,-1),s=tb(a._matchFinder,-a.reps[0]-1-1),J=b&a._posStateMask,d=h+Xe[a._isMatch[(S<<4)+J]>>>2]+xd(qd(a._literalEncoder,b,tb(a._matchFinder,-2)),S>=7,s,i),x=a._optimum[c+1],v=!1,d<x.Price&&(x.Price=d,x.PosPrev=c,x.BackPrev=-1,x.Prev1IsChar=!1,v=!0),t=h+Xe[2048-a._isMatch[(S<<4)+J]>>>2],O=t+Xe[2048-a._isRep[S]>>>2],s!=i||x.PosPrev<c&&0==x.BackPrev||(Q=O+(Xe[a._isRepG0[S]>>>2]+Xe[a._isRep0Long[(S<<4)+J]>>>2]),Q<=x.Price&&(x.Price=Q,x.PosPrev=c,x.BackPrev=0,x.Prev1IsChar=!1,v=!0)),B=vb(a._matchFinder)+1,B=B>4095-c?4095-c:B,A=B,!(2>A)){if(A>a._numFastBytes&&(A=a._numFastBytes),!v&&s!=i&&(U=Ta(B-1,a._numFastBytes),q=ub(a._matchFinder,0,a.reps[0],U),q>=2)){for(T=Xb(S),K=b+1&a._posStateMask,y=d+Xe[2048-a._isMatch[(T<<4)+K]>>>2]+Xe[2048-a._isRep[T]>>>2],E=c+1+q;E>m;)a._optimum[++m].Price=268435455;f=y+(V=ld(a._repMatchLenEncoder,q-2,K),V+Oc(a,0,T,K)),G=a._optimum[E],f<G.Price&&(G.Price=f,G.PosPrev=c+1,G.BackPrev=0,G.Prev1IsChar=!0,G.Prev2=!1)}for(R=2,M=0;4>M;++M)if(p=ub(a._matchFinder,-1,a.reps[M],A),!(2>p)){r=p;do{for(;c+p>m;)a._optimum[++m].Price=268435455;f=O+(W=ld(a._repMatchLenEncoder,p-2,J),W+Oc(a,M,S,J)),G=a._optimum[c+p],f<G.Price&&(G.Price=f,G.PosPrev=c,G.BackPrev=M,G.Prev1IsChar=!1)}while(--p>=2);if(p=r,0==M&&(R=p+1),B>p&&(U=Ta(B-1-p,a._numFastBytes),q=ub(a._matchFinder,p,a.reps[M],U),q>=2)){for(T=7>S?8:11,K=b+p&a._posStateMask,e=O+(X=ld(a._repMatchLenEncoder,p-2,J),X+Oc(a,M,S,J))+Xe[a._isMatch[(T<<4)+K]>>>2]+xd(qd(a._literalEncoder,b+p,tb(a._matchFinder,p-1-1)),!0,tb(a._matchFinder,p-1-(a.reps[M]+1)),tb(a._matchFinder,p-1)),T=Xb(T),K=b+p+1&a._posStateMask,w=e+Xe[2048-a._isMatch[(T<<4)+K]>>>2],y=w+Xe[2048-a._isRep[T]>>>2],E=p+1+q;c+E>m;)a._optimum[++m].Price=268435455;f=y+(Y=ld(a._repMatchLenEncoder,q-2,K),Y+Oc(a,0,T,K)),G=a._optimum[c+E],f<G.Price&&(G.Price=f,G.PosPrev=c+p+1,G.BackPrev=0,G.Prev1IsChar=!0,G.Prev2=!0,G.PosPrev2=c,G.BackPrev2=M)}}if(u>A){for(u=A,C=0;u>a._matchDistances[C];C+=2);a._matchDistances[C]=u,C+=2}if(u>=R){for(z=t+Xe[a._isRep[S]>>>2];c+u>m;)a._optimum[++m].Price=268435455;for(D=0;R>a._matchDistances[D];)D+=2;for(p=R;;++p)if(g=a._matchDistances[D+1],f=z+Nc(a,g,p,J),G=a._optimum[c+p],f<G.Price&&(G.Price=f,G.PosPrev=c,G.BackPrev=g+4,G.Prev1IsChar=!1),p==a._matchDistances[D]){if(B>p&&(U=Ta(B-1-p,a._numFastBytes),q=ub(a._matchFinder,p,g,U),q>=2)){for(T=7>S?7:10,K=b+p&a._posStateMask,e=f+Xe[a._isMatch[(T<<4)+K]>>>2]+xd(qd(a._literalEncoder,b+p,tb(a._matchFinder,p-1-1)),!0,tb(a._matchFinder,p-(g+1)-1),tb(a._matchFinder,p-1)),T=Xb(T),K=b+p+1&a._posStateMask,w=e+Xe[2048-a._isMatch[(T<<4)+K]>>>2],y=w+Xe[2048-a._isRep[T]>>>2],E=p+1+q;c+E>m;)a._optimum[++m].Price=268435455;f=y+(Z=ld(a._repMatchLenEncoder,q-2,K),Z+Oc(a,0,T,K)),G=a._optimum[c+E],f<G.Price&&(G.Price=f,G.PosPrev=c+p+1,G.BackPrev=0,G.Prev1IsChar=!0,G.Prev2=!0,G.PosPrev2=c,G.BackPrev2=g+4)}if(D+=2,D==C)break}}}}}function Nc(a,b,c,d){var e,f;return e=Wb(c),f=128>b?a._distancesPrices[128*e+b]:a._posSlotPrices[(e<<6)+ad(b)]+a._alignPrices[15&b],f+ld(a._lenEncoder,c-2,d)}function Oc(a,b,c,d){var e;return 0==b?(Zd(),e=Xe[a._isRepG0[c]>>>2],e+=Xe[2048-a._isRep0Long[(c<<4)+d]>>>2]):(Zd(),e=Xe[2048-a._isRepG0[c]>>>2],1==b?e+=Xe[a._isRepG1[c]>>>2]:(e+=Xe[2048-a._isRepG1[c]>>>2],e+=ee(a._isRepG2[c],b-2))),e}function Pc(a,b,c){return Zd(),Xe[a._isRepG0[b]>>>2]+Xe[a._isRep0Long[(b<<4)+c]>>>2]}function Qc(a){var b;for(Fc(a),ce(a._rangeEncoder),fe(a._isMatch),fe(a._isRep0Long),fe(a._isRep),fe(a._isRepG0),fe(a._isRepG1),fe(a._isRepG2),fe(a._posEncoders),rd(a._literalEncoder),b=0;4>b;++b)Wd(a._posSlotEncoder[b].Models);fd(a._lenEncoder,1<<a._posStateBits),fd(a._repMatchLenEncoder,1<<a._posStateBits),Wd(a._posAlignEncoder.Models),a._longestMatchWasFound=!1,a._optimumEndIndex=0,a._optimumCurrentIndex=0,a._additionalOffset=0}function Rc(a,b){b>0&&(Jb(a._matchFinder,b),a._additionalOffset+=b)}function Sc(a){var b;return b=0,a._numDistancePairs=Eb(a._matchFinder,a._matchDistances),a._numDistancePairs>0&&(b=a._matchDistances[a._numDistancePairs-2],b==a._numFastBytes&&(b+=ub(a._matchFinder,b-1,a._matchDistances[a._numDistancePairs-1],273-b))),++a._additionalOffset,b}function Tc(a){a._matchFinder&&a._needReleaseMFStream&&(a._matchFinder._stream=null,a._needReleaseMFStream=!1)}function Uc(a){Tc(a),a._rangeEncoder.Stream=null}function Vc(a,b){var c;if(1>b||b>536870912)return!1;for(a._dictionarySize=b,c=0;b>1<<c;++c);return a._distTableSize=2*c,!0}function Wc(a,b,c,d){return 0>c||c>4||0>b||b>8||0>d||d>4?!1:(a._numLiteralPosStateBits=c,a._numLiteralContextBits=b,a._posStateBits=d,a._posStateMask=(1<<a._posStateBits)-1,!0)}function Xc(a,b){var c;return 0>b||b>2?!1:(c=a._matchFinderType,a._matchFinderType=b,a._matchFinder&&c!=a._matchFinderType&&(a._dictionarySizePrev=-1,a._matchFinder=null),!0)}function Yc(a,b){return 5>b||b>273?!1:(a._numFastBytes=b,!0)}function Zc(a,b){var c;for(a.properties[0]=9*(5*a._posStateBits+a._numLiteralPosStateBits)+a._numLiteralContextBits<<24>>24,c=0;4>c;++c)a.properties[1+c]=a._dictionarySize>>8*c<<24>>24;qa(b,a.properties,0,5)}function $c(a,b){var c;a._writeEndMark&&($d(a._rangeEncoder,a._isMatch,(a._state<<4)+b,1),$d(a._rangeEncoder,a._isRep,a._state,0),a._state=a._state<7?7:10,jd(a._lenEncoder,a._rangeEncoder,0,b),c=Wb(2),Ld(a._posSlotEncoder[c],a._rangeEncoder,63),_d(a._rangeEncoder,67108863,26),Nd(a._posAlignEncoder,a._rangeEncoder,15))}function _c(a){return 2048>a?We[a]:2097152>a?We[a>>10]+20:We[a>>20]+40}function ad(a){return 131072>a?We[a>>6]+12:134217728>a?We[a>>16]+32:We[a>>26]+52}function bd(){return Mf}function cd(){}function dd(a,b,c,d){8>c?($d(b,a._choice,0,0),Ld(a._lowCoder[d],b,c)):(c-=8,$d(b,a._choice,0,1),8>c?($d(b,a._choice,1,0),Ld(a._midCoder[d],b,c)):($d(b,a._choice,1,1),Ld(a._highCoder,b,c-8)))}function ed(a){var b;for(a._choice=s(Bf,0,-1,2,1),a._lowCoder=s(Jf,0,8,16,0),a._midCoder=s(Jf,0,8,16,0),a._highCoder=Kd(new Sd,8),b=0;16>b;++b)a._lowCoder[b]=Kd(new Sd,3),a._midCoder[b]=Kd(new Sd,3);return a}function fd(a,b){var c;for(fe(a._choice),c=0;b>c;++c)Wd(a._lowCoder[c].Models),Wd(a._midCoder[c].Models);Wd(a._highCoder.Models)}function gd(a,b,c,d,e){var f,g,h,i,j;for(Zd(),f=Xe[a._choice[0]>>>2],g=Xe[2048-a._choice[0]>>>2],h=g+Xe[a._choice[1]>>>2],i=g+Xe[2048-a._choice[1]>>>2],j=0,j=0;8>j;++j){if(j>=c)return;d[e+j]=f+Md(a._lowCoder[b],j)}for(;16>j;++j){if(j>=c)return;d[e+j]=h+Md(a._midCoder[b],j-8)}for(;c>j;++j)d[e+j]=i+Md(a._highCoder,j-8-8)}function hd(){return Qf}function id(){}function jd(a,b,c,d){dd(a,b,c,d),0==--a._counters[d]&&(gd(a,d,a._tableSize,a._prices,272*d),a._counters[d]=a._tableSize)}function kd(a){return ed(a),a._prices=s(tf,0,-1,4352,1),a._counters=s(tf,0,-1,16,1),a}function ld(a,b,c){return a._prices[272*c+b]}function md(a,b){var c;for(c=0;b>c;++c)gd(a,c,a._tableSize,a._prices,272*c),a._counters[c]=a._tableSize}function nd(){return Rf}function od(){}function pd(a,b,c){var d,e;if(null==a.m_Coders||a.m_NumPrevBits!=c||a.m_NumPosBits!=b)for(a.m_NumPosBits=b,a.m_PosMask=(1<<b)-1,a.m_NumPrevBits=c,e=1<<a.m_NumPrevBits+a.m_NumPosBits,a.m_Coders=s(Nf,0,5,e,0),d=0;e>d;++d)a.m_Coders[d]=wd(new zd)}function qd(a,b,c){return a.m_Coders[((b&a.m_PosMask)<<a.m_NumPrevBits)+((255&c)>>>8-a.m_NumPrevBits)]}function rd(a){var b,c;for(c=1<<a.m_NumPrevBits+a.m_NumPosBits,b=0;c>b;++b)fe(a.m_Coders[b].m_Encoders)}function sd(){return Of}function td(){}function ud(a,b,c){var d,e,f;for(e=1,f=7;f>=0;--f)d=c>>f&1,$d(b,a.m_Encoders,e,d),e=e<<1|d}function vd(a,b,c,d){var e,f,g,h,i,j;for(f=1,i=!0,g=7;g>=0;--g)e=d>>g&1,j=f,i&&(h=c>>g&1,j+=1+h<<8,i=h==e),$d(b,a.m_Encoders,j,e),f=f<<1|e}function wd(a){return a.m_Encoders=s(Bf,0,-1,768,1),a}function xd(a,b,c,d){var e,f,g,h,i;if(i=0,f=1,g=7,b)for(;g>=0;--g)if(h=c>>g&1,e=d>>g&1,i+=ee(a.m_Encoders[(1+h<<8)+f],e),f=f<<1|e,h!=e){--g;break}for(;g>=0;--g)e=d>>g&1,i+=ee(a.m_Encoders[f],e),f=f<<1|e;return i}function yd(){return Pf}function zd(){}function Ad(a){a.BackPrev=-1,a.Prev1IsChar=!1}function Bd(a){a.BackPrev=0,a.Prev1IsChar=!1}function Cd(){return Sf}function Dd(){}function Ed(a,b){return a.NumBitLevels=b,a.Models=s(Bf,0,-1,1<<b,1),a}function Fd(a,b){var c,d;for(d=1,c=a.NumBitLevels;0!=c;--c)d=(d<<1)+Td(b,a.Models,d);return d-(1<<a.NumBitLevels)}function Gd(a,b){var c,d,e,f;for(e=1,f=0,d=0;d<a.NumBitLevels;++d)c=Td(b,a.Models,e),e<<=1,e+=c,f|=c<<d;return f}function Hd(a,b,c,d){var e,f,g,h;for(g=1,h=0,f=0;d>f;++f)e=Td(c,a,b+g),g<<=1,g+=e,h|=e<<f;return h}function Id(){return Tf}function Jd(){}function Kd(a,b){return a.NumBitLevels=b,a.Models=s(Bf,0,-1,1<<b,1),a}function Ld(a,b,c){var d,e,f;for(f=1,e=a.NumBitLevels;0!=e;)--e,d=c>>>e&1,$d(b,a.Models,f,d),f=f<<1|d}function Md(a,b){var c,d,e,f;for(f=0,e=1,d=a.NumBitLevels;0!=d;)--d,c=b>>>d&1,f+=ee(a.Models[e],c),e=(e<<1)+c;return f}function Nd(a,b,c){var d,e,f;for(f=1,e=0;e<a.NumBitLevels;++e)d=1&c,$d(b,a.Models,f,d),f=f<<1|d,c>>=1}function Od(a,b){var c,d,e,f;for(f=0,e=1,d=a.NumBitLevels;0!=d;--d)c=1&b,b>>>=1,f+=ee(a.Models[e],c),e=e<<1|c;return f}function Pd(a,b,c,d,e){var f,g,h;for(h=1,g=0;d>g;++g)f=1&e,$d(c,a,b+h,f),h=h<<1|f,e>>=1}function Qd(a,b,c,d){var e,f,g,h;for(h=0,g=1,f=c;0!=f;--f)e=1&d,d>>>=1,Zd(),h+=Xe[(2047&(a[b+g]-e^-e))>>>2],g=g<<1|e;return h}function Rd(){return Uf}function Sd(){}function Td(a,b,c){var d,e;return e=b[c],d=(a.Range>>>11)*e,(-2147483648^a.Code)<(-2147483648^d)?(a.Range=d,b[c]=e+(2048-e>>>5)<<16>>16,0==(-16777216&a.Range)&&(a.Code=a.Code<<8|ga(a.Stream),a.Range<<=8),0):(a.Range-=d,a.Code-=d,b[c]=e-(e>>>5)<<16>>16,0==(-16777216&a.Range)&&(a.Code=a.Code<<8|ga(a.Stream),a.Range<<=8),1)}function Ud(a,b){var c,d,e;for(d=0,c=b;0!=c;--c)a.Range>>>=1,e=a.Code-a.Range>>>31,a.Code-=a.Range&e-1,d=d<<1|1-e,0==(-16777216&a.Range)&&(a.Code=a.Code<<8|ga(a.Stream),a.Range<<=8);return d}function Vd(a){var b;for(a.Code=0,a.Range=-1,b=0;5>b;++b)a.Code=a.Code<<8|ga(a.Stream)}function Wd(a){var b;for(b=0;b<a.length;++b)a[b]=1024}function Xd(){return Vf}function Yd(){}function Zd(){Zd=se;var a,b,c,d;for(Xe=s(tf,0,-1,512,1),b=8;b>=0;--b)for(d=1<<9-b-1,a=1<<9-b,c=d;a>c;++c)Xe[c]=(b<<6)+(a-c<<6>>>9-b-1)}function $d(a,b,c,d){var e,f;f=b[c],e=(a.Range>>>11)*f,0==d?(a.Range=e,b[c]=f+(2048-f>>>5)<<16>>16):(a.Low=F(a.Low,H(N(e),He)),a.Range-=e,b[c]=f-(f>>>5)<<16>>16),0==(-16777216&a.Range)&&(a.Range<<=8,de(a))}function _d(a,b,c){var d;for(d=c-1;d>=0;--d)a.Range>>>=1,1==(b>>>d&1)&&(a.Low=F(a.Low,N(a.Range))),0==(-16777216&a.Range)&&(a.Range<<=8,de(a))}function ae(a){var b;for(b=0;5>b;++b)de(a)}function be(a){return F(F(N(a._cacheSize),a._position),Ce)}function ce(a){a._position=Ae,a.Low=Ae,a.Range=-1,a._cacheSize=1,a._cache=0}function de(a){var b,c;if(b=P(X(a.Low,32)),0!=b||I(a.Low,Ge)<0){a._position=F(a._position,N(a._cacheSize)),c=a._cache;do pa(a.Stream,c+b),c=255;while(0!=--a._cacheSize);a._cache=P(a.Low)>>>24}++a._cacheSize,a.Low=V(H(a.Low,Ee),8)}function ee(a,b){return Zd(),Xe[(2047&(a-b^-b))>>>2]}function fe(a){Zd();var b;for(b=0;b<a.length;++b)a[b]=1024}function ge(){return Wf}function he(){}function ie(a){var b,c,d,e,f;for(b=Za(new _a),c=0;c<a.length;++c)if(d=255&a[c],0==(128&d)){if(0==d)throw La(new Na,"invalid UTF-8");o(b.data,String.fromCharCode(65535&d))}else if(192==(224&d)){if(c+1>=a.length)throw La(new Na,"invalid UTF-8");if(e=255&a[++c],128!=(192&e))throw La(new Na,"invalid UTF-8");n(b.data,String.fromCharCode((31&d)<<6&65535|63&e))}else{if(224!=(240&d))throw La(new Na,"invalid UTF-8");if(c+2>=a.length)throw La(new Na,"invalid UTF-8");if(e=255&a[++c],128!=(192&e))throw La(new Na,"invalid UTF-8");if(f=255&a[++c],128!=(192&f))throw La(new Na,"invalid UTF-8");o(b.data,String.fromCharCode(65535&((15&d)<<12|(63&e)<<6|63&f)))}return p(b.data)}function je(a){var b,c,d,e,f,g,h;for(h=a.length,g=s(nf,0,-1,h,1),Xa(a,0,h,g,0),c=g,e=0,f=0;f<a.length;++f)b=c[f],b>=1&&127>=b?++e:e+=0==b||b>=128&&2047>=b?2:3;for(d=s(ff,0,-1,e,1),e=0,f=0;f<a.length;++f)b=c[f],b>=1&&127>=b?d[e++]=b<<24>>24:0==b||b>=128&&2047>=b?(d[e++]=(192|b>>6&31)<<24>>24,d[e++]=(128|63&b)<<24>>24):(d[e++]=(224|b>>12&15)<<24>>24,d[e++]=(128|b>>6&63)<<24>>24,d[e++]=(128|63&b)<<24>>24);return d}function ke(a){return a}function le(a){return a[1]+a[0]}function me(){function b(){var i;for(d=(new Date).getTime();eb(h.c);)if(c=le(h.c.chunker.inBytesProcessed)/le(h.c.length_0),(new Date).getTime()-d>200)return g?g(c):"undefined"!=typeof e&&a(c,e),setTimeout(b,0),!1;g?g(1):"undefined"!=typeof e&&a(1,e),i=oa(h.c.output).slice(0),f?f(i):"undefined"!=typeof e&&postMessage({action:we,callback_num:e,result:i})}var c,d,e,f,g,h=ke(new pe),i=arguments[0],j=arguments[1];"function"==typeof arguments[2]?(f=arguments[2],"function"==typeof arguments[3]&&(g=arguments[3])):e=arguments[2],h.mode=bg(j),h.c=ib(new kb,je(i),h.mode),g?g(0):"undefined"!=typeof e&&a(0,e),setTimeout(b,1)}function ne(){function b(){var d;for(e=(new Date).getTime();lb(i.d);)if(c=le(i.d.chunker.decoder.nowPos64)/le(i.d.length_0),(new Date).getTime()-e>200)return h?h(c):"undefined"!=typeof f&&a(c,f),setTimeout(b,0),!1;h?h(1):"undefined"!=typeof f&&a(1,f),d=ie(oa(i.d.output)),g?g(d):"undefined"!=typeof f&&postMessage({action:xe,callback_num:f,result:d})}var c,d,e,f,g,h,i=ke(new pe),j=arguments[0];"function"==typeof arguments[1]?(g=arguments[1],"function"==typeof arguments[2]&&(h=arguments[2])):f=arguments[1],d=t(ff,0,-1,j),i.d=pb(new rb,d),h?h(0):"undefined"!=typeof f&&a(0,f),setTimeout(b,0)}function oe(){return ag}function pe(){}function qe(){!!$stats&&$stats({moduleName:te,subSystem:"startup",evtGroup:"moduleStartup",millis:(new Date).getTime(),type:"onModuleLoadStart",className:"org.dellroad.lzma.demo.client.LZMADemo"})}function re(a,b,c){if(te=b,ue=c,a)try{qe()}catch(d){a(b)}else qe()}function se(){}var te,ue,ve,we=1,xe=2,ye=[0,-0x8000000000000000],ze=[4294967295,-4294967296],Ae=[0,0],Be=[1,0],Ce=[4,0],De=[4096,0],Ee=[16777215,0],Fe=[16777216,0],Ge=[4278190080,0],He=[4294967295,0],Ie=[4294967295,0x7fffffff00000000];ve=c.prototype={},ve.getClass$=b,ve.typeMarker$=se,ve.typeId$=1,ve=e.prototype=new c,ve.getClass$=d,ve.typeId$=3,ve.detailMessage=null,ve=g.prototype=new e,ve.getClass$=f,ve.typeId$=4,ve=j.prototype=new g,ve.getClass$=i,ve.typeId$=5,ve=m.prototype=new j,ve.getClass$=l,ve.typeId$=6,ve=v.prototype=new c,ve.getClass$=r,ve.typeId$=0,ve.arrayClass$=null,ve.length=0,ve.queryId$=0;var Je,Ke,Le,Me,Ne,Oe,Pe,Qe,Re,Se,Te,Ue=[{},{},{1:1},{2:1},{2:1},{2:1},{2:1},{2:1,10:1},{2:1},{2:1},{2:1},{2:1},{2:1},{2:1,11:1},{2:1},{2:1},{2:1},{4:1},{5:1},{6:1},{7:1},{8:1},{9:1}];ve=da.prototype=new c,ve.getClass$=ca,ve.typeId$=0,ve=ja.prototype=new da,ve.getClass$=ia,ve.typeId$=0,ve.buf=null,ve.count=0,ve.pos=0,ve=la.prototype=new c,ve.getClass$=ka,ve.typeId$=0,ve=sa.prototype=new la,ve.getClass$=ra,ve.typeId$=0,ve.buf=null,ve.count=0,ve=va.prototype=new g,ve.getClass$=ua,ve.typeId$=7,ve=ya.prototype=new j,ve.getClass$=xa,ve.typeId$=8,ve=Ba.prototype=new j,ve.getClass$=Aa,ve.typeId$=9,ve=Ga.prototype=new c,ve.getClass$=Fa,ve.typeId$=0,ve.typeName=null,ve=Ia.prototype=new j,ve.getClass$=Ha,ve.typeId$=12,ve=Ka.prototype=new c,ve.getClass$=Ja,ve.typeId$=0,ve=Na.prototype=new j,ve.getClass$=Ma,ve.typeId$=13,ve=Pa.prototype=new j,ve.getClass$=Oa,ve.typeId$=14,ve=Ra.prototype=new j,ve.getClass$=Qa,ve.typeId$=15,ve=Va.prototype=new j,ve.getClass$=Ua,ve.typeId$=16,ve=String.prototype,ve.getClass$=Ya,ve.typeId$=2,ve=_a.prototype=new c,ve.getClass$=$a,ve.typeId$=0,ve=db.prototype=new Ka,ve.getClass$=cb,ve.typeId$=0,ve.dictionarySize=0,ve.fb=0,ve.lc=0,ve.lp=0,ve.matchFinder=0,ve.pb=0,ve=hb.prototype=new c,ve.getClass$=gb,ve.typeId$=0,ve.chunker=null,ve=kb.prototype=new hb,ve.getClass$=jb,ve.typeId$=0,ve.output=null,ve=ob.prototype=new c,ve.getClass$=nb,ve.typeId$=0,ve.chunker=null,ve.exception=null,ve.length_0=Ae,ve=rb.prototype=new ob,ve.getClass$=qb,ve.typeId$=0,ve.output=null,ve=Bb.prototype=new c,ve.getClass$=Ab,ve.typeId$=0,ve._blockSize=0,ve._bufferBase=null,ve._bufferOffset=0,ve._keepSizeAfter=0,ve._keepSizeBefore=0,ve._pointerToLastSafePosition=0,ve._pos=0,ve._posLimit=0,ve._stream=null,ve._streamEndWasReached=!1,ve._streamPos=0,ve=Lb.prototype=new Bb,ve.getClass$=Kb,ve.typeId$=0,ve.HASH_ARRAY=!0,ve._cutValue=255,ve._cyclicBufferPos=0,ve._cyclicBufferSize=0,ve._hash=null,ve._hashMask=0,ve._hashSizeSum=0,ve._matchMaxLen=0,ve._son=null,ve.kFixHashSize=66560,ve.kMinMatchCheck=4,ve.kNumHashDirectBytes=0;var Ve;ve=Vb.prototype=new c,ve.getClass$=Ub,ve.typeId$=0,ve._buffer=null,ve._pos=0,ve._stream=null,ve._streamPos=0,ve._windowSize=0,ve=cc.prototype=new c,ve.getClass$=bc,ve.typeId$=0,ve.alive=!1,ve.decoder=null,ve.encoder=null,ve=mc.prototype=new c,ve.getClass$=lc,ve.typeId$=0,ve.m_DictionarySize=-1,ve.m_DictionarySizeCheck=-1,ve.m_PosStateMask=0,ve.nowPos64=Ae,ve.outSize=Ae,ve.prevByte=0,ve.rep0=0,ve.rep1=0,ve.rep2=0,ve.rep3=0,ve.state=0,ve=sc.prototype=new c,ve.getClass$=rc,ve.typeId$=0,ve.m_NumPosStates=0,ve=xc.prototype=new c,ve.getClass$=wc,ve.typeId$=0,ve.m_Coders=null,ve.m_NumPosBits=0,ve.m_NumPrevBits=0,ve.m_PosMask=0,ve=Cc.prototype=new c,ve.getClass$=Bc,ve.typeId$=17,ve=cd.prototype=new c,ve.getClass$=bd,ve.typeId$=0,ve._additionalOffset=0,ve._alignPriceCount=0,ve._dictionarySize=4194304,ve._dictionarySizePrev=-1,ve._distTableSize=44,ve._finished=!1,ve._inStream=null,ve._longestMatchLength=0,ve._longestMatchWasFound=!1,ve._matchFinder=null,ve._matchFinderType=1,ve._matchPriceCount=0,ve._needReleaseMFStream=!1,ve._numDistancePairs=0,ve._numFastBytes=32,ve._numFastBytesPrev=-1,ve._numLiteralContextBits=3,ve._numLiteralPosStateBits=0,ve._optimumCurrentIndex=0,ve._optimumEndIndex=0,ve._posStateBits=2,ve._posStateMask=3,ve._previousByte=0,ve._state=0,ve._writeEndMark=!1,ve.backRes=0,ve.nowPos64=Ae;var We;ve=id.prototype=new c,ve.getClass$=hd,ve.typeId$=0,ve=od.prototype=new id,ve.getClass$=nd,ve.typeId$=0,ve._tableSize=0,ve=td.prototype=new c,ve.getClass$=sd,ve.typeId$=0,ve.m_Coders=null,ve.m_NumPosBits=0,ve.m_NumPrevBits=0,
ve.m_PosMask=0,ve=zd.prototype=new c,ve.getClass$=yd,ve.typeId$=18,ve=Dd.prototype=new c,ve.getClass$=Cd,ve.typeId$=19,ve.BackPrev=0,ve.BackPrev2=0,ve.Backs0=0,ve.Backs1=0,ve.Backs2=0,ve.Backs3=0,ve.PosPrev=0,ve.PosPrev2=0,ve.Prev1IsChar=!1,ve.Prev2=!1,ve.Price=0,ve.State=0,ve=Jd.prototype=new c,ve.getClass$=Id,ve.typeId$=20,ve.Models=null,ve.NumBitLevels=0,ve=Sd.prototype=new c,ve.getClass$=Rd,ve.typeId$=21,ve.Models=null,ve.NumBitLevels=0,ve=Yd.prototype=new c,ve.getClass$=Xd,ve.typeId$=0,ve.Code=0,ve.Range=0,ve.Stream=null,ve=he.prototype=new c,ve.getClass$=ge,ve.typeId$=0,ve.Low=Ae,ve.Range=0,ve.Stream=null,ve._cache=0,ve._cacheSize=0,ve._position=Ae;var Xe;ve=pe.prototype=new c,ve.getClass$=oe,ve.typeId$=0,ve.c=null,ve.d=null;var Ye=Da("java.lang.","Object"),Ze=Da("java.lang.","Throwable"),$e=Da("java.lang.","Exception"),_e=Da("java.lang.","RuntimeException"),af=Da("com.google.gwt.core.client.","JavaScriptException"),bf=Da("com.google.gwt.core.client.","JavaScriptObject$"),cf=Ca("","[[D"),df=Da("java.io.","InputStream"),ef=Da("java.io.","ByteArrayInputStream"),ff=Ca("","[B"),gf=Da("java.io.","OutputStream"),hf=Da("java.io.","ByteArrayOutputStream"),jf=Da("java.io.","IOException"),kf=Da("java.lang.","Enum"),lf=Da("java.lang.","ArithmeticException"),mf=Da("java.lang.","ArrayStoreException"),nf=Ca("","[C"),of=Da("java.lang.","Class"),pf=Da("java.lang.","ClassCastException"),qf=Da("java.lang.","IllegalArgumentException"),rf=Da("java.lang.","IllegalStateException"),sf=Da("java.lang.","IndexOutOfBoundsException"),tf=Ca("","[I"),uf=Da("java.lang.","NullPointerException"),vf=Da("java.lang.","String"),wf=Da("java.lang.","StringBuilder"),xf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZ.","InWindow"),yf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZ.","BinTree"),zf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZ.","OutWindow"),Af=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Chunker"),Bf=Ca("","[S"),Cf=Ca("[Lorg.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeDecoder;"),Df=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder"),Ef=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LenDecoder"),Ff=Ca("[Lorg.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LiteralDecoder$Decoder2;"),Gf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LiteralDecoder"),Hf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Decoder$LiteralDecoder$Decoder2"),If=Ca("[Lorg.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$Optimal;"),Jf=Ca("[Lorg.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeEncoder;"),Kf=Ca("","[J"),Lf=Ca("","[Z"),Mf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder"),Nf=Ca("[Lorg.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LiteralEncoder$Encoder2;"),Of=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LiteralEncoder"),Pf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LiteralEncoder$Encoder2"),Qf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LenEncoder"),Rf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$LenPriceTableEncoder"),Sf=Da("org.dellroad.lzma.client.SevenZip.Compression.LZMA.","Encoder$Optimal"),Tf=Da("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeDecoder"),Uf=Da("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","BitTreeEncoder"),Vf=Da("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","Decoder"),Wf=Da("org.dellroad.lzma.client.SevenZip.Compression.RangeCoder.","Encoder"),Xf=Ea("org.dellroad.lzma.client.","CompressionMode"),Yf=Da("org.dellroad.lzma.client.","LZMACompressor"),Zf=Da("org.dellroad.lzma.client.","LZMAByteArrayCompressor"),$f=Da("org.dellroad.lzma.client.","LZMADecompressor"),_f=Da("org.dellroad.lzma.client.","LZMAByteArrayDecompressor"),ag=Da("org.dellroad.lzma.demo.client.","LZMADemo");re(function(){},"lzma_demo","");var bg=function(){function a(a){return!isNaN(parseFloat(a))&&isFinite(a)}var b=[{dictionarySize:16,fb:64,matchFinder:0,lc:3,lp:0,pb:2},{dictionarySize:20,fb:64,matchFinder:0,lc:3,lp:0,pb:2},{dictionarySize:19,fb:64,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:20,fb:64,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:21,fb:128,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:22,fb:128,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:23,fb:128,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:24,fb:255,matchFinder:1,lc:3,lp:0,pb:2},{dictionarySize:25,fb:255,matchFinder:1,lc:3,lp:0,pb:2}];return function(c){return a(c)?1>c?c=1:c>9&&(c=9):c=1,b[c-1]}}();return{compress:me,decompress:ne}}();this.LZMA=f,e("undefined"!=typeof f?f:window.LZMA)}).call(a,void 0,void 0,void 0,void 0,function(a){b.exports=a})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],319:[function(a,b,c){(function(c){jQuery=c.jQuery=a("jquery");(function(a,b,c){!function(a){function b(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=0,g=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),g=e,void 0!==c.axis&&c.axis===c.HORIZONTAL_AXIS&&(g=0,f=-1*e),void 0!==c.wheelDeltaY&&(g=c.wheelDeltaY/120),void 0!==c.wheelDeltaX&&(f=-1*c.wheelDeltaX/120),d.unshift(b,e,f,g),(a.event.dispatch||a.event.handle).apply(this,d)}var c=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var d=c.length;d;)a.event.fixHooks[c[--d]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=c.length;a;)this.addEventListener(c[--a],b,!1);else this.onmousewheel=b},teardown:function(){if(this.removeEventListener)for(var a=c.length;a;)this.removeEventListener(c[--a],b,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}(jQuery)}).call(c,b,void 0,void 0)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{jquery:57}],320:[function(a,b,c){(function(c){jQuery=c.jQuery=a("jquery");(function(a,b,c){!function(a){function b(){this===e.elem&&(e.pos=[-260,-260],e.elem=!1,f=3)}var c,d,e={pos:[-260,-260]},f=3,g=document,h=g.documentElement,i=g.body;a.event.special.mwheelIntent={setup:function(){var c=a(this).on("mousewheel",a.event.special.mwheelIntent.handler);return this!==g&&this!==h&&this!==i&&c.on("mouseleave",b),c=null,!0},teardown:function(){return a(this).off("mousewheel",a.event.special.mwheelIntent.handler).off("mouseleave",b),!0},handler:function(b,g){var h=[b.clientX,b.clientY];return this===e.elem||Math.abs(e.pos[0]-h[0])>f||Math.abs(e.pos[1]-h[1])>f?(e.elem=this,e.pos=h,f=250,clearTimeout(d),d=setTimeout(function(){f=10},200),clearTimeout(c),c=setTimeout(function(){f=3},1500),b=a.extend({},b,{type:"mwheelIntent"}),a.event.dispatch.apply(this,arguments)):void 0}},a.fn.extend({mwheelIntent:function(a){return a?this.on("mwheelIntent",a):this.trigger("mwheelIntent")},unmwheelIntent:function(a){return this.off("mwheelIntent",a)}}),a(function(){i=g.body,a(g).on("mwheelIntent.mwheelIntentDefault",a.noop)})}(jQuery)}).call(c,b,void 0,void 0)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{jquery:57}],321:[function(require,module,exports){(function(global){var __browserify_shim_require__=require;(function browserifyShim(module,exports,require,define,browserify_shim__define__module__export__){!function(a,b,c){b[a]=c(a,b)}("bean",this,function(a,b){var c=window,d=b[a],e=/over|out/,f=/[^\.]*(?=\..*)\.|.*/,g=/\..*/,h="addEventListener",i="attachEvent",j="removeEventListener",k="detachEvent",l=document||{},m=l.documentElement||{},n=m[h],o=n?h:i,p=Array.prototype.slice,q=/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,r=/mouse.*(wheel|scroll)/i,s=/^text/i,t=/^touch|^gesture/i,u={one:1},v=function(a,b,c){for(c=0;c<b.length;c++)a[b[c]]=1;return a}({},("click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange error abort scroll "+(n?"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend MSPointerUp MSPointerDown MSPointerCancel MSPointerMove MSPointerOver MSPointerOut pointerup pointerdown pointermove pointercancelmessage readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete ":"")).split(" ")),w=function(){function a(a,b){for(;null!==(b=b.parentNode);)if(b===a)return!0;return!1}function b(b){var c=b.relatedTarget;return c?c!==this&&"xul"!==c.prefix&&!/document/.test(this.toString())&&!a(this,c):null===c}return{mouseenter:{base:"mouseover",condition:b},mouseleave:{base:"mouseout",condition:b},mousewheel:{base:/Firefox/.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel"}}}(),x=function(){var a="altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which".split(" "),b=a.concat("button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" ")),c=b.concat("wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis".split(" ")),d=a.concat("char charCode key keyCode keyIdentifier keyLocation".split(" ")),f=a.concat(["data"]),g=a.concat("touches targetTouches changedTouches scale rotation".split(" ")),h="preventDefault",i=function(a){return function(){a[h]?a[h]():a.returnValue=!1}},j="stopPropagation",k=function(a){return function(){a[j]?a[j]():a.cancelBubble=!0}},n=function(a){return function(){a[h](),a[j](),a.stopped=!0}},o=function(a,b,c){var d,e;for(d=c.length;d--;)e=c[d],!(e in b)&&e in a&&(b[e]=a[e])};return function(p,u){var v={originalEvent:p,isNative:u};if(!p)return v;var w,x=p.type,y=p.target||p.srcElement;return v[h]=i(p),v[j]=k(p),v.stop=n(v),v.target=y&&3===y.nodeType?y.parentNode:y,u&&(-1!==x.indexOf("key")?(w=d,v.keyCode=p.which||p.keyCode):q.test(x)?(w=b,v.rightClick=3===p.which||2===p.button,v.pos={x:0,y:0},p.pageX||p.pageY?(v.clientX=p.pageX,v.clientY=p.pageY):(p.clientX||p.clientY)&&(v.clientX=p.clientX+l.body.scrollLeft+m.scrollLeft,v.clientY=p.clientY+l.body.scrollTop+m.scrollTop),e.test(x)&&(v.relatedTarget=p.relatedTarget||p[("mouseover"===x?"from":"to")+"Element"])):t.test(x)?w=g:r.test(x)?w=c:s.test(x)&&(w=f),o(p,v,w||a)),v}}(),y=function(a,b){return n||b||a!==l&&a!==c?a:m},z=function(){function a(a,b,c,d,e){this.element=a,this.type=b,this.handler=c,this.original=d,this.namespaces=e,this.custom=w[b],this.isNative=v[b]&&a[o],this.eventType=n||this.isNative?b:"propertychange",this.customType=!n&&!this.isNative&&b,this.target=y(a,this.isNative),this.eventSupport=this.target[o]}return a.prototype={inNamespaces:function(a){var b,c;if(!a)return!0;if(!this.namespaces)return!1;for(b=a.length;b--;)for(c=this.namespaces.length;c--;)if(a[b]===this.namespaces[c])return!0;return!1},matches:function(a,b,c){return!(this.element!==a||b&&this.original!==b||c&&this.handler!==c)}},a}(),A=function(){var a={},b=function(c,d,e,f,g){if(d&&"*"!==d){var h,i=0,j=a["$"+d],k="*"===c;if(!j)return;for(h=j.length;h>i;i++)if((k||j[i].matches(c,e,f))&&!g(j[i],j,i,d))return}else for(var l in a)"$"===l.charAt(0)&&b(c,l.substr(1),e,f,g)},c=function(b,c,d){var e,f=a["$"+c];if(f)for(e=f.length;e--;)if(f[e].matches(b,d,null))return!0;return!1},d=function(a,c,d){var e=[];return b(a,c,d,null,function(a){return e.push(a)}),e},e=function(b){return(a["$"+b.type]||(a["$"+b.type]=[])).push(b),b},f=function(c){b(c.element,c.type,null,c.handler,function(b,c,d){return c.splice(d,1),0===c.length&&delete a["$"+b.type],!1})},g=function(){var b,c=[];for(b in a)"$"===b.charAt(0)&&(c=c.concat(a[b]));return c};return{has:c,get:d,put:e,del:f,entries:g}}(),B=n?function(a,b,c,d){a[d?h:j](b,c,!1)}:function(a,b,c,d,e){e&&d&&null===a["_on"+e]&&(a["_on"+e]=0),a[d?i:k]("on"+b,c)},C=function(a,b,d){return function(e){return e=x(e||((this.ownerDocument||this.document||this).parentWindow||c).event,!0),b.apply(a,[e].concat(d))}},D=function(a,b,d,e,f,g){return function(h){(e?e.apply(this,arguments):n?!0:h&&h.propertyName==="_on"+d||!h)&&(h&&(h=x(h||((this.ownerDocument||this.document||this).parentWindow||c).event,g)),b.apply(a,!h||f&&0!==f.length?p.call(arguments,h?0:1).concat(f):arguments))}},E=function(a,b,c,d,e){return function(){a(b,c,e),d.apply(this,arguments)}},F=function(a,b,c,d){var e,f,h,i=b&&b.replace(g,""),j=A.get(a,i,c);for(e=0,f=j.length;f>e;e++)j[e].inNamespaces(d)&&((h=j[e]).eventSupport&&B(h.target,h.eventType,h.handler,!1,h.type),A.del(h))},G=function(a,b,c,d,e){var h,i=b.replace(g,""),j=b.replace(f,"").split(".");return A.has(a,i,c)?a:("unload"===i&&(c=E(F,a,i,c,d)),w[i]&&(w[i].condition&&(c=D(a,c,i,w[i].condition,!0)),i=w[i].base||i),h=A.put(new z(a,i,c,d,j[0]&&j)),h.handler=h.isNative?C(a,h.handler,e):D(a,h.handler,i,!1,e,!1),void(h.eventSupport&&B(h.target,h.eventType,h.handler,!0,h.customType)))},H=function(a,b,c){return function(d){var e,f,g="string"==typeof a?c(a,this):a;for(e=d.target;e&&e!==this;e=e.parentNode)for(f=g.length;f--;)if(g[f]===e)return b.apply(e,arguments)}},I=function(a,b,c){var d,e,h,i,j=F,k=b&&"string"==typeof b;if(k&&b.indexOf(" ")>0){for(b=b.split(" "),i=b.length;i--;)I(a,b[i],c);return a}if(e=k&&b.replace(g,""),e&&w[e]&&(e=w[e].type),!b||k)(h=k&&b.replace(f,""))&&(h=h.split(".")),j(a,e,c,h);else if("function"==typeof b)j(a,null,b);else for(d in b)b.hasOwnProperty(d)&&I(a,d,b[d]);return a},J=function(a,b,c,d,e){var f,g,h,i,j=c,k=c&&"string"==typeof c;if(b&&!c&&"object"==typeof b)for(f in b)b.hasOwnProperty(f)&&J.apply(this,[a,f,b[f]]);else for(i=arguments.length>3?p.call(arguments,3):[],g=(k?c:b).split(" "),k&&(c=H(b,j=d,e))&&(i=p.call(i,1)),this===u&&(c=E(I,a,b,c,j)),h=g.length;h--;)G(a,g[h],c,j,i);return a},K=function(){return J.apply(u,arguments)},L=n?function(a,b,d){var e=l.createEvent(a?"HTMLEvents":"UIEvents");e[a?"initEvent":"initUIEvent"](b,!0,!0,c,1),d.dispatchEvent(e)}:function(a,b,c){c=y(c,a),a?c.fireEvent("on"+b,l.createEventObject()):c["_on"+b]++},M=function(a,b,c){var d,e,h,i,j,k=b.split(" ");for(d=k.length;d--;)if(b=k[d].replace(g,""),(i=k[d].replace(f,""))&&(i=i.split(".")),i||c||!a[o])for(j=A.get(a,b),c=[!1].concat(c),e=0,h=j.length;h>e;e++)j[e].inNamespaces(i)&&j[e].handler.apply(a,c);else L(v[b],b,a);return a},N=function(a,b,c){for(var d=0,e=A.get(b,c),f=e.length;f>d;d++)e[d].original&&J(a,e[d].type,e[d].original);return a},O={add:J,one:K,remove:I,clone:N,fire:M,noConflict:function(){return b[a]=d,this}};if(c[i]){var P=function(){var a,b=A.entries();for(a in b)b[a].type&&"unload"!==b[a].type&&I(b[a].element,b[a].type);c[k]("onunload",P),c.CollectGarbage&&c.CollectGarbage()};c[i]("onunload",P)}return O});var html4={};html4.atype={NONE:0,URI:1,URI_FRAGMENT:11,SCRIPT:2,STYLE:3,ID:4,IDREF:5,IDREFS:6,GLOBAL_NAME:7,LOCAL_NAME:8,CLASSES:9,FRAME_TARGET:10},html4.ATTRIBS={"*::class":9,"*::dir":0,"*::id":4,"*::lang":0,"*::onclick":2,"*::ondblclick":2,"*::onkeydown":2,"*::onkeypress":2,"*::onkeyup":2,"*::onload":2,"*::onmousedown":2,"*::onmousemove":2,"*::onmouseout":2,"*::onmouseover":2,"*::onmouseup":2,"*::style":3,"*::title":0,"a::accesskey":0,"a::coords":0,"a::href":1,"a::hreflang":0,"a::name":7,"a::onblur":2,"a::onfocus":2,"a::rel":0,"a::rev":0,"a::shape":0,"a::tabindex":0,"a::target":10,"a::type":0,"area::accesskey":0,"area::alt":0,"area::coords":0,"area::href":1,"area::nohref":0,"area::onblur":2,"area::onfocus":2,"area::shape":0,"area::tabindex":0,"area::target":10,"bdo::dir":0,"blockquote::cite":1,"br::clear":0,"button::accesskey":0,"button::disabled":0,"button::name":8,"button::onblur":2,"button::onfocus":2,"button::tabindex":0,"button::type":0,"button::value":0,"canvas::height":0,"canvas::width":0,"caption::align":0,"col::align":0,"col::char":0,"col::charoff":0,"col::span":0,"col::valign":0,"col::width":0,"colgroup::align":0,"colgroup::char":0,"colgroup::charoff":0,"colgroup::span":0,"colgroup::valign":0,"colgroup::width":0,"del::cite":1,"del::datetime":0,"dir::compact":0,"div::align":0,"dl::compact":0,"font::color":0,"font::face":0,"font::size":0,"form::accept":0,"form::action":1,"form::autocomplete":0,"form::enctype":0,"form::method":0,"form::name":7,"form::onreset":2,"form::onsubmit":2,"form::target":10,"h1::align":0,"h2::align":0,"h3::align":0,"h4::align":0,"h5::align":0,"h6::align":0,"hr::align":0,"hr::noshade":0,"hr::size":0,"hr::width":0,"iframe::align":0,"iframe::frameborder":0,"iframe::height":0,"iframe::marginheight":0,"iframe::marginwidth":0,"iframe::width":0,"img::align":0,"img::alt":0,"img::border":0,"img::height":0,"img::hspace":0,"img::ismap":0,"img::name":7,"img::src":1,"img::usemap":11,"img::vspace":0,"img::width":0,"input::accept":0,"input::accesskey":0,"input::align":0,"input::alt":0,"input::autocomplete":0,"input::checked":0,"input::disabled":0,"input::ismap":0,"input::maxlength":0,"input::name":8,"input::onblur":2,"input::onchange":2,"input::onfocus":2,"input::onselect":2,"input::readonly":0,"input::size":0,"input::src":1,"input::tabindex":0,"input::type":0,"input::usemap":11,"input::value":0,"ins::cite":1,"ins::datetime":0,"label::accesskey":0,"label::for":5,"label::onblur":2,"label::onfocus":2,"legend::accesskey":0,"legend::align":0,"li::type":0,"li::value":0,"map::name":7,"menu::compact":0,"ol::compact":0,"ol::start":0,"ol::type":0,"optgroup::disabled":0,"optgroup::label":0,"option::disabled":0,"option::label":0,"option::selected":0,"option::value":0,"p::align":0,"pre::width":0,"q::cite":1,"select::disabled":0,"select::multiple":0,"select::name":8,"select::onblur":2,"select::onchange":2,"select::onfocus":2,"select::size":0,"select::tabindex":0,"table::align":0,"table::bgcolor":0,"table::border":0,"table::cellpadding":0,"table::cellspacing":0,"table::frame":0,"table::rules":0,"table::summary":0,"table::width":0,"tbody::align":0,"tbody::char":0,"tbody::charoff":0,"tbody::valign":0,"td::abbr":0,"td::align":0,"td::axis":0,"td::bgcolor":0,"td::char":0,"td::charoff":0,"td::colspan":0,"td::headers":6,"td::height":0,"td::nowrap":0,"td::rowspan":0,"td::scope":0,"td::valign":0,"td::width":0,"textarea::accesskey":0,"textarea::cols":0,"textarea::disabled":0,"textarea::name":8,"textarea::onblur":2,"textarea::onchange":2,"textarea::onfocus":2,"textarea::onselect":2,"textarea::readonly":0,"textarea::rows":0,"textarea::tabindex":0,"tfoot::align":0,"tfoot::char":0,"tfoot::charoff":0,"tfoot::valign":0,"th::abbr":0,"th::align":0,"th::axis":0,"th::bgcolor":0,"th::char":0,"th::charoff":0,"th::colspan":0,"th::headers":6,"th::height":0,"th::nowrap":0,"th::rowspan":0,"th::scope":0,"th::valign":0,"th::width":0,"thead::align":0,"thead::char":0,"thead::charoff":0,"thead::valign":0,"tr::align":0,"tr::bgcolor":0,"tr::char":0,"tr::charoff":0,"tr::valign":0,"ul::compact":0,"ul::type":0},html4.eflags={OPTIONAL_ENDTAG:1,EMPTY:2,CDATA:4,RCDATA:8,UNSAFE:16,FOLDABLE:32,SCRIPT:64,STYLE:128},html4.ELEMENTS={a:0,abbr:0,acronym:0,address:0,applet:16,area:2,b:0,base:18,basefont:18,bdo:0,big:0,blockquote:0,body:49,br:2,button:0,canvas:0,caption:0,center:0,cite:0,code:0,col:2,colgroup:1,dd:1,del:0,dfn:0,dir:0,div:0,dl:0,dt:1,em:0,fieldset:0,font:0,form:0,frame:18,frameset:16,h1:0,h2:0,h3:0,h4:0,h5:0,h6:0,head:49,hr:2,html:49,i:0,iframe:4,img:2,input:2,ins:0,isindex:18,kbd:0,label:0,legend:0,li:1,link:18,map:0,menu:0,meta:18,nobr:0,noembed:4,noframes:20,noscript:20,object:16,ol:0,optgroup:0,option:1,p:1,param:18,pre:0,q:0,s:0,samp:0,script:84,select:0,small:0,span:0,strike:0,strong:0,style:148,sub:0,sup:0,table:0,tbody:1,td:1,textarea:8,tfoot:1,th:1,thead:1,title:24,tr:1,tt:0,u:0,ul:0,"var":0},html4.ueffects={NOT_LOADED:0,SAME_DOCUMENT:1,NEW_DOCUMENT:2},html4.URIEFFECTS={"a::href":2,"area::href":2,"blockquote::cite":0,"body::background":1,"del::cite":0,"form::action":2,"img::src":1,"input::src":1,"ins::cite":0,"q::cite":0},html4.ltypes={UNSANDBOXED:2,SANDBOXED:1,DATA:0},html4.LOADERTYPES={"a::href":2,"area::href":2,"blockquote::cite":2,"body::background":1,"del::cite":2,"form::action":2,"img::src":1,"input::src":1,"ins::cite":2,"q::cite":2};var html=function(a){function b(a){if(a=k(a),l.hasOwnProperty(a))return l[a];var b=a.match(n);return b?String.fromCharCode(parseInt(b[1],10)):(b=a.match(o))?String.fromCharCode(parseInt(b[1],16)):""}function c(a,c){return b(c)}function d(a){return a.replace(p,"")}function e(a){return a.replace(q,c)}function f(a){return a.replace(r,"&amp;").replace(t,"&lt;").replace(u,"&gt;").replace(v,"&#34;").replace(w,"&#61;")}function g(a){return a.replace(s,"&amp;$1").replace(t,"&lt;").replace(u,"&gt;")}function h(b){return function(c,f){c=String(c);var h=null,i=!1,j=[],l=void 0,m=void 0,n=void 0;for(b.startDoc&&b.startDoc(f);c;){var o=c.match(i?x:y);if(c=c.substring(o[0].length),i){if(o[1]){var p,q=k(o[1]);if(o[2]){var r=o[3];switch(r.charCodeAt(0)){case 34:case 39:r=r.substring(1,r.length-1)}p=e(d(r))}else p=q;j.push(q,p)}else if(o[4]){if(void 0!==m&&(n?b.startTag&&b.startTag(l,j,f):b.endTag&&b.endTag(l,f)),n&&m&(a.eflags.CDATA|a.eflags.RCDATA)){h=null===h?k(c):h.substring(h.length-c.length);var s=h.indexOf("</"+l);0>s&&(s=c.length),s&&(m&a.eflags.CDATA?b.cdata&&b.cdata(c.substring(0,s),f):b.rcdata&&b.rcdata(g(c.substring(0,s)),f),c=c.substring(s))}l=m=n=void 0,j.length=0,i=!1}}else if(o[1])b.pcdata&&b.pcdata(o[0],f);else if(o[3])n=!o[2],i=!0,l=k(o[3]),m=a.ELEMENTS.hasOwnProperty(l)?a.ELEMENTS[l]:void 0;else if(o[4])b.pcdata&&b.pcdata(o[4],f);else if(o[5]&&b.pcdata){var t=o[5];b.pcdata("<"===t?"&lt;":">"===t?"&gt;":"&amp;",f)}}b.endDoc&&b.endDoc(f)}}function i(b){var c,d;return h({startDoc:function(a){c=[],d=!1},startTag:function(e,g,h){if(!d&&a.ELEMENTS.hasOwnProperty(e)){var i=a.ELEMENTS[e];if(!(i&a.eflags.FOLDABLE)){if(i&a.eflags.UNSAFE)return void(d=!(i&a.eflags.EMPTY));if(g=b(e,g)){i&a.eflags.EMPTY||c.push(e),h.push("<",e);for(var j=0,k=g.length;k>j;j+=2){var l=g[j],m=g[j+1];null!==m&&void 0!==m&&h.push(" ",l,'="',f(m),'"')}h.push(">")}}}},endTag:function(b,e){if(d)return void(d=!1);if(a.ELEMENTS.hasOwnProperty(b)){var f=a.ELEMENTS[b];if(!(f&(a.eflags.UNSAFE|a.eflags.EMPTY|a.eflags.FOLDABLE))){var g;if(f&a.eflags.OPTIONAL_ENDTAG)for(g=c.length;--g>=0;){var h=c[g];if(h===b)break;if(!(a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG))return}else for(g=c.length;--g>=0&&c[g]!==b;);if(0>g)return;for(var i=c.length;--i>g;){var h=c[i];a.ELEMENTS[h]&a.eflags.OPTIONAL_ENDTAG||e.push("</",h,">")}c.length=g,e.push("</",b,">")}}},pcdata:function(a,b){d||b.push(a)},rcdata:function(a,b){d||b.push(a)},cdata:function(a,b){d||b.push(a)},endDoc:function(a){for(var b=c.length;--b>=0;)a.push("</",c[b],">");c.length=0}})}function j(b,c,d){var e=[];return i(function(b,e){for(var f=0;f<e.length;f+=2){var g,h=e[f],i=e[f+1],j=null;if(g=b+"::"+h,(a.ATTRIBS.hasOwnProperty(g)||(g="*::"+h,a.ATTRIBS.hasOwnProperty(g)))&&(j=a.ATTRIBS[g]),null!==j)switch(j){case a.atype.NONE:break;case a.atype.SCRIPT:case a.atype.STYLE:i=null;break;case a.atype.ID:case a.atype.IDREF:case a.atype.IDREFS:case a.atype.GLOBAL_NAME:case a.atype.LOCAL_NAME:case a.atype.CLASSES:i=d?d(i):i;break;case a.atype.URI:var k=(""+i).match(z);i=k&&(!k[1]||m.test(k[1]))?c&&c(i):null;break;case a.atype.URI_FRAGMENT:i&&"#"===i.charAt(0)?(i=d?d(i):i,i&&(i="#"+i)):i=null;break;default:i=null}else i=null;e[f+1]=i}return e})(b,e),e.join("")}var k;k="script"==="SCRIPT".toLowerCase()?function(a){return a.toLowerCase()}:function(a){return a.replace(/[A-Z]/g,function(a){return String.fromCharCode(32|a.charCodeAt(0))})};var l={lt:"<",gt:">",amp:"&",nbsp:" ",quot:'"',apos:"'"},m=/^(?:https?|mailto|data)$/i,n=/^#(\d+)$/,o=/^#x([0-9A-Fa-f]+)$/,p=/\0/g,q=/&(#\d+|#x[0-9A-Fa-f]+|\w+);/g,r=/&/g,s=/&([^a-z#]|#(?:[^0-9x]|x(?:[^0-9a-f]|$)|$)|$)/gi,t=/</g,u=/>/g,v=/\"/g,w=/\=/g,x=new RegExp("^\\s*(?:(?:([a-z][a-z-]*)(\\s*=\\s*(\"[^\"]*\"|'[^']*'|(?=[a-z][a-z-]*\\s*=)|[^>\"'\\s]*))?)|(/?>)|[\\s\\S][^a-z\\s>]*)","i"),y=new RegExp("^(?:&(\\#[0-9]+|\\#[x][0-9a-f]+|\\w+);|<!--[\\s\\S]*?-->|<!\\w[^>]*>|<\\?[^>*]*>|<(/)?([a-z][a-z0-9]*)|([^<&>]+)|([<&>]))","i"),z=new RegExp("^(?:([^:/?#]+):)?");return{escapeAttrib:f,makeHtmlSanitizer:i,makeSaxParser:h,normalizeRCData:g,sanitize:j,unescapeEntities:e}}(html4),html_sanitize=html.sanitize;"undefined"!=typeof window&&(window.html=html,window.html_sanitize=html_sanitize),html4.ATTRIBS["*::style"]=0,html4.ELEMENTS.style=0,html4.ATTRIBS["a::target"]=0,html4.ELEMENTS.video=0,html4.ATTRIBS["video::src"]=0,html4.ATTRIBS["video::poster"]=0,html4.ATTRIBS["video::controls"]=0,html4.ELEMENTS.audio=0,html4.ATTRIBS["audio::src"]=0,html4.ATTRIBS["video::autoplay"]=0,html4.ATTRIBS["video::controls"]=0,function(a,b,c){b[a]=c()}("reqwest",this,function(){function handleReadyState(a,b,c){return function(){return a._aborted?c(a.request):void(a.request&&4==a.request[readyState]&&(a.request.onreadystatechange=noop,twoHundo.test(a.request.status)?b(a.request):c(a.request)))}}function setHeaders(a,b){var c,d=b.headers||{};d.Accept=d.Accept||defaultHeaders.accept[b.type]||defaultHeaders.accept["*"],b.crossOrigin||d[requestedWith]||(d[requestedWith]=defaultHeaders.requestedWith),d[contentType]||(d[contentType]=b.contentType||defaultHeaders.contentType);for(c in d)d.hasOwnProperty(c)&&a.setRequestHeader(c,d[c])}function setCredentials(a,b){"undefined"!=typeof b.withCredentials&&"undefined"!=typeof a.withCredentials&&(a.withCredentials=!!b.withCredentials)}function generalCallback(a){lastValue=a}function urlappend(a,b){return a+(/\?/.test(a)?"&":"?")+b}function handleJsonp(a,b,c,d){var e=uniqid++,f=a.jsonpCallback||"callback",g=a.jsonpCallbackName||reqwest.getcallbackPrefix(e),h=new RegExp("((^|\\?|&)"+f+")=([^&]+)"),i=d.match(h),j=doc.createElement("script"),k=0,l=-1!==navigator.userAgent.indexOf("MSIE 10.0");return i?"?"===i[3]?d=d.replace(h,"$1="+g):g=i[3]:d=urlappend(d,f+"="+g),win[g]=generalCallback,j.type="text/javascript","undefined"==typeof j.onreadystatechange||l||(j.event="onclick",j.htmlFor=j.id="_reqwest_"+e),j.onload=j.onreadystatechange=function(){return j[readyState]&&"complete"!==j[readyState]&&"loaded"!==j[readyState]||k?!1:(j.onload=j.onreadystatechange=null,j.onclick&&j.onclick(),a.success&&a.success(lastValue),lastValue=void 0,head.removeChild(j),void(k=1))},j.src=d,j.async=!0,head.appendChild(j),{abort:function(){j.onload=j.onreadystatechange=null,a.error&&a.error({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(j),k=1}}}function getRequest(a,b){var c,d=this.o,e=(d.method||"GET").toUpperCase(),f="string"==typeof d?d:d.url,g=d.processData!==!1&&d.data&&"string"!=typeof d.data?reqwest.toQueryString(d.data):d.data||null;return"jsonp"!=d.type&&"GET"!=e||!g||(f=urlappend(f,g),g=null),"jsonp"==d.type?handleJsonp(d,a,b,f):(c=xhr(),c.open(e,f,!0),setHeaders(c,d),setCredentials(c,d),c.onreadystatechange=handleReadyState(this,a,b),d.before&&d.before(c),c.send(g),c)}function Reqwest(a,b){this.o=a,this.fn=b,init.apply(this,arguments)}function setType(a){var b=a.match(/\.(json|jsonp|html|xml)(\?|$)/);return b?b[1]:"js"}function init(o,fn){function complete(a){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(a)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp);self._fulfillmentHandlers.length>0;)self._fulfillmentHandlers.shift()(resp);complete(resp)}function error(a,b,c){for(self._responseArgs.resp=a,self._responseArgs.msg=b,self._responseArgs.t=c,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(a,b,c);complete(a)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this,type=o.type||setType(this.url);fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),o.success&&this._fulfillmentHandlers.push(function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(a,b){return new Reqwest(a,b)}function normalize(a){return a?a.replace(/\r?\n/g,"\r\n"):""}function serial(a,b){var c,d,e,f,g=a.name,h=a.tagName.toLowerCase(),i=function(a){a&&!a.disabled&&b(g,normalize(a.attributes.value&&a.attributes.value.specified?a.value:a.text))};if(!a.disabled&&g)switch(h){case"input":/reset|button|image|file/i.test(a.type)||(c=/checkbox/i.test(a.type),d=/radio/i.test(a.type),e=a.value,(!(c||d)||a.checked)&&b(g,normalize(c&&""===e?"on":e)));break;case"textarea":b(g,normalize(a.value));break;case"select":if("select-one"===a.type.toLowerCase())i(a.selectedIndex>=0?a.options[a.selectedIndex]:null);else for(f=0;a.length&&f<a.length;f++)a.options[f].selected&&i(a.options[f])}}function eachFormElement(){var a,b,c=this,d=function(a,b){var d,e,f;for(d=0;d<b.length;d++)for(f=a[byTag](b[d]),e=0;e<f.length;e++)serial(f[e],c)};for(b=0;b<arguments.length;b++)a=arguments[b],/input|select|textarea/i.test(a.tagName)&&serial(a,c),d(a,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var a={};return eachFormElement.apply(function(b,c){b in a?(a[b]&&!isArray(a[b])&&(a[b]=[a[b]]),a[b].push(c)):a[b]=c},arguments),a}var win=window,doc=document,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(a){return a instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(a,b){return this._fulfilled?a(this._responseArgs.resp):this._erred?b(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(a),this._errorHandlers.push(b)),this},always:function(a){return this._fulfilled||this._erred?a(this._responseArgs.resp):this._completeHandlers.push(a),this},fail:function(a){return this._erred?a(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(a),this}},reqwest.serializeArray=function(){var a=[];return eachFormElement.apply(function(b,c){a.push({name:b,value:c})},arguments),a},reqwest.serialize=function(){if(0===arguments.length)return"";
var a,b,c=Array.prototype.slice.call(arguments,0);return a=c.pop(),a&&a.nodeType&&c.push(a)&&(a=null),a&&(a=a.type),b="map"==a?serializeHash:"array"==a?reqwest.serializeArray:serializeQueryString,b.apply(null,c)},reqwest.toQueryString=function(a){var b,c,d,e="",f=encodeURIComponent,g=function(a,b){e+=f(a)+"="+f(b)+"&"};if(isArray(a))for(b=0;a&&b<a.length;b++)g(a[b].name,a[b].value);else for(c in a)if(Object.hasOwnProperty.call(a,c))if(d=a[c],isArray(d))for(b=0;b<d.length;b++)g(c,d[b]);else g(c,a[c]);return e.replace(/&$/,"").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(a,b){return a&&(a.type&&(a.method=a.type)&&delete a.type,a.dataType&&(a.type=a.dataType),a.jsonpCallback&&(a.jsonpCallbackName=a.jsonpCallback)&&delete a.jsonpCallback,a.jsonp&&(a.jsonpCallback=a.jsonp)),new Reqwest(a,b)},reqwest}),wax=wax||{},wax.attribution=function(){var a={},b=document.createElement("div");return b.className="map-attribution",a.content=function(a){return"undefined"==typeof a?b.innerHTML:(b.innerHTML=wax.u.sanitize(a),this)},a.element=function(){return b},a.init=function(){return this},a},wax=wax||{},wax.bwdetect=function(a,b){function c(){wax.bw=-1;var a=new Image;a.src=f;var b=!0,c=setTimeout(function(){b&&-1==wax.bw&&(d.bw(0),b=!1)},e);a.onload=function(){b&&-1==wax.bw&&(clearTimeout(c),d.bw(1),b=!1)}}var d={},e=a.threshold||400,f="http://a.tiles.mapbox.com/mapbox/1.0.0/blue-marble-topo-bathy-jul/0/0/0.png?preventcache="+ +new Date,g=1,h=void 0===a.auto?!0:a.auto;return d.bw=function(a){if(!arguments.length)return g;wax.bwlisteners&&wax.bwlisteners.length&&function(){for(listeners=wax.bwlisteners,wax.bwlisteners=[],i=0;i<listeners;i++)listeners[i](a)}(),wax.bw=a,g!=(g=a)&&b(a)},d.add=function(){return h&&c(),this},-1==wax.bw?(wax.bwlisteners=wax.bwlisteners||[],wax.bwlisteners.push(d.bw)):void 0!==wax.bw?d.bw(wax.bw):d.add(),d},wax.formatter=function(x){var formatter={},f;if(x&&"string"==typeof x)try{eval("f = "+x)}catch(e){console&&console.log(e)}else f=x&&"function"==typeof x?x:function(){};return formatter.format=function(a,b){try{return wax.u.sanitize(f(a,b))}catch(c){console&&console.log(c)}},formatter},wax.gi=function(a,b){function c(a){return a>=93&&a--,a>=35&&a--,a-=32}b=b||{};var d={},e=b.resolution||4,f=b.tileSize||256;return d.grid_tile=function(){return a},d.getKey=function(b,d){return a&&a.grid&&!(0>d||0>b||Math.floor(d)>=f||Math.floor(b)>=f)?c(a.grid[Math.floor(d/e)].charCodeAt(Math.floor(b/e))):void 0},d.gridFeature=function(b,c){var d=this.getKey(b,c),e=a.keys;return e&&e[d]&&a.data[e[d]]?a.data[e[d]]:void 0},d.tileFeature=function(b,c,d){if(a){var e=wax.u.offset(d);return feature=this.gridFeature(b-e.left,c-e.top),feature}},d},wax.gm=function(){function a(a){return"string"==typeof a&&(a=[a]),function(b){if(b){var c=new RegExp(e.tileRegexp()),d=c.exec(b);if(d)return a[parseInt(d[2],10)%a.length].replace(/\{z\}/g,d[1]).replace(/\{x\}/g,d[2]).replace(/\{y\}/g,d[3])}}}var b,c,d=4,e={},f=function(a){return a?a.replace(/(\.png|\.jpg|\.jpeg)(\d*)/,".grid.json"):void 0};return e.tileRegexp=function(){var a=b.tiles[0],c=a.indexOf("?");-1!==c&&(a=a.substr(0,c)),a=a.replace(/[\(\)\?\$\*\+\^]/g,"."),0===a.indexOf("https")?a=a.replace(":443","[:0-9]*"):0===a.indexOf("http")&&(a=a.replace(":80","[:0-9]*"));var d="";if(b.tiles.length>1)for(var e=b.tiles[0],f=b.tiles[1],g=0;g<e.length;++g)d+=e.charAt(g)!=f.charAt(g)?".":a.charAt(g)||"";else d=a;return d.replace(/\{x\}/,"(\\d+)").replace(/\{y\}/,"(\\d+)").replace(/\{z\}/,"(\\d+)")},e.formatter=function(a){return arguments.length?(c=wax.formatter(a),e):c},e.template=function(a){return arguments.length?(c=wax.template(a),e):c},e.gridUrl=function(b){return arguments.length?(f=b?"function"==typeof b?b:a(b):function(){return null},e):f},e.getGrid=function(a,b){var g=f(a);return c&&g?(wax.request.get(g,function(a,e){return a?b(a,null):void b(null,wax.gi(e,{formatter:c,resolution:d}))}),e):b(null,null)},e.tilejson=function(a){return arguments.length?(a.template?e.template(a.template):a.formatter?e.formatter(a.formatter):c=void 0,e.gridUrl(a.grids),a.resolution&&(d=a.resolution),b=a,e):b},e},wax=wax||{},wax.hash=function(a){function b(){return location.hash.substring(1)}function c(a){var b=window.location;b.replace(b.toString().replace(b.hash||/$/,"#"+a))}function d(b){for(var c=b.split("/"),d=0;d<c.length;d++)if(c[d]=Number(c[d]),isNaN(c[d]))return!0;return c.length<3?!0:void(3==c.length&&a.setCenterZoom(c))}function e(){var b=a.getCenterZoom();g!==b&&(g=b,c(g))}function f(a){a!==g&&d(g=a)&&e()}a=a||{};var g,h={},i=wax.u.throttle(e,500);return h.add=function(){return f(b()),a.bindChange(i),h},h.remove=function(){return a.unbindChange(i),h},h},wax=wax||{},wax.interaction=function(){function a(a){for(var b=i(),c=new RegExp(n.tileRegexp()),d=0;d<b.length;d++)if(a){var e=b[d][0]<=a.y&&b[d][0]+256>a.y&&b[d][1]<=a.x&&b[d][1]+256>a.x;if(e&&c.exec(b[d][2].src))return b[d][2]}return!1}function b(){return q?(window.clearTimeout(q),q=null,!0):!1}function c(a){if(!p){var b="MSPointerMove"!==a.type&&"pointermove"!==a.type?a:a.originalEvent,c=wax.u.eventoffset(b);o.screen_feature(c,function(b){b?bean.fire(o,"on",{parent:l(),data:b,formatter:n.formatter().format,e:a}):bean.fire(o,"off")})}}function d(a){p=!0;var b="MSPointerDown"!==a.type&&"pointerdown"!==a.type?a:a.originalEvent;h=wax.u.eventoffset(b),"mousedown"===a.type?(bean.add(document.body,"click",g),bean.add(document.body,"mouseup",e)):"touchstart"===a.type&&1===a.touches.length?(bean.remove(document.body,"click",g),bean.add(document.body,"click",g),bean.add(document.body,"touchEnd",e)):"MSPointerDown"===a.originalEvent.type&&a.originalEvent.touches&&1===a.originalEvent.touches.length?(bean.fire(o,"off"),bean.add(l(),v)):"pointerdown"===a.type&&a.originalEvent.touches&&1===a.originalEvent.touches.length?(bean.fire(o,"off"),bean.add(l(),w)):p=!1}function e(){p=!1}function f(){bean.remove(l(),u),bean.remove(l(),v),bean.remove(l(),w),p=!1}function g(a){var c={},d="MSPointerMove"!==a.type&&"MSPointerUp"!==a.type&&"pointerup"!==a.type&&"pointermove"!==a.type?a:a.originalEvent,e=wax.u.eventoffset(d);p=!1;for(var f in d)c[f]=d[f];if(bean.remove(document.body,"mouseup",g),bean.remove(l(),u),bean.remove(l(),v),bean.remove(l(),w),"touchend"===a.type)o.click(a,h);else if(e&&h)if("MSPointerMove"===c.type||"MSPointerUp"===c.type)c.changedTouches=[],o.click(c,e);else if("pointermove"===c.type||"pointerup"===c.type)o.click(c,e);else if(Math.round(e.y/r)===Math.round(h.y/r)&&Math.round(e.x/r)===Math.round(h.x/r)){if(s&&"touchmove"===c.type)return g;q?b():q=window.setTimeout(function(){q=null,o.click(c,e)},150)}return g}var h,i,j,k,l,m,n=wax.gm(),o={},p=!1,q=null,r=4,s=!1,t={mousemove:c,touchstart:d,mousedown:d},u={touchend:g,touchmove:g,touchcancel:f},v={MSPointerUp:g,MSPointerMove:g,MSPointerCancel:f},w={pointerup:g,pointermove:g,pointercancel:f};return o.discardTouchMove=function(a){return arguments.length?(s=a,o):s},o.click=function(a,b){o.screen_feature(b,function(b){b&&bean.fire(o,"on",{parent:l(),data:b,formatter:n.formatter().format,e:a})})},o.screen_feature=function(b,c){var d=a(b);d||c(null),n.getGrid(d.src,function(a,e){if(a||!e)return c(null);var f=e.tileFeature(b.x,b.y,d);c(f)})},o.attach=function(a){return arguments.length?(j=a,o):j},o.detach=function(a){return arguments.length?(k=a,o):k},o.map=function(a){return arguments.length?(m=a,j&&j(m),bean.add(l(),t),bean.add(l(),"touchstart",d),bean.add(l(),"MSPointerDown",d),bean.add(l(),"pointerdown",d),o):m},o.grid=function(a){return arguments.length?(i=a,o):i},o.remove=function(a){return k&&k(m),bean.remove(l(),t),bean.fire(o,"remove"),o},o.tilejson=function(a){return arguments.length?(n.tilejson(a),o):n.tilejson()},o.formatter=function(){return n.formatter()},o.on=function(a,b){return bean.add(o,a,b),o},o.off=function(a,b){return bean.remove(o,a,b),o},o.gridmanager=function(a){return arguments.length?(n=a,o):n},o.parent=function(a){return l=a,o},o};var wax=wax||{};wax.location=function(){function a(a){if("mousemove"!==a.e.type&&a.e.type){var b=a.formatter({format:"location"},a.data);b&&(window.location.href=b)}}var b={};return b.events=function(){return{on:a}},b};var wax=wax||{};if(wax.request={cache:{},locks:{},promises:{},get:function(a,b){if(this.cache[a])return b(this.cache[a][0],this.cache[a][1]);if(this.promises[a]=this.promises[a]||[],this.promises[a].push(b),!this.locks[a]){var c=this;this.locks[a]=!0,reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:function(b){c.locks[a]=!1,c.cache[a]=[null,b];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])},error:function(b){c.locks[a]=!1,c.cache[a]=[b,null];for(var d=0;d<c.promises[a].length;d++)c.promises[a][d](c.cache[a][0],c.cache[a][1])}})}}},wax.template=function(a){var b={};return b.format=function(a,b){throw new Error("mustache.js templates are no longer supported")},b},!wax)var wax={};wax.tilejson=function(a,b){reqwest({url:a+(~a.indexOf("?")?"&":"?")+"callback=grid",type:"jsonp",jsonpCallback:"callback",success:b,error:b})};var wax=wax||{};wax.u={offset:function(a){function b(){h(a);try{for(;a=a.offsetParent;)h(a)}catch(b){}}var c=a.offsetWidth||parseInt(a.style.width,10),d=a.offsetHeight||parseInt(a.style.height,10),e=document.body,f=0,g=0,h=function(a){if(a!==e&&a!==document.documentElement){f+=a.offsetTop,g+=a.offsetLeft;var b=a.style.transform||a.style.WebkitTransform||a.style.OTransform||a.style.MozTransform||a.style.msTransform;if(b){var c;if(c=b.match(/translate\((.+)px, (.+)px\)/))f+=parseInt(c[2],10),g+=parseInt(c[1],10);else if(c=b.match(/translate3d\((.+)px, (.+)px, (.+)px\)/))f+=parseInt(c[2],10),g+=parseInt(c[1],10);else if(c=b.match(/matrix3d\(([\-\d,\s]+)\)/)){var d=c[1].split(",");f+=parseInt(d[13],10),g+=parseInt(d[12],10)}else(c=b.match(/matrix\(.+, .+, .+, .+, (.+), (.+)\)/))&&(f+=parseInt(c[2],10),g+=parseInt(c[1],10))}}};if("undefined"!=typeof a.getBoundingClientRect){var i=document.body,j=a.ownerDocument.documentElement,k=document.clientTop||i.clientTop||0,l=document.clientLeft||i.clientLeft||0,m=window.pageYOffset||j.scrollTop,n=window.pageXOffset||j.scrollLeft;try{var o=a.getBoundingClientRect();f=o.top+m-k,g=o.left+n-l}catch(p){b()}}else b();f+=e.offsetTop,g+=e.offsetLeft,f+=e.parentNode.offsetTop,g+=e.parentNode.offsetLeft;var q=document.defaultView?window.getComputedStyle(e.parentNode,null):e.parentNode.currentStyle;return e.parentNode.offsetTop===parseInt(q.marginTop,10)||isNaN(parseInt(q.marginTop,10))||(f+=parseInt(q.marginTop,10),g+=parseInt(q.marginLeft,10)),{top:f,left:g,height:d,width:c}},$:function(a){return"string"==typeof a?document.getElementById(a):a},eventoffset:function(a){return a||(a=window.event),"MSPointerMove"==a.type||"MSPointerDown"==a.type||"MSPointerUp"==a.type?{x:a.pageX+window.pageXOffset,y:a.pageY+window.pageYOffset}:a.pageX||a.pageY?{x:a.pageX,y:a.pageY}:a.clientX||a.clientY?{x:a.clientX,y:a.clientY}:a.touches&&1===a.touches.length?{x:a.touches[0].pageX,y:a.touches[0].pageY}:void 0},limit:function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,a.apply(e,f)};c&&clearTimeout(d),!c&&d||(d=setTimeout(g,b))}},throttle:function(a,b){return this.limit(a,b,!1)},sanitize:function(a){function b(a){return/^(https?:\/\/|data:image)/.test(a)?a:void 0}function c(a){return a}return a?html_sanitize(a,b,c):""}},wax=wax||{},wax.leaf=wax.leaf||{},wax.leaf.hash=function(a){return wax.hash({getCenterZoom:function(){var b=a.getCenter(),c=a.getZoom(),d=Math.max(0,Math.ceil(Math.log(c)/Math.LN2));return[c,b.lat.toFixed(d),b.lng.toFixed(d)].join("/")},setCenterZoom:function(b){a.setView(new L.LatLng(b[1],b[2]),b[0])},bindChange:function(b){a.on("moveend",b)},unbindChange:function(b){a.off("moveend",b)}})},wax=wax||{},wax.leaf=wax.leaf||{},wax.leaf.interaction=function(){function a(){g=!0}function b(){return!g&&e?e:e=function(a){var b=[];for(var c in a)if(a[c]._tiles)for(var d in a[c]._tiles){var e=a[c]._tiles[d];if(e.src){var f=wax.u.offset(e);b.push([f.top,f.left,e])}}return b}(f._layers)}function c(b){if(!arguments.length)return f;f=b;for(var c=["moveend"],d=0;d<c.length;d++)f.on(c[d],a)}function d(b){if(!arguments.length)return f;f=b;for(var c=["moveend"],d=0;d<c.length;d++)f.off(c[d],a)}var e,f,g=!1;return wax.interaction().attach(c).detach(d).parent(function(){return f._container}).grid(b)},wax=wax||{},wax.leaf=wax.leaf||{},wax.leaf.connector=L.TileLayer.extend({initialize:function(a){a=a||{},a.minZoom=a.minzoom||0,a.maxZoom=a.maxzoom||22,L.TileLayer.prototype.initialize.call(this,a.tiles[0],a)}}),wax=wax||{},wax.g=wax.g||{},wax.g.attribution=function(a,b){b=b||{};var c,d={};return d.element=function(){return c.element()},d.appendTo=function(a){return wax.u.$(a).appendChild(c.element()),this},d.init=function(){return c=wax.attribution(),c.content(b.attribution),c.element().className="map-attribution map-g",this},d.init()},wax=wax||{},wax.g=wax.g||{},wax.g.bwdetect=function(a,b){b=b||{};var c=b.png||".png128",d=b.jpg||".jpg70";if(!a.mapTypes["mb-low"]){for(var e=a.mapTypes.mb,f={tiles:[],scheme:e.options.scheme,blankImage:e.options.blankImage,minzoom:e.minZoom,maxzoom:e.maxZoom,name:e.name,description:e.description},g=0;g<e.options.tiles.length;g++)f.tiles.push(e.options.tiles[g].replace(".png",c).replace(".jpg",d));m.mapTypes.set("mb-low",new wax.g.connector(f))}return wax.bwdetect(b,function(b){a.setMapTypeId(b?"mb":"mb-low")})},wax=wax||{},wax.g=wax.g||{},wax.g.hash=function(a){return wax.hash({getCenterZoom:function(){var b=a.getCenter(),c=a.getZoom(),d=Math.max(0,Math.ceil(Math.log(c)/Math.LN2));return[c.toFixed(2),b.lat().toFixed(d),b.lng().toFixed(d)].join("/")},setCenterZoom:function(b){a.setCenter(new google.maps.LatLng(b[1],b[2])),a.setZoom(b[0])},bindChange:function(b){google.maps.event.addListener(a,"idle",b)},unbindChange:function(b){google.maps.event.removeListener(a,"idle",b)}})},wax=wax||{},wax.g=wax.g||{},wax.g.interaction=function(){function a(){g=!0}function b(){if(!g&&e&&(e.length>0||!h))return e;e=[];var a=f.getZoom(),b=(wax.u.offset(f.getDiv()),function(b){if(b&&b.interactive){h=!0;for(var c in b.cache)if(c.split("/")[0]==a){var d=wax.u.offset(b.cache[c]);e.push([d.top,d.left,b.cache[c]])}}});for(var c in f.mapTypes)b(f.mapTypes[c]);return f.overlayMapTypes.forEach(b),e}function c(b){return arguments.length?(f=b,i=google.maps.event.addListener(f,"tileloaded",a),void(j=google.maps.event.addListener(f,"idle",a))):f}function d(a){i&&google.maps.event.removeListener(i),j&&google.maps.event.removeListener(j)}var e,f,g=!1,h=!1,i=null,j=null;return wax.interaction().attach(c).detach(d).discardTouchMove(!0).parent(function(){return f.getDiv()}).grid(b)};var wax=wax||{};wax.g=wax.g||{},wax.g.connector=function(a){a=a||{},this.options={tiles:a.tiles,scheme:a.scheme||"xyz",blankImage:a.blankImage||"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},this.opacity=a.opacity||0,this.minZoom=a.minzoom||0,this.maxZoom=a.maxzoom||22,this.name=a.name||"",this.description=a.description||"",this.interactive=!0,this.tileSize=new google.maps.Size(256,256),this.cache={}},wax.g.connector.prototype.getTile=function(a,b,c){var d=b+"/"+a.x+"/"+a.y;if(!this.cache[d]){var e=this.cache[d]=new Image(256,256);this.cache[d].src=this.getTileUrl(a,b),this.cache[d].setAttribute("gTileKey",d),this.cache[d].setAttribute("style","opacity: "+this.opacity+"; filter: alpha(opacity="+100*this.opacity+");"),this.cache[d].onerror=function(){e.style.display="none"}}return this.cache[d]},wax.g.connector.prototype.releaseTile=function(a){var b=a.getAttribute("gTileKey");this.cache[b]&&delete this.cache[b],a.parentNode&&a.parentNode.removeChild(a)},wax.g.connector.prototype.getTileUrl=function(a,b){var c=Math.pow(2,b),d="tms"===this.options.scheme?c-1-a.y:a.y,e=a.x%c;return e=0>e?a.x%c+c:e,0>d?this.options.blankImage:this.options.tiles[parseInt(e+d,10)%this.options.tiles.length].replace(/\{z\}/g,b).replace(/\{x\}/g,e).replace(/\{y\}/g,d)},browserify_shim__define__module__export__("undefined"!=typeof wax?wax:window.wax)}).call(global,void 0,void 0,void 0,void 0,function(a){module.exports=a})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],322:[function(a,b,c){b.exports=a(1)},{dup:1,jquery:331,underscore:354}],323:[function(a,b,c){},{}],324:[function(a,b,c){function d(a,b){return n.isUndefined(b)?""+b:n.isNumber(b)&&!isFinite(b)?b.toString():n.isFunction(b)||n.isRegExp(b)?b.toString():b}function e(a,b){return n.isString(a)?a.length<b?a:a.slice(0,b):a}function f(a){return e(JSON.stringify(a.actual,d),128)+" "+a.operator+" "+e(JSON.stringify(a.expected,d),128)}function g(a,b,c,d,e){throw new q.AssertionError({message:c,actual:a,expected:b,operator:d,stackStartFunction:e})}function h(a,b){a||g(a,!0,b,"==",q.ok)}function i(a,b){if(a===b)return!0;if(n.isBuffer(a)&&n.isBuffer(b)){if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}return n.isDate(a)&&n.isDate(b)?a.getTime()===b.getTime():n.isRegExp(a)&&n.isRegExp(b)?a.source===b.source&&a.global===b.global&&a.multiline===b.multiline&&a.lastIndex===b.lastIndex&&a.ignoreCase===b.ignoreCase:n.isObject(a)||n.isObject(b)?k(a,b):a==b}function j(a){return"[object Arguments]"==Object.prototype.toString.call(a)}function k(a,b){if(n.isNullOrUndefined(a)||n.isNullOrUndefined(b))return!1;if(a.prototype!==b.prototype)return!1;if(n.isPrimitive(a)||n.isPrimitive(b))return a===b;var c=j(a),d=j(b);if(c&&!d||!c&&d)return!1;if(c)return a=o.call(a),b=o.call(b),i(a,b);var e,f,g=r(a),h=r(b);if(g.length!=h.length)return!1;for(g.sort(),h.sort(),f=g.length-1;f>=0;f--)if(g[f]!=h[f])return!1;for(f=g.length-1;f>=0;f--)if(e=g[f],!i(a[e],b[e]))return!1;return!0}function l(a,b){return a&&b?"[object RegExp]"==Object.prototype.toString.call(b)?b.test(a):a instanceof b?!0:b.call({},a)===!0:!1}function m(a,b,c,d){var e;n.isString(c)&&(d=c,c=null);try{b()}catch(f){e=f}if(d=(c&&c.name?" ("+c.name+").":".")+(d?" "+d:"."),a&&!e&&g(e,c,"Missing expected exception"+d),!a&&l(e,c)&&g(e,c,"Got unwanted exception"+d),a&&e&&c&&!l(e,c)||!a&&e)throw e}var n=a("util/"),o=Array.prototype.slice,p=Object.prototype.hasOwnProperty,q=b.exports=h;q.AssertionError=function(a){this.name="AssertionError",this.actual=a.actual,this.expected=a.expected,this.operator=a.operator,a.message?(this.message=a.message,this.generatedMessage=!1):(this.message=f(this),this.generatedMessage=!0);var b=a.stackStartFunction||g;if(Error.captureStackTrace)Error.captureStackTrace(this,b);else{var c=new Error;if(c.stack){var d=c.stack,e=b.name,h=d.indexOf("\n"+e);if(h>=0){var i=d.indexOf("\n",h+1);d=d.substring(i+1)}this.stack=d}}},n.inherits(q.AssertionError,Error),q.fail=g,q.ok=h,q.equal=function(a,b,c){a!=b&&g(a,b,c,"==",q.equal)},q.notEqual=function(a,b,c){a==b&&g(a,b,c,"!=",q.notEqual)},q.deepEqual=function(a,b,c){i(a,b)||g(a,b,c,"deepEqual",q.deepEqual)},q.notDeepEqual=function(a,b,c){i(a,b)&&g(a,b,c,"notDeepEqual",q.notDeepEqual)},q.strictEqual=function(a,b,c){a!==b&&g(a,b,c,"===",q.strictEqual)},q.notStrictEqual=function(a,b,c){a===b&&g(a,b,c,"!==",q.notStrictEqual)},q["throws"]=function(a,b,c){m.apply(this,[!0].concat(o.call(arguments)))},q.doesNotThrow=function(a,b){m.apply(this,[!1].concat(o.call(arguments)))},q.ifError=function(a){if(a)throw a};var r=Object.keys||function(a){var b=[];for(var c in a)p.call(a,c)&&b.push(c);return b}},{"util/":329}],325:[function(a,b,c){"function"==typeof Object.create?b.exports=function(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(a,b){a.super_=b;var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],326:[function(a,b,c){(function(a){function b(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function d(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)};c.resolve=function(){for(var c="",e=!1,f=arguments.length-1;f>=-1&&!e;f--){var g=f>=0?arguments[f]:a.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(c=g+"/"+c,e="/"===g.charAt(0))}return c=b(d(c.split("/"),function(a){return!!a}),!e).join("/"),(e?"/":"")+c||"."},c.normalize=function(a){var e=c.isAbsolute(a),f="/"===g(a,-1);return a=b(d(a.split("/"),function(a){return!!a}),!e).join("/"),a||e||(a="."),a&&f&&(a+="/"),(e?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a,b){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=f(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return f(a)[3]};var g="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return 0>b&&(b=a.length+b),a.substr(b,c)}}).call(this,a("_process"))},{_process:327}],327:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h&&h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],328:[function(a,b,c){b.exports=function(a){return a&&"object"==typeof a&&"function"==typeof a.copy&&"function"==typeof a.fill&&"function"==typeof a.readUInt8}},{}],329:[function(a,b,c){(function(b,d){function e(a,b){var d={seen:[],stylize:g};return arguments.length>=3&&(d.depth=arguments[2]),arguments.length>=4&&(d.colors=arguments[3]),p(b)?d.showHidden=b:b&&c._extend(d,b),v(d.showHidden)&&(d.showHidden=!1),v(d.depth)&&(d.depth=2),v(d.colors)&&(d.colors=!1),v(d.customInspect)&&(d.customInspect=!0),d.colors&&(d.stylize=f),i(d,a,d.depth)}function f(a,b){var c=e.styles[b];return c?"["+e.colors[c][0]+"m"+a+"["+e.colors[c][1]+"m":a}function g(a,b){return a}function h(a){var b={};return a.forEach(function(a,c){b[a]=!0}),b}function i(a,b,d){if(a.customInspect&&b&&A(b.inspect)&&b.inspect!==c.inspect&&(!b.constructor||b.constructor.prototype!==b)){var e=b.inspect(d,a);return t(e)||(e=i(a,e,d)),e}var f=j(a,b);if(f)return f;var g=Object.keys(b),p=h(g);if(a.showHidden&&(g=Object.getOwnPropertyNames(b)),z(b)&&(g.indexOf("message")>=0||g.indexOf("description")>=0))return k(b);if(0===g.length){if(A(b)){var q=b.name?": "+b.name:"";return a.stylize("[Function"+q+"]","special")}if(w(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(y(b))return a.stylize(Date.prototype.toString.call(b),"date");if(z(b))return k(b)}var r="",s=!1,u=["{","}"];if(o(b)&&(s=!0,u=["[","]"]),A(b)){var v=b.name?": "+b.name:"";r=" [Function"+v+"]"}if(w(b)&&(r=" "+RegExp.prototype.toString.call(b)),y(b)&&(r=" "+Date.prototype.toUTCString.call(b)),z(b)&&(r=" "+k(b)),0===g.length&&(!s||0==b.length))return u[0]+r+u[1];if(0>d)return w(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);var x;return x=s?l(a,b,d,p,g):g.map(function(c){return m(a,b,d,p,c,s)}),a.seen.pop(),n(x,r,u)}function j(a,b){if(v(b))return a.stylize("undefined","undefined");if(t(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}return s(b)?a.stylize(""+b,"number"):p(b)?a.stylize(""+b,"boolean"):q(b)?a.stylize("null","null"):void 0}function k(a){return"["+Error.prototype.toString.call(a)+"]"}function l(a,b,c,d,e){for(var f=[],g=0,h=b.length;h>g;++g)F(b,String(g))?f.push(m(a,b,c,d,String(g),!0)):f.push("");return e.forEach(function(e){e.match(/^\d+$/)||f.push(m(a,b,c,d,e,!0))}),f}function m(a,b,c,d,e,f){var g,h,j;if(j=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]},j.get?h=j.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):j.set&&(h=a.stylize("[Setter]","special")),F(d,e)||(g="["+e+"]"),h||(a.seen.indexOf(j.value)<0?(h=q(c)?i(a,j.value,null):i(a,j.value,c-1),h.indexOf("\n")>-1&&(h=f?h.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+h.split("\n").map(function(a){return"   "+a}).join("\n"))):h=a.stylize("[Circular]","special")),v(g)){if(f&&e.match(/^\d+$/))return h;g=JSON.stringify(""+e),g.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(g=g.substr(1,g.length-2),g=a.stylize(g,"name")):(g=g.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),g=a.stylize(g,"string"))}return g+": "+h}function n(a,b,c){var d=0,e=a.reduce(function(a,b){return d++,b.indexOf("\n")>=0&&d++,a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return e>60?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function o(a){return Array.isArray(a)}function p(a){return"boolean"==typeof a}function q(a){return null===a}function r(a){return null==a}function s(a){return"number"==typeof a}function t(a){return"string"==typeof a}function u(a){return"symbol"==typeof a}function v(a){return void 0===a}function w(a){return x(a)&&"[object RegExp]"===C(a)}function x(a){return"object"==typeof a&&null!==a}function y(a){return x(a)&&"[object Date]"===C(a)}function z(a){return x(a)&&("[object Error]"===C(a)||a instanceof Error)}function A(a){return"function"==typeof a}function B(a){return null===a||"boolean"==typeof a||"number"==typeof a||"string"==typeof a||"symbol"==typeof a||"undefined"==typeof a}function C(a){return Object.prototype.toString.call(a)}function D(a){return 10>a?"0"+a.toString(10):a.toString(10)}function E(){var a=new Date,b=[D(a.getHours()),D(a.getMinutes()),D(a.getSeconds())].join(":");return[a.getDate(),J[a.getMonth()],b].join(" ")}function F(a,b){return Object.prototype.hasOwnProperty.call(a,b)}var G=/%[sdj%]/g;c.format=function(a){if(!t(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(e(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,f=d.length,g=String(a).replace(G,function(a){if("%%"===a)return"%";if(c>=f)return a;switch(a){case"%s":return String(d[c++]);case"%d":return Number(d[c++]);case"%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),h=d[c];f>c;h=d[++c])g+=q(h)||!x(h)?" "+h:" "+e(h);return g},c.deprecate=function(a,e){function f(){if(!g){if(b.throwDeprecation)throw new Error(e);b.traceDeprecation?console.trace(e):console.error(e),g=!0}return a.apply(this,arguments)}if(v(d.process))return function(){return c.deprecate(a,e).apply(this,arguments)};if(b.noDeprecation===!0)return a;var g=!1;return f};var H,I={};c.debuglog=function(a){if(v(H)&&(H=b.env.NODE_DEBUG||""),a=a.toUpperCase(),!I[a])if(new RegExp("\\b"+a+"\\b","i").test(H)){var d=b.pid;I[a]=function(){var b=c.format.apply(c,arguments);console.error("%s %d: %s",a,d,b)}}else I[a]=function(){};return I[a]},c.inspect=e,e.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},e.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},c.isArray=o,c.isBoolean=p,c.isNull=q,c.isNullOrUndefined=r,c.isNumber=s,c.isString=t,c.isSymbol=u,c.isUndefined=v,c.isRegExp=w,c.isObject=x,c.isDate=y,c.isError=z,c.isFunction=A,c.isPrimitive=B,c.isBuffer=a("./support/isBuffer");var J=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];c.log=function(){console.log("%s - %s",E(),c.format.apply(c,arguments))},c.inherits=a("inherits"),c._extend=function(a,b){if(!b||!x(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":328,_process:327,inherits:325}],330:[function(a,b,c){b.exports=a(56)},{dup:56}],331:[function(a,b,c){b.exports=a(57)},{dup:57}],332:[function(a,b,c){!function(a,d){"object"==typeof c&&"undefined"!=typeof b?b.exports=d():"function"==typeof define&&define.amd?define(d):a.moment=d()}(this,function(){"use strict";function c(){return Jc.apply(null,arguments)}function d(a){Jc=a}function e(a){return"[object Array]"===Object.prototype.toString.call(a)}function f(a){return a instanceof Date||"[object Date]"===Object.prototype.toString.call(a)}function g(a,b){var c,d=[];for(c=0;c<a.length;++c)d.push(b(a[c],c));return d}function h(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function i(a,b){for(var c in b)h(b,c)&&(a[c]=b[c]);return h(b,"toString")&&(a.toString=b.toString),h(b,"valueOf")&&(a.valueOf=b.valueOf),a}function j(a,b,c,d){return Ea(a,b,c,d,!0).utc()}function k(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function l(a){return null==a._pf&&(a._pf=k()),a._pf}function m(a){if(null==a._isValid){var b=l(a);a._isValid=!(isNaN(a._d.getTime())||!(b.overflow<0)||b.empty||b.invalidMonth||b.invalidWeekday||b.nullInput||b.invalidFormat||b.userInvalidated),a._strict&&(a._isValid=a._isValid&&0===b.charsLeftOver&&0===b.unusedTokens.length&&void 0===b.bigHour)}return a._isValid}function n(a){var b=j(NaN);return null!=a?i(l(b),a):l(b).userInvalidated=!0,b}function o(a,b){var c,d,e;if("undefined"!=typeof b._isAMomentObject&&(a._isAMomentObject=b._isAMomentObject),"undefined"!=typeof b._i&&(a._i=b._i),"undefined"!=typeof b._f&&(a._f=b._f),"undefined"!=typeof b._l&&(a._l=b._l),"undefined"!=typeof b._strict&&(a._strict=b._strict),"undefined"!=typeof b._tzm&&(a._tzm=b._tzm),"undefined"!=typeof b._isUTC&&(a._isUTC=b._isUTC),"undefined"!=typeof b._offset&&(a._offset=b._offset),"undefined"!=typeof b._pf&&(a._pf=l(b)),"undefined"!=typeof b._locale&&(a._locale=b._locale),Lc.length>0)for(c in Lc)d=Lc[c],e=b[d],"undefined"!=typeof e&&(a[d]=e);return a}function p(a){o(this,a),this._d=new Date(null!=a._d?a._d.getTime():NaN),Mc===!1&&(Mc=!0,c.updateOffset(this),Mc=!1)}function q(a){return a instanceof p||null!=a&&null!=a._isAMomentObject}function r(a){return 0>a?Math.ceil(a):Math.floor(a)}function s(a){var b=+a,c=0;return 0!==b&&isFinite(b)&&(c=r(b)),c}function t(a,b,c){var d,e=Math.min(a.length,b.length),f=Math.abs(a.length-b.length),g=0;for(d=0;e>d;d++)(c&&a[d]!==b[d]||!c&&s(a[d])!==s(b[d]))&&g++;return g+f}function u(){}function v(a){return a?a.toLowerCase().replace("_","-"):a}function w(a){for(var b,c,d,e,f=0;f<a.length;){for(e=v(a[f]).split("-"),b=e.length,c=v(a[f+1]),c=c?c.split("-"):null;b>0;){if(d=x(e.slice(0,b).join("-")))return d;if(c&&c.length>=b&&t(e,c,!0)>=b-1)break;b--;
}f++}return null}function x(c){var d=null;if(!Nc[c]&&"undefined"!=typeof b&&b&&b.exports)try{d=Kc._abbr,a("./locale/"+c),y(d)}catch(e){}return Nc[c]}function y(a,b){var c;return a&&(c="undefined"==typeof b?A(a):z(a,b),c&&(Kc=c)),Kc._abbr}function z(a,b){return null!==b?(b.abbr=a,Nc[a]=Nc[a]||new u,Nc[a].set(b),y(a),Nc[a]):(delete Nc[a],null)}function A(a){var b;if(a&&a._locale&&a._locale._abbr&&(a=a._locale._abbr),!a)return Kc;if(!e(a)){if(b=x(a))return b;a=[a]}return w(a)}function B(a,b){var c=a.toLowerCase();Oc[c]=Oc[c+"s"]=Oc[b]=a}function C(a){return"string"==typeof a?Oc[a]||Oc[a.toLowerCase()]:void 0}function D(a){var b,c,d={};for(c in a)h(a,c)&&(b=C(c),b&&(d[b]=a[c]));return d}function E(a,b){return function(d){return null!=d?(G(this,a,d),c.updateOffset(this,b),this):F(this,a)}}function F(a,b){return a._d["get"+(a._isUTC?"UTC":"")+b]()}function G(a,b,c){return a._d["set"+(a._isUTC?"UTC":"")+b](c)}function H(a,b){var c;if("object"==typeof a)for(c in a)this.set(c,a[c]);else if(a=C(a),"function"==typeof this[a])return this[a](b);return this}function I(a,b,c){var d=""+Math.abs(a),e=b-d.length,f=a>=0;return(f?c?"+":"":"-")+Math.pow(10,Math.max(0,e)).toString().substr(1)+d}function J(a,b,c,d){var e=d;"string"==typeof d&&(e=function(){return this[d]()}),a&&(Sc[a]=e),b&&(Sc[b[0]]=function(){return I(e.apply(this,arguments),b[1],b[2])}),c&&(Sc[c]=function(){return this.localeData().ordinal(e.apply(this,arguments),a)})}function K(a){return a.match(/\[[\s\S]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function L(a){var b,c,d=a.match(Pc);for(b=0,c=d.length;c>b;b++)Sc[d[b]]?d[b]=Sc[d[b]]:d[b]=K(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+=d[b]instanceof Function?d[b].call(e,a):d[b];return f}}function M(a,b){return a.isValid()?(b=N(b,a.localeData()),Rc[b]=Rc[b]||L(b),Rc[b](a)):a.localeData().invalidDate()}function N(a,b){function c(a){return b.longDateFormat(a)||a}var d=5;for(Qc.lastIndex=0;d>=0&&Qc.test(a);)a=a.replace(Qc,c),Qc.lastIndex=0,d-=1;return a}function O(a){return"function"==typeof a&&"[object Function]"===Object.prototype.toString.call(a)}function P(a,b,c){fd[a]=O(b)?b:function(a){return a&&c?c:b}}function Q(a,b){return h(fd,a)?fd[a](b._strict,b._locale):new RegExp(R(a))}function R(a){return a.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(a,b,c,d,e){return b||c||d||e}).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function S(a,b){var c,d=b;for("string"==typeof a&&(a=[a]),"number"==typeof b&&(d=function(a,c){c[b]=s(a)}),c=0;c<a.length;c++)gd[a[c]]=d}function T(a,b){S(a,function(a,c,d,e){d._w=d._w||{},b(a,d._w,d,e)})}function U(a,b,c){null!=b&&h(gd,a)&&gd[a](b,c._a,c,a)}function V(a,b){return new Date(Date.UTC(a,b+1,0)).getUTCDate()}function W(a){return this._months[a.month()]}function X(a){return this._monthsShort[a.month()]}function Y(a,b,c){var d,e,f;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),d=0;12>d;d++){if(e=j([2e3,d]),c&&!this._longMonthsParse[d]&&(this._longMonthsParse[d]=new RegExp("^"+this.months(e,"").replace(".","")+"$","i"),this._shortMonthsParse[d]=new RegExp("^"+this.monthsShort(e,"").replace(".","")+"$","i")),c||this._monthsParse[d]||(f="^"+this.months(e,"")+"|^"+this.monthsShort(e,""),this._monthsParse[d]=new RegExp(f.replace(".",""),"i")),c&&"MMMM"===b&&this._longMonthsParse[d].test(a))return d;if(c&&"MMM"===b&&this._shortMonthsParse[d].test(a))return d;if(!c&&this._monthsParse[d].test(a))return d}}function Z(a,b){var c;return"string"==typeof b&&(b=a.localeData().monthsParse(b),"number"!=typeof b)?a:(c=Math.min(a.date(),V(a.year(),b)),a._d["set"+(a._isUTC?"UTC":"")+"Month"](b,c),a)}function $(a){return null!=a?(Z(this,a),c.updateOffset(this,!0),this):F(this,"Month")}function _(){return V(this.year(),this.month())}function aa(a){var b,c=a._a;return c&&-2===l(a).overflow&&(b=c[id]<0||c[id]>11?id:c[jd]<1||c[jd]>V(c[hd],c[id])?jd:c[kd]<0||c[kd]>24||24===c[kd]&&(0!==c[ld]||0!==c[md]||0!==c[nd])?kd:c[ld]<0||c[ld]>59?ld:c[md]<0||c[md]>59?md:c[nd]<0||c[nd]>999?nd:-1,l(a)._overflowDayOfYear&&(hd>b||b>jd)&&(b=jd),l(a).overflow=b),a}function ba(a){c.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+a)}function ca(a,b){var c=!0;return i(function(){return c&&(ba(a+"\n"+(new Error).stack),c=!1),b.apply(this,arguments)},b)}function da(a,b){qd[a]||(ba(b),qd[a]=!0)}function ea(a){var b,c,d=a._i,e=rd.exec(d);if(e){for(l(a).iso=!0,b=0,c=sd.length;c>b;b++)if(sd[b][1].exec(d)){a._f=sd[b][0];break}for(b=0,c=td.length;c>b;b++)if(td[b][1].exec(d)){a._f+=(e[6]||" ")+td[b][0];break}d.match(cd)&&(a._f+="Z"),xa(a)}else a._isValid=!1}function fa(a){var b=ud.exec(a._i);return null!==b?void(a._d=new Date(+b[1])):(ea(a),void(a._isValid===!1&&(delete a._isValid,c.createFromInputFallback(a))))}function ga(a,b,c,d,e,f,g){var h=new Date(a,b,c,d,e,f,g);return 1970>a&&h.setFullYear(a),h}function ha(a){var b=new Date(Date.UTC.apply(null,arguments));return 1970>a&&b.setUTCFullYear(a),b}function ia(a){return ja(a)?366:365}function ja(a){return a%4===0&&a%100!==0||a%400===0}function ka(){return ja(this.year())}function la(a,b,c){var d,e=c-b,f=c-a.day();return f>e&&(f-=7),e-7>f&&(f+=7),d=Fa(a).add(f,"d"),{week:Math.ceil(d.dayOfYear()/7),year:d.year()}}function ma(a){return la(a,this._week.dow,this._week.doy).week}function na(){return this._week.dow}function oa(){return this._week.doy}function pa(a){var b=this.localeData().week(this);return null==a?b:this.add(7*(a-b),"d")}function qa(a){var b=la(this,1,4).week;return null==a?b:this.add(7*(a-b),"d")}function ra(a,b,c,d,e){var f,g=6+e-d,h=ha(a,0,1+g),i=h.getUTCDay();return e>i&&(i+=7),c=null!=c?1*c:e,f=1+g+7*(b-1)-i+c,{year:f>0?a:a-1,dayOfYear:f>0?f:ia(a-1)+f}}function sa(a){var b=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==a?b:this.add(a-b,"d")}function ta(a,b,c){return null!=a?a:null!=b?b:c}function ua(a){var b=new Date;return a._useUTC?[b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]:[b.getFullYear(),b.getMonth(),b.getDate()]}function va(a){var b,c,d,e,f=[];if(!a._d){for(d=ua(a),a._w&&null==a._a[jd]&&null==a._a[id]&&wa(a),a._dayOfYear&&(e=ta(a._a[hd],d[hd]),a._dayOfYear>ia(e)&&(l(a)._overflowDayOfYear=!0),c=ha(e,0,a._dayOfYear),a._a[id]=c.getUTCMonth(),a._a[jd]=c.getUTCDate()),b=0;3>b&&null==a._a[b];++b)a._a[b]=f[b]=d[b];for(;7>b;b++)a._a[b]=f[b]=null==a._a[b]?2===b?1:0:a._a[b];24===a._a[kd]&&0===a._a[ld]&&0===a._a[md]&&0===a._a[nd]&&(a._nextDay=!0,a._a[kd]=0),a._d=(a._useUTC?ha:ga).apply(null,f),null!=a._tzm&&a._d.setUTCMinutes(a._d.getUTCMinutes()-a._tzm),a._nextDay&&(a._a[kd]=24)}}function wa(a){var b,c,d,e,f,g,h;b=a._w,null!=b.GG||null!=b.W||null!=b.E?(f=1,g=4,c=ta(b.GG,a._a[hd],la(Fa(),1,4).year),d=ta(b.W,1),e=ta(b.E,1)):(f=a._locale._week.dow,g=a._locale._week.doy,c=ta(b.gg,a._a[hd],la(Fa(),f,g).year),d=ta(b.w,1),null!=b.d?(e=b.d,f>e&&++d):e=null!=b.e?b.e+f:f),h=ra(c,d,e,g,f),a._a[hd]=h.year,a._dayOfYear=h.dayOfYear}function xa(a){if(a._f===c.ISO_8601)return void ea(a);a._a=[],l(a).empty=!0;var b,d,e,f,g,h=""+a._i,i=h.length,j=0;for(e=N(a._f,a._locale).match(Pc)||[],b=0;b<e.length;b++)f=e[b],d=(h.match(Q(f,a))||[])[0],d&&(g=h.substr(0,h.indexOf(d)),g.length>0&&l(a).unusedInput.push(g),h=h.slice(h.indexOf(d)+d.length),j+=d.length),Sc[f]?(d?l(a).empty=!1:l(a).unusedTokens.push(f),U(f,d,a)):a._strict&&!d&&l(a).unusedTokens.push(f);l(a).charsLeftOver=i-j,h.length>0&&l(a).unusedInput.push(h),l(a).bigHour===!0&&a._a[kd]<=12&&a._a[kd]>0&&(l(a).bigHour=void 0),a._a[kd]=ya(a._locale,a._a[kd],a._meridiem),va(a),aa(a)}function ya(a,b,c){var d;return null==c?b:null!=a.meridiemHour?a.meridiemHour(b,c):null!=a.isPM?(d=a.isPM(c),d&&12>b&&(b+=12),d||12!==b||(b=0),b):b}function za(a){var b,c,d,e,f;if(0===a._f.length)return l(a).invalidFormat=!0,void(a._d=new Date(NaN));for(e=0;e<a._f.length;e++)f=0,b=o({},a),null!=a._useUTC&&(b._useUTC=a._useUTC),b._f=a._f[e],xa(b),m(b)&&(f+=l(b).charsLeftOver,f+=10*l(b).unusedTokens.length,l(b).score=f,(null==d||d>f)&&(d=f,c=b));i(a,c||b)}function Aa(a){if(!a._d){var b=D(a._i);a._a=[b.year,b.month,b.day||b.date,b.hour,b.minute,b.second,b.millisecond],va(a)}}function Ba(a){var b=new p(aa(Ca(a)));return b._nextDay&&(b.add(1,"d"),b._nextDay=void 0),b}function Ca(a){var b=a._i,c=a._f;return a._locale=a._locale||A(a._l),null===b||void 0===c&&""===b?n({nullInput:!0}):("string"==typeof b&&(a._i=b=a._locale.preparse(b)),q(b)?new p(aa(b)):(e(c)?za(a):c?xa(a):f(b)?a._d=b:Da(a),a))}function Da(a){var b=a._i;void 0===b?a._d=new Date:f(b)?a._d=new Date(+b):"string"==typeof b?fa(a):e(b)?(a._a=g(b.slice(0),function(a){return parseInt(a,10)}),va(a)):"object"==typeof b?Aa(a):"number"==typeof b?a._d=new Date(b):c.createFromInputFallback(a)}function Ea(a,b,c,d,e){var f={};return"boolean"==typeof c&&(d=c,c=void 0),f._isAMomentObject=!0,f._useUTC=f._isUTC=e,f._l=c,f._i=a,f._f=b,f._strict=d,Ba(f)}function Fa(a,b,c,d){return Ea(a,b,c,d,!1)}function Ga(a,b){var c,d;if(1===b.length&&e(b[0])&&(b=b[0]),!b.length)return Fa();for(c=b[0],d=1;d<b.length;++d)b[d].isValid()&&!b[d][a](c)||(c=b[d]);return c}function Ha(){var a=[].slice.call(arguments,0);return Ga("isBefore",a)}function Ia(){var a=[].slice.call(arguments,0);return Ga("isAfter",a)}function Ja(a){var b=D(a),c=b.year||0,d=b.quarter||0,e=b.month||0,f=b.week||0,g=b.day||0,h=b.hour||0,i=b.minute||0,j=b.second||0,k=b.millisecond||0;this._milliseconds=+k+1e3*j+6e4*i+36e5*h,this._days=+g+7*f,this._months=+e+3*d+12*c,this._data={},this._locale=A(),this._bubble()}function Ka(a){return a instanceof Ja}function La(a,b){J(a,0,0,function(){var a=this.utcOffset(),c="+";return 0>a&&(a=-a,c="-"),c+I(~~(a/60),2)+b+I(~~a%60,2)})}function Ma(a){var b=(a||"").match(cd)||[],c=b[b.length-1]||[],d=(c+"").match(zd)||["-",0,0],e=+(60*d[1])+s(d[2]);return"+"===d[0]?e:-e}function Na(a,b){var d,e;return b._isUTC?(d=b.clone(),e=(q(a)||f(a)?+a:+Fa(a))-+d,d._d.setTime(+d._d+e),c.updateOffset(d,!1),d):Fa(a).local()}function Oa(a){return 15*-Math.round(a._d.getTimezoneOffset()/15)}function Pa(a,b){var d,e=this._offset||0;return null!=a?("string"==typeof a&&(a=Ma(a)),Math.abs(a)<16&&(a=60*a),!this._isUTC&&b&&(d=Oa(this)),this._offset=a,this._isUTC=!0,null!=d&&this.add(d,"m"),e!==a&&(!b||this._changeInProgress?db(this,$a(a-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,c.updateOffset(this,!0),this._changeInProgress=null)),this):this._isUTC?e:Oa(this)}function Qa(a,b){return null!=a?("string"!=typeof a&&(a=-a),this.utcOffset(a,b),this):-this.utcOffset()}function Ra(a){return this.utcOffset(0,a)}function Sa(a){return this._isUTC&&(this.utcOffset(0,a),this._isUTC=!1,a&&this.subtract(Oa(this),"m")),this}function Ta(){return this._tzm?this.utcOffset(this._tzm):"string"==typeof this._i&&this.utcOffset(Ma(this._i)),this}function Ua(a){return a=a?Fa(a).utcOffset():0,(this.utcOffset()-a)%60===0}function Va(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function Wa(){if("undefined"!=typeof this._isDSTShifted)return this._isDSTShifted;var a={};if(o(a,this),a=Ca(a),a._a){var b=a._isUTC?j(a._a):Fa(a._a);this._isDSTShifted=this.isValid()&&t(a._a,b.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted}function Xa(){return!this._isUTC}function Ya(){return this._isUTC}function Za(){return this._isUTC&&0===this._offset}function $a(a,b){var c,d,e,f=a,g=null;return Ka(a)?f={ms:a._milliseconds,d:a._days,M:a._months}:"number"==typeof a?(f={},b?f[b]=a:f.milliseconds=a):(g=Ad.exec(a))?(c="-"===g[1]?-1:1,f={y:0,d:s(g[jd])*c,h:s(g[kd])*c,m:s(g[ld])*c,s:s(g[md])*c,ms:s(g[nd])*c}):(g=Bd.exec(a))?(c="-"===g[1]?-1:1,f={y:_a(g[2],c),M:_a(g[3],c),d:_a(g[4],c),h:_a(g[5],c),m:_a(g[6],c),s:_a(g[7],c),w:_a(g[8],c)}):null==f?f={}:"object"==typeof f&&("from"in f||"to"in f)&&(e=bb(Fa(f.from),Fa(f.to)),f={},f.ms=e.milliseconds,f.M=e.months),d=new Ja(f),Ka(a)&&h(a,"_locale")&&(d._locale=a._locale),d}function _a(a,b){var c=a&&parseFloat(a.replace(",","."));return(isNaN(c)?0:c)*b}function ab(a,b){var c={milliseconds:0,months:0};return c.months=b.month()-a.month()+12*(b.year()-a.year()),a.clone().add(c.months,"M").isAfter(b)&&--c.months,c.milliseconds=+b-+a.clone().add(c.months,"M"),c}function bb(a,b){var c;return b=Na(b,a),a.isBefore(b)?c=ab(a,b):(c=ab(b,a),c.milliseconds=-c.milliseconds,c.months=-c.months),c}function cb(a,b){return function(c,d){var e,f;return null===d||isNaN(+d)||(da(b,"moment()."+b+"(period, number) is deprecated. Please use moment()."+b+"(number, period)."),f=c,c=d,d=f),c="string"==typeof c?+c:c,e=$a(c,d),db(this,e,a),this}}function db(a,b,d,e){var f=b._milliseconds,g=b._days,h=b._months;e=null==e?!0:e,f&&a._d.setTime(+a._d+f*d),g&&G(a,"Date",F(a,"Date")+g*d),h&&Z(a,F(a,"Month")+h*d),e&&c.updateOffset(a,g||h)}function eb(a,b){var c=a||Fa(),d=Na(c,this).startOf("day"),e=this.diff(d,"days",!0),f=-6>e?"sameElse":-1>e?"lastWeek":0>e?"lastDay":1>e?"sameDay":2>e?"nextDay":7>e?"nextWeek":"sameElse";return this.format(b&&b[f]||this.localeData().calendar(f,this,Fa(c)))}function fb(){return new p(this)}function gb(a,b){var c;return b=C("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=q(a)?a:Fa(a),+this>+a):(c=q(a)?+a:+Fa(a),c<+this.clone().startOf(b))}function hb(a,b){var c;return b=C("undefined"!=typeof b?b:"millisecond"),"millisecond"===b?(a=q(a)?a:Fa(a),+a>+this):(c=q(a)?+a:+Fa(a),+this.clone().endOf(b)<c)}function ib(a,b,c){return this.isAfter(a,c)&&this.isBefore(b,c)}function jb(a,b){var c;return b=C(b||"millisecond"),"millisecond"===b?(a=q(a)?a:Fa(a),+this===+a):(c=+Fa(a),+this.clone().startOf(b)<=c&&c<=+this.clone().endOf(b))}function kb(a,b,c){var d,e,f=Na(a,this),g=6e4*(f.utcOffset()-this.utcOffset());return b=C(b),"year"===b||"month"===b||"quarter"===b?(e=lb(this,f),"quarter"===b?e/=3:"year"===b&&(e/=12)):(d=this-f,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?(d-g)/864e5:"week"===b?(d-g)/6048e5:d),c?e:r(e)}function lb(a,b){var c,d,e=12*(b.year()-a.year())+(b.month()-a.month()),f=a.clone().add(e,"months");return 0>b-f?(c=a.clone().add(e-1,"months"),d=(b-f)/(f-c)):(c=a.clone().add(e+1,"months"),d=(b-f)/(c-f)),-(e+d)}function mb(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function nb(){var a=this.clone().utc();return 0<a.year()&&a.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():M(a,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):M(a,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")}function ob(a){var b=M(this,a||c.defaultFormat);return this.localeData().postformat(b)}function pb(a,b){return this.isValid()?$a({to:this,from:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function qb(a){return this.from(Fa(),a)}function rb(a,b){return this.isValid()?$a({from:this,to:a}).locale(this.locale()).humanize(!b):this.localeData().invalidDate()}function sb(a){return this.to(Fa(),a)}function tb(a){var b;return void 0===a?this._locale._abbr:(b=A(a),null!=b&&(this._locale=b),this)}function ub(){return this._locale}function vb(a){switch(a=C(a)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.weekday(0),"isoWeek"===a&&this.isoWeekday(1),"quarter"===a&&this.month(3*Math.floor(this.month()/3)),this}function wb(a){return a=C(a),void 0===a||"millisecond"===a?this:this.startOf(a).add(1,"isoWeek"===a?"week":a).subtract(1,"ms")}function xb(){return+this._d-6e4*(this._offset||0)}function yb(){return Math.floor(+this/1e3)}function zb(){return this._offset?new Date(+this):this._d}function Ab(){var a=this;return[a.year(),a.month(),a.date(),a.hour(),a.minute(),a.second(),a.millisecond()]}function Bb(){var a=this;return{years:a.year(),months:a.month(),date:a.date(),hours:a.hours(),minutes:a.minutes(),seconds:a.seconds(),milliseconds:a.milliseconds()}}function Cb(){return m(this)}function Db(){return i({},l(this))}function Eb(){return l(this).overflow}function Fb(a,b){J(0,[a,a.length],0,b)}function Gb(a,b,c){return la(Fa([a,11,31+b-c]),b,c).week}function Hb(a){var b=la(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==a?b:this.add(a-b,"y")}function Ib(a){var b=la(this,1,4).year;return null==a?b:this.add(a-b,"y")}function Jb(){return Gb(this.year(),1,4)}function Kb(){var a=this.localeData()._week;return Gb(this.year(),a.dow,a.doy)}function Lb(a){return null==a?Math.ceil((this.month()+1)/3):this.month(3*(a-1)+this.month()%3)}function Mb(a,b){return"string"!=typeof a?a:isNaN(a)?(a=b.weekdaysParse(a),"number"==typeof a?a:null):parseInt(a,10)}function Nb(a){return this._weekdays[a.day()]}function Ob(a){return this._weekdaysShort[a.day()]}function Pb(a){return this._weekdaysMin[a.day()]}function Qb(a){var b,c,d;for(this._weekdaysParse=this._weekdaysParse||[],b=0;7>b;b++)if(this._weekdaysParse[b]||(c=Fa([2e3,1]).day(b),d="^"+this.weekdays(c,"")+"|^"+this.weekdaysShort(c,"")+"|^"+this.weekdaysMin(c,""),this._weekdaysParse[b]=new RegExp(d.replace(".",""),"i")),this._weekdaysParse[b].test(a))return b}function Rb(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=a?(a=Mb(a,this.localeData()),this.add(a-b,"d")):b}function Sb(a){var b=(this.day()+7-this.localeData()._week.dow)%7;return null==a?b:this.add(a-b,"d")}function Tb(a){return null==a?this.day()||7:this.day(this.day()%7?a:a-7)}function Ub(a,b){J(a,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),b)})}function Vb(a,b){return b._meridiemParse}function Wb(a){return"p"===(a+"").toLowerCase().charAt(0)}function Xb(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"}function Yb(a,b){b[nd]=s(1e3*("0."+a))}function Zb(){return this._isUTC?"UTC":""}function $b(){return this._isUTC?"Coordinated Universal Time":""}function _b(a){return Fa(1e3*a)}function ac(){return Fa.apply(null,arguments).parseZone()}function bc(a,b,c){var d=this._calendar[a];return"function"==typeof d?d.call(b,c):d}function cc(a){var b=this._longDateFormat[a],c=this._longDateFormat[a.toUpperCase()];return b||!c?b:(this._longDateFormat[a]=c.replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a])}function dc(){return this._invalidDate}function ec(a){return this._ordinal.replace("%d",a)}function fc(a){return a}function gc(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)}function hc(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)}function ic(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)}function jc(a,b,c,d){var e=A(),f=j().set(d,b);return e[c](f,a)}function kc(a,b,c,d,e){if("number"==typeof a&&(b=a,a=void 0),a=a||"",null!=b)return jc(a,b,c,e);var f,g=[];for(f=0;d>f;f++)g[f]=jc(a,f,c,e);return g}function lc(a,b){return kc(a,b,"months",12,"month")}function mc(a,b){return kc(a,b,"monthsShort",12,"month")}function nc(a,b){return kc(a,b,"weekdays",7,"day")}function oc(a,b){return kc(a,b,"weekdaysShort",7,"day")}function pc(a,b){return kc(a,b,"weekdaysMin",7,"day")}function qc(){var a=this._data;return this._milliseconds=Yd(this._milliseconds),this._days=Yd(this._days),this._months=Yd(this._months),a.milliseconds=Yd(a.milliseconds),a.seconds=Yd(a.seconds),a.minutes=Yd(a.minutes),a.hours=Yd(a.hours),a.months=Yd(a.months),a.years=Yd(a.years),this}function rc(a,b,c,d){var e=$a(b,c);return a._milliseconds+=d*e._milliseconds,a._days+=d*e._days,a._months+=d*e._months,a._bubble()}function sc(a,b){return rc(this,a,b,1)}function tc(a,b){return rc(this,a,b,-1)}function uc(a){return 0>a?Math.floor(a):Math.ceil(a)}function vc(){var a,b,c,d,e,f=this._milliseconds,g=this._days,h=this._months,i=this._data;return f>=0&&g>=0&&h>=0||0>=f&&0>=g&&0>=h||(f+=864e5*uc(xc(h)+g),g=0,h=0),i.milliseconds=f%1e3,a=r(f/1e3),i.seconds=a%60,b=r(a/60),i.minutes=b%60,c=r(b/60),i.hours=c%24,g+=r(c/24),e=r(wc(g)),h+=e,g-=uc(xc(e)),d=r(h/12),h%=12,i.days=g,i.months=h,i.years=d,this}function wc(a){return 4800*a/146097}function xc(a){return 146097*a/4800}function yc(a){var b,c,d=this._milliseconds;if(a=C(a),"month"===a||"year"===a)return b=this._days+d/864e5,c=this._months+wc(b),"month"===a?c:c/12;switch(b=this._days+Math.round(xc(this._months)),a){case"week":return b/7+d/6048e5;case"day":return b+d/864e5;case"hour":return 24*b+d/36e5;case"minute":return 1440*b+d/6e4;case"second":return 86400*b+d/1e3;case"millisecond":return Math.floor(864e5*b)+d;default:throw new Error("Unknown unit "+a)}}function zc(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*s(this._months/12)}function Ac(a){return function(){return this.as(a)}}function Bc(a){return a=C(a),this[a+"s"]()}function Cc(a){return function(){return this._data[a]}}function Dc(){return r(this.days()/7)}function Ec(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function Fc(a,b,c){var d=$a(a).abs(),e=me(d.as("s")),f=me(d.as("m")),g=me(d.as("h")),h=me(d.as("d")),i=me(d.as("M")),j=me(d.as("y")),k=e<ne.s&&["s",e]||1===f&&["m"]||f<ne.m&&["mm",f]||1===g&&["h"]||g<ne.h&&["hh",g]||1===h&&["d"]||h<ne.d&&["dd",h]||1===i&&["M"]||i<ne.M&&["MM",i]||1===j&&["y"]||["yy",j];return k[2]=b,k[3]=+a>0,k[4]=c,Ec.apply(null,k)}function Gc(a,b){return void 0===ne[a]?!1:void 0===b?ne[a]:(ne[a]=b,!0)}function Hc(a){var b=this.localeData(),c=Fc(this,!a,b);return a&&(c=b.pastFuture(+this,c)),b.postformat(c)}function Ic(){var a,b,c,d=oe(this._milliseconds)/1e3,e=oe(this._days),f=oe(this._months);a=r(d/60),b=r(a/60),d%=60,a%=60,c=r(f/12),f%=12;var g=c,h=f,i=e,j=b,k=a,l=d,m=this.asSeconds();return m?(0>m?"-":"")+"P"+(g?g+"Y":"")+(h?h+"M":"")+(i?i+"D":"")+(j||k||l?"T":"")+(j?j+"H":"")+(k?k+"M":"")+(l?l+"S":""):"P0D"}var Jc,Kc,Lc=c.momentProperties=[],Mc=!1,Nc={},Oc={},Pc=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Qc=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Rc={},Sc={},Tc=/\d/,Uc=/\d\d/,Vc=/\d{3}/,Wc=/\d{4}/,Xc=/[+-]?\d{6}/,Yc=/\d\d?/,Zc=/\d{1,3}/,$c=/\d{1,4}/,_c=/[+-]?\d{1,6}/,ad=/\d+/,bd=/[+-]?\d+/,cd=/Z|[+-]\d\d:?\d\d/gi,dd=/[+-]?\d+(\.\d{1,3})?/,ed=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,fd={},gd={},hd=0,id=1,jd=2,kd=3,ld=4,md=5,nd=6;J("M",["MM",2],"Mo",function(){return this.month()+1}),J("MMM",0,0,function(a){return this.localeData().monthsShort(this,a)}),J("MMMM",0,0,function(a){return this.localeData().months(this,a)}),B("month","M"),P("M",Yc),P("MM",Yc,Uc),P("MMM",ed),P("MMMM",ed),S(["M","MM"],function(a,b){b[id]=s(a)-1}),S(["MMM","MMMM"],function(a,b,c,d){var e=c._locale.monthsParse(a,d,c._strict);null!=e?b[id]=e:l(c).invalidMonth=a});var od="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),pd="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),qd={};c.suppressDeprecationWarnings=!1;var rd=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,sd=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],td=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ud=/^\/?Date\((\-?\d+)/i;c.createFromInputFallback=ca("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(a){a._d=new Date(a._i+(a._useUTC?" UTC":""))}),J(0,["YY",2],0,function(){return this.year()%100}),J(0,["YYYY",4],0,"year"),J(0,["YYYYY",5],0,"year"),J(0,["YYYYYY",6,!0],0,"year"),B("year","y"),P("Y",bd),P("YY",Yc,Uc),P("YYYY",$c,Wc),P("YYYYY",_c,Xc),P("YYYYYY",_c,Xc),S(["YYYYY","YYYYYY"],hd),S("YYYY",function(a,b){b[hd]=2===a.length?c.parseTwoDigitYear(a):s(a)}),S("YY",function(a,b){b[hd]=c.parseTwoDigitYear(a)}),c.parseTwoDigitYear=function(a){return s(a)+(s(a)>68?1900:2e3)};var vd=E("FullYear",!1);J("w",["ww",2],"wo","week"),J("W",["WW",2],"Wo","isoWeek"),B("week","w"),B("isoWeek","W"),P("w",Yc),P("ww",Yc,Uc),P("W",Yc),P("WW",Yc,Uc),T(["w","ww","W","WW"],function(a,b,c,d){b[d.substr(0,1)]=s(a)});var wd={dow:0,doy:6};J("DDD",["DDDD",3],"DDDo","dayOfYear"),B("dayOfYear","DDD"),P("DDD",Zc),P("DDDD",Vc),S(["DDD","DDDD"],function(a,b,c){c._dayOfYear=s(a)}),c.ISO_8601=function(){};var xd=ca("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(){var a=Fa.apply(null,arguments);return this>a?this:a}),yd=ca("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(){var a=Fa.apply(null,arguments);return a>this?this:a});La("Z",":"),La("ZZ",""),P("Z",cd),P("ZZ",cd),S(["Z","ZZ"],function(a,b,c){c._useUTC=!0,c._tzm=Ma(a)});var zd=/([\+\-]|\d\d)/gi;c.updateOffset=function(){};var Ad=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Bd=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/;$a.fn=Ja.prototype;var Cd=cb(1,"add"),Dd=cb(-1,"subtract");c.defaultFormat="YYYY-MM-DDTHH:mm:ssZ";var Ed=ca("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(a){return void 0===a?this.localeData():this.locale(a)});J(0,["gg",2],0,function(){return this.weekYear()%100}),J(0,["GG",2],0,function(){return this.isoWeekYear()%100}),Fb("gggg","weekYear"),Fb("ggggg","weekYear"),Fb("GGGG","isoWeekYear"),Fb("GGGGG","isoWeekYear"),B("weekYear","gg"),B("isoWeekYear","GG"),P("G",bd),P("g",bd),P("GG",Yc,Uc),P("gg",Yc,Uc),P("GGGG",$c,Wc),P("gggg",$c,Wc),P("GGGGG",_c,Xc),P("ggggg",_c,Xc),T(["gggg","ggggg","GGGG","GGGGG"],function(a,b,c,d){b[d.substr(0,2)]=s(a)}),T(["gg","GG"],function(a,b,d,e){b[e]=c.parseTwoDigitYear(a)}),J("Q",0,0,"quarter"),B("quarter","Q"),P("Q",Tc),S("Q",function(a,b){b[id]=3*(s(a)-1)}),J("D",["DD",2],"Do","date"),B("date","D"),P("D",Yc),P("DD",Yc,Uc),P("Do",function(a,b){return a?b._ordinalParse:b._ordinalParseLenient}),S(["D","DD"],jd),S("Do",function(a,b){b[jd]=s(a.match(Yc)[0],10)});var Fd=E("Date",!0);J("d",0,"do","day"),J("dd",0,0,function(a){return this.localeData().weekdaysMin(this,a)}),J("ddd",0,0,function(a){return this.localeData().weekdaysShort(this,a)}),J("dddd",0,0,function(a){return this.localeData().weekdays(this,a)}),J("e",0,0,"weekday"),J("E",0,0,"isoWeekday"),B("day","d"),B("weekday","e"),B("isoWeekday","E"),P("d",Yc),P("e",Yc),P("E",Yc),P("dd",ed),P("ddd",ed),P("dddd",ed),T(["dd","ddd","dddd"],function(a,b,c){var d=c._locale.weekdaysParse(a);null!=d?b.d=d:l(c).invalidWeekday=a}),T(["d","e","E"],function(a,b,c,d){b[d]=s(a)});var Gd="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Hd="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),Id="Su_Mo_Tu_We_Th_Fr_Sa".split("_");J("H",["HH",2],0,"hour"),J("h",["hh",2],0,function(){return this.hours()%12||12}),Ub("a",!0),Ub("A",!1),B("hour","h"),P("a",Vb),P("A",Vb),P("H",Yc),P("h",Yc),P("HH",Yc,Uc),P("hh",Yc,Uc),S(["H","HH"],kd),S(["a","A"],function(a,b,c){c._isPm=c._locale.isPM(a),c._meridiem=a}),S(["h","hh"],function(a,b,c){b[kd]=s(a),l(c).bigHour=!0});var Jd=/[ap]\.?m?\.?/i,Kd=E("Hours",!0);J("m",["mm",2],0,"minute"),B("minute","m"),P("m",Yc),P("mm",Yc,Uc),S(["m","mm"],ld);var Ld=E("Minutes",!1);J("s",["ss",2],0,"second"),B("second","s"),P("s",Yc),P("ss",Yc,Uc),S(["s","ss"],md);var Md=E("Seconds",!1);J("S",0,0,function(){return~~(this.millisecond()/100)}),J(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),J(0,["SSS",3],0,"millisecond"),J(0,["SSSS",4],0,function(){return 10*this.millisecond()}),J(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),J(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),J(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),J(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),J(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),B("millisecond","ms"),P("S",Zc,Tc),P("SS",Zc,Uc),P("SSS",Zc,Vc);var Nd;for(Nd="SSSS";Nd.length<=9;Nd+="S")P(Nd,ad);for(Nd="S";Nd.length<=9;Nd+="S")S(Nd,Yb);var Od=E("Milliseconds",!1);J("z",0,0,"zoneAbbr"),J("zz",0,0,"zoneName");var Pd=p.prototype;Pd.add=Cd,Pd.calendar=eb,Pd.clone=fb,Pd.diff=kb,Pd.endOf=wb,Pd.format=ob,Pd.from=pb,Pd.fromNow=qb,Pd.to=rb,Pd.toNow=sb,Pd.get=H,Pd.invalidAt=Eb,Pd.isAfter=gb,Pd.isBefore=hb,Pd.isBetween=ib,Pd.isSame=jb,Pd.isValid=Cb,Pd.lang=Ed,Pd.locale=tb,Pd.localeData=ub,Pd.max=yd,Pd.min=xd,Pd.parsingFlags=Db,Pd.set=H,Pd.startOf=vb,Pd.subtract=Dd,Pd.toArray=Ab,Pd.toObject=Bb,Pd.toDate=zb,Pd.toISOString=nb,Pd.toJSON=nb,Pd.toString=mb,Pd.unix=yb,Pd.valueOf=xb,Pd.year=vd,Pd.isLeapYear=ka,Pd.weekYear=Hb,Pd.isoWeekYear=Ib,Pd.quarter=Pd.quarters=Lb,Pd.month=$,Pd.daysInMonth=_,Pd.week=Pd.weeks=pa,Pd.isoWeek=Pd.isoWeeks=qa,Pd.weeksInYear=Kb,Pd.isoWeeksInYear=Jb,Pd.date=Fd,Pd.day=Pd.days=Rb,Pd.weekday=Sb,Pd.isoWeekday=Tb,Pd.dayOfYear=sa,Pd.hour=Pd.hours=Kd,Pd.minute=Pd.minutes=Ld,Pd.second=Pd.seconds=Md,Pd.millisecond=Pd.milliseconds=Od,Pd.utcOffset=Pa,Pd.utc=Ra,Pd.local=Sa,Pd.parseZone=Ta,Pd.hasAlignedHourOffset=Ua,Pd.isDST=Va,Pd.isDSTShifted=Wa,Pd.isLocal=Xa,Pd.isUtcOffset=Ya,Pd.isUtc=Za,Pd.isUTC=Za,Pd.zoneAbbr=Zb,Pd.zoneName=$b,Pd.dates=ca("dates accessor is deprecated. Use date instead.",Fd),Pd.months=ca("months accessor is deprecated. Use month instead",$),Pd.years=ca("years accessor is deprecated. Use year instead",vd),Pd.zone=ca("moment().zone is deprecated, use moment().utcOffset instead. https://github.com/moment/moment/issues/1779",Qa);var Qd=Pd,Rd={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Sd={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},Td="Invalid date",Ud="%d",Vd=/\d{1,2}/,Wd={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},Xd=u.prototype;Xd._calendar=Rd,Xd.calendar=bc,Xd._longDateFormat=Sd,Xd.longDateFormat=cc,Xd._invalidDate=Td,Xd.invalidDate=dc,Xd._ordinal=Ud,Xd.ordinal=ec,Xd._ordinalParse=Vd,Xd.preparse=fc,Xd.postformat=fc,Xd._relativeTime=Wd,Xd.relativeTime=gc,Xd.pastFuture=hc,Xd.set=ic,Xd.months=W,Xd._months=od,Xd.monthsShort=X,Xd._monthsShort=pd,Xd.monthsParse=Y,Xd.week=ma,Xd._week=wd,Xd.firstDayOfYear=oa,Xd.firstDayOfWeek=na,Xd.weekdays=Nb,Xd._weekdays=Gd,Xd.weekdaysMin=Pb,Xd._weekdaysMin=Id,Xd.weekdaysShort=Ob,Xd._weekdaysShort=Hd,Xd.weekdaysParse=Qb,Xd.isPM=Wb,Xd._meridiemParse=Jd,Xd.meridiem=Xb,y("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(a){var b=a%10,c=1===s(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),c.lang=ca("moment.lang is deprecated. Use moment.locale instead.",y),c.langData=ca("moment.langData is deprecated. Use moment.localeData instead.",A);var Yd=Math.abs,Zd=Ac("ms"),$d=Ac("s"),_d=Ac("m"),ae=Ac("h"),be=Ac("d"),ce=Ac("w"),de=Ac("M"),ee=Ac("y"),fe=Cc("milliseconds"),ge=Cc("seconds"),he=Cc("minutes"),ie=Cc("hours"),je=Cc("days"),ke=Cc("months"),le=Cc("years"),me=Math.round,ne={s:45,m:45,h:22,d:26,M:11},oe=Math.abs,pe=Ja.prototype;pe.abs=qc,pe.add=sc,pe.subtract=tc,pe.as=yc,pe.asMilliseconds=Zd,pe.asSeconds=$d,pe.asMinutes=_d,pe.asHours=ae,pe.asDays=be,pe.asWeeks=ce,pe.asMonths=de,pe.asYears=ee,pe.valueOf=zc,pe._bubble=vc,pe.get=Bc,pe.milliseconds=fe,pe.seconds=ge,pe.minutes=he,pe.hours=ie,pe.days=je,pe.weeks=Dc,pe.months=ke,pe.years=le,pe.humanize=Hc,pe.toISOString=Ic,pe.toString=Ic,pe.toJSON=Ic,pe.locale=tb,pe.localeData=ub,pe.toIsoString=ca("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ic),
pe.lang=Ed,J("X",0,0,"unix"),J("x",0,0,"valueOf"),P("x",bd),P("X",dd),S("X",function(a,b,c){c._d=new Date(1e3*parseFloat(a,10))}),S("x",function(a,b,c){c._d=new Date(s(a))}),c.version="2.10.6",d(Fa),c.fn=Qd,c.min=Ha,c.max=Ia,c.utc=j,c.unix=_b,c.months=lc,c.isDate=f,c.locale=y,c.invalid=n,c.duration=$a,c.isMoment=q,c.weekdays=nc,c.parseZone=ac,c.localeData=A,c.isDuration=Ka,c.monthsShort=mc,c.weekdaysMin=pc,c.defineLocale=z,c.weekdaysShort=oc,c.normalizeUnits=C,c.relativeTimeThreshold=Gc;var qe=c;return qe})},{}],333:[function(a,b,c){b.exports=a(60)},{"./src/js/main":339,dup:60}],334:[function(a,b,c){arguments[4][61][0].apply(c,arguments)},{dup:61}],335:[function(a,b,c){arguments[4][62][0].apply(c,arguments)},{dup:62}],336:[function(a,b,c){arguments[4][63][0].apply(c,arguments)},{dup:63}],337:[function(a,b,c){arguments[4][64][0].apply(c,arguments)},{dup:64}],338:[function(a,b,c){arguments[4][65][0].apply(c,arguments)},{"./class":334,"./dom":335,dup:65}],339:[function(a,b,c){arguments[4][66][0].apply(c,arguments)},{"./plugin/destroy":341,"./plugin/initialize":349,"./plugin/update":353,dup:66}],340:[function(a,b,c){arguments[4][67][0].apply(c,arguments)},{dup:67}],341:[function(a,b,c){arguments[4][68][0].apply(c,arguments)},{"../lib/dom":335,"../lib/helper":338,"./instances":350,dup:68}],342:[function(a,b,c){arguments[4][69][0].apply(c,arguments)},{"../../lib/helper":338,"../instances":350,"../update-geometry":351,"../update-scroll":352,dup:69}],343:[function(a,b,c){arguments[4][70][0].apply(c,arguments)},{"../../lib/dom":335,"../../lib/helper":338,"../instances":350,"../update-geometry":351,"../update-scroll":352,dup:70}],344:[function(a,b,c){arguments[4][71][0].apply(c,arguments)},{"../../lib/helper":338,"../instances":350,"../update-geometry":351,"../update-scroll":352,dup:71}],345:[function(a,b,c){arguments[4][72][0].apply(c,arguments)},{"../../lib/helper":338,"../instances":350,"../update-geometry":351,"../update-scroll":352,dup:72}],346:[function(a,b,c){arguments[4][73][0].apply(c,arguments)},{"../instances":350,"../update-geometry":351,dup:73}],347:[function(a,b,c){arguments[4][74][0].apply(c,arguments)},{"../../lib/helper":338,"../instances":350,"../update-geometry":351,"../update-scroll":352,dup:74}],348:[function(a,b,c){arguments[4][75][0].apply(c,arguments)},{"../instances":350,"../update-geometry":351,"../update-scroll":352,dup:75}],349:[function(a,b,c){arguments[4][76][0].apply(c,arguments)},{"../lib/class":334,"../lib/helper":338,"./handler/click-rail":342,"./handler/drag-scrollbar":343,"./handler/keyboard":344,"./handler/mouse-wheel":345,"./handler/native-scroll":346,"./handler/selection":347,"./handler/touch":348,"./instances":350,"./update-geometry":351,dup:76}],350:[function(a,b,c){arguments[4][77][0].apply(c,arguments)},{"../lib/dom":335,"../lib/event-manager":336,"../lib/guid":337,"../lib/helper":338,"./default-setting":340,dup:77}],351:[function(a,b,c){arguments[4][78][0].apply(c,arguments)},{"../lib/class":334,"../lib/dom":335,"../lib/helper":338,"./instances":350,"./update-scroll":352,dup:78}],352:[function(a,b,c){arguments[4][79][0].apply(c,arguments)},{"./instances":350,dup:79}],353:[function(a,b,c){arguments[4][80][0].apply(c,arguments)},{"../lib/dom":335,"../lib/helper":338,"./instances":350,"./update-geometry":351,dup:80}],354:[function(a,b,c){b.exports=a(148)},{dup:148}],355:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("./dashboard-view"),g=a("./widgets/widgets-collection"),h=a("./widgets-service");b.exports=function(a,b,c){var i=document.querySelector(a);if(!i)throw new Error("no element found with selector "+a);c=c||{},c.renderMenu=d.isBoolean(c.renderMenu)?c.renderMenu:!0;var j=new g,k=new e.core.Model({title:b.title,description:b.description,updatedAt:b.updated_at,userName:b.user.fullname,userAvatarURL:b.user.avatar_url,renderMenu:c.renderMenu}),l=new f({el:i,widgets:j,model:k}),m=e.createVis(l.$("#map"),b,d.extend(c,{skipMapInstantiation:!0})),n=new h(j,m.dataviews),o={list:n.createListModel.bind(n),formula:n.createFormulaModel.bind(n),histogram:n.createHistogramModel.bind(n),"time-series":n.createTimeSeriesModel.bind(n),category:n.createCategoryModel.bind(n)};return b.widgets.forEach(function(a){var b=d.extend({},a,a.options),c=o[a.type];if(d.isFunction(c)){var f;a.layer_id?f=m.map.layers.get(a.layer_id):Number.isInteger(a.layerIndex)&&(f=m.map.layers.at(a.layerIndex)),c(b,f)}else e.log.error("No widget found for type "+a.type)}),l.render(),j.size()>0&&m.centerMapToOrigin(),m.instantiateMap(),{dashboardView:l,widgets:n,vis:m}}},{"./dashboard-view":361,"./widgets-service":365,"./widgets/widgets-collection":438,"cartodb.js":283,underscore:354}],356:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("./widgets/widget-view-factory"),g=a("./widgets/time-series/content-view"),h=a("./widgets/time-series/torque-content-view");b.exports=e.core.View.extend({className:"CDB-Dashboard-belowMap",initialize:function(a){this._widgetViewFactory=new f([{match:function(a){if("time-series"===a.get("type")){var b=a.dataviewModel;return b&&"torque"===b.layer.get("type")}return!1},createContentView:function(a){return new h({model:a})},customizeWidgetAttrs:function(a){return a.className+=" CDB-Widget--timeSeries",a}},{type:"time-series",createContentView:function(a){return new g({model:a})},customizeWidgetAttrs:function(a){return a.className+=" CDB-Widget--timeSeries",a}}]),this._widgets=a.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("add reset remove",this._onWidgetsChange,this),this.add_related_model(this._widgets)},render:function(){return this.clearSubViews(),this.$el.empty(),this._widgets.each(this._maybeRenderWidgetView,this),this._toggleVisiblity(),this},_maybeRenderWidgetView:function(a){var b=this._widgetViewFactory.createWidgetView(a);b&&(this.addView(b),this.$el.append(b.render().el))},_toggleVisiblity:function(){this.$el.toggle(!d.isEmpty(this._subviews))},_onWidgetsChange:function(){this._toggleVisiblity()}})},{"./widgets/time-series/content-view":413,"./widgets/time-series/torque-content-view":418,"./widgets/widget-view-factory":436,"cartodb.js":283,underscore:354}],357:[function(a,b,c){var d=a("cartodb.js"),e=a("./dashboard-menu-view.tpl"),f=a("moment"),g=d.core.View.extend({className:"CDB-Dashboard-menu",events:{"click .js-toggle-view":"_toogleView"},render:function(){return this.$el.html(e({title:this.model.get("title"),description:this.model.get("description"),updatedAt:f(this.model.get("updatedAt")).fromNow(),userName:this.model.get("userName"),userAvatarURL:this.model.get("userAvatarURL")})),this},_toogleView:function(){this.$el.toggleClass("is-active")}});b.exports=g},{"./dashboard-menu-view.tpl":358,"cartodb.js":283,moment:332}],358:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Dashboard-menuContainer"> <div class="CDB-Dashboard-menuInner"> <div class="CDB-Dashboard-menuHeader"> <div class="CDB-Dashboard-menuLogo"> <i class="CDB-IconFont CDB-IconFont-cartoFante"></i> </div> <div class="CDB-Dashboard-menuInfo"> <button class="CDB-Shape CDB-Shape--medium js-toggle-view"> <div class="CDB-Shape-threePoints is-horizontal is-medium is-white"> <div class="CDB-Shape-threePointsItem is-round"></div> <div class="CDB-Shape-threePointsItem is-round"></div> <div class="CDB-Shape-threePointsItem is-round"></div> </div> </button> </div> <div class="CDB-Dashboard-menuInfo is-active"> <button class="CDB-Shape CDB-Shape--medium js-toggle-view"> <div class="CDB-Shape-threePoints is-horizontal is-medium"> <div class="CDB-Shape-threePointsItem is-round"></div> <div class="CDB-Shape-threePointsItem is-round"></div> <div class="CDB-Shape-threePointsItem is-round"></div> </div> </button> </div> <ul class="CDB-Dashboard-menuActions"> <li class="CDB-Dashboard-menuActionsItem"> <a href="#" class="u-hintTextColor"> <i class="CDB-IconFont CDB-IconFont-heartFill CDB-Size-large"></i> </a> </li> <li class="CDB-Dashboard-menuActionsItem"> <a href="#" class="u-hintTextColor"> <i class="CDB-IconFont CDB-IconFont-twitter CDB-Size-large"></i> </a> </li> <li class="CDB-Dashboard-menuActionsItem"> <a href="#" class="u-hintTextColor"> <i class="CDB-IconFont CDB-IconFont-facebook CDB-Size-medium"></i> </a> </li> <li class="CDB-Dashboard-menuActionsItem"> <a href="#" class="u-hintTextColor"> <i class="CDB-IconFont CDB-IconFont-anchor CDB-Size-medium"></i> </a> </li> </ul> <div class="CDB-Dashboard-menuTexts CDB-Dashboard-hideMobile"> <p class="CDB-Text CDB-Size-small u-upperCase u-altTextColor u-bSpace--m js-timeAgo">UPDATED '+(null==(__t=updatedAt)?"":_.escape(__t))+'</p> <h1 class="CDB-Dashboard-menuTitle CDB-Text CDB-Size-huge u-ellipsis js-title">'+(null==(__t=title)?"":_.escape(__t))+'</h1> <h2 class="CDB-Text CDB-Size-large is-light u-secondaryTextColor js-description">'+(null==(__t=cdb.core.sanitize.html(description))?"":__t)+'</h2> </div> </div> <div class="CDB-Dashboard-menuFooter"> <ul> <li class="CDB-Dashboard-menuFooterItem"> <div class="CDB-Dashboard-menuMedia CDB-Dashboard-menuAvatar"> <img src="'+(null==(__t=userAvatarURL)?"":_.escape(__t))+'" alt="avatar" class="inline-block"> </div> <p class="CDB-Text CDB-Size-medium CDB-Dashboard-menuFooterTxt">'+(null==(__t=userName)?"":_.escape(__t))+'</p> </li> </ul> </div> </div> <div class="CDB-Dashboard-bg js-toggle-view"></div> <div class="CDB-Dashboard-menuHeaderMobile u-showMobile"> <div class="CDB-Dashboard-menuLogo"> <i class="CDB-IconFont CDB-IconFont-cartoFante"></i> </div> <button class="js-toggle-view"> <span class="CDB-Shape CDB-Shape--hamburguer"></span> </button> <div class="CDB-Dashboard-menuMedia CDB-Dashboard-menuAvatar"> <img src="'+(null==(__t=userAvatarURL)?"":_.escape(__t))+'" alt="avatar" class="inline-block"> </div> </div> </div>';return __p}},{underscore:354}],359:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("perfect-scrollbar"),g=a("cartodb.js"),h=a("./widgets/category/content-view"),i=a("./widgets/formula/content-view"),j=a("./widgets/histogram/content-view"),k=a("./widgets/list/content-view"),l=a("./widgets/widget-view-factory"),m=a("./dashboard-sidebar.tpl");b.exports=g.core.View.extend({className:"CDB-Widget-canvas",initialize:function(a){this._widgetViewFactory=new l([{type:"formula",createContentView:function(a){return new i({model:a})}},{type:"list",createContentView:function(a){return new k({model:a})}},{type:"histogram",createContentView:function(a){return new j({model:a})}},{type:"category",createContentView:function(a){return new h({model:a})}}]),this._widgets=a.widgets,this._widgets.bind("add",this._maybeRenderWidgetView,this),this._widgets.bind("reset",this.render,this),this._widgets.bind("orderChanged",this.render,this),this._widgets.bind("change:collapsed",this._onWidgetCollapsed,this),this._widgets.bind("add remove reset",this._onUpdate,this),this.add_related_model(this._widgets)},render:function(){return this._cleanScroll(),this.clearSubViews(),this.$el.html(m()),this.$el.toggleClass("CDB-Widget-canvas--withMenu",this.model.get("renderMenu")),this._widgets.each(this._maybeRenderWidgetView,this),this.$el.toggle(!d.isEmpty(this._subviews)),this._renderScroll(),this._renderShadows(),this._bindScroll(),this},_$container:function(){return e(this._container())},_container:function(){return this.el.querySelector(".js-container")},_maybeRenderWidgetView:function(a){var b=this._widgetViewFactory.createWidgetView(a);b&&(this.addView(b),this._$container().append(b.render().el))},_bindScroll:function(){this._$container().on("ps-y-reach-start",d.bind(this._onScrollTop,this)).on("ps-y-reach-end",d.bind(this._onScrollBottom,this)).on("ps-scroll-y",d.bind(this._onScroll,this))},_renderScroll:function(){f.initialize(this._container(),{wheelSpeed:2,wheelPropagation:!0,minScrollbarLength:20})},_onWidgetCollapsed:function(){f.update(this._container())},_renderShadows:function(){this.$shadowTop=e("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--top"),this.$shadowBottom=e("<div>").addClass("CDB-Widget-canvasShadow CDB-Widget-canvasShadow--bottom is-visible"),this.$el.append(this.$shadowTop),this.$el.append(this.$shadowBottom)},_onScrollTop:function(){this.$shadowTop.removeClass("is-visible")},_onScroll:function(){var a=this._$container(),b=a.scrollTop(),c=a.get(0).scrollHeight,d=a.outerHeight(),e=c-d;this.$shadowTop.toggleClass("is-visible",b>0),this.$shadowBottom.toggleClass("is-visible",e>b)},_onScrollBottom:function(){this.$shadowBottom.removeClass("is-visible")},_cleanScroll:function(){this._container()&&(this._$container().off("ps-scroll-y"),f.destroy(this._container()))},_onUpdate:function(){this.$el.toggle(d.size(this._subviews)>0)},clean:function(){this._cleanScroll(),g.core.View.prototype.clean.call(this)}})},{"./dashboard-sidebar.tpl":360,"./widgets/category/content-view":370,"./widgets/formula/content-view":395,"./widgets/histogram/content-view":399,"./widgets/list/content-view":406,"./widgets/widget-view-factory":436,"cartodb.js":283,jquery:331,"perfect-scrollbar":333,underscore:354}],360:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-canvasInner js-container"></div>';return __p}},{underscore:354}],361:[function(a,b,c){var d=a("cartodb.js"),e=a("./dashboard.tpl"),f=a("./dashboard-below-map-view"),g=a("./dashboard-menu-view"),h=a("./dashboard-sidebar-view");b.exports=d.core.View.extend({className:"CDB-Dashboard-canvas",initialize:function(a){this._widgets=a.widgets,this._infoView=a.infoView,this.el.classList.add(this.className),this.$el.html(e())},render:function(){this.clearSubViews();var a,b=this.model.get("renderMenu");return b&&(a=new g({model:this.model}),this.addView(a),this.$el.append(a.render().el)),a=new f({widgets:this._widgets}),this.addView(a),this.$(".js-map-wrapper").toggleClass("CDB-Dashboard-mapWrapper--withMenu",b).append(a.render().el),a=new h({widgets:this._widgets,model:this.model}),this.addView(a),this.$el.append(a.render().el),this}})},{"./dashboard-below-map-view":356,"./dashboard-menu-view":357,"./dashboard-sidebar-view":359,"./dashboard.tpl":362,"cartodb.js":283}],362:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Dashboard-mapWrapper js-map-wrapper"> <div class="CDB-Map-canvas"> <div class="CDB-Map" id="map"></div> </div> </div>';return __p}},{underscore:354}],363:[function(a,b,c){var d=a("underscore"),e=a("d3"),f={};f.formatNumber=function(a,b){if(!d.isNumber(a))return a;var c=e.format(".2s");if(1e3>a){var f=a.toFixed(2);return f.match(".00$")&&(f=f.replace(".00","")),f}return a=c(a)+(b?" "+b:""),a.match(".0$")&&(a=a.replace(".0","")),"0.0"===a?0:a},f.formatDate=function(a){return e.time.format("%Y-%m-%d")(a)},f.formatValue=function(a){return d.isNumber(a)?f.formatNumber(a):d.isDate(a)?f.formatDate(a):a},b.exports=f},{d3:330,underscore:354}],364:[function(a,b,c){var d=a("cartodb.js");d.deepInsights={createDashboard:a("./create-dashboard")},b.exports=d},{"./create-dashboard":355,"cartodb.js":283}],365:[function(a,b,c){function d(a,b){e.each(b,function(b){if(void 0===a[b])throw new Error(b+" is required")})}var e=a("underscore"),f=a("./widgets/widget-model"),g=a("./widgets/category/category-widget-model"),h=a("./widgets/histogram/histogram-widget-model"),i=function(a,b){this._widgetsCollection=a,this._dataviews=b};i.prototype.get=function(a){return this._widgetsCollection.get(a)},i.prototype.createCategoryModel=function(a,b){d(a,["title"]);var c=this._dataviews.createCategoryModel(b,a),f=["id","title","order","collapsed","prefix","suffix","show_stats"],h=e.pick(a,f);h.attrsNames=f;var i=new g(h,{dataviewModel:c});return this._widgetsCollection.add(i),i},i.prototype.createHistogramModel=function(a,b){d(a,["title"]);var c=this._dataviews.createHistogramModel(b,a),f=["id","title","order","collapsed","bins","show_stats","normalized"],g=e.pick(a,f);g.type="histogram",g.attrsNames=f;var i=new h(g,{dataviewModel:c});return this._widgetsCollection.add(i),i},i.prototype.createFormulaModel=function(a,b){d(a,["title"]);var c=this._dataviews.createFormulaModel(b,a),g=["id","title","order","collapsed","prefix","suffix","show_stats","description"],h=e.pick(a,g);h.type="formula",h.attrsNames=g;var i=new f(h,{dataviewModel:c});return this._widgetsCollection.add(i),i},i.prototype.createListModel=function(a,b){d(a,["title","columns_title"]);var c=this._dataviews.createListModel(b,a),g=["id","title","order","columns_title","show_stats"],h=e.pick(a,g);h.type="list",h.attrsNames=g;var i=new f(h,{dataviewModel:c});return this._widgetsCollection.add(i),i},i.prototype.createTimeSeriesModel=function(a,b){a.column_type=a.column_type||"date";var c=this._dataviews.createHistogramModel(b,a),d=["id"],g=e.pick(a,d);g.type="time-series",g.attrsNames=d;var h=new f(g,{dataviewModel:c});return this._widgetsCollection.add(h),h},b.exports=i},{"./widgets/category/category-widget-model":368,"./widgets/histogram/histogram-widget-model":403,"./widgets/widget-model":434,underscore:354}],366:[function(a,b,c){var d=a("underscore"),e=a("d3"),f=a("cartodb.js");b.exports=f.core.View.extend({animateFromValues:function(a,b,c,f,g){var h=this.$(c),i=g||{},j=i.formatter||e.format("0,000"),k=i.templateData||{},l=i.debounceWait||500,m=b%1===0,n=function(a){a=m?Math.round(a):a;var b=d.isNaN(a)||void 0===a?i.defaultValue||0:j(a),c=d.extend({value:b},k);h.text(f(c))};if(0===i.animationSpeed)return void n(b);n(a);var o=d.debounce(function(){h.prop("counter",a).stop().animate({counter:b},{duration:i.animationSpeed||500,easing:i.easingMethod||"swing",step:n})},l);o()},animateFromCurrentValue:function(a,b,c,f){var g=this.$(b),h=f||{},i=h.debounceWait||500,j=a,k=+this.$(b).text(),l=h.formatter||e.format("0,000"),m=h.templateData||{},n=j%1===0,o=function(b){b=n?Math.round(b):b,a=d.isNaN(b)||void 0===b?h.defaultValue||0:l(b);var e=d.extend({value:a},m);g.text(c(e))};if(0===h.animationSpeed)return void o(j);o(k);var p=d.debounce(function(){g.prop("counter",k).stop().animate({counter:j},{duration:h.animationSpeed||500,easing:h.easingMethod||"swing",step:o})},i);p()},animateValue:function(a,b,c,f,g){var h=this.$(c),i=g||{},j=i.debounceWait||500,k=a.get(b),l=a.previous(b)||0,m=i.formatter||e.format("0,000"),n=i.templateData||{},o=k%1===0,p=function(a){a=o?Math.round(a):a;var b=d.isNaN(a)||void 0===a?i.defaultValue||0:m(a),c=d.extend({value:b},n);h.text(f(c))};if(0===i.animationSpeed)return void p(k);p(l);var q=d.debounce(function(){h.prop("counter",l).stop().animate({counter:k},{duration:i.animationSpeed||500,easing:i.easingMethod||"swing",step:p})},j);q()}})},{"cartodb.js":283,d3:330,underscore:354}],367:[function(a,b,c){function d(){this.colors={},e.each(f,function(a){this.colors[a]=null},this)}var e=a("underscore"),f=["#2CA095","#E5811B","#4A4DBA","#AD2BAD","#559030","#E1C221"],g="#CCC";d.prototype.updateData=function(a){e.each(this.colors,function(b,c){e.contains(a,b)?a=e.without(a,b):this.colors[c]=null},this),e.each(a,function(a){var b=this.getNextAvailableColor();b&&(this.colors[b]=a)},this)},d.prototype.getNextAvailableColor=function(){for(var a in this.colors)if(null===this.colors[a])return a;return null},d.prototype.getColorByCategory=function(a){for(var b in this.colors)if(this.colors[b]===a)return b;return g},d.prototype.getCategoryByColor=function(a){return this.colors[a]},b.exports=d},{underscore:354}],368:[function(a,b,c){var d=a("underscore"),e=a("../widget-model"),f=a("./category-colors"),g=a("./locked-categories-collection");b.exports=e.extend({defaults:d.extend({type:"category",search:!1,locked:!1,isColorsApplied:!1},e.prototype.defaults),initialize:function(){e.prototype.initialize.apply(this,arguments),this.colors=new f,this.lockedCategories=new g,this.listenTo(this.dataviewModel,"change:allCategoryNames",this._onDataviewAllCategoryNamesChange),this.on("change:locked",this._onLockedChange,this),this.on("change:collapsed",this._onCollapsedChange,this)},setupSearch:function(){this.dataviewModel.setupSearch(),this.lockedCategories.addItems(this._acceptedCategories().toJSON()),this.toggleSearch()},toggleSearch:function(){this.set("search",!this.get("search"))},enableSearch:function(){this.set("search",!0)},disableSearch:function(){this.set("search",!1)},isSearchEnabled:function(){return this.get("search")},cleanSearch:function(){this.dataviewModel.cleanSearch(),this.lockedCategories.reset([])},applyColors:function(){this.set("isColorsApplied",!0)},cancelColors:function(){this.set("isColorsApplied",!1)},isColorApplied:function(){return this.get("isColorsApplied")},isLocked:function(){return this.get("locked")},canBeLocked:function(){return this.isLocked()||this._acceptedCategories().size()>0},canApplyLocked:function(){return this._acceptedCategories().size()!==this.lockedCategories.size()?!0:this._acceptedCategories().any(function(a){return!this.lockedCategories.isItemLocked(a.get("name"))},this)},applyLocked:function(){var a=this.lockedCategories.getItemsName();if(!a.length)return this.unlockCategories(),!1;this.set("locked",!0);var b=this.dataviewModel.filter;b.cleanFilter(!1),b.accept(a),b.applyFilter(),this.cleanSearch()},lockCategories:function(){this.set("locked",!0),this.dataviewModel.fetch()},unlockCategories:function(){this.set("locked",!1),this.dataviewModel.filter.acceptAll()},_onDataviewAllCategoryNamesChange:function(a,b){this.colors.updateData(b),this.isColorApplied()&&this.applyColors()},_onLockedChange:function(a,b){b?this.dataviewModel.enableFilter():this.dataviewModel.disableFilter()},_acceptedCategories:function(){return this.dataviewModel.filter.acceptedCategories},_onCollapsedChange:function(a,b){this.dataviewModel.set("enabled",!b)}})},{"../widget-model":434,"./category-colors":367,"./locked-categories-collection":380,underscore:354}],369:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-header js-header"></div> <div class="CDB-Widget-content CDB-Widget-content--noSidesMargin"> <div class="CDB-Widget-listWrapper js-content"></div> </div> <div class="CDB-Widget-footer js-footer"></div>';return __p}},{underscore:354}],370:[function(a,b,c){var d=a("cartodb.js"),e=a("./title/search-title-view"),f=a("./options/options-view"),g=a("./list/items-view"),h=a("./stats/stats-view"),i=a("./paginator/paginator-view"),j=a("./list/search-items-view"),k=a("./paginator/search-paginator-view"),l=a("./content-template.tpl");b.exports=d.core.View.extend({className:"CDB-Widget-body",_ITEMS_PER_PAGE:6,initialize:function(){this._dataviewModel=this.model.dataviewModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(l()),this._initViews(),this},_initBinds:function(){this.model.bind("change:collapsed",function(a,b){this.$el.toggleClass("is-collapsed",!!b)},this)},_initViews:function(){var a=new e({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-header").append(a.render().el),this.addView(a);var b=new h({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-header").append(b.render().el),this.addView(b);var c=new f({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-content").html(c.render().el),this.addView(c);var d=new g({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE});this.$(".js-content").append(d.render().el),this.addView(d);var l=new i({$target:d.$el,widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE});this.$(".js-footer").append(l.render().el),this.addView(l);var m=new j({widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0});this.$(".js-content").append(m.render().el),this.addView(m);var n=new k({$target:m.$el,widgetModel:this.model,dataviewModel:this._dataviewModel,itemsPerPage:this._ITEMS_PER_PAGE,paginator:!0});this.$(".js-footer").append(n.render().el),this.addView(n)}})},{"./content-template.tpl":369,"./list/items-view":377,"./list/search-items-view":379,"./options/options-view":382,"./paginator/paginator-view":384,"./paginator/search-paginator-view":386,"./stats/stats-view":389,"./title/search-title-view":391,"cartodb.js":283}],371:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button type="button" class="CDB-Widget-listItemInner CDB-Widget-listButton js-button '+(null==(__t=isDisabled?"is-disabled":"")?"":_.escape(__t))+'"> <div class="CDB-Widget-contentSpaced"> <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+(null==(__t=name)?"":_.escape(__t))+'">'+(null==(__t=name)?"":_.escape(__t))+'</p> <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+(null==(__t=value)?"":_.escape(__t))+'">'+(null==(__t=prefix)?"":_.escape(__t))+(null==(__t=formattedValue)?"":_.escape(__t))+(null==(__t=suffix)?"":_.escape(__t))+'</p> </div> <div class="CDB-Widget-progressBar"> <div class="CDB-Widget-progressState '+(null==(__t=isAggregated?"CDB-Widget-progressState--pattern":"")?"":_.escape(__t))+'" style="width: '+(null==(__t=percentage)?"":_.escape(__t))+"%; background-color: "+(null==(__t=customColor?color:"")?"":_.escape(__t))+'"></div> </div> </button>';return __p}},{underscore:354}],372:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-listItemInner '+(null==(__t=isDisabled?"is-disabled":"")?"":_.escape(__t))+'"> <div class="CDB-Widget-contentSpaced"> <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+(null==(__t=name)?"":_.escape(__t))+'">'+(null==(__t=name)?"":_.escape(__t))+'</p> <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+(null==(__t=value)?"":_.escape(__t))+'">'+(null==(__t=prefix)?"":_.escape(__t))+(null==(__t=formattedValue)?"":_.escape(__t))+(null==(__t=suffix)?"":_.escape(__t))+'</p> </div> <div class="CDB-Widget-progressBar"> <div class="CDB-Widget-progressState CDB-Widget-progressState--pattern '+(null==(__t=isAggregated?"CDB-Widget-progressState--inactive":"")?"":_.escape(__t))+'" style="width: '+(null==(__t=percentage)?"":_.escape(__t))+"%; background-color: "+(null==(__t=customColor?color:"")?"":_.escape(__t))+'"></div> </div> </div>';return __p}},{underscore:354}],373:[function(a,b,c){var d=a("cartodb.js"),e=a("../../../../formatter"),f=a("./item-clickable-template.tpl"),g=a("./item-unclickable-template.tpl");b.exports=d.core.View.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(a){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){var a=this.model.get("name"),b=this.model.get("value"),c=this.model.get("agg")||this.widgetModel.isLocked()?g:f;return this.$el.html(c({customColor:this.widgetModel.isColorApplied(),isAggregated:this.model.get("agg"),name:a,value:b,formattedValue:e.formatNumber(b),percentage:b/this.dataviewModel.get("max")*100,color:this.widgetModel.colors.getColorByCategory(a),isDisabled:this.model.get("selected")?"":"is-disabled",prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change",this.render,this),this.widgetModel.bind("change:search change:isColorsApplied change:prefix change:suffix",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.trigger("itemClicked",this.model,this)}})},{"../../../../formatter":363,"./item-clickable-template.tpl":371,"./item-unclickable-template.tpl":372,"cartodb.js":283}],374:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<button type="button" class="CDB-Widget-listItemInner CDB-Widget-listItemInner--fullSpace CDB-Widget-listButton js-button '+(null==(__t=isDisabled?"is-disabled":"")?"":_.escape(__t))+'"> <span class="CDB-Widget-checkbox '+(null==(__t=isDisabled?"":"is-checked")?"":_.escape(__t))+'"></span> <div class="u-lSpace--xl"> <div class="CDB-Widget-contentSpaced"> <p class="CDB-Text is-semibold u-upperCase CDB-Size-medium u-ellipsis u-rSpace--xl" title="'+(null==(__t=name)?"":_.escape(__t))+'">'+(null==(__t=name)?"":_.escape(__t))+'</p> <p class="CDB-Text CDB-Size-small u-secondaryTextColor" title="'+(null==(__t=value)?"":_.escape(__t))+'">'+(null==(__t=prefix)?"":_.escape(__t))+(null==(__t=formattedValue)?"":_.escape(__t))+(null==(__t=suffix)?"":_.escape(__t))+'</p> </div> <div class="CDB-Widget-progressBar"> <div class="CDB-Widget-progressState" style="width: '+(null==(__t=percentage)?"":_.escape(__t))+'%"></div> </div> </div> </button>';return __p}},{underscore:354}],375:[function(a,b,c){var d=a("cartodb.js"),e=a("../../../../formatter"),f=a("./search-item-clickable-template.tpl");b.exports=d.core.View.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(a){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var a=this.model.get("value");return this.$el.html(f({name:this.model.get("name"),value:a,formattedValue:e.formatNumber(a),percentage:a/this.dataviewModel.get("max")*100,isDisabled:!this.model.get("selected"),prefix:this.widgetModel.get("prefix"),suffix:this.widgetModel.get("suffix")})),this},_initBinds:function(){this.model.bind("change:selected",this.render,this),this.widgetModel.bind("change:prefix change:suffix",this.render,this),this.add_related_model(this.widgetModel)},_onItemClick:function(){this.model.set("selected",!this.model.get("selected"))}})},{"../../../../formatter":363,"./search-item-clickable-template.tpl":374,"cartodb.js":283}],376:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li>';return __p}},{underscore:354}],377:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("cartodb.js"),g=a("./item/item-view"),h=a("./items-placeholder-template.tpl");b.exports=f.core.View.extend({options:{paginator:!1,itemsPerPage:6},className:"CDB-Widget-list CDB-Widget-list--wrapped js-list",tagName:"ul",initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var a=this.dataviewModel.getData(),b=e.isEmpty(a)||0===e.size(a);return b?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){this.widgetModel.bind("change:search",this.toggle,this),this.widgetModel.bind("change:isColorsApplied",this.render,this),this.add_related_model(this.widgetModel),this.dataviewModel.bind("change:data",this.render,this),this.add_related_model(this.dataviewModel)},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--withBorders").removeClass("CDB-Widget-list--wrapped"),this.$el.append(h())},_renderList:function(){this.$el.removeClass("CDB-Widget-list--withBorders"),this.$el[this.options.paginator?"addClass":"removeClass"]("CDB-Widget-list--wrapped");var a,b=this.dataviewModel.getData();b.each(function(b,c){c%this.options.itemsPerPage===0&&(a=d("<div>").addClass("CDB-Widget-listGroup"),this.$el.append(a)),this._addItem(b,a)},this)},_addItem:function(a,b){var c=new g({model:a,widgetModel:this.widgetModel,
dataviewModel:this.dataviewModel});c.bind("itemClicked",this._setFilters,this),this.addView(c),b.append(c.render().el)},_setFilters:function(a){var b=a.get("selected"),c=this.dataviewModel.filter,d=a.get("name");if(b)if(0===c.rejectedCategories.size()&&0===c.acceptedCategories.size()){var e=this.dataviewModel.getData();e.each(function(a){var b=a.get("name");b!==d&&a.set("selected",!1)}),c.accept(a.get("name"))}else a.set("selected",!1),c.reject(d);else a.set("selected",!0),c.accept(d)},toggle:function(){this[this.widgetModel.isSearchEnabled()?"hide":"show"]()},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")}})},{"./item/item-view":373,"./items-placeholder-template.tpl":376,"cartodb.js":283,jquery:331,underscore:354}],378:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<li class="CDB-Widget-listItem"> <h4 class="CDB-Text CDB-Size-large">No results</h4> <p class="CDB-Text CDB-Size-medium u-tSpace-xl u-altTextColor">Your search "'+(null==(__t=q)?"":_.escape(__t))+'" didn\'t match<br>with any value.</p> <p class="CDB-Text CDB-Size-medium u-tSpace-xl u-altTextColor">Try searching again.</p> </li>';return __p}},{underscore:354}],379:[function(a,b,c){var d=a("jquery"),e=a("./items-view"),f=a("./item/search-item-view"),g=a("./search-items-no-results-template.tpl");b.exports=e.extend({className:"CDB-Widget-list is-hidden CDB-Widget-list--wrapped js-list",render:function(){this.clearSubViews(),this.$el.empty();var a=this._searchResultsCollection,b=a.isEmpty()||0===a.size();return b?this._renderPlaceholder():this._renderList(),this},_initBinds:function(){e.prototype._initBinds.apply(this,arguments),this._searchResultsCollection=this.dataviewModel.getSearchResult(),this._searchResultsCollection.on("change:selected",this._onSelectedItemChange,this),this._searchResultsCollection.on("reset",this.render,this),this.add_related_model(this._searchResultsCollection)},_renderList:function(){this.$el.removeClass("CDB-Widget-list--withBorders CDB-Widget-list--noresults"),this.$el.addClass("CDB-Widget-list--wrapped");var a,b=this._searchResultsCollection;b.each(function(b,c){c%this.options.itemsPerPage===0&&(a=d("<div>").addClass("CDB-Widget-listGroup"),this.$el.append(a)),this._addItem(b,a)},this)},_renderPlaceholder:function(){this.$el.addClass("CDB-Widget-list--noresults").removeClass("CDB-Widget-list--wrapped"),this.$el.html(g({q:this.dataviewModel.getSearchQuery()}))},_addItem:function(a,b){var c=new f({model:a,widgetModel:this.widgetModel,dataviewModel:this.dataviewModel});this.addView(c),b.append(c.render().el)},toggle:function(){this[this.widgetModel.isSearchEnabled()?"show":"hide"]()},_onSelectedItemChange:function(a,b){this.widgetModel.lockedCategories[b?"addItem":"removeItem"](a)}})},{"./item/search-item-view":375,"./items-view":377,"./search-items-no-results-template.tpl":378,jquery:331}],380:[function(a,b,c){var d=a("underscore"),e=a("backbone");b.exports=e.Collection.extend({addItem:function(a){this.isItemLocked(a.get("name"))||this.add(a)},addItems:function(a){d.each(a,function(a){this.isItemLocked(a.name)||this.add(a)},this)},resetItems:function(a){this.reset(a)},removeItem:function(a){var b=this.isItemLocked(a.get("name"));b&&this.remove(b)},removeItems:function(){this.reset([])},isItemLocked:function(a){return this.find(function(b){return b.get("name")===a})},getItemsName:function(){return this.pluck("name")}})},{backbone:322,underscore:354}],381:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",isSearchEnabled?__p+=' <p class="CDB-Text is-semibold CDB-Size-small u-upperCase js-lockCategories">'+(null==(__t=totalLocked)?"":_.escape(__t))+" selected</p> ":(__p+=' <p class="CDB-Text is-semibold CDB-Size-small u-upperCase js-textInfo"> ',isLocked?__p+=" "+(null==(__t=totalCats)?"":_.escape(__t))+' blocked <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link u-lSpace js-unlock">unlock</button> ':(__p+=" ",noneSelected?__p+=" None selected ":(__p+=" "+(null==(__t=allSelected?"All selected":acceptedCats+" selected")?"":_.escape(__t))+" ",canBeLocked&&(__p+=' <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link u-lSpace js-lock">lock</button> '),__p+=" "),__p+=" "),__p+=" </p> ",canSelectAll&&(__p+=' <div class="CDB-Widget-filterButtons"> <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-link CDB-Widget-filterButton js-all">all</button> </div> '),__p+=" "),__p+="";return __p}},{underscore:354}],382:[function(a,b,c){var d=a("cartodb.js"),e=a("./options-template.tpl");b.exports=d.core.View.extend({className:"CDB-Widget-filter CDB-Widget-contentSpaced CDB-Widget-contentSpaced--sideMargins",events:{"click .js-all":"_onSelectAll","click .js-lock":"_lockCategories","click .js-unlock":"_unlockCategories"},initialize:function(){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._initBinds()},render:function(){var a=this.dataviewModel.filter.acceptedCategories.size(),b=this.dataviewModel.filter.rejectedCategories.size(),c=this.dataviewModel.filter.areAllRejected(),d=this.dataviewModel.getData().size(),f=this.widgetModel.isLocked();return this.$el.html(e({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:f,canBeLocked:this.widgetModel.canBeLocked(),allSelected:0===b&&0===a&&!c,canSelectAll:!f&&(b>0||a>0||c),noneSelected:c||!d&&!a,acceptedCats:a,totalLocked:this.widgetModel.lockedCategories.size(),totalCats:d})),this},_initBinds:function(){this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.lockedCategories.bind("change add remove",this.render,this),this.add_related_model(this.widgetModel),this.add_related_model(this.widgetModel.lockedCategories),this.dataviewModel.bind("change:data",this.render,this),this.add_related_model(this.dataviewModel);var a=this.dataviewModel.filter;a.acceptedCategories.bind("add remove reset",this.render,this),a.rejectedCategories.bind("add remove reset",this.render,this),this.add_related_model(a.rejectedCategories),this.add_related_model(a.acceptedCategories)},_lockCategories:function(){this.widgetModel.lockCategories()},_unlockCategories:function(){this.widgetModel.unlockCategories()},_onSelectAll:function(){this.dataviewModel.filter.acceptAll()}})},{"./options-template.tpl":381,"cartodb.js":283}],383:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){if(__p+='<div class="CDB-Widget-contentFlex"> <button class="u-rSpace--m CDB-Text is-semibold u-upperCase CDB-Size-small js-searchToggle"> <div class="CDB-Shape u-iBlock"> <span class="CDB-Shape-magnify is-small is-blue"></span> </div> <span class="u-iBlock u-actionTextColor"> search in '+(null==(__t=categoriesCount)?"":_.escape(__t))+" categor"+(null==(__t=1===categoriesCount?"y":"ies")?"":_.escape(__t))+" </span> </button> </div> ",showPaginator){__p+=' <div class="CDB-Widget-navDots js-dots"> ';for(var i=0,l=pages;l>i;i++)__p+='<button class="CDB-Shape-dot CDB-Widget-dot--navigation js-page ',currentPage===i&&(__p+="is-selected"),__p+='" data-page="'+(null==(__t=i)?"":_.escape(__t))+'"></button>';__p+=" </div> "}__p+=""}return __p}},{underscore:354}],384:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("cartodb.js"),g=a("./paginator-template.tpl"),h=5;b.exports=f.core.View.extend({options:{itemsPerPage:6,template:g,paginator:!1},className:"CDB-Widget-nav CDB-Widget-contentSpaced",events:{"click .js-searchToggle":"_onSearchClicked","click .js-page":"_onDotClick"},initialize:function(){this.dataviewModel=this.options.dataviewModel,this.widgetModel=this.options.widgetModel,this._$target=this.options.$target,this.model=new f.core.Model({page:0}),this._initBinds()},render:function(){this.clearSubViews(),this.$el.empty();var a=this.dataviewModel.getCount();if(a>h){var b=Math.ceil(this.dataviewModel.getSize()/this.options.itemsPerPage),c=this.options.template;this.$el.html(c({showPaginator:this.options.paginator,currentPage:this.model.get("page"),categoriesCount:a,pages:b}))}else this.model.set("page",0);return this._scrollToPage(),this},_initBinds:function(){d(window).bind("resize."+this.cid,e.bind(this._scrollToPage,this)),this.model.bind("change:page",this.render,this),this.dataviewModel.bind("change:categoriesCount",this.render,this),this.dataviewModel.bind("change:data change:searchData",function(){this._setPage(),this.render()},this),this.widgetModel.bind("change:search",this.toggle,this),this.add_related_model(this.dataviewModel),this.add_related_model(this.widgetModel)},_setPage:function(){var a=this.dataviewModel.getSize(),b=Math.ceil(a/this._ITEMS_PER_PAGE);this.model.get("page")>b-1&&this.model.set({page:0},{silent:!0})},_onSearchClicked:function(){this.widgetModel.setupSearch()},_scrollToPage:function(){var a=this.model.get("page"),b=this._$target.find(".CDB-Widget-listGroup:eq(0)").outerWidth();this._$target.css("margin-left",-(a*b))},_onDotClick:function(a){var b=d(a.target).data("page");this.model.set("page",b)},toggle:function(){this[this.widgetModel.isSearchEnabled()?"hide":"show"]()},hide:function(){this.$el.addClass("is-hidden")},show:function(){this.$el.removeClass("is-hidden")},clean:function(){d(window).unbind("resize."+this.cid),f.core.View.prototype.clean.call(this)}})},{"./paginator-template.tpl":383,"cartodb.js":283,jquery:331,underscore:354}],385:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){if(__p+='<div class="CDB-Widget-contentFlex u-tSpace--m"> <button class="CDB-Text is-semibold u-upperCase CDB-Size-small u-rSpace--m js-searchToggle u-actionTextColor">cancel</button> </div> ',showPaginator){__p+=' <div class="CDB-Widget-navDots js-dots u-tSpace--m"> ';for(var i=0,l=pages;l>i;i++)__p+='<button class="CDB-Shape-dot CDB-Widget-dot--navigation js-page ',currentPage===i&&(__p+="is-selected"),__p+='" data-page="'+(null==(__t=i)?"":_.escape(__t))+'"></button>';__p+=" </div> "}__p+=""}return __p}},{underscore:354}],386:[function(a,b,c){var d=a("./paginator-view"),e=a("./search-paginator-template.tpl");b.exports=d.extend({className:"CDB-Widget-nav is-hidden CDB-Widget-contentSpaced",render:function(){this.clearSubViews(),this.$el.empty();var a=Math.ceil(this.dataviewModel.getSearchCount()/this.options.itemsPerPage);return this.$el.html(e({showPaginator:!0,currentPage:this.model.get("page"),pages:a})),this._scrollToPage(),this},_setPage:function(){var a=this.dataviewModel.getSearchCount(),b=Math.ceil(a/this._ITEMS_PER_PAGE);this.model.get("page")>b-1&&this.model.set({page:0},{silent:!0})},toggle:function(){this[this.widgetModel.isSearchEnabled()?"show":"hide"]()},_onSearchClicked:function(){this.widgetModel.cleanSearch(),this.widgetModel.toggleSearch()}})},{"./paginator-view":384,"./search-paginator-template.tpl":385}],387:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+=""+(null==(__t=value)?"":_.escape(__t));return __p}},{underscore:354}],388:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",isSearchEnabled?(__p+="",__p+=isSearchApplied?' <dt class="CDB-Widget-infoCount">'+(null==(__t=resultsCount)?"":_.escape(__t))+'</dt><dd class="CDB-Widget-infoDescription">found</dd> ':" &nbsp; ",__p+="  "):__p+=' <dt class="CDB-Widget-infoCount">'+(null==(__t=nullsPer)?"":_.escape(__t))+'%</dt><dd class="CDB-Widget-infoDescription"> null rows</dd> <dt class="CDB-Widget-infoCount"><span class="js-cats">'+(null==(__t=catsPer)?"":_.escape(__t))+'</span>%</dt><dd class="CDB-Widget-infoDescription">of total</dd> ',__p+="";return __p}},{underscore:354}],389:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("../../../formatter"),g=a("./stats-template.tpl"),h=a("./cats-template.tpl"),i=a("../../animate-values");b.exports=e.core.View.extend({className:"CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace",tagName:"dl",initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){this.$el.html(g({isSearchEnabled:this.widgetModel.isSearchEnabled(),isSearchApplied:this.dataviewModel.isSearchApplied(),isLocked:this.widgetModel.isLocked(),isOtherAvailable:this.dataviewModel.isOtherAvailable(),resultsCount:this.dataviewModel.getSearchCount(),totalCats:this._getCategoriesSize(),nullsPer:this._getNullPercentage(),catsPer:this._getCurrentCategoriesPercentage()}));var a=new i({el:this.$el});return a.animateFromValues(this._getPreviousCategoriesPercentage(),this._getCurrentCategoriesPercentage(),".js-cats",h,{defaultValue:"-",animationSpeed:700,formatter:f.formatValue}),this._checkVisibility(),this},_initBinds:function(){this.dataviewModel.bind("change:data change:totalCount",this.render,this),this.widgetModel.bind("change:search change:locked",this.render,this),this.widgetModel.bind("change:show_stats",this._checkVisibility,this),this.add_related_model(this.dataviewModel),this.add_related_model(this.widgetModel)},_getNullPercentage:function(){var a=this.dataviewModel.get("nulls"),b=this.dataviewModel.get("totalCount")||0;return a?(a/b*100).toFixed(2):0},_getPreviousCategoriesPercentage:function(){var a=this.dataviewModel.previous("totalCount")||0,b=this.dataviewModel.getPreviousData();return this._getCategoriesPercentage(b,a)},_getCurrentCategoriesPercentage:function(){var a=this.dataviewModel.get("totalCount")||0,b=this.dataviewModel.getData().toJSON();return this._getCategoriesPercentage(b,a)},_getCategoriesPercentage:function(a,b){if(!b)return 0;var c=a.reduce(function(a,b){return b.agg?a:a+parseFloat(b.value)},0);return c?(c/b*100).toFixed(2):0},_getCategoriesSize:function(){return d.pluck(this.dataviewModel.getData().reject(function(a){return a.get("agg")}),"name").length},_checkVisibility:function(){this.$el.toggle(!!this.widgetModel.get("show_stats"))}})},{"../../../formatter":363,"../../animate-values":366,"./cats-template.tpl":387,"./stats-template.tpl":388,"cartodb.js":283,underscore:354}],390:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+="",isSearchEnabled?(__p+=' <form class="CDB-Widget-search js-form"> <div class="CDB-Shape CDB-Widget-searchLens u-iBlock u-rSpace js-searchIcon"> <span class="CDB-Shape-magnify is-small is-blue"></span> </div> <input type="text" class="CDB-Text CDB-Size-large CDB-Widget-textInput CDB-Widget-searchTextInput js-textInput" value="'+(null==(__t=q)?"":_.escape(__t))+'" placeholder="Search by '+(null==(__t=columnName)?"":_.escape(__t))+'"> ',canShowApply&&(__p+=' <button type="button" class="CDB-Text is-semibold u-upperCase CDB-Size-small CDB-Widget-searchApply js-applyLocked u-actionTextColor">apply</button> '),__p+=" </form> "):__p+=' <div class="CDB-Widget-title CDB-Widget-contentSpaced js-title"> <h3 class="CDB-Text CDB-Size-large u-ellipsis js-titleText" title="'+(null==(__t=title)?"":_.escape(__t))+'">'+(null==(__t=title)?"":_.escape(__t))+'</h3> <div class="CDB-Widget-options CDB-Widget-contentSpaced"> <button class="CDB-Widget-buttonIcon CDB-Widget-buttonIcon--circle js-colors '+(null==(__t=isColorApplied?"is-selected":"")?"":_.escape(__t))+" "+(null==(__t=isColorApplied?"js-cancelColors":"js-applyColors")?"":_.escape(__t))+'" data-tooltip="\n          '+(null==(__t=isColorApplied?"Remove colors":"Apply colors")?"":_.escape(__t))+'\n        "> <i class="CDB-IconFont CDB-IconFont-drop CDB-IconFont--small CDB-IconFont--top"></i> </button> <button class="CDB-Shape js-actions u-lSpace"> <div class="CDB-Shape-threePoints is-blue is-small"> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> </div> </button> </div> </div> ',__p+="";return __p}},{underscore:354}],391:[function(a,b,c){var d=a("underscore"),e=a("jquery"),f=a("cartodb.js"),g=a("../../dropdown/widget-dropdown-view"),h=a("../../widget-tooltip-view"),i=a("./search-title-template.tpl");b.exports=f.core.View.extend({events:{"keyup .js-textInput":"_onKeyupInput","submit .js-form":"_onSubmitForm","click .js-applyLocked":"_applyLocked","click .js-applyColors":"_applyColors","click .js-cancelColors":"_cancelColors"},initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(i({isCollapsed:this.widgetModel.get("collapsed"),isColorApplied:this.widgetModel.isColorApplied(),title:this.widgetModel.get("title"),columnName:this.dataviewModel.get("column"),q:this.dataviewModel.getSearchQuery(),isLocked:this.widgetModel.isLocked(),canBeLocked:this.widgetModel.canBeLocked(),isSearchEnabled:this.widgetModel.isSearchEnabled(),canShowApply:this.widgetModel.canApplyLocked()})),this._initViews(),this},_initBinds:function(){this.widgetModel.bind("change:search",this._onSearchToggled,this),this.widgetModel.bind("change:title change:collapsed change:isColorsApplied",this.render,this),this.widgetModel.lockedCategories.bind("change add remove",this.render,this),this.add_related_model(this.widgetModel),this.add_related_model(this.widgetModel.lockedCategories),this.dataviewModel.filter.bind("change",this.render,this),this.add_related_model(this.dataviewModel.filter)},_initViews:function(){var a=new g({target:this.$(".js-actions"),container:this.$el});a.bind("click",function(a){"toggle"===a&&this.widgetModel.set("collapsed",!this.widgetModel.get("collapsed"))},this),this.addView(a);var b=new h({target:this.$(".js-colors")});e("body").append(b.render().el),this.addView(b)},_onSearchToggled:function(){var a=this.widgetModel.isSearchEnabled();this[a?"_bindESC":"_unbindESC"](),this.render(),a&&this._focusOnInput()},_onSubmitForm:function(a){a&&a.preventDefault();var b=this.$(".js-textInput").val();this.dataviewModel.getSearchQuery()!==b&&(this.dataviewModel.setSearchQuery(b),this.dataviewModel.isSearchValid()&&this.dataviewModel.applySearch())},_focusOnInput:function(){var a=this;setTimeout(function(){a.$(".js-textInput").focus()},0)},_onKeyupInput:d.debounce(function(a){var b=this.$(".js-textInput").val();13!==a.keyCode&&27!==a.keyCode&&""!==b&&this._onSubmitForm()},250),_bindESC:function(){e(document).bind("keyup."+this.cid,d.bind(this._onKeyUp,this))},_unbindESC:function(){e(document).unbind("keyup."+this.cid)},_onKeyUp:function(a){return 27===a.keyCode?(this._cancelSearch(),!1):void 0},_applyLocked:function(){this.widgetModel.toggleSearch(),this.widgetModel.applyLocked()},_applyColors:function(){this.widgetModel.applyColors()},_cancelColors:function(){this.widgetModel.cancelColors()},_cancelSearch:function(){this.widgetModel.cleanSearch(),this.widgetModel.disableSearch()},clean:function(){this._unbindESC(),f.core.View.prototype.clean.call(this)}})},{"../../dropdown/widget-dropdown-view":393,"../../widget-tooltip-view":435,"./search-title-template.tpl":390,"cartodb.js":283,jquery:331,underscore:354}],392:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<ul class="CDB-Text CDB-Size-medium"> <li class="CDB-Dropdown-item"> <button class="CDB-Dropdown-link js-toggle">Toggle widget</button> </li> <li class="CDB-Dropdown-item"> <button class="CDB-Dropdown-link js-pin">Pin widget</button> </li> ',normalizeHistogram&&(__p+=' <li class="CDB-Dropdown-item"> <button class="CDB-Dropdown-link js-normalize">Normalize</button> </li> '),__p+=" </ul>";return __p}},{underscore:354}],393:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("cartodb.js"),g=a("./template.tpl");b.exports=f.core.View.extend({_WIDGET_BOTTOM_PADDING:20,className:"CDB-Dropdown",events:{"click .js-pin":"_pin","click .js-toggle":"_toggle","click .js-normalize":"_normalize"},initialize:function(a){if(!a.target)throw new Error("target is not defined");this.model=new f.core.Model({open:!1}),this._$target=this.options.target,this._$container=this.options.container,this.options.flags=this.options.flags||{},e.defaults(this.options.flags,{normalizeHistogram:!1}),this._initBinds()},render:function(){return this.$el.html(g(this.options.flags)),this},_initBinds:function(){this.add_related_model(this.model),this.model.bind("change:open",this._onChangeOpen,this),this._$target.click(e.bind(this._toggleClick,this))},_bindGlobalClick:function(){d(document).bind("click."+this.cid,e.bind(this._onGlobalClick,this))},_unbindGlobalClick:function(){d(document).unbind("click."+this.cid)},_bindESC:function(){d(document).bind("keyup."+this.cid,e.bind(this._onKeyUp,this))},_unbindESC:function(){d(document).unbind("keyup."+this.cid)},_onGlobalClick:function(a){this._$target.get(0)!==d(a.target).closest(this._$target).get(0)&&this.model.set("open",!1)},_onKeyUp:function(a){return 27===a.keyCode?(this.model.set("open",!1),!1):void 0},_onChangeOpen:function(){this.model.get("open")?this._open():this._close()},_pin:function(){this.model.set("open",!1),this.trigger("click","pin")},_toggle:function(){this.model.set("open",!1),this.trigger("click","toggle")},_normalize:function(){this.model.set("normalize",!this.model.get("normalize")),this.trigger("click","normalize",this.model.get("normalize"))},_open:function(){this._bindESC(),this._bindGlobalClick(),this.render(),this._$container.append(this.$el),this.$el.show(),this._adjustVerticalPosition()},_adjustVerticalPosition:function(){var a=d("body").height(),b=this.$el.offset().top+this.$el.height();this.$el.toggleClass("has-top-position",b+this._WIDGET_BOTTOM_PADDING>a)},_close:function(){this._unbindESC(),this._unbindGlobalClick(),this.$el.hide()},_toggleClick:function(){this.model.set("open",!this.model.get("open"))},clean:function(){this._unbindESC(),this._unbindGlobalClick(),this._$target.off("click"),f.core.View.prototype.clean.call(this)}})},{"./template.tpl":392,"cartodb.js":283,jquery:331,underscore:354}],394:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+=""+(null==(__t=prefix)?"":_.escape(__t))+(null==(__t=value)?"":_.escape(__t))+(null==(__t=suffix)?"":_.escape(__t));return __p}},{underscore:354}],395:[function(a,b,c){var d=a("underscore"),e=a("d3"),f=a("cartodb.js"),g=a("../../formatter"),h=a("./template.tpl"),i=a("../dropdown/widget-dropdown-view"),j=a("./animation-template.tpl"),k=a("../animate-values.js");b.exports=f.core.View.extend({className:"CDB-Widget-body",initialize:function(){this._dataviewModel=this.model.dataviewModel,this._initBinds()},render:function(){this.clearSubViews();var a=this._dataviewModel.get("data"),b=function(a){var b=e.format("0,000");return d.isNumber(a)?b(a.toFixed(2)):0},c=!d.isUndefined(this._dataviewModel.get("nulls"))&&g.formatNumber(this._dataviewModel.get("nulls"))||"-",f=this.model.get("collapsed"),i=this.model.get("prefix"),l=this.model.get("suffix");this.$el.html(h({title:this.model.get("title"),showStats:this.model.get("show_stats"),operation:this._dataviewModel.get("operation"),value:a,formatedValue:b(a),description:this.model.get("description"),nulls:c,prefix:i,suffix:l,isCollapsed:f}));var m=new k({el:this.$el});return m.animateValue(this._dataviewModel,"data",".js-value",j,{animationSpeed:700,formatter:b,templateData:{prefix:i,suffix:l}}),this.$el.toggleClass("is-collapsed",!!f),this._initViews(),this},_initBinds:function(){this.model.bind("change:title change:description change:collapsed change:prefix change:suffix",this.render,this),this._dataviewModel.bind("change:data",this.render,this),this.add_related_model(this._dataviewModel)},_initViews:function(){var a=new i({target:this.$(".js-actions"),container:this.$(".js-header")});a.bind("click",function(a){"toggle"===a&&this.model.set("collapsed",!this.model.get("collapsed"))},this),this.addView(a)}})},{"../../formatter":363,"../animate-values.js":366,"../dropdown/widget-dropdown-view":393,"./animation-template.tpl":394,"./template.tpl":396,"cartodb.js":283,d3:330,underscore:354}],396:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-header js-header"> <div class="CDB-Widget-title CDB-Widget-contentSpaced"> <h3 class="CDB-Text CDB-Size-large u-ellipsis '+(null==(__t=isCollapsed?"js-value is-collapsed":"js-title")?"":_.escape(__t))+'">',__p+=isCollapsed?""+(null==(__t=formatedValue)?"":_.escape(__t)):" "+(null==(__t=title)?"":_.escape(__t)),__p+='</h3> <div class="CDB-Widget-options"> <button class="CDB-Shape js-actions"> <div class="CDB-Shape-threePoints is-blue is-small"> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> </div> </button> </div> </div> ',showStats&&(__p+=' <dl class="CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace"> <dt class="CDB-Widget-infoCount">'+(null==(__t=nulls)?"":_.escape(__t))+'</dt><dd class="CDB-Widget-infoDescription">null rows</dd> </dl> '),__p+=' </div> <div class="CDB-Widget-content"> ',_.isNumber(value)?(__p+=' <h4 class="CDB-Text CDB-Size-huge '+(null==(__t=isCollapsed?"":"js-value")?"":_.escape(__t))+'" title="'+(null==(__t=value)?"":_.escape(__t))+'"> '+(null==(__t=prefix)?"":_.escape(__t))+(null==(__t=value)?"":_.escape(__t))+(null==(__t=suffix)?"":_.escape(__t))+" </h4> ",description&&(__p+=' <p class="CDB-Text CDB-Size-small u-tSpace js-description">'+(null==(__t=description)?"":_.escape(__t))+"</p> "),__p+=" "):__p+=' <div class="CDB-Widget-listItem--fake"></div> ',__p+=" </div>";return __p}},{underscore:354}],397:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+=""+(null==(__t=value)?"":_.escape(__t))+(null==(__t=suffix)?"":_.escape(__t));return __p}},{underscore:354}],398:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("d3"),g=a("cartodb.js"),h=a("../../formatter");b.exports=g.core.View.extend({options:{showOnWidthChange:!0,chartBarColorClass:"",labelsMargin:16,hasAxisTip:!1,minimumBarHeight:2,animationSpeed:750,handleWidth:6,handleHeight:23,handleRadius:3,divisionWidth:80,animationBarDelay:function(a,b){return Math.random()*(100+10*b)},transitionType:"elastic"},initialize:function(){if(this._originalData=this.options.originalData,!e.isNumber(this.options.height))throw new Error("height is required");e.bindAll(this,"_selectBars","_adjustBrushHandles","_onBrushMove","_onBrushStart","_onMouseMove","_onMouseOut"),this._onWindowResize=e.debounce(this._resizeToParentElement.bind(this),50),d(window).bind("resize",this._onWindowResize),this.setElement(d('<svg class=""></svg>')[0]),this.canvas=f.select(this.el).attr("width",0).attr("height",this.options.height),this.canvas.append("g").attr("class","CDB-WidgetCanvas"),this._setupModel(),this._setupBindings(),this._setupDimensions(),this._setupD3Bindings(),this.hide()},render:function(){return this._generateChart(),this._generateChartContent(),this},replaceData:function(a){this.model.set({data:a})},toggleLabels:function(a){this.model.set("showLabels",a)},chartWidth:function(){var a=this.model.get("margin");return Math.max(0,this.model.get("width")-a.left-a.right)},chartHeight:function(){var a=this.model.get("margin"),b=this.model.get("showLabels")?this.options.labelsMargin:0;return this.model.get("height")-a.top-a.bottom-b},_resizeToParentElement:function(){if(this.$el.parent()){var a=this.isHidden();this.hide();var b=this.$el.parent().width()||0;a?this.hide():this.show(),this.model.set("width",b)}},_onChangeLeftAxisTip:function(){this._updateAxisTip("left")},_onChangeRightAxisTip:function(){this._updateAxisTip("right")},_updateAxisTip:function(a){var b=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+a),c=this.chart.select(".CDB-Chart-axisTip.CDB-Chart-axisTip-"+a),d=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+a),e=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+a);b.data([this.model.get(a+"_axis_tip")]).text(function(a){return h.formatNumber(a)});var f=b.node().getBBox().width;d.attr("width",f+4);var g=/translate\(\s*([^\s,)]+), ([^\s,)]+)/.exec(e.attr("transform")),i=+g[1]+3;0>i-f/2?(c.attr("transform","translate(0, 52)"),b.attr("dx",-i),d.attr("x",-i)):i+f/2+2>=this.chartWidth()?(c.attr("transform","translate(0, 52)"),b.attr("dx",this.chartWidth()-(i+f-2)),d.attr("x",this.chartWidth()-(i+f))):(c.attr("transform","translate(-"+f/2+", 52)"),d.attr("x",0),b.attr("dx",2))},_onChangeData:function(){this.model.previous("data").length!==this.model.get("data").length?this.reset():this.refresh()},_onChangeRange:function(){0===this.model.get("lo_index")&&0===this.model.get("hi_index")||this.trigger("range_updated",this.model.get("lo_index"),this.model.get("hi_index"))},_onChangeWidth:function(){var a=this.model.get("width");this.$el.width(a),this.chart.attr("width",a),this.options.showOnWidthChange&&a>0&&this.show(),this.reset();var b=this.model.get("lo_index"),c=this.model.get("hi_index");this.selectRange(b,c)},_onChangeNormalized:function(){this._generateShadowBars(),this.updateYScale(),this.refresh()},_onChangeHeight:function(){var a=this.model.get("height");this.$el.height(a),this.chart.attr("height",a),this.leftHandle.attr("height",a),this.rightHandle.attr("height",a),this.reset()},_onChangShowLabels:function(){this._axis.style("opacity",this.model.get("showLabels")?1:0)},_onChangePos:function(){var a=this.model.get("pos"),b=this.model.get("margin"),c=+a.x,d=+a.y;this.chart.transition().duration(150).attr("transform","translate("+(b.left+c)+", "+(b.top+d)+")")},_onBrushStart:function(){this.chart.classed("is-selectable",!0),this._axis.classed("is-disabled",!0)},_onChangeDragging:function(){this.chart.classed("is-dragging",this.model.get("dragging")),this._updateAxisTipOpacity("right"),this._updateAxisTipOpacity("left")},_showAxisTip:function(a){var b=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+a),c=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+a);b&&b.transition().duration(200).attr("opacity",1),c&&c.transition().duration(200).attr("opacity",1)},_hideAxisTip:function(a){var b=this.chart.select(".CDB-Chart-axisTipText.CDB-Chart-axisTip-"+a),c=this.chart.select(".CDB-Chart-axisTipRect.CDB-Chart-axisTip-"+a);b&&b.transition().duration(200).attr("opacity",0),c&&c.transition().duration(200).attr("opacity",0)},_updateAxisTipOpacity:function(a){this.model.get("dragging")&&this._showAxisTip(a)},_onBrushMove:function(){this.model.set({dragging:!0}),this._selectBars(),this._adjustBrushHandles()},_onMouseOut:function(){var a=this.chart.selectAll(".CDB-Chart-bar");a.classed("is-highlighted",!1),this.trigger("hover",{value:null})},_onMouseMove:function(){var a=f.event.offsetX,b=Math.floor(a/this.barWidth),c=this.model.get("data");if(void 0!==c[b]&&null!==c[b]){var d=c[b].freq,e={},g=this.chart.select(".CDB-Chart-bar:nth-child("+(b+1)+")");if(g&&g.node()&&!g.classed("is-selected")){var i=b*this.barWidth+this.barWidth/2,j=this.yScale(d),k=this.chartHeight()-this.yScale(d);if(k<this.options.minimumBarHeight&&k>0&&(j=this.chartHeight()-this.options.minimumBarHeight),!this._isDragging()&&d>0){var l=h.formatNumber(d);e={top:j,left:i,data:l}}else e=null}else e=null;this.trigger("hover",e),this.chart.selectAll(".CDB-Chart-bar").classed("is-highlighted",!1),g&&g.node()&&g.classed("is-highlighted",!0)}},reset:function(){this._removeChartContent(),this._setupDimensions(),
this._calcBarWidth(),this._generateChartContent(),this._generateShadowBars()},refresh:function(){this._setupDimensions(),this._removeAxis(),this._generateAxis(),this._updateChart(),this.chart.select(".CDB-Chart-handles").moveToFront(),this.chart.select(".Brush").moveToFront()},resetIndexes:function(){this.model.set({lo_index:null,hi_index:null})},removeShadowBars:function(){this.model.set("show_shadow_bars",!1)},_removeShadowBars:function(){this.chart.selectAll(".CDB-Chart-shadowBars").remove()},_removeBars:function(){this.chart.selectAll(".CDB-Chart-bars").remove()},_removeBrush:function(){this.chart.selectAll(".Brush").remove(),this.chart.classed("is-selectable",!1),this._axis.classed("is-disabled",!1)},_removeLines:function(){this.chart.select(".CDB-Chart-lines").remove(),this.chart.select(".CDB-Chart-line--bottom").remove()},_removeChartContent:function(){this._removeBrush(),this._removeHandles(),this._removeBars(),this._removeAxis(),this._removeLines()},_generateChartContent:function(){this._generateAxis(),this._generateLines(),this._generateBars(),this._generateHandles(),this._setupBrush(),this._generateBottomLine()},_generateLines:function(){this._generateHorizontalLines(),"time"!==this.options.type&&this._generateVerticalLines()},_generateVerticalLines:function(){var a=this.chart.select(".CDB-Chart-lines");a.append("g").selectAll(".CDB-Chart-line").data(this.verticalRange.slice(1,this.verticalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("y1",0).attr("x1",function(a){return a}).attr("y2",this.chartHeight()).attr("x2",function(a){return a})},_generateHorizontalLines:function(){var a=this.chart.append("g").attr("class","CDB-Chart-lines");a.append("g").attr("class","y").selectAll(".CDB-Chart-line").data(this.horizontalRange.slice(0,this.horizontalRange.length-1)).enter().append("svg:line").attr("class","CDB-Chart-line").attr("x1",0).attr("y1",function(a){return a}).attr("x2",this.chartWidth()).attr("y2",function(a){return a})},_generateBottomLine:function(){this.chart.append("line").attr("class","CDB-Chart-line CDB-Chart-line--bottom").attr("x1",0).attr("y1",this.chartHeight()-1).attr("x2",this.chartWidth()-1).attr("y2",this.chartHeight()-1)},_setupD3Bindings:function(){f.selection.prototype.moveToBack=function(){return this.each(function(){var a=this.parentNode.firstChild;a&&this.parentNode.insertBefore(this,a)})},f.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})}},_setupModel:function(){this.model=new g.core.Model({bounded:!1,showLabels:!0,data:this.options.data,height:this.options.height,display:!0,show_shadow_bars:this.options.displayShadowBars,margin:e.clone(this.options.margin),width:0,pos:{x:0,y:0},normalized:this.options.normalized})},_setupBindings:function(){this.model.bind("change:data",this._onChangeData,this),this.model.bind("change:display",this._onChangeDisplay,this),this.model.bind("change:dragging",this._onChangeDragging,this),this.model.bind("change:height",this._onChangeHeight,this),this.model.bind("change:left_axis_tip",this._onChangeLeftAxisTip,this),this.model.bind("change:lo_index change:hi_index",this._onChangeRange,this),this.model.bind("change:pos",this._onChangePos,this),this.model.bind("change:right_axis_tip",this._onChangeRightAxisTip,this),this.model.bind("change:showLabels",this._onChangShowLabels,this),this.model.bind("change:show_shadow_bars",this._onChangeShowShadowBars,this),this.model.bind("change:width",this._onChangeWidth,this),this.model.bind("change:normalized",this._onChangeNormalized,this),this._originalData&&(this._originalData.on("change:data",function(){this._removeShadowBars(),this._generateShadowBars()},this),this.add_related_model(this._originalData))},_setupDimensions:function(){this._setupScales(),this._setupRanges(),this._onWindowResize()},_getXScale:function(){return f.scale.linear().domain([0,100]).range([0,this.chartWidth()])},_getYScale:function(){var a=this._originalData&&this._originalData.getData()||this.model.get("data");return this.model.get("normalized")&&(a=this.model.get("data")),f.scale.linear().domain([0,f.max(a,function(a){return e.isEmpty(a)?0:a.freq})]).range([this.chartHeight(),0])},updateXScale:function(){this.xScale=this._getXScale()},updateYScale:function(){this.yScale=this._getYScale()},resetYScale:function(){this.yScale=this._originalYScale},_getDataForScales:function(){return!this.model.get("bounded")&&this._originalData?this._originalData.getData():this.model.get("data")},_setupScales:function(){var a=this._getDataForScales();this.updateXScale(),this._originalYScale&&!this.model.get("normalized")||(this._originalYScale=this.yScale=this._getYScale()),a&&a.length&&("time"===this.options.type?this.xAxisScale=f.time.scale().domain([1e3*a[0].start,1e3*a[a.length-1].end]).nice().range([0,this.chartWidth()]):this.xAxisScale=f.scale.linear().range([a[0].start,a[a.length-1].end]).domain([0,this.chartWidth()]))},_setupRanges:function(){var a=Math.round(this.chartWidth()/this.options.divisionWidth);this.verticalRange=f.range(0,this.chartWidth()+this.chartWidth()/a,this.chartWidth()/a),this.horizontalRange=f.range(0,this.chartHeight()+this.chartHeight()/2,this.chartHeight()/2)},_calcBarWidth:function(){this.barWidth=this.chartWidth()/this.model.get("data").length},_generateChart:function(){var a=this.model.get("margin");this.chart=f.select(this.el).selectAll(".CDB-WidgetCanvas").append("g").attr("class","CDB-Chart").attr("transform","translate("+a.left+", "+a.top+")"),this.chart.classed(this.options.className||"",!0)},_onChangeShowShadowBars:function(){this.model.get("show_shadow_bars")?this._generateShadowBars():this._removeShadowBars()},_onChangeDisplay:function(){this.model.get("display")?this._show():this._hide()},hide:function(){this.model.set("display",!1)},show:function(){this.model.set("display",!0)},_hide:function(){this.$el.hide()},_show:function(){this.$el.show()},isHidden:function(){return!this.model.get("display")},_selectBars:function(){var a=this,b=this.brush.extent(),c=b[0],d=b[1];this.model.set({lo_index:this._getLoBarIndex(),hi_index:this._getHiBarIndex()}),this.chart.selectAll(".CDB-Chart-bar").classed("is-selected",function(b,e){var f=Math.floor(e*a.barWidth),g=Math.floor(f+a.barWidth),h=Math.floor(a.xScale(c)),i=Math.floor(a.xScale(d)),j=f>h&&i>f||g>h&&i>g||h>=f&&g>=i;return!j})},_isDragging:function(){return this.model.get("dragging")},_move:function(a){this.model.set({pos:a})},expand:function(a){this.canvas.attr("height",this.model.get("height")+a),this._move({x:0,y:a})},contract:function(a){this.canvas.attr("height",a),this._move({x:0,y:0})},resizeHeight:function(a){this.model.set("height",a)},setNormalized:function(a){return this.model.set("normalized",!!a),this},removeSelection:function(){this.resetIndexes(),this.chart.selectAll(".CDB-Chart-bar").classed("is-selected",!1),this._removeBrush(),this._setupBrush()},selectRange:function(a,b){if(a||b){var c=this._getBarPosition(a),d=this._getBarPosition(b);this._selectRange(c,d)}},_selectRange:function(a,b){this.chart.select(".Brush").transition().duration(this.brush.empty()?0:150).call(this.brush.extent([a,b])).call(this.brush.event)},_getLoBarIndex:function(){var a=this.brush.extent();return Math.round(this.xScale(a[0])/this.barWidth)},_getHiBarIndex:function(){var a=this.brush.extent();return Math.round(this.xScale(a[1])/this.barWidth)},_getBarIndex:function(){var a=f.event.sourceEvent.offsetX;return Math.floor(a/this.barWidth)},_getBarPosition:function(a){var b=this.model.get("data");return a*(100/b.length)},_setupBrush:function(){function a(){var a,d,e=b.model.get("data");if(b.model.set({dragging:!1}),c.empty())b.chart.selectAll(".CDB-Chart-bar").classed("is-selected",!1),f.select(this).call(c.extent([0,0]));else{var g=b._getLoBarIndex(),h=b._getHiBarIndex();if(a=b._getBarPosition(g),d=b._getBarPosition(h),!f.event.sourceEvent)return;g===h&&(h>=e.length?a=b._getBarPosition(g-1):d=b._getBarPosition(h+1)),b._selectRange(a,d),b.model.set({lo_index:g,hi_index:h}),b._adjustBrushHandles(),b._selectBars(),b.trigger("on_brush_end",b.model.get("lo_index"),b.model.get("hi_index"))}if(f.event.sourceEvent&&void 0===a&&void 0===d){var i=b._getBarIndex();a=b._getBarPosition(i),d=b._getBarPosition(i+1),b.model.set({lo_index:i,hi_index:i+1}),b._selectRange(a,d),b.trigger("on_brush_end",b.model.get("lo_index"),b.model.get("hi_index"))}}var b=this,c=this.brush=f.svg.brush().x(this.xScale);this.brush.on("brushstart",this._onBrushStart).on("brush",this._onBrushMove).on("brushend",a),this.chart.append("g").attr("class","Brush").call(this.brush).selectAll("rect").attr("y",0).attr("height",this.chartHeight()).on("mouseout",this._onMouseOut).on("mousemove",this._onMouseMove)},_adjustBrushHandles:function(){var a=this.brush.extent(),b=a[0],c=a[1],d=this.xScale(b)-this.options.handleWidth/2,e=this.xScale(c)-this.options.handleWidth/2;this.chart.select(".CDB-Chart-handle-left").attr("transform","translate("+d+", 0)"),this.chart.select(".CDB-Chart-handle-right").attr("transform","translate("+e+", 0)"),this.options.hasAxisTip&&this.model.set({left_axis_tip:this.xAxisScale(d+3),right_axis_tip:this.xAxisScale(e+3)})},_generateAxisTip:function(a){var b=this.chart.select(".CDB-Chart-handle.CDB-Chart-handle-"+a),c=b.selectAll("g").data([""]).enter().append("g").attr("class","CDB-Chart-axisTip CDB-Chart-axisTip-"+a).attr("transform",function(a,b){return"translate(0,52)"});this.rectLabel=c.append("rect").attr("class","CDB-Chart-axisTipRect CDB-Chart-axisTip-"+a).attr("height",12).attr("width",10),this.textLabel=c.append("text").attr("class","CDB-Text CDB-Size-small CDB-Chart-axisTipText CDB-Chart-axisTip-"+a).attr("dy","11").attr("dx","0").text(function(a){return a})},_generateHandle:function(a){var b={width:this.options.handleWidth,height:this.options.handleHeight,radius:this.options.handleRadius},c=this.chartHeight()/2-this.options.handleHeight/2,d=this.chart.select(".CDB-Chart-handles").append("g").attr("class","CDB-Chart-handle CDB-Chart-handle-"+a);if(this.options.hasAxisTip&&this._generateAxisTip(a),d.append("line").attr("class","CDB-Chart-handleLine").attr("x1",3).attr("y1",-4).attr("x2",3).attr("y2",this.chartHeight()+4),this.options.hasHandles){d.append("rect").attr("class","CDB-Chart-handleRect").attr("transform","translate(0, "+c+")").attr("width",b.width).attr("height",b.height).attr("rx",b.radius).attr("ry",b.radius);for(var e=21,f=0;3>f;f++)d.append("line").attr("class","CDB-Chart-handleGrip").attr("x1",2).attr("y1",e+3*f).attr("x2",4).attr("y2",e+3*f)}return d},_generateHandles:function(){this.chart.append("g").attr("class","CDB-Chart-handles"),this.leftHandle=this._generateHandle("left"),this.rightHandle=this._generateHandle("right")},_generateHandleLine:function(){return this.chart.select(".CDB-Chart-handles").append("line").attr("class","CDB-Chart-handleLine").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",this.chartHeight())},_removeHandles:function(){this.chart.select(".CDB-Chart-handles").remove()},_removeAxis:function(){this.canvas.select(".CDB-Chart-axis").remove()},_generateAdjustAnchorMethod:function(a){return function(b,c){return 0===c?"start":c===a.length-1?"end":"middle"}},_generateAxis:function(){this._axis="time"===this.options.type?this._generateTimeAxis():this._generateNumericAxis(),this._onChangShowLabels()},_generateNumericAxis:function(){var a=this,b=this._generateAdjustAnchorMethod(this.verticalRange),c=this.chart.append("g").attr("class","CDB-Chart-axis CDB-Text CDB-Size-small");return c.append("g").selectAll(".Label").data(this.verticalRange).enter().append("text").attr("x",function(a){return a}).attr("y",function(b){return a.chartHeight()+15}).attr("text-anchor",b).text(function(b){return a.xAxisScale?h.formatNumber(a.xAxisScale(b)):void 0}),c},_generateTimeAxis:function(){var a=this._generateAdjustAnchorMethod(this.xAxisScale.ticks()),b=f.svg.axis().orient("bottom").tickPadding(5).innerTickSize(-this.chartHeight()).scale(this.xAxisScale).orient("bottom"),c=this.canvas.append("g").attr("class","CDB-Chart-axis CDB-Text CDB-Size-small").attr("transform","translate(0,"+(this.chartHeight()+5)+")").call(b);return c.selectAll("text").style("text-anchor",a),c.moveToBack(),c},_updateChart:function(){var a=this,b=this.model.get("data"),c=this.chart.selectAll(".CDB-Chart-bar").data(b);c.enter().append("rect").attr("class","CDB-Chart-bar "+this.options.chartBarColorClass).attr("data",function(a){return e.isEmpty(a)?0:a.freq}).attr("transform",function(b,c){return"translate("+c*a.barWidth+", 0 )"}).attr("y",a.chartHeight()).attr("height",0).attr("width",Math.max(0,this.barWidth-1)),c.transition().duration(200).attr("height",function(b){if(e.isEmpty(b))return 0;var c=a.chartHeight()-a.yScale(b.freq);return c<a.options.minimumBarHeight&&c>0&&(c=a.options.minimumBarHeight),c}).attr("y",function(b){if(e.isEmpty(b))return a.chartHeight();var c=a.chartHeight()-a.yScale(b.freq);return c<a.options.minimumBarHeight&&c>0?a.chartHeight()-a.options.minimumBarHeight:a.yScale(b.freq)}),c.exit().transition().duration(200).attr("height",function(a){return 0}).attr("y",function(b){return a.chartHeight()})},_generateBars:function(){var a=this,b=this.model.get("data");this._calcBarWidth();var c=this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-bars").selectAll(".CDB-Chart-bar").data(b);c.enter().append("rect").attr("class","CDB-Chart-bar "+this.options.chartBarColorClass).attr("data",function(a){return e.isEmpty(a)?0:a.freq}).attr("transform",function(b,c){return"translate("+c*a.barWidth+", 0 )"}).attr("y",a.chartHeight()).attr("height",0).attr("width",Math.max(0,this.barWidth-1)),c.transition().ease(this.options.transitionType).duration(this.options.animationSpeed).delay(this.options.animationBarDelay).transition().attr("height",function(b){if(e.isEmpty(b))return 0;var c=a.chartHeight()-a.yScale(b.freq);return c<a.options.minimumBarHeight&&c>0&&(c=a.options.minimumBarHeight),c}).attr("y",function(b){if(e.isEmpty(b))return a.chartHeight();var c=a.chartHeight()-a.yScale(b.freq);return c<a.options.minimumBarHeight&&c>0?a.chartHeight()-a.options.minimumBarHeight:a.yScale(b.freq)})},showShadowBars:function(){this.options.displayShadowBars&&this.model.set("show_shadow_bars",!0)},_generateShadowBars:function(){var a=this._originalData&&this._originalData.getData()||this.model.get("data");if(!a||!a.length||!this.model.get("show_shadow_bars")||this.model.get("normalized"))return void this._removeShadowBars();this._removeShadowBars();var b=this,c=f.scale.linear().domain([0,f.max(a,function(a){return e.isEmpty(a)?0:a.freq})]).range([this.chartHeight(),0]),d=this.chartWidth()/a.length;this.chart.append("g").attr("transform","translate(0, 0)").attr("class","CDB-Chart-shadowBars").selectAll(".CDB-Chart-shadowBar").data(a).enter().append("rect").attr("class","CDB-Chart-shadowBar").attr("data",function(a){return e.isEmpty(a)?0:a.freq}).attr("transform",function(a,b){return"translate("+b*d+", 0 )"}).attr("y",function(a){if(e.isEmpty(a))return b.chartHeight();var d=b.chartHeight()-c(a.freq);return d<b.options.minimumBarHeight&&d>0?b.chartHeight()-b.options.minimumBarHeight:c(a.freq)}).attr("width",Math.max(0,d-1)).attr("height",function(a){if(e.isEmpty(a))return 0;var d=b.chartHeight()-c(a.freq);return d<b.options.minimumBarHeight&&d>0&&(d=b.options.minimumBarHeight),d}),this.chart.selectAll(".CDB-Chart-shadowBars").moveToBack(),this.chart.selectAll(".CDB-Chart-lines").moveToBack()},unsetBounds:function(){this.model.set("bounded",!1),this.updateYScale(),this.contract(this.options.height),this.resetIndexes(),this.removeSelection()},setBounds:function(){this.model.set("bounded",!0),this.updateYScale(),this.expand(4),this.removeShadowBars()},clean:function(){d(window).unbind("resize",this._onWindowResize),g.core.View.prototype.clean.call(this)}})},{"../../formatter":363,"cartodb.js":283,d3:330,jquery:331,underscore:354}],399:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("../../formatter"),g=a("./histogram-title-view"),h=a("./chart"),i=a("./placeholder.tpl"),j=a("./content.tpl"),k=a("../dropdown/widget-dropdown-view"),l=a("../animate-values.js"),m=a("./animation-template.tpl");b.exports=e.core.View.extend({className:"CDB-Widget-body",defaults:{chartHeight:72},events:{"click .js-clear":"_resetWidget","click .js-zoom":"_zoom"},initialize:function(){this._dataviewModel=this.model.dataviewModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this.filter=this._dataviewModel.filter,this.lockedByUser=!1,this._initBinds()},_initViews:function(){this._initTitleView();var a=new k({target:this.$(".js-actions"),container:this.$(".js-header"),flags:{normalizeHistogram:!0}});a.bind("click",function(a,b){"toggle"===a?this.model.set("collapsed",!this.model.get("collapsed")):"normalize"===a&&(this.histogramChartView.setNormalized(b),this.miniHistogramChartView.setNormalized(b))},this),this.addView(a),this._renderMiniChart(),this._renderMainChart()},_initTitleView:function(){var a=new g({widgetModel:this.model,dataviewModel:this._dataviewModel});this.$(".js-title").append(a.render().el),this.addView(a)},_initBinds:function(){this._originalData.once("change:data",this._onFirstLoad,this),this.model.bind("change:collapsed",this.render,this)},_onFirstLoad:function(){this.render(),this._dataviewModel.bind("change:data",this._onHistogramDataChanged,this),this.add_related_model(this._dataviewModel),this._dataviewModel.fetch()},_isZoomed:function(){return this.model.get("zoomed")},_onHistogramDataChanged:function(){this._dataviewModel.changed.url&&this._isZoomed()||(this.lockedByUser?this.lockedByUser=!1:(this._isZoomed()||(this.histogramChartView.showShadowBars(),this.miniHistogramChartView.replaceData(this._dataviewModel.getData())),this.histogramChartView.replaceData(this._dataviewModel.getData())),this.unsettingRange&&this._unsetRange(),this._updateStats())},render:function(){this.clearSubViews();var a=this._dataviewModel.getData(),b=this._originalData.getData(),c=!d.size(a)&&!d.size(b);return this.$el.html(j({title:this.model.get("title"),showStats:this.model.get("show_stats"),itemsCount:c?"-":a.length})),c?(this._addPlaceholder(),this._initTitleView()):(this._setupBindings(),this.$el.toggleClass("is-collapsed",!!this.model.get("collapsed")),this._initViews()),this},_unsetRange:function(){this.unsettingRange=!1,this.histogramChartView.replaceData(this._dataviewModel.getData()),this.model.set({lo_index:null,hi_index:null}),this._isZoomed()||this.histogramChartView.showShadowBars()},_addPlaceholder:function(){this.$(".js-content").append(i())},_renderMainChart:function(){this.histogramChartView=new h({margin:{top:4,right:4,bottom:4,left:4},hasHandles:!0,hasAxisTip:!0,width:this.canvasWidth,height:this.defaults.chartHeight,data:this._dataviewModel.getData(),originalData:this._originalData,displayShadowBars:!this.model.get("normalized"),normalized:this.model.get("normalized")}),this.$(".js-content").append(this.histogramChartView.el),this.addView(this.histogramChartView),this.histogramChartView.bind("range_updated",this._onRangeUpdated,this),this.histogramChartView.bind("on_brush_end",this._onBrushEnd,this),this.histogramChartView.bind("hover",this._onValueHover,this),this.histogramChartView.render().show(),this._updateStats()},_renderMiniChart:function(){this.miniHistogramChartView=new h({className:"CDB-Chart--mini",margin:{top:0,right:4,bottom:4,left:4},height:40,showOnWidthChange:!1,data:this._dataviewModel.getData(),normalized:this.model.get("normalized"),originalData:this._originalData}),this.addView(this.miniHistogramChartView),this.$(".js-content").append(this.miniHistogramChartView.el),this.miniHistogramChartView.bind("on_brush_end",this._onMiniRangeUpdated,this),this.miniHistogramChartView.render()},_setupBindings:function(){this._dataviewModel.bind("change:bins",this._onChangeBins,this),this.model.bind("change:zoomed",this._onChangeZoomed,this),this.model.bind("change:zoom_enabled",this._onChangeZoomEnabled,this),this.model.bind("change:filter_enabled",this._onChangeFilterEnabled,this),this.model.bind("change:total",this._onChangeTotal,this),this.model.bind("change:nulls",this._onChangeNulls,this),this.model.bind("change:max",this._onChangeMax,this),this.model.bind("change:min",this._onChangeMin,this),this.model.bind("change:avg",this._onChangeAvg,this)},_clearTooltip:function(){this.$(".js-tooltip").stop().hide()},_onValueHover:function(a){var b=this.$(".js-tooltip");if(a&&a.data){var c=this.defaults.chartHeight+3-a.top;b.css({bottom:c,left:a.left}),b.text(a.data),b.css({left:a.left-b.width()/2}),b.fadeIn(70)}else this._clearTooltip()},_onMiniRangeUpdated:function(a,b){this.lockedByUser=!1,this._clearTooltip(),this.histogramChartView.removeSelection();var c=this._originalData.getData();a>=0&&a<c.length&&b-1>=0&&b-1<c.length?(this.filter.setRange(c[a].start,c[b-1].end),this._updateStats()):console.error("Error accessing array bounds",a,b,c)},_onBrushEnd:function(a,b){var c=this._dataviewModel.getData();if(c&&c.length){this._isZoomed()&&(this.lockedByUser=!0);var d={filter_enabled:!0,lo_index:a,hi_index:b};this.model.get("zoomed")||(d.zoom_enabled=!0),this.model.set(d),a>=0&&a<c.length&&b-1>=0&&b-1<c.length?(this.filter.setRange(c[a].start,c[b-1].end),this._updateStats()):console.error("Error accessing array bounds",a,b,c)}},_onRangeUpdated:function(a,b){var c=this;this.model.get("zoomed")?this.model.set({zoom_enabled:!1,lo_index:a,hi_index:b}):this.model.set({lo_index:a,hi_index:b});var e=d.debounce(function(){c._updateStats()},400);e()},_onChangeFilterEnabled:function(){this.$(".js-filter").toggleClass("is-hidden",!this.model.get("filter_enabled"))},_onChangeBins:function(a,b){this._originalData.setBins(b),this.model.set({zoom_enabled:!1,filter_enabled:!1,lo_index:null,hi_index:null})},_onChangeZoomEnabled:function(){this.$(".js-zoom").toggleClass("is-hidden",!this.model.get("zoom_enabled"))},_changeHeaderValue:function(a,b,c){if(void 0===this.model.get(b))return void this.$(a).text("0 "+c);this._addTitleForValue(a,b,c);var d=new l({el:this.$el});d.animateValue(this.model,b,a,m,{formatter:f.formatNumber,templateData:{suffix:" "+c}})},_onChangeNulls:function(){this._changeHeaderValue(".js-nulls","nulls","")},_onChangeTotal:function(){this._changeHeaderValue(".js-val","total","SELECTED")},_onChangeMax:function(){this._changeHeaderValue(".js-max","max","")},_onChangeMin:function(){this._changeHeaderValue(".js-min","min","")},_onChangeAvg:function(){this._changeHeaderValue(".js-avg","avg","")},_addTitleForValue:function(a,b,c){this.$(a).attr("title",this._formatNumberWithCommas(this.model.get(b).toFixed(2))+" "+c)},_formatNumberWithCommas:function(a){return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},_updateStats:function(){var a,b,c=this._dataviewModel.getData(),d=this._dataviewModel.get("nulls");if(c&&c.length){var e=this.model.get("lo_index")||0,f=this.model.get("hi_index")||c.length,g=this._calcSum(c,e,f),h=this._calcAvg(c,e,f);e>=0&&e<c.length&&(a=c[e].start),f>=0&&f-1<c.length&&(b=c[f-1].end),this.model.set({total:g,nulls:d,min:a,max:b,avg:h})}},_calcAvg:function(a,b,c){var e=a.slice(b,c),f=this._calcSum(a,b,c,f);if(!f)return 0;var g=d.reduce(e,function(a,b){return b.avg&&b.freq?b.avg*b.freq+a:a},0);return g/f},_calcSum:function(a,b,c){return d.reduce(a.slice(b,c),function(a,b){return b.freq+a},0)},_onChangeZoomed:function(){this.model.get("zoomed")?this._onZoomIn():this._resetWidget()},_showMiniRange:function(){var a=this.model.get("lo_index"),b=this.model.get("hi_index");this.miniHistogramChartView.selectRange(a,b),this.miniHistogramChartView.show()},_zoom:function(){this.model.set({zoomed:!0,zoom_enabled:!1}),this.histogramChartView.removeSelection()},_onZoomIn:function(){this.lockedByUser=!1,this._showMiniRange(),this.histogramChartView.setBounds(),this._dataviewModel.enableFilter(),this._dataviewModel.fetch()},_resetWidget:function(){this.lockedByUser=!0,this.unsettingRange=!0,this.model.set({zoomed:!1,zoom_enabled:!1,filter_enabled:!1,lo_index:null,hi_index:null}),this._dataviewModel.disableFilter(),this.filter.unsetRange(),this.histogramChartView.unsetBounds(),this.miniHistogramChartView.hide()}})},{"../../formatter":363,"../animate-values.js":366,"../dropdown/widget-dropdown-view":393,"./animation-template.tpl":397,"./chart":398,"./content.tpl":400,"./histogram-title-view":402,"./placeholder.tpl":404,"cartodb.js":283,underscore:354}],400:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-header js-header"> <div class="js-title"></div> ',showStats&&(__p+=' <dl class="CDB-Widget-info CDB-Text CDB-Size-small u-secondaryTextColor u-upperCase u-tSpace"> <dt class="CDB-Widget-infoCount js-nulls">0</dt><dd class="CDB-Widget-infoDescription">NULL ROWS</dd> <dt class="CDB-Widget-infoCount js-min">0</dt><dd class="CDB-Widget-infoDescription">MIN</dd> <dt class="CDB-Widget-infoCount js-avg">0</dt><dd class="CDB-Widget-infoDescription">AVG</dd> <dt class="CDB-Widget-infoCount js-max">0</dt><dd class="CDB-Widget-infoDescription">MAX</dd> </dl> '),__p+=' </div> <div class="CDB-Widget-content CDB-Widget-content--histogram js-content"> <div class="CDB-Widget-tooltip CDB-Widget-tooltip--light CDB-Text CDB-Size-small js-tooltip"></div> <div class="CDB-Widget-filter CDB-Widget-contentSpaced"> <p class="CDB-Text CDB-Size-small is-semibold u-upperCase js-val">…</p> <div class="CDB-Widget-filterButtons js-filter is-hidden"> <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-zoom">zoom</button> <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-clear">clear</button> </div> </div> </div>';return __p}},{underscore:354}],401:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-title CDB-Widget-contentSpaced"> <h3 class="CDB-Text CDB-Size-large is-overflow" title="'+(null==(__t=title)?"":_.escape(__t))+'">'+(null==(__t=title)?"":_.escape(__t))+'</h3> <div class="CDB-Widget-options CDB-Widget-contentSpaced"> <button class="CDB-Widget-buttonIcon CDB-Widget-buttonIcon--circle js-sizes '+(null==(__t=isSizesApplied?"is-selected":"")?"":_.escape(__t))+" "+(null==(__t=isSizesApplied?"js-cancelSizes":"js-applySizes")?"":_.escape(__t))+'" data-tooltip="'+(null==(__t=isSizesApplied?"Remove sizes":"Apply sizes")?"":_.escape(__t))+'"> <i class="CDB-IconFont CDB-IconFont-drop CDB-IconFont--small CDB-IconFont--top"></i> </button> <button class="CDB-Shape js-actions u-lSpace"> <div class="CDB-Shape-threePoints is-blue is-small"> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> <div class="CDB-Shape-threePointsItem"></div> </div> </button> </div> </div>';return __p}},{underscore:354}],402:[function(a,b,c){var d=a("jquery"),e=a("cartodb.js"),f=a("../widget-tooltip-view"),g=a("./histogram-title-template.tpl");b.exports=e.core.View.extend({className:"CDB-Widget-title CDB-Widget-contentSpaced",events:{"click .js-applySizes":"_applySizes","click .js-cancelSizes":"_cancelSizes"},initialize:function(){this.widgetModel=this.options.widgetModel,this.dataviewModel=this.options.dataviewModel,this._initBinds()},render:function(){return this.clearSubViews(),this.$el.html(g({title:this.widgetModel.get("title"),isSizesApplied:this.dataviewModel.get("histogram_sizes"),isCollapsed:this.widgetModel.get("collapsed")})),this._initViews(),this},_initBinds:function(){this.widgetModel.bind("change:title change:collapsed",this.render,this),this.dataviewModel.bind("change:histogram_sizes",this.render,this),this.add_related_model(this.dataviewModel)},_initViews:function(){var a=new f({target:this.$(".js-sizes")});d("body").append(a.render().el),this.addView(a)},_applySizes:function(){this.dataviewModel.set("histogram_sizes",!0)},_cancelSizes:function(){this.dataviewModel.set("histogram_sizes",!1)}})},{"../widget-tooltip-view":435,"./histogram-title-template.tpl":401,"cartodb.js":283,jquery:331}],403:[function(a,b,c){var d=a("../widget-model");b.exports=d.extend({initialize:function(a,b){d.prototype.initialize.apply(this,arguments),this.on("change:collapsed",this._onCollapsedChange,this)},_onCollapsedChange:function(a,b){this.dataviewModel.set("enabled",!b)}})},{"../widget-model":434}],404:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<ul class="CDB-Widget-chart CDB-Widget-chart--fake"> ';for(var i=0;15>i;i++)__p+=' <li class="CDB-Widget-chartItem CDB-Widget-chartItem--'+(null==(__t=_.sample(["small","medium","big"],1)[0])?"":_.escape(__t))+' CDB-Widget-chartItem--fake"></li> ';__p+=" </ul>"}return __p}},{underscore:354}],405:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-header"> <div class="CDB-Widget-title CDB-Widget-contentSpaced"> <h3 class="CDB-Widget-textBig" title="'+(null==(__t=title)?"":_.escape(__t))+'">'+(null==(__t=title)?"":_.escape(__t))+'</h3> </div> <dl class="CDB-Widget-info CDB-Widget-textSmaller CDB-Widget-textSmaller--upper u-tSpace"> <dt>'+(null==(__t=itemsCount)?"":_.escape(__t))+'</dt><dd class="CDB-Widget-info">rows</dd> </dl> </div> <div class="CDB-Widget-content CDB-Widget-content--noSidesMargin"> <div class="CDB-Widget-listWrapper js-content"></div> </div> <div class="CDB-Widget-footer js-footer"></div>';return __p}},{underscore:354}],406:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("../../formatter"),g=a("./items-view"),h=a("./paginator-view"),i=a("./edges-view"),j=a("./content-template.tpl"),k=a("./placeholder-template.tpl");b.exports=e.core.View.extend({className:"CDB-Widget-body",options:{showScroll:!1},initialize:function(){this._dataviewModel=this.model.dataviewModel,this._initBinds()},render:function(){this.clearSubViews();var a=this._dataviewModel.getData(),b=d.isEmpty(a)||0===d.size(a);return this.$el.html(j({title:this.model.get("title"),itemsCount:b?"-":f.formatValue(a.length)})),b?this.$(".js-content").append(k()):this._initViews(),this},_initBinds:function(){this.listenTo(this.model,"change:title",this.render),this.listenTo(this._dataviewModel,"change:data",this.render),this.add_related_model(this._dataviewModel)},_initViews:function(){this._list=new g({model:this.model,dataviewModel:this._dataviewModel}),this.$(".js-content").html(this._list.render().el),this.addView(this._list);var a=this._list.$el.get(0).scrollHeight-this._list.$el.outerHeight()>0;(a||this.options.showScroll)&&(this._pagination=new h({$target:this._list.$el}),this.$(".js-footer").append(this._pagination.render().el),this.addView(this._pagination),this._edges=new i({$target:this._list.$el}),this.$(".js-content").append(this._edges.render().el),this.addView(this._edges))}})},{"../../formatter":363,"./content-template.tpl":405,"./edges-view":407,"./items-view":410,"./paginator-view":411,"./placeholder-template.tpl":412,"cartodb.js":283,underscore:354}],407:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js");b.exports=e.core.View.extend({_TEMPLATE:' <div class="CDB-Widget-listEdge CDB-Widget-listEdge--top"><div class="CDB-Widget-listEdgeShadow js-topShadow"></div><div class="CDB-Widget-listEdgeBorder"></div></div><div class="CDB-Widget-listEdge CDB-Widget-listEdge--bottom"><div class="CDB-Widget-listEdgeShadow js-bottomShadow"></div><div class="CDB-Widget-listEdgeBorder"></div></div>',initialize:function(){this._$target=this.options.$target,this._initBinds()},render:function(){this.clearSubViews();var a=d.template(this._TEMPLATE);return this.$el.html(a()),this._checkScroll(),this},_initBinds:function(){var a=this;this._$target.bind("scroll",function(){a._checkScroll()})},_unbindScroll:function(){this._$target.unbind("scroll");
},_checkScroll:function(){var a=this._$target.scrollTop(),b=this._$target.get(0).scrollHeight-this._$target.outerHeight();this.$(".js-topShadow").toggle(0!==a),this.$(".js-bottomShadow").toggle(a!==b)},clean:function(){this._unbindScroll(),e.core.View.prototype.clean.call(this)}})},{"cartodb.js":283,underscore:354}],408:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){if(__p+="",__p+=isClickable?' <button type="button" class="CDB-Widget-listItemInner CDB-Widget-listButton CDB-Widget-listButton--withBorder js-button"> ':' <div class="CDB-Widget-listItemInner CDB-Widget-listItemInner--withBorders"> ',__p+=' <div class="CDB-Widget-contentSpaced CDB-Widget-contentSpaced--topAligned CDB-Widget-contentSpaced--start"> <em class="CDB-Shape-dot CDB-Widget-listDot"></em> ',itemsCount>0){if(__p+=' <div class="CDB-Widget-contentFull"> <p class="CDB-Widget-textSmall CDB-Widget-textSmall--upper CDB-Widget-textSmall--bold" title="'+(null==(__t=items[0][1])?"":_.escape(__t))+'">'+(null==(__t=items[0][1])?"":_.escape(__t))+"</p> ",itemsCount>2){__p+=' <dl class="CDB-Widget-inlineList"> ';for(var i=1,l=itemsCount;l>i;i++)__p+=' <div class="CDB-Widget-inlineListItem CDB-Widget-textSmaller CDB-Widget-textSmaller--noEllip"> <dd class="CDB-Widget-textSmaller--bold CDB-Widget-textSmaller--dark u-rSpace" title="'+(null==(__t=items[i][1])?"":_.escape(__t))+'">'+(null==(__t=items[i][1])?"":_.escape(__t))+'</dd> <dt title="'+(null==(__t=items[i][0])?"":_.escape(__t))+'">'+(null==(__t=items[i][0])?"":_.escape(__t))+"</dt> </div> ";__p+=" </dl> "}else 2===itemsCount&&(__p+=' <dl class="CDB-Widget-textSmaller CDB-Widget-textSmaller--noEllip u-tSpace"> <dd class="CDB-Widget-textSmaller--bold CDB-Widget-textSmaller--dark u-rSpace" title="'+(null==(__t=items[1][1])?"":_.escape(__t))+'">'+(null==(__t=items[1][1])?"":_.escape(__t))+'</dd> <dt title="'+(null==(__t=items[1][0])?"":_.escape(__t))+'">'+(null==(__t=items[1][0])?"":_.escape(__t))+"</dt> </dl> ");__p+=" </div> "}__p+=" </div> ",__p+=isClickable?" </div></button> ":"  ",__p+=""}return __p}},{underscore:354}],409:[function(a,b,c){var d=a("underscore"),e=a("../../formatter"),f=a("cartodb.js"),g=a("./item-template.tpl");b.exports=f.core.View.extend({tagName:"li",className:"CDB-Widget-listItem",events:{"click .js-button":"_onItemClick"},initialize:function(){this._widgetModel=this.options.widgetModel,this._dataviewModel=this.options.dataviewModel},render:function(){var a=this.model.toJSON(),b=this._hasInteractivity(a),c=this._sanitizeData(a);return this.$el.html(g({items:c,isClickable:b,itemsCount:d.size(c)})),this[b?"delegateEvents":"undelegateEvents"](),this},_sanitizeData:function(a){var b=this._hasInteractivity(a);a=d.omit(a,function(a,b,c){return"cartodb_id"===b});var c=this._widgetModel.get("columns_title");b&&!d.isEmpty(c)&&(c=d.rest(c,1));var f=[],g=0;return d.each(a,function(a,b){var d=c&&c[g]||b;f.push([d,e.formatValue(a)]),++g}),f},_hasInteractivity:function(a){return!d.isEmpty(d.filter(a,function(a,b){return"cartodb_id"===b}))},_onItemClick:function(){this.trigger("itemClicked",this.model,this)}})},{"../../formatter":363,"./item-template.tpl":408,"cartodb.js":283,underscore:354}],410:[function(a,b,c){var d=a("cartodb.js"),e=a("./item-view");b.exports=d.core.View.extend({className:"CDB-Widget-list js-list",tagName:"ul",events:{scroll:"_checkScroll"},initialize:function(a){this._dataviewModel=a.dataviewModel},render:function(){return this.clearSubViews(),this._renderList(),this},_renderList:function(){this._dataviewModel.getData().each(this._addItem,this)},_addItem:function(a){var b=new e({model:a,widgetModel:this.model,dataviewModel:this._dataviewModel});b.bind("itemClicked",function(){this.trigger("itemClicked",a,this)},this),this.addView(b),this.$el.append(b.render().el)}})},{"./item-view":409,"cartodb.js":283}],411:[function(a,b,c){var d=a("jquery"),e=a("underscore"),f=a("cartodb.js");b.exports=f.core.View.extend({className:"CDB-Widget-nav CDB-Widget-contentSpaced",_TEMPLATE:' <span></span><div class="CDB-Widget-navArrows CDB-Widget-contentSpaced"><button class="CDB-Shape-arrow CDB-Shape-arrow--up js-up"></button><button class="CDB-Shape-arrow CDB-Shape-arrow--down js-down"></button></div>',events:{"click .js-up":"_scrollUp","click .js-down":"_scrollDown"},initialize:function(){if(!this.options.$target)throw new Error("target should be defined in order to be able to paginate");this._$target=this.options.$target,this._scrollHeight=this._$target.get(0).scrollHeight-this._$target.outerHeight(),this._initBinds()},render:function(){var a=e.template(this._TEMPLATE);return this.$el.html(a()),this._checkScroll(),this},_initBinds:function(){var a=this;this._$target.bind("scroll",function(){a._checkScroll()})},_unbindScroll:function(){this._$target.unbind("scroll")},_checkScroll:function(){var a=this._$target.scrollTop();this.$(".js-up").toggleClass("is-disabled",0===a),this.$(".js-down").toggleClass("is-disabled",a>=this._scrollHeight)},_getEdgeVisibleItems:function(){var a=this._$target.outerHeight(),b=null,c=null,e=this._$target.children(".CDB-Widget-listItem");return e.each(function(f,g){var h=d(this).position().top,i=d(this).outerHeight();h>-1&&null===b?b=this:h+i>a&&null===c&&(c=e[f-1])}),[b,c]},_scrollDown:function(){var a=this._getEdgeVisibleItems()[1],b=this._$target.scrollTop(),c=d(a).next();if(c.length){var e=c.position().top,f=c.outerHeight(),g=e+f-this._$target.outerHeight()+b;g>0&&this._$target.scrollTop(g)}},_scrollUp:function(){var a=this._getEdgeVisibleItems()[0],b=this._$target.scrollTop(),c=d(a).prev();if(c.length){var e=c.position().top,f=b+e;this._$target.scrollTop(f)}},clean:function(){this._unbindScroll(),f.core.View.prototype.clean.call(this)}})},{"cartodb.js":283,jquery:331,underscore:354}],412:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<ul class="CDB-Widget-list CDB-Widget-list--withBorders"> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> <li class="CDB-Widget-listItem CDB-Widget-listItem--fake"></li> </ul>';return __p}},{underscore:354}],413:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("./placeholder.tpl"),g=a("./histogram-view");b.exports=e.core.View.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){this._dataviewModel=this.model.dataviewModel,this._originalData=this.model.dataviewModel.getUnfilteredDataModel(),this._initBinds()},render:function(){return this.clearSubViews(),this.$el.empty(),this._isDataEmpty()?this.$el.append(f({hasTorqueLayer:!1})):this._appendView(new g({model:this._dataviewModel,rangeFilter:this._dataviewModel.filter,torqueLayerModel:this._dataviewModel.layer})),this},_initBinds:function(){this._originalData.once("change:data",this._onOriginalDataChange,this),this._dataviewModel.once("error",function(){console.log("the tiler does not support non-torque layers just yet…")}),this._dataviewModel.once("change:data",this.render,this),this.add_related_model(this._dataviewModel),this.add_related_model(this._originalData)},_appendView:function(a){this.addView(a),this.$el.append(a.render().el)},_isDataEmpty:function(){var a=this._dataviewModel.getData();return d.isEmpty(a)||0===d.size(a)},_onOriginalDataChange:function(){this._dataviewModel.fetch()}})},{"./histogram-view":414,"./placeholder.tpl":415,"cartodb.js":283,underscore:354}],414:[function(a,b,c){var d=a("jquery"),e=a("cartodb.js"),f=a("../histogram/chart"),g=a("./time-series-header-view");b.exports=e.core.View.extend({className:"CDB-Widget-content CDB-Widget-content--timeSeries",defaults:{mobileThreshold:960,histogramChartHeight:72,histogramChartMobileHeight:24},initialize:function(){this._rangeFilter=this.options.rangeFilter,this._originalData=this.model.getUnfilteredDataModel(),this.model.bind("change:data",this._onChangeData,this)},render:function(){return this.clearSubViews(),this._createHeaderView(),this._createHistogramView(),this},_createHeaderView:function(){var a=new g({dataviewModel:this.model,rangeFilter:this._rangeFilter});a.bind("resetFilter",this._onResetFilter,this),this.addView(a),this.$el.append(a.render().el)},_createHistogramView:function(){this._chartView=new f({type:"time",chartBarColorClass:"CDB-Chart-bar--timeSeries",animationSpeed:100,margin:{top:4,right:4,bottom:4,left:4},hasHandles:!0,animationBarDelay:function(a,b){return 3*b},height:this.defaults.histogramChartHeight,data:this.model.getData(),originalData:this._originalData,displayShadowBars:!0}),this.addView(this._chartView),this.$el.append(this._chartView.render().el),this._chartView.show(),this._chartView.bind("on_brush_end",this._onBrushEnd,this),this._chartView.model.bind("change:width",this._onChangeChartWidth,this),this.add_related_model(this._chartView.model)},_onChangeData:function(){this._chartView&&(this._chartView.replaceData(this.model.getData()),this._chartView.updateXScale(),this._chartView.updateYScale())},_onResetFilter:function(){this._rangeFilter.unsetRange(),this._chartView.removeSelection()},_onBrushEnd:function(a,b){var c=this.model.getData();this._rangeFilter.setRange(c[a].start,c[b-1].end)},_onChangeChartWidth:function(){var a=d(window).width()<this.defaults.mobileThreshold;this._chartView.toggleLabels(!a);var b=a?this.defaults.histogramChartMobileHeight:this.defaults.histogramChartHeight;this._chartView.model.set("height",b)}})},{"../histogram/chart":398,"./time-series-header-view":416,"cartodb.js":283,jquery:331}],415:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{}){__p+='<div class="CDB-Widget-header CDB-Widget-header--timeSeries"> ',hasTorqueLayer&&(__p+=' <div class="CDB-Widget-timeSeriesFakeControl"></div> <div class="CDB-Widget-timeSeriesTimeInfo CDB-Widget-timeSeriesTimeInfo--fake"></div> '),__p+=' </div> <div class="CDB-Widget-content CDB-Widget-content--timeSeries"> <div class="CDB-Widget-timeSeriesFakeChart ',hasTorqueLayer&&(__p+="CDB-Widget-timeSeriesFakeChart--torque"),__p+='"> ';for(var i=0;50>i;i++)__p+=' <div class="CDB-Widget-timeSeriesFakeChartItem" style="height: '+(null==(__t=Math.floor(100*Math.random()))?"":_.escape(__t))+'%"></div> ';__p+=" </div> </div>"}return __p}},{underscore:354}],416:[function(a,b,c){var d=a("cartodb.js"),e=a("./time-series-header.tpl"),f=a("d3");b.exports=d.core.View.extend({className:"CDB-Widget-header--timeSeries js-header CDB-Widget-contentSpaced",events:{"click .js-clear":"_onClick"},initialize:function(){this._dataviewModel=this.options.dataviewModel,this._rangeFilter=this.options.rangeFilter,this._rangeFilter.bind("change",this.render,this),this._setupScales()},render:function(){return this.$el.empty(),this._rangeFilter.isEmpty()||this.$el.html(e({timeFormatter:this._timeFormatter,dateFormatter:this._dateFormatter,startDate:new Date(this._scale.invert(this._rangeFilter.get("min"))),endDate:new Date(this._scale.invert(this._rangeFilter.get("max")))})),this},_setupScales:function(){var a=this._dataviewModel.get("data");this._scale=f.time.scale().domain([1e3*a[0].start,1e3*a[a.length-1].end]).nice().range([this._dataviewModel.get("start"),this._dataviewModel.get("end")]),this._timeFormatter=f.time.format("%H:%M"),this._dateFormatter=f.time.format("%x")},_onClick:function(){this.trigger("resetFilter",this)}})},{"./time-series-header.tpl":417,"cartodb.js":283,d3:330}],417:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div> <p class="CDB-Text CDB-Size-large u-iBlock"> Selected from </p> <p class="CDB-Text CDB-Size-large u-secondaryTextColor u-iBlock"> '+(null==(__t=timeFormatter(startDate))?"":_.escape(__t))+" "+(null==(__t=dateFormatter(startDate))?"":_.escape(__t))+' </p> <p class="CDB-Text CDB-Size-large u-iBlock"> to </p> <p class="CDB-Text CDB-Size-large u-secondaryTextColor u-iBlock"> '+(null==(__t=timeFormatter(endDate))?"":_.escape(__t))+" "+(null==(__t=dateFormatter(endDate))?"":_.escape(__t))+' </p> </div> <div> <button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-clear">Clear selection</button> </div>';return __p}},{underscore:354}],418:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js"),f=a("./torque-template.tpl"),g=a("./placeholder.tpl"),h=a("./torque-histogram-view"),i=a("./torque-header-view");b.exports=e.core.View.extend({className:"CDB-Widget-body CDB-Widget-body--timeSeries",initialize:function(){this._dataviewModel=this.model.dataviewModel,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this._initBinds()},render:function(){if(this.clearSubViews(),this._isDataEmpty())this.$el.html(g({hasTorqueLayer:!0}));else{this.$el.html(f());var a=this._dataviewModel.layer;this._appendView(new i({el:this.$(".js-header"),dataviewModel:this._dataviewModel,torqueLayerModel:a}));var b=new h({dataviewModel:this._dataviewModel,rangeFilter:this._dataviewModel.filter,torqueLayerModel:a});this._appendView(b),this.$el.append(b.el)}return this},_initBinds:function(){this._originalData.once("change:data",this._onOriginalDataChange,this),this.add_related_model(this._originalData),this._dataviewModel.once("change:data",this.render,this),this.add_related_model(this._dataviewModel)},_appendView:function(a){this.addView(a),a.render()},_isDataEmpty:function(){var a=this._dataviewModel.getData();return d.isEmpty(a)||0===d.size(a)},_onOriginalDataChange:function(){this._dataviewModel.fetch()}})},{"./placeholder.tpl":415,"./torque-header-view":421,"./torque-histogram-view":422,"./torque-template.tpl":427,"cartodb.js":283,underscore:354}],419:[function(a,b,c){var d=a("cartodb.js"),e=a("./torque-controls.tpl");b.exports=d.core.View.extend({tagName:"button",className:"CDB-Widget-controlButton",events:{click:"_onClick"},initialize:function(){this._torqueLayerModel=this.options.torqueLayerModel,this._torqueLayerModel.bind("change:isRunning",this.render,this),this.add_related_model(this._torqueLayerModel)},render:function(){return this.$el.html(e({iconClass:"CDB-Widget-controlButtonIcon CDB-Widget-controlButtonIcon--"+(this._torqueLayerModel.get("isRunning")?"pause":"play")})),this},_onClick:function(){this._torqueLayerModel.get("isRunning")?this._torqueLayerModel.pause():this._torqueLayerModel.play()}})},{"./torque-controls.tpl":420,"cartodb.js":283}],420:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-controlButtonContent"> <i class="'+(null==(__t=iconClass)?"":_.escape(__t))+'"></i> </div>';return __p}},{underscore:354}],421:[function(a,b,c){var d=a("cartodb.js"),e=a("./torque-controls-view"),f=a("./torque-time-info-view"),g=a("./torque-render-range-info-view"),h=a("./torque-reset-render-range-view");b.exports=d.core.View.extend({initialize:function(){this._dataviewModel=this.options.dataviewModel,this._torqueLayerModel=this.options.torqueLayerModel,this._rangeFilter=this._dataviewModel.filter,this._rangeFilter.bind("change",this.render,this),this.add_related_model(this._rangeFilter)},render:function(){return this.clearSubViews(),this._rangeFilter.isEmpty()?(this.el.classList.remove("CDB-Widget-contentSpaced"),this._appendView(new e({torqueLayerModel:this._torqueLayerModel})),this._appendView(new f({torqueLayerModel:this._torqueLayerModel}))):(this.el.classList.add("CDB-Widget-contentSpaced"),this._appendView(new g({dataviewModel:this._dataviewModel})),this._appendView(new h({torqueLayerModel:this._torqueLayerModel}))),this},_appendView:function(a){this.addView(a),this.$el.append(a.el),a.render()}})},{"./torque-controls-view":419,"./torque-render-range-info-view":423,"./torque-reset-render-range-view":425,"./torque-time-info-view":428,"cartodb.js":283}],422:[function(a,b,c){var d=a("jquery"),e=a("cartodb.js"),f=a("../histogram/chart"),g=a("./torque-time-slider-view");b.exports=e.core.View.extend({className:"CDB-Widget-content CDB-Widget-content--timeSeries",defaults:{mobileThreshold:960,histogramChartHeight:72,histogramChartMobileHeight:24},initialize:function(){if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");if(!this.options.rangeFilter)throw new Error("rangeFilter is required");this._dataviewModel=this.options.dataviewModel,this._rangeFilter=this.options.rangeFilter,this._originalData=this._dataviewModel.getUnfilteredDataModel(),this._torqueLayerModel=this.options.torqueLayerModel,this._initBinds()},render:function(){return this.clearSubViews(),this._createHistogramView(),this},_initBinds:function(){this._torqueLayerModel.bind("change:renderRange",this._onRenderRangeChanged,this),this._torqueLayerModel.bind("change:steps change:start change:end",this._reSelectRange,this),this.add_related_model(this._torqueLayerModel),this._dataviewModel.bind("change:data",this._onChangeData,this),this.add_related_model(this._dataviewModel)},_createHistogramView:function(){this._chartView=new f({type:"time",animationSpeed:100,animationBarDelay:function(a,b){return 3*b},chartBarColorClass:"CDB-Chart-bar--timeSeries",margin:{top:4,right:4,bottom:4,left:4},hasHandles:!0,height:this.defaults.histogramChartHeight,data:this._dataviewModel.getData(),originalData:this._originalData,displayShadowBars:!0}),this.addView(this._chartView),this.$el.append(this._chartView.render().el),this._chartView.show(),this._chartView.bind("on_brush_end",this._onBrushEnd,this),this._chartView.model.bind("change:width",this._onChangeChartWidth,this),this.add_related_model(this._chartView.model);var a=new g({dataviewModel:this._dataviewModel,chartView:this._chartView,torqueLayerModel:this._torqueLayerModel});this.addView(a),a.render()},_onChangeData:function(){this._chartView&&(this._chartView.replaceData(this._dataviewModel.getData()),this._chartView.updateXScale(),this._chartView.updateYScale(),this._reSelectRange())},_onRenderRangeChanged:function(a,b){void 0===b.start&&void 0===b.end&&(this._chartView.removeSelection(),this._rangeFilter.unsetRange())},_onBrushEnd:function(a,b){var c=this._dataviewModel.getData();this._rangeFilter.setRange(c[a].start,c[b-1].end),this._reSelectRange()},timeToStep:function(a){var b=this._torqueLayerModel.get("steps"),c=this._torqueLayerModel.get("start"),d=this._torqueLayerModel.get("end"),e=b*(1e3*a-c)/(d-c);return e},_reSelectRange:function(){if(!this._rangeFilter.isEmpty()){var a=this.timeToStep(this._rangeFilter.get("min")),b=this.timeToStep(this._rangeFilter.get("max")),c=this._torqueLayerModel.get("steps");this._torqueLayerModel.renderRange(this._clampRangeVal(0,c,a),this._clampRangeVal(0,c,b))}},_clampRangeVal:function(a,b,c){return Math.max(a,Math.min(b,c))},_onChangeChartWidth:function(){var a=d(window).width()<this.defaults.mobileThreshold;this._chartView.toggleLabels(!a);var b=a?this.defaults.histogramChartMobileHeight:this.defaults.histogramChartHeight;this._chartView.model.set("height",b)}})},{"../histogram/chart":398,"./torque-time-slider-view":430,"cartodb.js":283,jquery:331}],423:[function(a,b,c){var d=a("cartodb.js"),e=a("d3"),f=a("./torque-render-range-info.tpl");b.exports=d.core.View.extend({initialize:function(){this._dataviewModel=this.options.dataviewModel,this._rangeFilter=this._dataviewModel.filter,this._setupScales(),this._initBinds()},render:function(){return this.$el.html(f({timeFormatter:this._timeFormatter,dateFormatter:this._dateFormatter,startDate:new Date(this._scale.invert(this._rangeFilter.get("min"))),endDate:new Date(this._scale.invert(this._rangeFilter.get("max")))})),this},_initBinds:function(){this._rangeFilter.bind("change",this.render,this),this.add_related_model(this._rangeFilter)},_setupScales:function(){var a=this._dataviewModel.get("data"),b=this._dataviewModel.get("start"),c=this._dataviewModel.get("end");this._scale=e.time.scale().domain([1e3*a[0].start,1e3*a[a.length-1].end]).nice().range([b,c]),this._timeFormatter=e.time.format("%H:%M"),this._dateFormatter=e.time.format("%x")}})},{"./torque-render-range-info.tpl":424,"cartodb.js":283,d3:330}],424:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<p class="CDB-Text CDB-Size-large u-iBlock"> Selected from </p> <p class="CDB-Text CDB-Size-large u-secondaryTextColor u-iBlock"> '+(null==(__t=timeFormatter(startDate))?"":_.escape(__t))+" "+(null==(__t=dateFormatter(startDate))?"":_.escape(__t))+' </p> <p class="CDB-Text CDB-Size-large u-iBlock"> to </p> <p class="CDB-Text CDB-Size-large u-secondaryTextColor u-iBlock"> '+(null==(__t=timeFormatter(endDate))?"":_.escape(__t))+" "+(null==(__t=dateFormatter(endDate))?"":_.escape(__t))+" </p>";return __p}},{underscore:354}],425:[function(a,b,c){var d=a("cartodb.js"),e=a("./torque-reset-render-range.tpl");b.exports=d.core.View.extend({className:"CDB-Widget-filterButtons",events:{"click .js-clear":"_onClick"},initialize:function(){this._torqueLayerModel=this.options.torqueLayerModel},render:function(){return this.$el.html(e()),this},_onClick:function(){this._torqueLayerModel.resetRenderRange()}})},{"./torque-reset-render-range.tpl":426,"cartodb.js":283}],426:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<button class="CDB-Text CDB-Size-small u-upperCase u-actionTextColor CDB-Widget-filterButton js-clear">Clear selection</button>';return __p}},{underscore:354}],427:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<div class="CDB-Widget-header CDB-Widget-header--timeSeries js-header"></div>';return __p}},{underscore:354}],428:[function(a,b,c){var d=a("d3"),e=a("cartodb.js"),f=a("./torque-time-info.tpl");b.exports=e.core.View.extend({className:"CDB-Widget-timeSeriesTimeInfo",initialize:function(){this._torqueLayerModel=this.options.torqueLayerModel,this._torqueLayerModel.bind("change:step",this.render,this),this.add_related_model(this._torqueLayerModel),this._timeFormatter=d.time.format("%H:%M"),this._dateFormatter=d.time.format("%x")},render:function(){var a=this._torqueLayerModel.get("time");return this.$el.html(isNaN(a&&a.getTime())?"":f({time:this._timeFormatter(a),date:this._dateFormatter(a)})),this}})},{"./torque-time-info.tpl":429,"cartodb.js":283,d3:330}],429:[function(require,module,exports){var _=require("underscore");module.exports=function(obj){var __t,__p="";Array.prototype.join;with(obj||{})__p+='<p class="CDB-Text CDB-Size-large u-iBlock"> '+(null==(__t=time)?"":_.escape(__t))+' </p> <p class="CDB-Text CDB-Size-large u-secondaryTextColor u-iBlock u-lSpace"> '+(null==(__t=date)?"":_.escape(__t))+" </p>";return __p}},{underscore:354}],430:[function(a,b,c){var d=a("d3"),e=a("cartodb.js");b.exports=e.core.View.extend({defaults:{width:4,height:8},initialize:function(){if(!this.options.chartView)throw new Error("chartView is required");if(!this.options.torqueLayerModel)throw new Error("torqeLayerModel is required");this.model=new e.core.Model,this._dataviewModel=this.options.dataviewModel,this._chartView=this.options.chartView,this._torqueLayerModel=this.options.torqueLayerModel,this._torqueLayerModel.bind("change:start change:end",this._updateChartandTimeslider,this),this._torqueLayerModel.bind("change:step",this._onChangeStep,this),this._torqueLayerModel.bind("change:steps",this._updateChartandTimeslider,this),this.add_related_model(this._torqueLayerModel),this._chartView.model.bind("change:width",this._updateChartandTimeslider,this),this._chartView.model.bind("change:height",this._onChangeChartHeight,this),this.add_related_model(this._chartView.model),this._dataviewModel.on("change:bins",this._updateChartandTimeslider,this),this.add_related_model(this._dataviewModel),this._dataviewModel.filter.on("change:min change:max",this._onFilterMinMaxChange,this),this.add_related_model(this._dataviewModel.filter),this._updateXScale()},render:function(){if(!this.timeSlider){var a=d.behavior.drag().on("dragstart",this._onDragStart.bind(this)).on("drag",this._onDrag.bind(this)).on("dragend",this._onDragEnd.bind(this)),b=this._chartView.canvas.append("rect");this.timeSlider=b.attr("class","CDB-TimeSlider").attr("width",this.defaults.width).attr("height",this._calcHeight()).attr("rx",3).attr("ry",3).data([{x:0,y:0}]).attr("transform",this._translateXY).call(a)}return this.setElement(b.node()),this},clean:function(){this.timeSlider&&this.timeSlider.remove(),e.core.View.prototype.clean.call(this)},_onDragStart:function(){var a=this._torqueLayerModel.get("isRunning");a&&this._torqueLayerModel.pause(),this.model.set({isDragging:!0,wasRunning:a})},_onDrag:function(a,b){var c=a.x+d.event.dx;if(this._isWithinRange(c)){a.x=c,this.timeSlider.attr("transform",this._translateXY);var e=Math.round(this._xScale.invert(a.x));this._torqueLayerModel.setStep(e)}},_onDragEnd:function(){this.model.set("isDragging",!1),this.model.get("wasRunning")&&this._torqueLayerModel.play()},_translateXY:function(a){return"translate("+[a.x,a.y]+")"},_isWithinRange:function(a){return a>=0&&a<=this._width()},_onChangeStep:function(){if(this.timeSlider&&!this.model.get("isDragging")){var a=this.timeSlider.data(),b=this._xScale(this._torqueLayerModel.get("step"));isNaN(b)||(a[0].x=b,this.timeSlider.data(a).transition().ease("linear").attr("transform",this._translateXY))}},_onFilterMinMaxChange:function(a,b){this.$el.toggle(!b)},_onChangeChartHeight:function(){this.timeSlider.attr("height",this._calcHeight())},_updateChartandTimeslider:function(){this._updateXScale(),this._onChangeStep()},_calcHeight:function(){return this._chartView.chartHeight()+this.defaults.height},_updateXScale:function(){var a=1e3*(this._dataviewModel.get("end")-this._dataviewModel.get("start")),b=(this._torqueLayerModel.get("start")-1e3*this._dataviewModel.get("start"))/a,c=(this._torqueLayerModel.get("end")-1e3*this._dataviewModel.get("start"))/a;this._xScale=d.scale.linear().domain([0,this._torqueLayerModel.get("steps")]).range([b*this._width(),c*this._width()])},_width:function(){return this._chartView.model.get("width")}})},{"cartodb.js":283,d3:330}],431:[function(require,module,exports){require("underscore");module.exports=function(obj){var __p="";Array.prototype.join;with(obj||{})__p+='<button class="CDB-Widget-button CDB-Widget-errorButton js-refresh"> <span class="CDB-Widget-textSmall CDB-Widget-textSmall--bold">REFRESH</span> </button>';return __p}},{underscore:354}],432:[function(a,b,c){var d=a("cartodb.js"),e=a("./widget-error-template.tpl");b.exports=d.core.View.extend({className:"CDB-Widget-error is-hidden",events:{"click .js-refresh":"_onRefreshClick"},initialize:function(){this._initBinds()},render:function(){return this.$el.html(e()),this},_initBinds:function(){this.model.bind("error",function(a,b){(!b||b&&"abort"!==b.statusText)&&this.show()},this),this.model.bind("loading loaded",this.hide,this)},_onRefreshClick:function(){this.model.refresh()},show:function(){this.$el.removeClass("is-hidden")},hide:function(){this.$el.addClass("is-hidden")}})},{"./widget-error-template.tpl":431,"cartodb.js":283}],433:[function(a,b,c){var d=a("cartodb.js");b.exports=d.core.View.extend({className:"CDB-Loader",initialize:function(){this._initBinds()},_initBinds:function(){this.model.bind("loading",this.show,this),this.model.bind("error",function(a,b){(!b||b&&"abort"!==b.statusText)&&this.hide()},this),this.model.bind("loaded",this.hide,this)},show:function(){this.$el.addClass("is-visible"),clearTimeout(this._timeout)},hide:function(){var a=this;this._timeout=setTimeout(function(){a.$el.removeClass("is-visible")},500)}})},{"cartodb.js":283}],434:[function(a,b,c){var d=a("underscore"),e=a("cartodb.js");b.exports=e.core.Model.extend({defaults:{attrsNames:[],show_stats:!1},initialize:function(a,b){this.dataviewModel=b.dataviewModel},update:function(a){var b=d.pick(a,this.get("attrsNames"));return this.set(b),this.dataviewModel.update(a),!(!this.changedAttributes()&&!this.dataviewModel.changedAttributes())},remove:function(){this.dataviewModel.remove(),this.trigger("destroy",this),this.stopListening()}})},{"cartodb.js":283,underscore:354}],435:[function(a,b,c){var d=a("cartodb.js"),e=a("underscore");b.exports=d.core.View.extend({className:"CDB-Widget-tooltip CDB-Widget-tooltip--light CDB-Text CDB-Size-small",options:{attribute:"data-tooltip",offsetX:10,offsetY:-28},initialize:function(a){if(!a.target)throw new Error("target is not defined");this._$target=this.options.target,this._initBinds()},render:function(){var a=this._$target.attr(this.options.attribute);return this.$el.html(a),this},_initBinds:function(){this._$target.hover(e.bind(this.show,this),e.bind(this.hide,this))},_setPosition:function(){var a=this._$target.offset(),b=this.$el.outerWidth();this.$el.css({top:a.top+this.options.offsetY,left:a.left-b/2+this.options.offsetX})},show:function(){this.render(),this._setPosition(),d.core.View.prototype.show.call(this)},clean:function(){this._$target.off("mouseenter mouseleave"),d.core.View.prototype.clean.call(this)}})},{"cartodb.js":283,underscore:354}],436:[function(a,b,c){var d=a("underscore"),e=a("./widget-view"),f=function(a){this.defs=[],d.each(a,function(a){this.addType(a)},this)};f.prototype.DEFAULT_CLASS_NAMES="CDB-Widget CDB-Widget--light",f.prototype.addType=function(a){if(!a.match){if(!a.type)throw new Error("def.type or def.match must be provided for createContentView to work");a.match=function(a){return a.get("type")===this.type}}if(!d.isFunction(a.createContentView))throw new Error("def.createContentView must be a function");this.defs.push(a)},f.prototype.createWidgetView=function(a){var b=d.find(this.defs,function(b){return b.match(a)});if(b){var c={className:this.DEFAULT_CLASS_NAMES,model:a,contentView:b.createContentView(a)};return new e(d.isFunction(b.customizeWidgetAttrs)?b.customizeWidgetAttrs(c):c)}},b.exports=f},{"./widget-view":437,underscore:354}],437:[function(a,b,c){var d=a("cartodb.js"),e=a("./widget-loader-view"),f=a("./widget-error-view");b.exports=d.core.View.extend({className:"CDB-Widget CDB-Widget--light",options:{columns_title:[]},initialize:function(){this.model.dataviewModel&&(this.model.dataviewModel.layer.bind("change:visible",this._onChangeLayerVisible,this),this.listenTo(this.model,"destroy",this.clean))},render:function(){var a=this.model.dataviewModel;return a&&(this._appendView(new e({model:a})),this._appendView(new f({model:a}))),this._appendView(this.options.contentView),this._setVisible(this.model.dataviewModel.layer.get("visible")),this},_appendView:function(a){this.$el.append(a.render().el),this.addView(a)},_setVisible:function(a){this.$el.toggle(a)},_onChangeLayerVisible:function(a){this._setVisible(!!a.get("visible"))}})},{"./widget-error-view":432,"./widget-loader-view":433,"cartodb.js":283}],438:[function(a,b,c){var d=a("underscore"),e=a("backbone");b.exports=e.Collection.extend({comparator:"order",initialize:function(){this._initBinds()},_initBinds:function(){this.bind("change:order",d.debounce(this._onChangeOrder.bind(this),10),this),this.bind("change:isColorsApplied",function(a,b){b&&this.each(function(b){a!==b&&d.isBoolean(b.get("isColorsApplied"))&&b.set("isColorsApplied",!1)})},this)},_onChangeOrder:function(){this.sort(),this.trigger("orderChanged",this)}})},{backbone:322,underscore:354}]},{},[364])(364)});
//# sourceMappingURL=deep-insights.js.map